[{"title":"ã€Œ11ã€å°ç¨‹åºä¹‹å‘Šåˆ« setData","date":"2017-11-23T09:45:00.000Z","path":"2017/11/23/11.say-goodbye-to-mina-setData/","text":"ä¼—æ‰€å‘¨çŸ¥ Vue æ˜¯å€ŸåŠ© ES5 çš„ Object.defineProperty æ–¹æ³•è®¾ç½® getterã€setter è¾¾åˆ°æ•°æ®é©±åŠ¨ç•Œé¢ï¼Œå½“ç„¶å…¶ä¸­è¿˜æœ‰æ¨¡æ¿ç¼–è¯‘ç­‰ç­‰å…¶ä»–è¿‡ç¨‹ã€‚ è€Œå°ç¨‹åºå®˜æ–¹çš„ api æ˜¯åœ¨ Page ä¸­è°ƒç”¨ this.setData æ–¹æ³•æ¥æ”¹å˜æ•°æ®ï¼Œä»è€Œæ”¹å˜ç•Œé¢ã€‚ é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬å°†ä¸¤è€…ç»“åˆä¸€ä¸‹ï¼Œå°† this.setData å°è£…èµ·æ¥ï¼Œå²‚ä¸æ˜¯å¯ä»¥åƒå¼€å‘ Vue åº”ç”¨ä¸€æ ·åœ°ä½¿ç”¨ this.foo = &#39;hello&#39; æ¥å¼€å‘å°ç¨‹åºäº†ï¼Ÿ æ›´è¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥å®ç° h5 å’Œå°ç¨‹åº js éƒ¨åˆ†ä»£ç çš„åŒæ„ æ›´è¿›ä¸€æ­¥åœ°ï¼Œå¢åŠ æ¨¡æ¿ç¼–è¯‘å’Œè§£æå°±å¯ä»¥è¿ wxml/html éƒ¨åˆ†ä¹ŸåŒæ„ æ›´è¿›ä¸€æ­¥åœ°ï¼Œå…¼å®¹ RN/Weex/å¿«åº”ç”¨ æ›´è¿›ä¸€æ­¥åœ°ï¼Œä¸–ç•Œå¤§åŒï¼Œå¤©ä¸‹ä¸ºå…¬ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆå…¨éƒ¨å¤±ä¸šâ€¦23333 0.æºç åœ°å€ github åœ°å€ 1.ç»‘å®šç®€å•å±æ€§ç¬¬ä¸€æ­¥æˆ‘ä»¬å…ˆå®šä¸€ä¸ªå°ç›®æ ‡ï¼šæŒ£ä»–ä¸€ä¸ªäº¿ï¼ï¼ï¼ å¯¹äºç®€å•éåµŒå¥—å±æ€§ï¼ˆéå¯¹è±¡ï¼Œæ•°ç»„ï¼‰ï¼Œç›´æ¥å¯¹å…¶èµ‹å€¼å°±èƒ½æ”¹å˜ç•Œé¢ã€‚ 123&lt;!-- index.wxml --&gt;&lt;view&gt;msg: &#123;&#123; msg &#125;&#125;&lt;/view&gt;&lt;button bindtap=\"tapMsg\"&gt;change msg&lt;/button&gt; 12345678910111213141516// index.jsTuaPage(&#123; data () &#123; return &#123; msg: 'hello world', &#125; &#125;, methods: &#123; tapMsg () &#123; this.msg = this.reverseStr(this.msg) &#125;, reverseStr (str) &#123; return str.split('').reverse().join('') &#125;, &#125;,&#125;) è¿™ä¸€æ­¥å¾ˆç®€å•å•¦ï¼Œç›´æ¥å¯¹äº data ä¸­çš„æ¯ä¸ªå±æ€§éƒ½ç»‘å®šä¸‹ getterã€setterï¼Œåœ¨ setter ä¸­è°ƒç”¨ä¸‹ this.setData å°±å¥½å•¦ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788/** * å°† source ä¸Šçš„å±æ€§ä»£ç†åˆ° target ä¸Š * @param &#123;Object&#125; source è¢«ä»£ç†å¯¹è±¡ * @param &#123;Object&#125; target è¢«ä»£ç†ç›®æ ‡ */const proxyData = (source, target) =&gt; &#123; Object.keys(source).forEach((key) =&gt; &#123; Object.defineProperty( target, key, Object.getOwnPropertyDescriptor(source, key) ) &#125;)&#125;/** * éå†è§‚å¯Ÿ vm.data ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œå¹¶å°†å…¶ç›´æ¥æŒ‚åˆ° vm ä¸Š * @param &#123;Page|Component&#125; vm Page æˆ– Component å®ä¾‹ */const bindData = (vm) =&gt; &#123; const defineReactive = (obj, key, val) =&gt; &#123; Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get () &#123; return val &#125;, set (newVal) &#123; if (newVal === val) return val = newVal vm.setData($data) &#125;, &#125;) &#125; /** * è§‚å¯Ÿå¯¹è±¡ * @param &#123;any&#125; obj å¾…è§‚å¯Ÿå¯¹è±¡ * @return &#123;any&#125; å·²è¢«è§‚å¯Ÿçš„å¯¹è±¡ */ const observe = (obj) =&gt; &#123; const observedObj = Object.create(null) Object.keys(obj).forEach((key) =&gt; &#123; // è¿‡æ»¤ __wxWebviewId__ ç­‰å†…éƒ¨å±æ€§ if (/^__.*__$/.test(key)) return defineReactive( observedObj, key, obj[key] ) &#125;) return observedObj &#125; const $data = observe(vm.data) vm.$data = $data proxyData($data, vm)&#125;/** * é€‚é… Vue é£æ ¼ä»£ç ï¼Œä½¿å…¶æ”¯æŒåœ¨å°ç¨‹åºä¸­è¿è¡Œï¼ˆå‘Šåˆ«ä¸æ–¹ä¾¿çš„ setDataï¼‰ * @param &#123;Object&#125; args Page å‚æ•° */export const TuaPage = (args = &#123;&#125;) =&gt; &#123; const &#123; data: rawData = &#123;&#125;, methods = &#123;&#125;, ...rest &#125; = args const data = typeof rawData === 'function' ? rawData() : rawData Page(&#123; ...rest, ...methods, data, onLoad (...options) &#123; bindData(this) rest.onLoad &amp;&amp; rest.onLoad.apply(this, options) &#125;, &#125;)&#125; 2.ç»‘å®šåµŒå¥—å¯¹è±¡ é‚£ä¹ˆå¦‚æœæ•°æ®æ˜¯åµŒå¥—çš„å¯¹è±¡å’‹åŠå’§ï¼Ÿ å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå’±ä»¬é€’å½’è§‚å¯Ÿä¸€ä¸‹å°±å¥½ã€‚ 123&lt;!-- index.wxml --&gt;&lt;view&gt;a.b: &#123;&#123; a.b &#125;&#125;&lt;/view&gt;&lt;button bindtap=\"tapAB\"&gt;change a.b&lt;/button&gt; 12345678910111213141516// index.jsTuaPage(&#123; data () &#123; return &#123; a: &#123; b: 'this is b' &#125;, &#125; &#125;, methods: &#123; tapAB () &#123; this.a.b = this.reverseStr(this.a.b) &#125;, reverseStr (str) &#123; return str.split('').reverse().join('') &#125;, &#125;,&#125;) observe -&gt; observeDeepï¼šåœ¨ observeDeep ä¸­åˆ¤æ–­æ˜¯å¯¹è±¡å°±é€’å½’è§‚å¯Ÿä¸‹å»ã€‚ 123456789101112131415161718192021222324252627282930// .../** * é€’å½’è§‚å¯Ÿå¯¹è±¡ * @param &#123;any&#125; obj å¾…è§‚å¯Ÿå¯¹è±¡ * @return &#123;any&#125; å·²è¢«è§‚å¯Ÿçš„å¯¹è±¡ */const observeDeep = (obj) =&gt; &#123; if (typeof obj === 'object') &#123; const observedObj = Object.create(null) Object.keys(obj).forEach((key) =&gt; &#123; if (/^__.*__$/.test(key)) return defineReactive( observedObj, key, // -&gt; æ³¨æ„åœ¨è¿™é‡Œé€’å½’ observeDeep(obj[key]), ) &#125;) return observedObj &#125; // ç®€å•å±æ€§ç›´æ¥è¿”å› return obj&#125;// ... 3.åŠ«æŒæ•°ç»„æ–¹æ³•å¤§å®¶éƒ½çŸ¥é“ï¼ŒVue åŠ«æŒäº†ä¸€äº›æ•°ç»„æ–¹æ³•ã€‚å’±ä»¬ä¹Ÿæ¥ä¾è‘«èŠ¦ç”»ç“¢åœ°å®ç°ä¸€ä¸‹~ 1234567891011121314151617181920212223242526272829/** * åŠ«æŒæ•°ç»„çš„æ–¹æ³• * @param &#123;Array&#125; arr åŸå§‹æ•°ç»„ * @return &#123;Array&#125; observedArray è¢«åŠ«æŒæ–¹æ³•åçš„æ•°ç»„ */const observeArray = (arr) =&gt; &#123; const observedArray = arr.map(observeDeep) ;[ 'pop', 'push', 'sort', 'shift', 'splice', 'unshift', 'reverse', ].forEach((method) =&gt; &#123; const original = observedArray[method] observedArray[method] = function (...args) &#123; const result = original.apply(this, args) vm.setData($data) return result &#125; &#125;) return observedArray&#125; å…¶å®ï¼ŒVue è¿˜åšäº†ä¸ªä¼˜åŒ–ï¼Œå¦‚æœå½“å‰ç¯å¢ƒæœ‰ __proto__ å±æ€§ï¼Œé‚£ä¹ˆå°±æŠŠä»¥ä¸Šæ–¹æ³•ç›´æ¥åŠ åˆ°æ•°ç»„çš„åŸå‹é“¾ä¸Šï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ•°ç»„æ•°æ®çš„æ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚ 4.å®ç° computed åŠŸèƒ½computed åŠŸèƒ½æ—¥å¸¸è¿˜è›®å¸¸ç”¨çš„ï¼Œé€šè¿‡å·²æœ‰çš„ data å…ƒæ•°æ®ï¼Œæ´¾ç”Ÿå‡ºä¸€äº›æ–¹ä¾¿çš„æ–°æ•°æ®ã€‚ è¦å®ç°çš„è¯ï¼Œå› ä¸º computed ä¸­çš„æ•°æ®éƒ½å®šä¹‰æˆå‡½æ•°ï¼Œæ‰€ä»¥å…¶å®ç›´æ¥å°†å…¶è®¾ç½®ä¸º getter å°±è¡Œå•¦ã€‚ 12345678910111213141516171819202122232425/** * å°† computed ä¸­å®šä¹‰çš„æ–°å±æ€§æŒ‚åˆ° vm ä¸Š * @param &#123;Page|Component&#125; vm Page æˆ– Component å®ä¾‹ * @param &#123;Object&#125; computed è®¡ç®—å±æ€§å¯¹è±¡ */const bindComputed = (vm, computed) =&gt; &#123; const $computed = Object.create(null) Object.keys(computed).forEach((key) =&gt; &#123; Object.defineProperty($computed, key, &#123; enumerable: true, configurable: true, get: computed[key].bind(vm), set () &#123;&#125;, &#125;) &#125;) proxyData($computed, vm) // æŒ‚åˆ° $data ä¸Šï¼Œè¿™æ ·åœ¨ data ä¸­æ•°æ®å˜åŒ–æ—¶å¯ä»¥ä¸€èµ·è¢« setData proxyData($computed, vm.$data) // åˆå§‹åŒ– vm.setData($computed)&#125; 5.å®ç° watch åŠŸèƒ½æ¥ä¸‹æ¥åˆæ˜¯ä¸€ä¸ªç‚’é¸¡å¥½ç”¨çš„ watch åŠŸèƒ½ï¼Œå³ç›‘å¬ data æˆ– computed ä¸­çš„æ•°æ®ï¼Œåœ¨å…¶å˜åŒ–çš„æ—¶å€™è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶ä¼ å…¥ newVal å’Œ oldValã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152const defineReactive = (obj, key, val) =&gt; &#123; Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get () &#123; return val &#125;, set (newVal) &#123; if (newVal === val) return // è¿™é‡Œä¿å­˜ oldVal const oldVal = val val = newVal vm.setData($data) // å®ç° watch data å±æ€§ const watchFn = watch[key] if (typeof watchFn === 'function') &#123; watchFn.call(vm, newVal, oldVal) &#125; &#125;, &#125;)&#125;const bindComputed = (vm, computed, watch) =&gt; &#123; const $computed = Object.create(null) Object.keys(computed).forEach((key) =&gt; &#123; // è¿™é‡Œä¿å­˜ oldVal let oldVal = computed[key].call(vm) Object.defineProperty($computed, key, &#123; enumerable: true, configurable: true, get () &#123; const newVal = computed[key].call(vm) // å®ç° watch computed å±æ€§ const watchFn = watch[key] if (typeof watchFn === 'function' &amp;&amp; newVal !== oldVal) &#123; watchFn.call(vm, newVal, oldVal) &#125; // é‡ç½® oldVal oldVal = newVal return newVal &#125;, set () &#123;&#125;, &#125;) &#125;) // ...&#125; çœ‹ä¼¼ä¸é”™ï¼Œå®åˆ™ä¸ç„¶ã€‚ å’±ä»¬ç°åœ¨ç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•ç›‘å¬ç±»ä¼¼ â€˜a.bâ€™ è¿™æ ·çš„åµŒå¥—æ•°æ®ï¼Ÿ è¿™ä¸ªé—®é¢˜çš„åŸå› åœ¨äºæˆ‘ä»¬åœ¨é€’å½’éå†æ•°æ®çš„æ—¶å€™æ²¡æœ‰è®°å½•ä¸‹è·¯å¾„ã€‚ 6.è®°å½•è·¯å¾„è§£å†³è¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾ï¼Œå…¶å®æˆ‘ä»¬åªè¦åœ¨é€’å½’è§‚å¯Ÿçš„æ¯ä¸€æ­¥ä¸­ä¼ é€’ key å³å¯ï¼Œæ³¨æ„å¯¹äºæ•°ç»„ä¸­çš„åµŒå¥—å…ƒç´ ä¼ é€’çš„æ˜¯ [${index}]ã€‚ å¹¶ä¸”ä¸€æ—¦æˆ‘ä»¬çŸ¥é“äº†æ•°æ®çš„è·¯å¾„ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥æé«˜ setData çš„æ€§èƒ½ã€‚ å› ä¸ºæˆ‘ä»¬å¯ä»¥ç²¾ç»†åœ°è°ƒç”¨ vm.setData({ [prefix]: newVal }) ä¿®æ”¹å…¶ä¸­çš„éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ª $data \béƒ½ setDataã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102const defineReactive = (obj, key, val, path) =&gt; &#123; Object.defineProperty(obj, key, &#123; // ... set (newVal) &#123; // ... vm.setData(&#123; // å› ä¸ºä¸çŸ¥é“ä¾èµ–æ‰€ä»¥æ›´æ–°æ•´ä¸ª computed ...vm.$computed, // ç›´æ¥ä¿®æ”¹ç›®æ ‡æ•°æ® [path]: newVal, &#125;) // é€šè¿‡è·¯å¾„æ¥æ‰¾ watch ç›®æ ‡ const watchFn = watch[path] if (typeof watchFn === 'function') &#123; watchFn.call(vm, newVal, oldVal) &#125; &#125;, &#125;)&#125;const observeArray = (arr, path) =&gt; &#123; const observedArray = arr.map( // æ³¨æ„è¿™é‡Œçš„è·¯å¾„æ‹¼æ¥ (item, idx) =&gt; observeDeep(item, `$&#123;path&#125;[$&#123;idx&#125;]`) ) ;[ 'pop', 'push', 'sort', 'shift', 'splice', 'unshift', 'reverse', ].forEach((method) =&gt; &#123; const original = observedArray[method] observedArray[method] = function (...args) &#123; const result = original.apply(this, args) vm.setData(&#123; // å› ä¸ºä¸çŸ¥é“ä¾èµ–æ‰€ä»¥æ›´æ–°æ•´ä¸ª computed ...vm.$computed, // ç›´æ¥ä¿®æ”¹ç›®æ ‡æ•°æ® [path]: observedArray, &#125;) return result &#125; &#125;) return observedArray&#125;const observeDeep = (obj, prefix = '') =&gt; &#123; if (Array.isArray(obj)) &#123; return observeArray(obj, prefix) &#125; if (typeof obj === 'object') &#123; const observedObj = Object.create(null) Object.keys(obj).forEach((key) =&gt; &#123; if (/^__.*__$/.test(key)) return const path = prefix === '' ? key : `$&#123;prefix&#125;.$&#123;key&#125;` defineReactive( observedObj, key, observeDeep(obj[key], path), path, ) &#125;) return observedObj &#125; return obj&#125;/** * å°† computed ä¸­å®šä¹‰çš„æ–°å±æ€§æŒ‚åˆ° vm ä¸Š * @param &#123;Page|Component&#125; vm Page æˆ– Component å®ä¾‹ * @param &#123;Object&#125; computed è®¡ç®—å±æ€§å¯¹è±¡ * @param &#123;Object&#125; watch ä¾¦å¬å™¨å¯¹è±¡ */const bindComputed = (vm, computed, watch) =&gt; &#123; // ... proxyData($computed, vm) // æŒ‚åœ¨ vm ä¸Šï¼Œåœ¨ data å˜åŒ–æ—¶é‡æ–° setData vm.$computed = $computed // åˆå§‹åŒ– vm.setData($computed)&#125; 7.å¼‚æ­¥ setDataç›®å‰çš„ä»£ç è¿˜æœ‰ä¸ªé—®é¢˜ï¼šæ¯æ¬¡å¯¹äº data æŸä¸ªæ•°æ®çš„ä¿®æ”¹éƒ½ä¼šè§¦å‘ setDataï¼Œé‚£ä¹ˆå‡å¦‚åå¤\båœ°ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®ï¼Œå°±ä¼šé¢‘ç¹åœ°è§¦å‘ setDataã€‚å¹¶ä¸”æ¯ä¸€æ¬¡ä¿®æ”¹æ•°æ®éƒ½ä¼šè§¦å‘ watch çš„ç›‘å¬â€¦ è€Œè¿™æ°æ°æ˜¯ä½¿ç”¨å°ç¨‹åº setData api çš„å¤§å¿Œï¼š æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¿™ä¸‰ç§å¸¸è§çš„ setData æ“ä½œé”™è¯¯ï¼š é¢‘ç¹çš„å» setData æ¯æ¬¡ setData éƒ½ä¼ é€’å¤§é‡æ–°æ•°æ® åå°æ€é¡µé¢è¿›è¡Œ setData è®¡å°†å®‰å‡ºï¼Ÿ \bç­”æ¡ˆå°±æ˜¯ç¼“å­˜ä¸€ä¸‹ï¼Œå¼‚æ­¥æ‰§è¡Œ setData~ 12345678910111213141516171819202122232425262728293031323334let newState = null/** * å¼‚æ­¥ setData æé«˜æ€§èƒ½ */const asyncSetData = (&#123; vm, newData, watchFn, prefix, oldVal,&#125;) =&gt; &#123; newState = &#123; ...newState, ...newData, &#125; // TODO: Promise -&gt; MutationObserve -&gt; setTimeout Promise.resolve().then(() =&gt; &#123; if (!newState) return vm.setData(&#123; // å› ä¸ºä¸çŸ¥é“ä¾èµ–æ‰€ä»¥æ›´æ–°æ•´ä¸ª computed ...vm.$computed, ...newState, &#125;) if (typeof watchFn === 'function') &#123; watchFn.call(vm, newState[prefix], oldVal) &#125; newState = null &#125;)&#125; åœ¨ Vue ä¸­å› ä¸ºå…¼å®¹æ€§é—®é¢˜ï¼Œ\bä¼˜å…ˆé€‰æ‹©ä½¿ç”¨ Promise.thenï¼Œå…¶æ¬¡æ˜¯ MutationObserveï¼Œæœ€åæ‰æ˜¯ setTimeoutã€‚ å› ä¸º Promise.then å’Œ MutationObserve å±äº microtaskï¼Œè€Œ setTimeout å±äº taskã€‚ ä¸ºå•¥è¦ç”¨ microtask ï¼Ÿ æ ¹æ® HTML Standardï¼Œåœ¨æ¯ä¸ª task è¿è¡Œå®Œä»¥åï¼ŒUI éƒ½ä¼šé‡æ¸²æŸ“ï¼Œé‚£ä¹ˆåœ¨ microtask ä¸­å°±å®Œæˆæ•°æ®æ›´æ–°ï¼Œå½“å‰ task ç»“æŸå°±å¯ä»¥å¾—åˆ°æœ€æ–°çš„ UI äº†ã€‚åä¹‹å¦‚æœæ–°å»ºä¸€ä¸ª task æ¥åšæ•°æ®æ›´æ–°ï¼Œé‚£ä¹ˆæ¸²æŸ“å°±ä¼šè¿›è¡Œä¸¤æ¬¡ã€‚ï¼ˆå½“ç„¶ï¼Œæµè§ˆå™¨å®ç°æœ‰ä¸å°‘ä¸ä¸€è‡´çš„åœ°æ–¹ï¼‰ æœ‰å…´è¶£çš„è¯æ¨èçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼šTasks, microtasks, queues and schedules 8.ä»£ç é‡æ„ä¹‹å‰çš„ä»£ç ä¸ºäº†æ–¹ä¾¿åœ°è·å– vm å’Œ watchï¼Œåœ¨ bindData å‡½æ•°ä¸­åˆå®šä¹‰äº†ä¸‰ä¸ªå‡½æ•°ï¼Œæ•´ä¸ªä»£ç è€¦åˆåº¦å¤ªé«˜äº†ï¼Œå‡½æ•°ä¾èµ–å¾ˆä¸æ˜ç¡®ã€‚ 1234567// ä»£ç è€¦åˆåº¦å¤ªé«˜const bindData = (vm, watch) =&gt; &#123; const defineReactive = () =&gt; &#123;&#125; const observeArray = () =&gt; &#123;&#125; const observeDeep = () =&gt; &#123;&#125; // ...&#125; è¿™æ ·åœ¨ä¸‹ä¸€æ­¥ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™å¾ˆéº»çƒ¦ã€‚ ä¸ºäº†å†™æµ‹è¯•è®©å’±ä»¬æ¥é‡æ„ä¸€æŠŠï¼Œåˆ©ç”¨å­¦ä¹ è¿‡çš„å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„é«˜é˜¶å‡½æ•°æŠŠä¾èµ–æ³¨å…¥ã€‚ 1234567891011121314151617181920212223242526// é«˜é˜¶å‡½æ•°ï¼Œä¼ é€’ vm å’Œ watch ç„¶åå¾—åˆ° asyncSetDataconst getAsyncSetData = (vm, watch) =&gt; (&#123; ... &#125;) =&gt; &#123; ... &#125;// ä» bindData ä¸­ç§»å‡ºæ¥// åŸæ¥æ”¾åœ¨é‡Œé¢å°±æ˜¯ä¸ºäº†è·å– vmï¼Œ\bç„¶åè°ƒç”¨ vm.setData// ä»¥åŠé€šè¿‡ watch è·å–ç›‘å¬å‡½æ•°const defineReactive = (&#123; // ... asyncSetData, // ä¸ä¼  vm æ”¹æˆä¼ é€’ asyncSetData&#125;) =&gt; &#123; ... &#125;// åŒç†const observeArray = (&#123; // ... asyncSetData, // åŒç†&#125;) =&gt; &#123; ... &#125;// åŒæ ·å¤–ç§»ï¼Œå› ä¸ºä¾èµ–å·²æ³¨å…¥äº† asyncSetDataconst getObserveDeep = (asyncSetData) =&gt; &#123; ... &#125;// å‡½æ•°å¤–ç§»åä»£ç é€»è¾‘æ›´åŠ æ¸…æ™°ç²¾ç®€const bindData = (vm, observeDeep) =&gt; &#123; const $data = observeDeep(vm.data) vm.$data = $data proxyData($data, vm)&#125; é«˜é˜¶å‡½æ•°æ˜¯ä¸æ˜¯å¾ˆè…»å®³ï¼ä»£ç ç¬é—´å°±åœ¨æ²¡äº‹çš„æ—¶å€™ï¼Œåœ¨æƒ³çš„æ—¶å€™ï¼Œåˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä¸ç›¸åŒçš„åœ°æ–¹ï¼Œåˆ°è¿™ä¸ªåœ°æ–¹ï¼Œæ¥äº†å§ï¼å¯ä»¥ç§ä¸€ç§ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œä¸ç›¸åŒçš„åœ°æ–¹ï¼Œæ”¹å˜äº†å¾ˆå¤šå¾ˆå¤š é‚£ä¹ˆæ¥ä¸‹æ¥ä½ ä¸€å®šä¼šå·å·åœ°é—®è‡ªå·±ï¼Œè¿™ä¹ˆè…»å®³çš„æŠ€æœ¯è¦å»å“ªé‡Œå­¦å‘¢ï¼Ÿ slide JavaScript å‡½æ•°å¼ç¼–ç¨‹ï¼ˆä¸€ï¼‰ JavaScript å‡½æ•°å¼ç¼–ç¨‹ï¼ˆäºŒï¼‰ JavaScript å‡½æ•°å¼ç¼–ç¨‹ï¼ˆä¸‰ï¼‰ï¼Œæ­£åœ¨åˆ¶ä½œ slide ä¸­â€¦ 9.ä¾èµ–æ”¶é›†å…¶å®ä»¥ä¸Šä»£ç è¿˜æœ‰ä¸€ä¸ªç›®å‰è§£å†³ä¸äº†çš„é—®é¢˜ï¼šæˆ‘ä»¬ä¸çŸ¥é“ computed é‡Œå®šä¹‰çš„å‡½æ•°çš„ä¾èµ–æ˜¯ä»€ä¹ˆã€‚æ‰€ä»¥åœ¨ data æ•°æ®æ›´æ–°çš„æ—¶å€™æˆ‘ä»¬åªå¥½å…¨éƒ¨å†ç®—ä¸€éã€‚ ä¹Ÿå°±æ˜¯è¯´å½“ data ä¸­çš„æŸä¸ªæ•°æ®æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒä¼šå½±å“å“ªä¸ª computed ä¸­çš„å±æ€§ï¼Œç‰¹åˆ«çš„è¿˜æœ‰ computed ä¾èµ–äº computed çš„æƒ…å†µã€‚ è®¡å°†å®‰å‡ºï¼Ÿ ä¸”å¬ä¸‹å›åˆ†è§£~æºœäº†æºœäº†ï¼Œå˜¿å˜¿å˜¿â€¦ ä»¥ä¸Š to be continuedâ€¦","tags":[{"name":"tua-mp","slug":"tua-mp","permalink":"https://buptsteve.github.io/blog/tags/tua-mp/"},{"name":"å°ç¨‹åº","slug":"å°ç¨‹åº","permalink":"https://buptsteve.github.io/blog/tags/å°ç¨‹åº/"}]},{"title":"ã€Œ10ã€JavaScript å‡½æ•°å¼ç¼–ç¨‹ï¼ˆäºŒï¼‰","date":"2017-11-23T09:45:00.000Z","path":"2017/11/23/10.fp-in-js-2/","text":"slide åœ°å€ ä¸‰ã€å¯ä»¥ï¼Œè¿™å¾ˆå‡½æ•°å¼~3.1.å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼3.1.1.æ»¥ç”¨åŒ¿åå‡½æ•°å…¶å®ç»å¸¸å†™ JavaScript çš„äººå¯èƒ½æ½œç§»é»˜åŒ–åœ°å·²ç»æ¥å—äº†è¿™ä¸ªè§‚å¿µï¼Œä¾‹å¦‚ä½ å¯ä»¥åƒå¯¹å¾…ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·å¯¹å¾…å‡½æ•°â€”â€”æŠŠå®ƒä»¬å­˜åœ¨æ•°ç»„é‡Œï¼Œå½“ä½œå‚æ•°ä¼ é€’ï¼Œèµ‹å€¼ç»™å˜é‡.ç­‰ç­‰ã€‚ ç„¶è€Œï¼Œå¸¸å¸¸å¯ä»¥çœ‹åˆ°æ»¥ç”¨åŒ¿åå‡½æ•°çš„ç°è±¡â€¦ 1234567891011121314151617// å¤ªå‚»äº†const getServerStuff = function (callback) &#123; return ajaxCall(function (json) &#123; return callback(json) &#125;)&#125;// è¿™æ‰åƒæ ·const getServerStuff = ajaxCall// ä¸‹é¢æ¥æ¨å¯¼ä¸€ä¸‹...const getServerStuff === callback =&gt; ajaxCall(json =&gt; callback(json)) === callback =&gt; ajaxCall(callback) === ajaxCall// from JSå‡½æ•°å¼ç¼–ç¨‹æŒ‡å— å†æ¥çœ‹ä¸€ä¸ªä¾‹å­â€¦ 1234567891011121314151617181920212223242526272829303132333435363738const BlogController = (function () &#123; const index = function (posts) &#123; return Views.index(posts) &#125; const show = function (post) &#123; return Views.show(post) &#125; const create = function (attrs) &#123; return Db.create(attrs) &#125; const update = function (post, attrs) &#123; return Db.update(post, attrs) &#125; const destroy = function (post) &#123; return Db.destroy(post) &#125; return &#123; index, show, create, update, destroy &#125;&#125;)()// ä»¥ä¸Šä»£ç  99% éƒ½æ˜¯å¤šä½™çš„...const BlogController = &#123; index: Views.index, show: Views.show, create: Db.create, update: Db.update, destroy: Db.destroy,&#125;// ...æˆ–è€…ç›´æ¥å…¨éƒ¨åˆ æ‰// å› ä¸ºå®ƒçš„ä½œç”¨ä»…ä»…å°±æ˜¯æŠŠè§†å›¾ï¼ˆViewsï¼‰å’Œæ•°æ®åº“ï¼ˆDbï¼‰æ‰“åŒ…åœ¨ä¸€èµ·è€Œå·²ã€‚// from JSå‡½æ•°å¼ç¼–ç¨‹æŒ‡å— 3.1.2.ä¸ºä½•é’Ÿçˆ±ä¸€ç­‰å…¬æ°‘ï¼Ÿä»¥ä¸Šé‚£ç§å¤šåŒ…ä¸€å±‚çš„å†™æ³•æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼Œä¸€æ—¦å†…éƒ¨å‡½æ•°éœ€è¦æ–°å¢æˆ–ä¿®æ”¹å‚æ•°ï¼Œé‚£ä¹ˆåŒ…è£¹å®ƒçš„å‡½æ•°ä¹Ÿè¦æ”¹â€¦ 12345678910111213// åŸå§‹å‡½æ•°httpGet('/post/2', function (json) &#123; return renderPost(json)&#125;)// å‡å¦‚éœ€è¦å¤šä¼ é€’ä¸€ä¸ª err å‚æ•°httpGet('/post/2', function (json, err) &#123; return renderPost(json, err)&#125;)// renderPost å°†ä¼šåœ¨ httpGet ä¸­è°ƒç”¨ï¼Œ// æƒ³è¦å¤šå°‘å‚æ•°ï¼Œæƒ³æ€ä¹ˆæ”¹éƒ½è¡ŒhttpGet('/post/2', renderPost) 3.1.3.æé«˜å‡½æ•°å¤ç”¨ç‡é™¤äº†ä¸Šé¢è¯´çš„é¿å…ä½¿ç”¨ä¸å¿…è¦çš„ä¸­é—´å‡½æ•°åŒ…è£¹ä»¥å¤–ï¼Œå¯¹äºå‡½æ•°å‚æ•°çš„èµ·åä¹Ÿå¾ˆé‡è¦ï¼Œå°½é‡ç¼–å†™é€šç”¨å‚æ•°çš„å‡½æ•°ã€‚ 12345678910111213// åªé’ˆå¯¹å½“å‰çš„åšå®¢const validArticles = function (articles) &#123; return articles.filter(function (article) &#123; return article !== null &amp;&amp; article !== undefined &#125;)&#125;// é€šç”¨æ€§å¥½å¤ªå¤šconst compact = function(xs) &#123; return xs.filter(function (x) &#123; return x !== null &amp;&amp; x !== undefined &#125;)&#125; ä»¥ä¸Šä¾‹å­è¯´æ˜äº†åœ¨å‘½åçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç‰¹åˆ«å®¹æ˜“æŠŠè‡ªå·±é™å®šåœ¨ç‰¹å®šçš„æ•°æ®ä¸Šï¼ˆæœ¬ä¾‹ä¸­æ˜¯ articlesï¼‰ã€‚è¿™ç§ç°è±¡å¾ˆå¸¸è§ï¼Œä¹Ÿæ˜¯é‡å¤é€ è½®å­çš„ä¸€å¤§åŸå› ã€‚ 3.1.4.this åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå…¶å®æ ¹æœ¬ç”¨ä¸åˆ° thisâ€¦ ä½†è¿™é‡Œå¹¶ä¸æ˜¯è¯´è¦é¿å…ä½¿ç”¨ thisï¼ˆæ±Ÿæ¥æŠ¥é“ä¸Šå‡ºäº†åå·®â€¦è¯†å¾—å””è¯†å¾—ï¼Ÿï¼‰ 3.2.æŸ¯é‡ŒåŒ–ï¼ˆcurryï¼‰3.2.1.æŸ¯é‡ŒåŒ–æ¦‚å¿µ æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆä¸€ç³»åˆ—æ¥å—å•ä¸€å‚æ•°ï¼ˆä»æœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¼€å§‹ï¼‰çš„å‡½æ•°çš„æŠ€æœ¯ã€‚ï¼ˆæ³¨æ„æ˜¯å•ä¸€å‚æ•°ï¼‰ 12345678910import &#123; curry &#125; from 'lodash'const add = (x, y) =&gt; x + yconst curriedAdd = curry(add)const increment = curriedAdd(1)const addTen = curriedAdd(10)increment(2) // 3addTen(2) // 12 æŸ¯é‡ŒåŒ–æ˜¯ç”± Christopher Strachey ä»¥é€»è¾‘å­¦å®¶ Haskell Curry å‘½åçš„ï¼Œå½“ç„¶ç¼–ç¨‹è¯­è¨€ Haskell ä¹Ÿæ˜¯æºè‡ªä»–çš„åå­—ï¼Œè™½ç„¶æŸ¯é‡ŒåŒ–æ˜¯ç”± Moses Schnfinkel å’Œ Gottlob Frege å‘æ˜çš„ã€‚ 3.2.2.æŸ¯é‡ŒåŒ– VS åå‡½æ•°åº”ç”¨ï¼ˆpartial applicationï¼‰ In computer science, partial application (or partial function application) refers to the process of fixing a number of arguments to a function, producing another function of smaller arity. by wikipedia åå‡½æ•°åº”ç”¨ç®€å•æ¥è¯´å°±æ˜¯ï¼šä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå¤šå‚æ•°çš„å‡½æ•°ä¸”ä¼ å…¥éƒ¨åˆ†å‚æ•°åï¼Œè¿”å›ä¸€ä¸ªéœ€è¦æ›´å°‘å‚æ•°çš„æ–°å‡½æ•°ã€‚ æŸ¯é‡ŒåŒ–ä¸€èˆ¬å’Œåå‡½æ•°åº”ç”¨ç›¸ä¼´å‡ºç°ï¼Œä½†è¿™ä¸¤è€…æ˜¯ä¸åŒçš„æ¦‚å¿µï¼š 12345678import &#123; curry, partial &#125; from 'lodash'const add = (x, y, z) =&gt; x + y + zconst curriedAdd = curry(add) // &lt;- åªæ¥å—ä¸€ä¸ªå‡½æ•°const addThree = partial(add, 1, 2) // &lt;- ä¸ä»…æ¥å—å‡½æ•°ï¼Œè¿˜æ¥å—è‡³å°‘ä¸€ä¸ªå‚æ•° === curriedAdd(1)(2) // &lt;- æŸ¯é‡ŒåŒ–æ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªå•å‚å‡½æ•° ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªå¤šå‚å‡½æ•°ï¼ˆn-aryï¼‰ï¼ŒæŸ¯é‡ŒåŒ–åå°±å˜æˆäº† n * 1-aryï¼Œè€Œåå‡½æ•°åº”ç”¨äº† x ä¸ªå‚æ•°åå°±å˜æˆäº† (n-x)-ary 3.2.3.æŸ¯é‡ŒåŒ–çš„å®ç°è™½ç„¶ä»ç†è®ºä¸Šè¯´æŸ¯é‡ŒåŒ–åº”è¯¥è¿”å›çš„æ˜¯ä¸€ç³»åˆ—çš„å•å‚å‡½æ•°ï¼Œä½†åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ºäº†åƒåå‡½æ•°åº”ç”¨é‚£æ ·æ–¹ä¾¿çš„è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡ŒæŸ¯é‡ŒåŒ–åçš„å‡½æ•°ä¹Ÿèƒ½æ¥å—å¤šä¸ªå‚æ•°ã€‚ 1234567891011// å®ç°ä¸€ä¸ªå‡½æ•° curry æ»¡è¶³ä»¥ä¸‹è°ƒç”¨ã€const f = (a, b, c d) =&gt; &#123; ... &#125;const curried = curry(f)curried(a, b, c, d)curried(a, b, c)(d)curried(a)(b, c, d)curried(a, b)(c, d)curried(a)(b, c)(d)curried(a)(b)(c, d)curried(a, b)(c)(d) å¾ˆæ˜æ˜¾ç¬¬ä¸€ååº”æ˜¯éœ€è¦ä½¿ç”¨é€’å½’ï¼Œè¿™æ ·æ‰èƒ½è¿”å›ä¸€ç³»åˆ—çš„å‡½æ•°ã€‚è€Œé€’å½’çš„ç»“æŸæ¡ä»¶å°±æ˜¯æ¥å—äº†åŸå‡½æ•°æ•°é‡çš„å‚æ•°ï¼Œæ‰€ä»¥é‡ç‚¹å°±æ˜¯å‚æ•°çš„ä¼ é€’~ 123456789101112131415161718192021// ES5var curry = function curry (fn, arr) &#123; arr = arr || [] return function () &#123; var args = [].slice.call(arguments) return function (arg) &#123; return arg.length === fn.length ? fn.apply(null, arg) : curry(fn, arg) &#125;(arr.concat(args)) &#125;&#125;// ES6const curry = (fn, arr = []) =&gt; (...args) =&gt; ( arg =&gt; arg.length === fn.length ? fn(...arg) : curry(fn, arg))([...arr, ...args]) 3.2.4.æŸ¯é‡ŒåŒ–çš„æ„ä¹‰å†™ä¹ æƒ¯äº†ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€çš„äººçš„ç¬¬ä¸€ååº”ä¸€èˆ¬éƒ½æ˜¯ï¼ŒæŸ¯é‡ŒåŒ–è¿™ç©æ„å„¿æœ‰å•¥ç”¨å’§ï¼Ÿ æŸ¯é‡ŒåŒ–å’Œåå‡½æ•°åº”ç”¨çš„ä¸»è¦æ„ä¹‰å°±æ˜¯å›ºå®šä¸€äº›æˆ‘ä»¬å·²çŸ¥çš„å‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªå‡½æ•°ç»§ç»­ç­‰å¾…æ¥æ”¶é‚£äº›æœªçŸ¥çš„å‚æ•°ã€‚ æ‰€ä»¥å¸¸è§çš„ä½¿ç”¨åœºæ™¯ä¹‹ä¸€å°±æ˜¯é«˜çº§æŠ½è±¡åçš„ä»£ç å¤ç”¨ã€‚ä¾‹å¦‚é¦–å…ˆç¼–å†™ä¸€ä¸ªå¤šå‚æ•°çš„é€šç”¨å‡½æ•°ï¼Œå°†å…¶æŸ¯é‡ŒåŒ–åï¼Œå°±å¯ä»¥åŸºäºåå‡½æ•°åº”ç”¨å°†å…¶ç»‘å®šä¸åŒçš„ä¸šåŠ¡ä»£ç ã€‚ 1234567891011121314151617181920// å®šä¹‰é€šç”¨å‡½æ•°const converter = ( toUnit, factor, offset = 0, input) =&gt; ([ ((offset + input) * factor).toFixed(2), toUnit,].join(' '))// åˆ†åˆ«ç»‘å®šä¸åŒå‚æ•°const milesToKm = curry(converter)('km', 1.60936, undefined)const poundsToKg = curry(converter)('kg', 0.45460, undefined)const farenheitToCelsius = curry(converter)('degrees C', 0.5556, -32)-- from https://stackoverflow.com/a/6861858 ä½ å¯èƒ½ä¼šåé©³è¯´å…¶å®ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è¿™äº›èŠ±é‡Œèƒ¡å“¨çš„æŸ¯é‡ŒåŒ–å•Šï¼Œåå‡½æ•°åº”ç”¨å•Šä»€ä¹ˆçš„ä¸œä¸œï¼Œæˆ‘å°±é“å¤´å¨ƒæ„£å¤´é’åœ°ç›´æ¥æ€¼ä¹Ÿèƒ½å®ç°ä»¥ä¸Šçš„é€»è¾‘ã€‚ï¼ˆè¿™ä¸€æ‰‹çš®çš„å˜›ï¼Œå°±ä¸è°ˆäº†â€¦ï¼‰ 12345678910function converter (ratio, symbol, input) &#123; return (input * ratio).toFixed(2) + ' ' + symbol&#125;converter(2.2, 'lbs', 4)converter(1.62, 'km', 34)converter(1.98, 'US pints', 2.4)converter(1.75, 'imperial pints', 2.4)-- from https://stackoverflow.com/a/32379766 ç„¶è€Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œå‡å¦‚å‡½æ•° converter æ‰€éœ€çš„å‚æ•°æ— æ³•åŒæ—¶å¾—åˆ°ï¼Œå¯¹æŸ¯é‡ŒåŒ–çš„æ–¹å¼æ¥è¯´æ²¡æœ‰å½±å“ï¼Œå› ä¸ºå·²ç»ç”¨é—­åŒ…ä¿å­˜ä½äº†å·²çŸ¥å‚æ•°ã€‚è€Œåè€…å¯èƒ½å°±éœ€è¦ä½¿ç”¨å˜é‡æš‚å­˜æˆ–å…¶ä»–æ–¹æ³•æ¥ä¿è¯åŒæ—¶å¾—åˆ°æ‰€æœ‰å‚æ•°ã€‚ 3.3.å‡½æ•°ç»„åˆï¼ˆcomposeï¼‰3.3.1.ç»„åˆçš„æ¦‚å¿µå‡½æ•°ç»„åˆå°±æ˜¯å°†ä¸¤ä¸ªæˆ–å¤šä¸ªå‡½æ•°ç»“åˆèµ·æ¥å½¢æˆä¸€ä¸ªæ–°å‡½æ•°ã€‚ å°±å¥½åƒå°†ä¸€èŠ‚ä¸€èŠ‚çš„ç®¡é“è¿æ¥èµ·æ¥ï¼ŒåŸå§‹æ•°æ®ç»è¿‡è¿™ä¸€èŠ‚ä¸€èŠ‚çš„ç®¡é“å¤„ç†ä¹‹åå¾—åˆ°æœ€ç»ˆç»“æœã€‚ è¯´èµ·æ¥å¾ˆç„ä¹ï¼Œå…¶å®å°±æ˜¯å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•° f å’Œå¦ä¸€ä¸ªå‡½æ•° gï¼Œè¿˜æœ‰æ•°æ® xï¼Œç»è¿‡è®¡ç®—æœ€ç»ˆç»“æœå°±æ˜¯ f(g(x))ã€‚ åœ¨é«˜ä¸­æ•°å­¦ä¸­æˆ‘ä»¬åº”è¯¥éƒ½å­¦åˆ°è¿‡å¤åˆå‡½æ•°ã€‚ å¦‚æœ y æ˜¯ w çš„å‡½æ•°ï¼Œw åˆæ˜¯ x çš„å‡½æ•°ï¼Œå³ y = f(w), w = g(x)ï¼Œé‚£ä¹ˆ y å…³äº x çš„å‡½æ•° y = f[g(x)] å«åšå‡½æ•° y = f(w) å’Œ w = g(x) çš„å¤åˆå‡½æ•°ã€‚å…¶ä¸­ w æ˜¯ä¸­é—´å˜é‡ï¼Œx æ˜¯è‡ªå˜é‡ï¼Œy æ˜¯å‡½æ•°å€¼ã€‚ æ­¤å¤–åœ¨ç¦»æ•£æ•°å­¦é‡Œï¼Œåº”è¯¥è¿˜å­¦è¿‡å¤åˆå‡½æ•° f(g(h(x))) å¯è®°ä¸º (f â—‹ g â—‹ h)(x)ã€‚ï¼ˆå…¶å®è¿™å°±æ˜¯å‡½æ•°ç»„åˆï¼‰ 3.3.2.ç»„åˆçš„å®ç° 1234567891011121314151617181920212223const add1 = x =&gt; x + 1const mul3 = x =&gt; x * 3const div2 = x =&gt; x / 2div2(mul3(add1(add1(0)))) // ç»“æœæ˜¯ 3ï¼Œä½†è¿™æ ·å†™å¯è¯»æ€§å¤ªå·®äº†const operate = compose(div2, mul3, add1, add1)operate(0) // =&gt; ç›¸å½“äº div2(mul3(add1(add1(0))))operate(2) // =&gt; ç›¸å½“äº div2(mul3(add1(add1(2))))// redux ç‰ˆconst compose = (...fns) =&gt; &#123; if (fns.length === 0) return arg =&gt; arg if (fns.length === 1) return fns[0] return fns.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))&#125;// ä¸€è¡Œç‰ˆï¼Œæ”¯æŒå¤šå‚æ•°ï¼Œä½†å¿…é¡»è‡³å°‘ä¼ ä¸€ä¸ªå‡½æ•°const compose = (...fns) =&gt; fns.reduceRight((acc, fn) =&gt; (...args) =&gt; fn(acc(...args)))// ä¸€è¡Œç‰ˆï¼Œåªæ”¯æŒå•å‚æ•°ï¼Œä½†æ”¯æŒä¸ä¼ å‡½æ•°const compose = (...fns) =&gt; arg =&gt; fns.reduceRight((acc, fn) =&gt; fn(acc), arg) 3.3.3.Pointfreeèµ·åå­—æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹å„¿ï¼Œè€Œ Pointfree é£æ ¼èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘å¤§é‡ä¸­é—´å˜é‡çš„å‘½åã€‚ Pointfree å³ä¸ä½¿ç”¨æ‰€è¦å¤„ç†çš„å€¼ï¼Œåªåˆæˆè¿ç®—è¿‡ç¨‹ã€‚ä¸­æ–‡å¯ä»¥è¯‘ä½œâ€æ— å€¼â€é£æ ¼ã€‚ from Pointfree ç¼–ç¨‹é£æ ¼æŒ‡å— è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ï¼ˆæ³¨æ„ç†è§£å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘å’Œå‡½æ•°ç»„åˆçš„æ¦‚å¿µï¼‰ 12const addOne = x =&gt; x + 1const square = x =&gt; x * x ä¸Šé¢æ˜¯ä¸¤ä¸ªç®€å•å‡½æ•° addOne å’Œ squareï¼Œç°åœ¨æŠŠå®ƒä»¬åˆæˆä¸€ä¸ªè¿ç®—ã€‚ 12const addOneThenSquare = compose(square, addOne)addOneThenSquare(2) // 9 ä¸Šé¢ä»£ç ä¸­ï¼ŒaddOneThenSquare æ˜¯ä¸€ä¸ªåˆæˆå‡½æ•°ã€‚å®šä¹‰å®ƒçš„æ—¶å€™ï¼Œæ ¹æœ¬ä¸éœ€è¦æåˆ°è¦å¤„ç†çš„å€¼ï¼Œè¿™å°±æ˜¯ Pointfreeã€‚ 1234567// é Pointfreeï¼Œå› ä¸ºæåˆ°äº†æ•°æ®ï¼šwordconst snakeCase = function (word) &#123; return word.toLowerCase().replace(/\\s+/ig, '_')&#125;// Pointfreeconst snakeCase = compose(replace(/\\s+/ig, '_'), toLowerCase) ç„¶è€Œå¯æƒœçš„æ˜¯ï¼Œä»¥ä¸Šå¾ˆ Pointfree çš„ä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨ JavaScript ä¸­ replace å’Œ toLowerCase å‡½æ•°æ˜¯å®šä¹‰åœ¨ String çš„åŸå‹é“¾ä¸Šçš„â€¦ æ­¤å¤–æœ‰çš„åº“ï¼ˆå¦‚ Underscoreã€Lodashâ€¦ï¼‰æŠŠéœ€è¦å¤„ç†çš„æ•°æ®æ”¾åˆ°äº†ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ 12345const square = n =&gt; n * n;_.map([4, 8], square) // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¾…å¤„ç†æ•°æ®R.map(square, [4, 8]) // ä¸€èˆ¬å‡½æ•°å¼åº“éƒ½å°†æ•°æ®æ”¾åœ¨æœ€å è¿™æ ·ä¼šæœ‰ä¸€äº›å¾ˆä¸å‡½æ•°å¼çš„é—®é¢˜ï¼Œå³ï¼š 1.æ— æ³•æŸ¯é‡ŒåŒ–ååå‡½æ•°åº”ç”¨ 2.æ— æ³•è¿›è¡Œå‡½æ•°ç»„åˆ 3.æ— æ³•æ‰©å±• mapï¼ˆreduce ç­‰æ–¹æ³•ï¼‰ åˆ°å„ç§å…¶ä»–ç±»å‹ ï¼ˆè¯¦æƒ…å‚é˜…å‚è€ƒæ–‡çŒ®ä¹‹ã€ŠHey Underscore, Youâ€™re Doing It Wrong!ã€‹ï¼‰ 3.3.4.å‡½æ•°ç»„åˆçš„æ„ä¹‰ é¦–å…ˆè®©æˆ‘ä»¬ä»æŠ½è±¡çš„å±‚æ¬¡æ¥æ€è€ƒä¸€ä¸‹ï¼šä¸€ä¸ª app ç”±ä»€ä¹ˆç»„æˆï¼Ÿï¼ˆå½“ç„¶æ˜¯ç”± aã€pã€p ä¸‰ä¸ªå­—æ¯ç»„æˆçš„å•¦ï¼‰ ä¸€ä¸ªåº”ç”¨å…¶å®å°±æ˜¯ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶å°†ä¸€ç³»åˆ—å¼‚æ­¥çš„äº‹ä»¶è½¬æ¢ä¸ºå¯¹åº”ç»“æœã€‚ ä¸€ä¸ª start å¯ä»¥æ˜¯ï¼š å¼€å¯åº”ç”¨ DOM äº‹ä»¶(DOMContentLoaded, onClick, onSubmitâ€¦) æ¥æ”¶åˆ°çš„ HTTP è¯·æ±‚ è¿”å›çš„ HTTP å“åº” æŸ¥è¯¢æ•°æ®åº“çš„ç»“æœ WebSocket æ¶ˆæ¯ .. ä¸€ä¸ª end æˆ–è€…è¯´æ˜¯ effect å¯ä»¥æ˜¯ï¼š æ¸²æŸ“æˆ–æ›´æ–° UI è§¦å‘ä¸€ä¸ª DOM äº‹ä»¶ åˆ›å»ºä¸€ä¸ª HTTP è¯·æ±‚ è¿”å›ä¸€ä¸ª HTTP å“åº” ä¿å­˜æ•°æ®åˆ° DB å‘é€ WebSocket æ¶ˆæ¯ â€¦ é‚£ä¹ˆåœ¨ start å’Œ end ä¹‹é—´çš„ä¸œä¸œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åšæ•°æ®æµçš„å˜æ¢ï¼ˆtransformationsï¼‰ã€‚è¿™äº›å˜æ¢å…·ä½“çš„è¯´å°±æ˜¯ä¸€ç³»åˆ—çš„å˜æ¢åŠ¨è¯çš„ç»“åˆã€‚ è¿™äº›åŠ¨è¯æè¿°äº†è¿™äº›å˜æ¢åšäº†äº›ä»€ä¹ˆï¼ˆè€Œä¸æ˜¯æ€ä¹ˆåšï¼‰å¦‚ï¼š filter slice map reduce concat zip fork flatten â€¦ å½“ç„¶æ—¥å¸¸ç¼–å†™çš„ç¨‹åºä¸­ä¸€èˆ¬ä¸ä¼šåƒä¹‹å‰çš„ä¾‹å­é‚£æ ·çš„ç®€å•ï¼Œå®ƒçš„æ•°æ®æµå¯èƒ½æ˜¯åƒä¸‹é¢è¿™æ ·çš„â€¦ å¹¶ä¸”ï¼Œå¦‚æœè¿™äº›å˜æ¢åœ¨ç¼–å†™æ—¶ï¼Œéµå®ˆäº†åŸºæœ¬çš„å‡½æ•°å¼è§„åˆ™å’Œæœ€ä½³å®è·µï¼ˆçº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ï¼Œå¼•ç”¨é€æ˜â€¦ï¼‰ã€‚ é‚£ä¹ˆè¿™äº›å˜æ¢å¯ä»¥è¢«è½»æ˜“åœ°é‡ç”¨ã€æ”¹å†™ã€ç»´æŠ¤ã€æµ‹è¯•ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ç¼–å†™çš„åº”ç”¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œæ‰©å±•ï¼Œè€Œè¿™äº›å˜æ¢ç»“åˆçš„åŸºç¡€æ­£æ˜¯å‡½æ•°ç»„åˆã€‚ 3.4.Hindley-Milner ç±»å‹ç­¾å3.4.1.åŸºæœ¬æ¦‚å¿µå…ˆæ¥çœ‹ä¸€äº›ä¾‹å­~ 1234567891011// strLength :: String -&gt; Numberconst strLength = s =&gt; s.length// join :: String -&gt; [String] -&gt; Stringconst join = curry((what, xs) =&gt; xs.join(what))// match :: Regex -&gt; String -&gt; [String]const match = curry((reg, s) =&gt; s.match(reg))// replace :: Regex -&gt; String -&gt; String -&gt; Stringconst replace = curry((reg, sub, s) =&gt; s.replace(reg, sub)) åœ¨ Hindley-Milner ç³»ç»Ÿä¸­ï¼Œå‡½æ•°éƒ½å†™æˆç±»ä¼¼ a -&gt; b è¿™ä¸ªæ ·å­ï¼Œå…¶ä¸­ a å’Œ b æ˜¯ä»»æ„ç±»å‹çš„å˜é‡ã€‚ ä»¥ä¸Šä¾‹å­ä¸­çš„å¤šå‚å‡½æ•°ï¼Œå¯èƒ½çœ‹èµ·æ¥æ¯”è¾ƒå¥‡æ€ªï¼Œä¸ºå•¥æ²¡æœ‰æ‹¬å·ï¼Ÿ ä¾‹å¦‚å¯¹äº match å‡½æ•°ï¼Œæˆ‘ä»¬å°†å…¶æŸ¯é‡ŒåŒ–åï¼Œå®Œå…¨å¯ä»¥æŠŠå®ƒçš„ç±»å‹ç­¾åè¿™æ ·åˆ†ç»„ï¼š 12// match :: Regex -&gt; (String -&gt; [String])const match = curry((reg, s) =&gt; s.match(reg)) ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹å‡º match è¿™ä¸ªå‡½æ•°é¦–å…ˆæ¥å—äº†ä¸€ä¸ª Regex ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªä» String åˆ° [String] çš„å‡½æ•°ã€‚ å› ä¸ºæŸ¯é‡ŒåŒ–ï¼Œé€ æˆçš„ç»“æœå°±æ˜¯è¿™æ ·ï¼šç»™ match å‡½æ•°ä¸€ä¸ª Regex å‚æ•°åï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿæ¥ç€å¤„ç† String å‚æ•°ã€‚ å‡è®¾æˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ /holiday/igï¼Œé‚£ä¹ˆä»£ç å°±å˜æˆäº†è¿™æ ·ï¼š 12345// match :: Regex -&gt; (String -&gt; [String])const match = curry((reg, s) =&gt; s.match(reg))// onHoliday :: String -&gt; [String]const onHoliday = match(/holiday/ig) å¯ä»¥çœ‹å‡ºæŸ¯é‡ŒåŒ–åæ¯ä¼ ä¸€ä¸ªå‚æ•°ï¼Œå°±ä¼šå¼¹å‡ºç±»å‹ç­¾åæœ€å‰é¢çš„é‚£ä¸ªç±»å‹ã€‚æ‰€ä»¥ onHoliday å°±æ˜¯å·²ç»æœ‰äº† Regex å‚æ•°çš„ match å‡½æ•°ã€‚ 12// replace :: Regex -&gt; (String -&gt; (String -&gt; String))const replace = curry((reg, sub, s) =&gt; s.replace(reg, sub)) åŒæ ·çš„æ€è·¯æ¥çœ‹æœ€åä¸€ä¸ªå‡½æ•° replaceï¼Œå¯ä»¥çœ‹å‡ºä¸º replace åŠ ä¸Šè¿™ä¹ˆå¤šæ‹¬å·æœªå…æœ‰äº›å¤šä½™ã€‚ æ‰€ä»¥è¿™é‡Œçš„æ‹¬å·æ˜¯å®Œå…¨å¯ä»¥çœç•¥çš„ï¼Œå¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œç”šè‡³å¯ä»¥ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰çš„å‚æ•°éƒ½ä¼ è¿›æ¥ã€‚ å†æ¥çœ‹å‡ ä¸ªä¾‹å­~ 12345// id :: a -&gt; aconst id = x =&gt; x// map :: (a -&gt; b) -&gt; [a] -&gt; [b]const map = curry((f, xs) =&gt; xs.map(f)) è¿™é‡Œçš„ id å‡½æ•°æ¥å—ä»»æ„ç±»å‹çš„ a å¹¶è¿”å›åŒä¸€ä¸ªç±»å‹çš„æ•°æ®ï¼ˆè¯è¯´ map çš„ç­¾åé‡Œä¸ºå•¥åŠ äº†æ‹¬å·å‘¢~ï¼‰ã€‚ å’Œæ™®é€šä»£ç ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç±»å‹ç­¾åä¸­ä½¿ç”¨å˜é‡ã€‚æŠŠå˜é‡å‘½åä¸º a å’Œ b åªæ˜¯ä¸€ç§çº¦å®šä¿—æˆçš„ä¹ æƒ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„åç§°ã€‚ä½†å¯¹äºç›¸åŒçš„å˜é‡åï¼Œå…¶ç±»å‹ä¸€å®šç›¸åŒã€‚ è¿™æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªåŸåˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é‡ç”³ï¼ša -&gt; b å¯ä»¥æ˜¯ä»ä»»æ„ç±»å‹çš„ a åˆ°ä»»æ„ç±»å‹çš„ bï¼Œä½†æ˜¯ a -&gt; a å¿…é¡»æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚ ä¾‹å¦‚ï¼Œid å¯ä»¥æ˜¯ String -&gt; Stringï¼Œä¹Ÿå¯ä»¥æ˜¯ Number -&gt; Numberï¼Œä½†ä¸èƒ½æ˜¯ String -&gt; Boolã€‚ ç›¸ä¼¼åœ°ï¼Œmap ä¹Ÿä½¿ç”¨äº†å˜é‡ï¼Œåªä¸è¿‡è¿™é‡Œçš„ b å¯èƒ½ä¸ a ç±»å‹ç›¸åŒï¼Œä¹Ÿå¯èƒ½ä¸ç›¸åŒã€‚ æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼šmap æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä»ä»»æ„ç±»å‹ a åˆ°ä»»æ„ç±»å‹ b çš„å‡½æ•°ï¼›ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…ƒç´ æ˜¯ä»»æ„ç±»å‹çš„ aï¼›map æœ€åè¿”å›çš„æ˜¯ä¸€ä¸ªç±»å‹ b çš„æ•°ç»„ã€‚ è¾¨åˆ«ç±»å‹å’Œå®ƒä»¬çš„å«ä¹‰æ˜¯ä¸€é¡¹é‡è¦çš„æŠ€èƒ½ï¼Œè¿™é¡¹æŠ€èƒ½å¯ä»¥è®©ä½ åœ¨å‡½æ•°å¼ç¼–ç¨‹çš„è·¯ä¸Šèµ°å¾—æ›´è¿œã€‚ä¸ä»…è®ºæ–‡ã€åšå®¢å’Œæ–‡æ¡£ç­‰æ›´æ˜“ç†è§£ï¼Œç±»å‹ç­¾åæœ¬èº«ä¹ŸåŸºæœ¬ä¸Šèƒ½å¤Ÿå‘Šè¯‰ä½ å®ƒçš„å‡½æ•°æ€§ï¼ˆfunctionalityï¼‰ã€‚è¦æˆä¸ºä¸€ä¸ªèƒ½å¤Ÿç†Ÿç»ƒè¯»æ‡‚ç±»å‹ç­¾åçš„äººï¼Œä½ å¾—å‹¤äºç»ƒä¹ ï¼›ä¸è¿‡ä¸€æ—¦æŒæ¡äº†è¿™é¡¹æŠ€èƒ½ï¼Œä½ å°†ä¼šå—ç›Šæ— ç©·ï¼Œä¸è¯»æ‰‹å†Œä¹Ÿèƒ½è·å–å¤§é‡ä¿¡æ¯ã€‚ æœ€åå†ä¸¾å‡ ä¸ªå¤æ‚çš„ä¾‹å­~~ 12345678// head :: [a] -&gt; aconst head = xs =&gt; xs[0]// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]const filter = curry((f, xs) =&gt; xs.filter(f))// reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; bconst reduce = curry((f, x, xs) =&gt; xs.reduce(f, x)) reduce å¯èƒ½æ˜¯ä»¥ä¸Šç­¾åé‡Œè®©äººå°è±¡æœ€ä¸ºæ·±åˆ»çš„ä¸€ä¸ªï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ä¸ªäº†ï¼Œæ‰€ä»¥å¦‚æœä½ ç†è§£èµ·æ¥æœ‰å›°éš¾çš„è¯ï¼Œä¹Ÿä¸å¿…æ°”é¦ã€‚ä¸ºäº†æ»¡è¶³ä½ çš„å¥½å¥‡å¿ƒï¼Œæˆ‘è¿˜æ˜¯è¯•ç€è§£é‡Šä¸€ä¸‹å§ï¼›å°½ç®¡æˆ‘çš„è§£é‡Šè¿œè¿œä¸å¦‚ä½ è‡ªå·±é€šè¿‡ç±»å‹ç­¾åç†è§£å…¶å«ä¹‰æ¥å¾—æœ‰æ•™ç›Šã€‚ ä¸ä¿è¯è§£é‡Šå®Œå…¨æ­£ç¡®â€¦ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¤„åŸæ–‡æ˜¯â€œhere goes nothingâ€ï¼Œä¸€èˆ¬ç”¨äºäººä»¬åœ¨åšæ²¡æœ‰æŠŠæ¡çš„äº‹æƒ…ä¹‹å‰è¯´çš„è¯ã€‚ï¼‰ æ³¨æ„çœ‹ reduce çš„ç­¾åï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ªå‡½æ•°ï¼ˆæ‰€ä»¥ç”¨äº†æ‹¬å·ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª b å’Œä¸€ä¸ª a å¹¶è¿”å›ä¸€ä¸ª bã€‚ é‚£ä¹ˆè¿™äº› a å’Œ b æ˜¯ä»å“ªæ¥çš„å‘¢ï¼Ÿ å¾ˆç®€å•ï¼Œç­¾åä¸­çš„ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ b å’Œå…ƒç´ ä¸º a çš„æ•°ç»„ï¼Œæ‰€ä»¥å”¯ä¸€åˆç†çš„å‡è®¾å°±æ˜¯è¿™é‡Œçš„ b å’Œæ¯ä¸€ä¸ª a éƒ½å°†ä¼ ç»™å‰é¢è¯´çš„å‡½æ•°ä½œä¸ºå‚æ•°ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œreduce å‡½æ•°æœ€åè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª bï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œreduce çš„ç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°çš„è¾“å‡ºå°±æ˜¯ reduce å‡½æ•°çš„è¾“å‡ºã€‚çŸ¥é“äº† reduce çš„å«ä¹‰ï¼Œæˆ‘ä»¬æ‰æ•¢è¯´ä¸Šé¢å…³äºç±»å‹ç­¾åçš„æ¨ç†æ˜¯æ­£ç¡®çš„ã€‚ 3.4.2.å‚æ•°æ€ï¼ˆParametricityï¼‰ä¸€æ—¦å¼•å…¥ä¸€ä¸ªç±»å‹å˜é‡ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªå¥‡æ€ªçš„ç‰¹æ€§å«åšå‚æ•°æ€ã€‚ è¿™ä¸ªç‰¹æ€§è¡¨æ˜ï¼Œå‡½æ•°å°†ä¼šä»¥ä¸€ç§ç»Ÿä¸€çš„è¡Œä¸ºä½œç”¨äºæ‰€æœ‰çš„ç±»å‹ã€‚ 1// head :: [a] -&gt; a ä»¥ head å‡½æ•°ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ¥å— [a] è¿”å› aã€‚æˆ‘ä»¬é™¤äº†çŸ¥é“å‚æ•°æ˜¯ä¸ªæ•°ç»„ï¼Œå…¶ä»–çš„ä¸€æ¦‚ä¸çŸ¥ï¼›æ‰€ä»¥å‡½æ•°çš„åŠŸèƒ½å°±åªé™äºæ“ä½œè¿™ä¸ªæ•°ç»„ä¸Šã€‚ åœ¨å®ƒå¯¹ a ä¸€æ— æ‰€çŸ¥çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½å¯¹ a åšä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ æ¢å¥è¯è¯´ï¼Œa å‘Šè¯‰æˆ‘ä»¬å®ƒä¸æ˜¯ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼›é‚£ä¹ˆæˆ‘ä»¬çš„å‡½æ•°å¯¹æ¯ä¸€ä¸ªå¯èƒ½çš„ç±»å‹çš„æ“ä½œéƒ½å¿…é¡»ä¿æŒç»Ÿä¸€ï¼Œè¿™å°±æ˜¯å‚æ•°æ€çš„å«ä¹‰ã€‚ è¦è®©æˆ‘ä»¬æ¥çŒœæµ‹ head çš„å®ç°çš„è¯ï¼Œå”¯ä¸€åˆç†çš„æ¨æ–­å°±æ˜¯å®ƒè¿”å›æ•°ç»„çš„ç¬¬ä¸€ä¸ªï¼Œæˆ–è€…æœ€åä¸€ä¸ªï¼Œæˆ–è€…æŸä¸ªéšæœºçš„å…ƒç´ ï¼›å½“ç„¶ï¼Œhead è¿™ä¸ªå‘½åå·²ç»å‘Šè¯‰æˆ‘ä»¬äº†ç­”æ¡ˆã€‚ å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š 1// reverse :: [a] -&gt; [a] ä»…ä»ç±»å‹ç­¾åæ¥çœ‹ï¼Œreverse å¯èƒ½çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ å†æ¬¡å¼ºè°ƒï¼Œå®ƒä¸èƒ½å¯¹ a åšä»»ä½•ç‰¹å®šçš„äº‹æƒ…ã€‚å®ƒä¸èƒ½æŠŠ a å˜æˆå¦ä¸€ä¸ªç±»å‹ï¼Œæˆ–è€…å¼•å…¥ä¸€ä¸ª bï¼›è¿™éƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚ é‚£å®ƒå¯ä»¥æ’åºä¹ˆï¼Ÿæˆ‘è§‰å¾—ä¸è¡Œï¼Œæˆ‘è§‰å¾—å¾ˆæ™®é€š~ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯è®©å®ƒå»ä¸ºæ¯ä¸€ä¸ªå¯èƒ½çš„ç±»å‹æ’åºã€‚ å®ƒèƒ½é‡æ–°æ’åˆ—ä¹ˆï¼Ÿæˆ‘è§‰å¾—è¿˜ okï¼Œä½†å®ƒå¿…é¡»ä»¥ä¸€ç§å¯é¢„æ–™çš„æ–¹å¼è¾¾æˆç›®æ ‡ã€‚å¦å¤–ï¼Œå®ƒä¹Ÿæœ‰å¯èƒ½åˆ é™¤æˆ–è€…é‡å¤æŸä¸€ä¸ªå…ƒç´ ã€‚ é‡ç‚¹æ˜¯ï¼Œä¸ç®¡åœ¨å“ªç§æƒ…å†µä¸‹ï¼Œç±»å‹ a çš„å¤šæ€æ€§ï¼ˆpolymorphismï¼‰éƒ½ä¼šå¤§å¹…ç¼©å° reverse å‡½æ•°å¯èƒ½çš„è¡Œä¸ºçš„èŒƒå›´ã€‚ è¿™ç§â€œå¯èƒ½æ€§èŒƒå›´çš„ç¼©å°â€ï¼ˆnarrowing of possibilityï¼‰å…è®¸æˆ‘ä»¬åˆ©ç”¨ç±»ä¼¼ Hoogle è¿™æ ·çš„ç±»å‹ç­¾åæœç´¢å¼•æ“å»æœç´¢æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°ã€‚ç±»å‹ç­¾åæ‰€èƒ½åŒ…å«çš„ä¿¡æ¯é‡çœŸçš„éå¸¸å¤§ã€‚ 3.4.3.è‡ªç”±å®šç†ï¼ˆFree Theoremsï¼‰ç±»å‹ç­¾åé™¤äº†èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ¨æ–­å‡½æ•°å¯èƒ½çš„å®ç°ï¼Œè¿˜èƒ½å¤Ÿç»™æˆ‘ä»¬å¸¦æ¥è‡ªç”±å®šç†ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªç›´æ¥ä» Wadler å…³äºæ­¤ä¸»é¢˜çš„è®ºæ–‡ ä¸­éšæœºé€‰æ‹©çš„ä¾‹å­ï¼š 1234567// head :: [a] -&gt; acompose(f, head) === compose(head, map(f))// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]// å…¶ä¸­ f å’Œ p æ˜¯è°“è¯å‡½æ•°compose(map(f), filter(compose(p, f))) === compose(filter(p), map(f)) ä¸ç”¨å†™ä¸€è¡Œä»£ç ä½ ä¹Ÿèƒ½ç†è§£è¿™äº›å®šç†ï¼Œå®ƒä»¬ç›´æ¥æ¥è‡ªäºç±»å‹æœ¬èº«ã€‚ ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œç­‰å¼å·¦è¾¹è¯´çš„æ˜¯ï¼Œå…ˆè·å–æ•°ç»„çš„å¤´éƒ¨ï¼ˆè¯‘è€…æ³¨ï¼šå³ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œç„¶åå¯¹å®ƒè°ƒç”¨å‡½æ•° fï¼›ç­‰å¼å³è¾¹è¯´çš„æ˜¯ï¼Œå…ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è°ƒç”¨ fï¼Œç„¶åå†å–å…¶è¿”å›ç»“æœçš„å¤´éƒ¨ã€‚è¿™ä¸¤ä¸ªè¡¨è¾¾å¼çš„ä½œç”¨æ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯å‰è€…è¦å¿«å¾—å¤šã€‚ ç¬¬äºŒä¸ªä¾‹å­ filter ä¹Ÿæ˜¯ä¸€æ ·ã€‚ç­‰å¼å·¦è¾¹æ˜¯è¯´ï¼Œå…ˆç»„åˆ f å’Œ p æ£€æŸ¥å“ªäº›å…ƒç´ è¦è¿‡æ»¤æ‰ï¼Œç„¶åå†é€šè¿‡ map å®é™…è°ƒç”¨ fï¼ˆåˆ«å¿˜äº† filter æ˜¯ä¸ä¼šæ”¹å˜æ•°ç»„ä¸­å…ƒç´ çš„ï¼Œè¿™å°±ä¿è¯äº† a å°†ä¿æŒä¸å˜ï¼‰ï¼›ç­‰å¼å³è¾¹æ˜¯è¯´ï¼Œå…ˆç”¨ map è°ƒç”¨ fï¼Œç„¶åå†æ ¹æ® p è¿‡æ»¤å…ƒç´ ã€‚è¿™ä¸¤è€…ä¹Ÿæ˜¯ç›¸ç­‰çš„ã€‚ ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™ä¸æ˜¯å¸¸è¯†ä¹ˆã€‚ä½†è®¡ç®—æœºæ˜¯æ²¡æœ‰å¸¸è¯†çš„ã€‚å®é™…ä¸Šï¼Œè®¡ç®—æœºå¿…é¡»è¦æœ‰ä¸€ç§å½¢å¼åŒ–æ–¹æ³•æ¥è‡ªåŠ¨è¿›è¡Œç±»ä¼¼çš„ä»£ç ä¼˜åŒ–ã€‚æ•°å­¦æä¾›äº†è¿™ç§æ–¹æ³•ï¼Œèƒ½å¤Ÿå½¢å¼åŒ–ç›´è§‚çš„æ„Ÿè§‰ï¼Œè¿™æ— ç–‘å¯¹æ­»æ¿çš„è®¡ç®—æœºé€»è¾‘éå¸¸æœ‰ç”¨ã€‚ ä»¥ä¸Šåªæ˜¯ä¸¤ä¸ªä¾‹å­ï¼Œä½†å®ƒä»¬ä¼ è¾¾çš„å®šç†å´æ˜¯æ™®é€‚çš„ï¼Œå¯ä»¥åº”ç”¨åˆ°æ‰€æœ‰çš„å¤šæ€æ€§ç±»å‹ç­¾åä¸Šã€‚åœ¨ JavaScript ä¸­ï¼Œä½ å¯ä»¥å€ŸåŠ©ä¸€äº›å·¥å…·æ¥å£°æ˜é‡å†™è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ compose å‡½æ•°æ¥å®šä¹‰é‡å†™è§„åˆ™ã€‚æ€»ä¹‹ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§ä¸”å”¾æ‰‹å¯å¾—çš„ï¼Œå¯èƒ½æ€§åˆ™æ˜¯æ— é™çš„ã€‚ 3.4.4.ç±»å‹çº¦æŸæœ€åè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç­¾åä¹Ÿå¯ä»¥æŠŠç±»å‹çº¦æŸä¸ºä¸€ä¸ªç‰¹å®šçš„æ¥å£ï¼ˆinterfaceï¼‰ã€‚ 1// sort :: Ord a =&gt; [a] -&gt; [a] èƒ–ç®­å¤´å·¦è¾¹è¡¨æ˜çš„æ˜¯è¿™æ ·ä¸€ä¸ªäº‹å®ï¼ša ä¸€å®šæ˜¯ä¸ª Ord å¯¹è±¡ï¼Œæˆ–è€…è¯´ a å¿…é¡»è¦å®ç° Ord æ¥å£ã€‚ Ord åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯ä»å“ªæ¥çš„ï¼Ÿåœ¨ä¸€é—¨å¼ºç±»å‹è¯­è¨€ä¸­ï¼Œå®ƒå¯èƒ½å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¥å£ï¼Œèƒ½å¤Ÿè®©ä¸åŒçš„å€¼æ’åºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¤Ÿè·å–å…³äº a çš„æ›´å¤šä¿¡æ¯ï¼Œäº†è§£ sort å‡½æ•°å…·ä½“è¦å¹²ä»€ä¹ˆï¼Œè€Œä¸”è¿˜èƒ½é™åˆ¶å‡½æ•°çš„ä½œç”¨èŒƒå›´ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ¥å£å£°æ˜å«åšç±»å‹çº¦æŸï¼ˆtype constraintsï¼‰ã€‚ 1// assertEqual :: (Eq a, Show a) =&gt; a -&gt; a -&gt; Assertion è¿™ä¸ªä¾‹å­ä¸­æœ‰ä¸¤ä¸ªçº¦æŸï¼šEq å’Œ Showã€‚å®ƒä»¬ä¿è¯äº†æˆ‘ä»¬å¯ä»¥æ£€æŸ¥ä¸åŒçš„ a æ˜¯å¦ç›¸ç­‰ï¼Œå¹¶åœ¨æœ‰ä¸ç›¸ç­‰çš„æƒ…å†µä¸‹æ‰“å°å‡ºå…¶ä¸­çš„å·®å¼‚ã€‚ 3.4.5.ç±»å‹ç­¾åçš„ä½œç”¨æ€»ç»“ä¸€ä¸‹ç±»å‹ç­¾åçš„ä½œç”¨å°±æ˜¯ï¼š å£°æ˜å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡º è®©å‡½æ•°ä¿æŒé€šç”¨å’ŒæŠ½è±¡ å¯ä»¥ç”¨äºç¼–è¯‘æ—¶å€™æ£€æŸ¥ ä»£ç æœ€å¥½çš„æ–‡æ¡£ å‚è€ƒèµ„æ–™ JSå‡½æ•°å¼ç¼–ç¨‹æŒ‡å— Pointfree ç¼–ç¨‹é£æ ¼æŒ‡å— Hey Underscore, Youâ€™re Doing It Wrong! Functional Concepts with JavaScript: Part I Professor Frisby Introduces Composable Functional JavaScript å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨æ•™ç¨‹ ä»¥ä¸Š to be continuedâ€¦","tags":[{"name":"FP","slug":"FP","permalink":"https://buptsteve.github.io/blog/tags/FP/"},{"name":"JavaScript","slug":"JavaScript","permalink":"https://buptsteve.github.io/blog/tags/JavaScript/"},{"name":"å‡½æ•°å¼","slug":"å‡½æ•°å¼","permalink":"https://buptsteve.github.io/blog/tags/å‡½æ•°å¼/"}]},{"title":"ã€Œ9ã€JavaScript å‡½æ•°å¼ç¼–ç¨‹ï¼ˆä¸€ï¼‰","date":"2017-10-10T09:32:00.000Z","path":"2017/10/10/9.fp-in-js-1/","text":"é›¶ã€å‰è¨€è¯´åˆ°å‡½æ•°å¼ç¼–ç¨‹ï¼Œæƒ³å¿…å„ä½æˆ–å¤šæˆ–å°‘éƒ½æœ‰æ‰€è€³é—»ï¼Œç„¶è€Œå¯¹äºå‡½æ•°å¼çš„å†…æ¶µå’Œæœ¬è´¨å¯èƒ½åˆæœ‰äº›è¯´ä¸æ¸…æ¥šã€‚ æ‰€ä»¥æœ¬æ–‡å¸Œæœ›é’ˆå¯¹å·¥ç¨‹å¸ˆï¼Œä»åº”ç”¨ï¼ˆè€Œéå­¦æœ¯ï¼‰çš„è§’åº¦å°†å‡½æ•°å¼ç¼–ç¨‹ç›¸å…³æ€æƒ³å’Œå®è·µï¼ˆä»¥ JavaScript ä¸ºä¾‹ï¼‰åˆ†äº«ç»™å¤§å®¶ã€‚ æ–‡ç« å†…å®¹å…¶å®ä¸»è¦æ¥è‡ªäºåœ¨ä¸‹é˜…è¯»å„ç±»å‚è€ƒæ–‡çŒ®åçš„å†æ•´ç†ï¼Œæ‰€ä»¥æœ‰ä»€ä¹ˆé”™è¯¯ä¹Ÿå¸Œæœ›å¤§å®¶å¸®å¿™æ–§æ­£~ slide åœ°å€ ä¸€ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿ Functional programming is a programming paradigm 1.treats computation as the evaluation of mathematical functions 2.avoids changing-state and mutable data by wikipedia ä»ä»¥ä¸Šç»´åŸºç™¾ç§‘çš„å®šä¹‰æ¥çœ‹æœ‰ä¸‰ä¸ªè¦ç‚¹ Programming Paradigmï¼šç¼–ç¨‹èŒƒå¼ Mathematical Functionsï¼šæ•°å­¦å‡½æ•° Changing-state And Mutable Dataï¼šæ”¹å˜çŠ¶æ€å’Œå¯å˜æ•°æ® ä¸‹é¢åˆ†åˆ«è§£æä¸€ä¸‹ä»¥ä¸Šè¦ç‚¹ã€‚ 1.1.ä»€ä¹ˆæ˜¯ç¼–ç¨‹èŒƒå¼ï¼Ÿ from Programming paradigms ç¼–ç¨‹èŒƒå¼ä»æ¦‚å¿µä¸Šæ¥è®²æŒ‡çš„æ˜¯ç¼–ç¨‹çš„åŸºæœ¬é£æ ¼å’Œå…¸èŒƒæ¨¡å¼ã€‚ æ¢å¥è¯è¯´å…¶å®å°±æ˜¯ç¨‹åºå‘˜å¯¹äºå¦‚ä½•ä½¿ç”¨ç¼–ç¨‹æ¥è§£å†³é—®é¢˜çš„ä¸–ç•Œè§‚å’Œæ–¹æ³•è®ºã€‚ å¦‚æœæŠŠä¸€é—¨ç¼–ç¨‹è¯­è¨€æ¯”ä½œå…µå™¨ï¼Œå®ƒçš„è¯­æ³•ã€å·¥å…·å’ŒæŠ€å·§ç­‰æ˜¯æ‹›æ³•ï¼Œé‚£ä¹ˆå®ƒé‡‡ç”¨çš„ç¼–ç¨‹èŒƒå¼ä¹Ÿå°±æ˜¯æ˜¯å†…åŠŸå¿ƒæ³•ã€‚ ä¸€ç§èŒƒå¼å¯ä»¥åœ¨ä¸åŒçš„è¯­è¨€ä¸­å®ç°ï¼Œä¸€ç§è¯­è¨€ä¹Ÿå¯ä»¥åŒæ—¶æ”¯æŒå¤šç§èŒƒå¼ã€‚ä¾‹å¦‚ JavaScript å°±æ˜¯ä¸€ç§å¤šèŒƒå¼çš„è¯­è¨€ã€‚ 1.2.ä»€ä¹ˆæ˜¯æ•°å­¦å‡½æ•°ï¼Ÿ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€ä¸ªå˜åŒ–è¿‡ç¨‹ä¸­ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªå˜é‡ xã€yï¼Œå¦‚æœå¯¹äºä»»æ„ä¸€ä¸ª x éƒ½æœ‰å”¯ä¸€ç¡®å®šçš„ä¸€ä¸ªyå’Œå®ƒå¯¹åº”ï¼Œé‚£ä¹ˆå°±ç§° x æ˜¯è‡ªå˜é‡ï¼Œy æ˜¯ x çš„å‡½æ•°ã€‚x çš„å–å€¼èŒƒå›´å«åšè¿™ä¸ªå‡½æ•°çš„å®šä¹‰åŸŸï¼Œç›¸åº” y çš„å–å€¼èŒƒå›´å«åšå‡½æ•°çš„å€¼åŸŸã€‚ ä»¥ä¸Šå®šä¹‰ï¼Œåœ¨åˆä¸­æ•°å­¦å’±ä»¬éƒ½åº”è¯¥å­¦è¿‡â€¦ æ¢å¥è¯è¯´ï¼Œå‡½æ•°åªæ˜¯ä¸¤ç§æ•°å€¼ä¹‹é—´çš„å…³ç³»ï¼šè¾“å…¥å’Œè¾“å‡ºã€‚ å°½ç®¡æ¯ä¸ªè¾“å…¥éƒ½åªä¼šæœ‰ä¸€ä¸ªè¾“å‡ºï¼Œä½†ä¸åŒçš„è¾“å…¥å´å¯ä»¥æœ‰ç›¸åŒçš„è¾“å‡ºã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªåˆæ³•çš„ä» x åˆ° y çš„å‡½æ•°å…³ç³»ï¼› ä¸ä¹‹ç›¸åï¼Œä¸‹é¢è¿™å¼ å›¾è¡¨å±•ç¤ºçš„å°±ä¸æ˜¯ä¸€ç§å‡½æ•°å…³ç³»ï¼Œå› ä¸ºè¾“å…¥å€¼ 5 æŒ‡å‘äº†å¤šä¸ªè¾“å‡ºï¼š 1.2.1.ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼ˆPure Functionsï¼‰ï¼Ÿ çº¯å‡½æ•°æ˜¯è¿™æ ·ä¸€ç§å‡½æ•°ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œæ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ã€‚ æ ¹æ®å®šä¹‰å¯ä»¥çœ‹å‡ºçº¯å‡½æ•°å…¶å®å°±æ˜¯æ•°å­¦å‡½æ•°ï¼Œå³è¡¨ç¤ºä»è¾“å…¥çš„å‚æ•°åˆ°è¾“å‡ºç»“æœçš„æ˜ å°„ã€‚ è€Œæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°æ˜¾ç„¶éƒ½æ˜¯å¼•ç”¨é€æ˜çš„ã€‚ å¼•ç”¨é€æ˜æ€§ï¼ˆReferential Transparencyï¼‰æŒ‡çš„æ˜¯ï¼Œå¦‚æœä¸€æ®µä»£ç åœ¨ä¸æ”¹å˜æ•´ä¸ªç¨‹åºè¡Œä¸ºçš„å‰æä¸‹ï¼Œå¯ä»¥æ›¿æ¢æˆå®ƒçš„æ‰§è¡Œç»“æœã€‚ 12345678const double = x =&gt; x * 2const addFive = x =&gt; x + 5const num = double(addFive(10))num === double(10 + 5) === double(15) === 15 * 2 === 30 ä¸è¿‡è¯´äº†åŠå¤©ï¼Œå‰¯ä½œç”¨åˆæ˜¯å•¥â€¦ï¼Ÿ 1.2.2.ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰ï¼Ÿ å‰¯ä½œç”¨æ˜¯åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»ŸçŠ¶æ€çš„ä¸€ç§å˜åŒ–ï¼Œæˆ–è€…ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œçš„å¯è§‚å¯Ÿçš„äº¤äº’ã€‚ å‰¯ä½œç”¨å¯èƒ½åŒ…å«ï¼Œä½†ä¸é™äºä¸€ä¸‹è¡Œä¸ºï¼š æ›´æ”¹æ–‡ä»¶ç³»ç»Ÿ å¾€æ•°æ®åº“ä¸­æ’å…¥è®°å½• å‘é€ä¸€ä¸ª http è¯·æ±‚ æ”¹å˜æ•°æ® æ‰“å° log è·å–ç”¨æˆ·è¾“å…¥ DOM æŸ¥è¯¢ è®¿é—®ç³»ç»ŸçŠ¶æ€ â€¦ åªè¦æ˜¯è·Ÿå‡½æ•°å¤–éƒ¨ç¯å¢ƒå‘ç”Ÿçš„äº¤äº’å°±éƒ½æ˜¯å‰¯ä½œç”¨â€”â€”è¿™ä¸€ç‚¹å¯èƒ½ä¼šè®©ä½ æ€€ç–‘æ— å‰¯ä½œç”¨ç¼–ç¨‹çš„å¯è¡Œæ€§ã€‚ å‡½æ•°å¼ç¼–ç¨‹çš„å“²å­¦å°±æ˜¯å‡å®šå‰¯ä½œç”¨æ˜¯é€ æˆä¸æ­£å½“è¡Œä¸ºçš„ä¸»è¦åŸå› ã€‚ å½“ç„¶è¿™å¹¶ä¸æ˜¯è¯´ï¼Œè¦ç¦æ­¢ä½¿ç”¨ä¸€åˆ‡å‰¯ä½œç”¨ï¼Œè€Œæ˜¯è¯´ï¼Œè¦è®©å®ƒä»¬åœ¨å¯æ§çš„èŒƒå›´å†…å‘ç”Ÿã€‚ åœ¨åé¢è®²åˆ°å‡½å­ï¼ˆfunctorï¼‰å’Œå•å­ï¼ˆmonadï¼‰çš„æ—¶å€™æˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•æ§åˆ¶å®ƒä»¬ã€‚ 1.2.3.çº¯å‡½æ•°çš„å¥½å¤„éƒ½æœ‰å•¥ï¼ˆè°è¯´å¯¹äº†å°±ç»™ä»–ï¼‰ï¼Ÿ é¢å‘å¯¹è±¡è¯­è¨€çš„é—®é¢˜æ˜¯ï¼Œå®ƒä»¬æ°¸è¿œéƒ½è¦éšèº«æºå¸¦é‚£äº›éšå¼çš„ç¯å¢ƒã€‚ä½ åªéœ€è¦ä¸€ä¸ªé¦™è•‰ï¼Œä½†å´å¾—åˆ°ä¸€ä¸ªæ‹¿ç€é¦™è•‰çš„å¤§çŒ©çŒ©â€¦ä»¥åŠæ•´ä¸ªä¸›æ— by Erlang ä½œè€…ï¼šJoe Armstrong æ‰€ä»¥ä½¿ç”¨çº¯å‡½æ•°å°†ä¼šæœ‰ä»¥ä¸‹å¥½å¤„ï¼š å¯ç¼“å­˜æ€§ï¼ˆCacheableï¼‰ å¯ç§»æ¤æ€§ï¼è‡ªæ–‡æ¡£åŒ–ï¼ˆPortable / Self-Documentingï¼‰ å¯æµ‹è¯•æ€§ï¼ˆTestableï¼‰ åˆç†æ€§ï¼ˆReasonableï¼‰ å¹¶è¡Œä»£ç ï¼ˆParallel Codeï¼‰ 1.3.ä¸ºä»€ä¹ˆè¦é¿å…æ”¹å˜çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Ÿ Shared mutable state is the root of all evil å…±äº«å¯å˜çŠ¶æ€æ˜¯ä¸‡æ¶ä¹‹æº by Pete Hunt 123const obj = &#123; val: 1 &#125;someFn(obj)console.log(obj) // ??? from Building Scalable, Highly Concurrent &amp; Fault Tolerant Systems - Lessons Learned 1.4.åŸæ•™æ—¨å‡½æ•°å¼ VS æ¸©å’Œæ´¾å‡½æ•°å¼ï¼Ÿè¯´åˆ°å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œå¤§å®¶çš„ç¬¬ä¸€ååº”å¯èƒ½æ˜¯ Haskellã€OCamlã€Lispã€Erlangã€Scalaã€F#â€¦ å› ä¸ºå®ƒä»¬å¯èƒ½æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š å‡½æ•°æ˜¯â€œä¸€ç­‰å…¬æ°‘â€ï¼ˆfirst classï¼‰ ä¸å¯å˜æ•°æ® ä½¿ç”¨é€’å½’è€Œä¸æ˜¯å¾ªç¯ æŸ¯é‡ŒåŒ– æƒ°æ€§æ±‚å€¼ ä»£æ•°æ•°æ®ç±»å‹ æ¨¡å¼åŒ¹é… â€¦ è€Œè¯´åˆ° JavaScriptï¼Œå¾ˆå¤šäººå¯èƒ½ç¬¬ä¸€ååº”è®¤ä¸ºè¿™æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ã€‚ ä½†æ˜¯æƒ³æƒ³å‰é¢è¯´çš„ï¼šå‡½æ•°å¼ç¼–ç¨‹åªæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œè€Œç¼–ç¨‹èŒƒå¼å°±åƒâ€œå†…åŠŸå¿ƒæ³•â€ï¼Œæ‰€ä»¥ä¸ä»¥ä¸Šè¿™äº›è¯­è¨€ç‰¹æ€§ä¸å®Œå…¨ç›¸å…³ï¼Œåè€Œä¸ä½ è‡ªå·±çš„ç¼–ç¨‹æ€ç»´ï¼ˆå³ä¸–ç•Œè§‚å’Œæ–¹æ³•è®ºï¼‰æ›´åŠ ç›¸å…³ã€‚ åœ¨å‡½æ•°å¼æ–¹é¢ï¼Œç”±äº JavaScript æ”¯æŒé«˜é˜¶å‡½æ•°ã€åŒ¿åå‡½æ•°ã€å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ã€é—­åŒ…ã€è§£æ„ï¼ˆæ¨¡å¼åŒ¹é…ï¼‰ç­‰ç‰¹æ€§ï¼Œæ‰€ä»¥å®ƒä¹Ÿèƒ½æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ã€‚ï¼ˆè™½ç„¶ä¸æ˜¯é‚£ä¹ˆçš„åŸæ•™æ—¨å‡½æ•°å¼ï¼Œä½†è¿˜åŸºæœ¬å¤Ÿç”¨~å°¤å…¶æ˜¯ ES6 æ–°å¢çš„ç®­å¤´å‡½æ•°ç­‰ç‰¹æ€§~è¿˜æœ‰å„ç§ç±»åº“ ï¼‰ äº‹å®ä¸Š JavaScript æ˜¯ä¸€é—¨åŸºäºåŸå‹ï¼ˆprototype-basedï¼‰çš„å¤šèŒƒå¼è¯­è¨€ã€‚ 1.5.ä½œä¸ºå‡½æ•°å¼è¯­è¨€ JavaScript è¿˜å·®ä»€ä¹ˆï¼Ÿ1.ä¸å¯å˜æ•°æ®ç»“æ„JavaScript ä¸€å…±æœ‰ 6 ç§åŸå§‹ç±»å‹ï¼ˆåŒ…æ‹¬ ES6 æ–°æ·»åŠ çš„ Symbol ç±»å‹ï¼‰ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ Booleanï¼ŒNullï¼ŒUndefinedï¼ŒNumberï¼ŒString å’Œ Symbolã€‚ é™¤äº†è¿™äº›åŸå§‹ç±»å‹ï¼Œå…¶ä»–çš„ç±»å‹éƒ½æ˜¯ Objectï¼Œè€Œ Object éƒ½æ˜¯å¯å˜çš„ã€‚ 2.æƒ°æ€§æ±‚å€¼æƒ°æ€§ï¼ˆlazyï¼‰æŒ‡æ±‚å€¼çš„è¿‡ç¨‹å¹¶ä¸ä¼šç«‹åˆ»å‘ç”Ÿã€‚ æ¯”å¦‚ä¸€äº›æ•°å­¦é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½ä¸€å¼€å§‹å¹¶ä¸éœ€è¦æŠŠæ‰€æœ‰è¡¨è¾¾å¼éƒ½æ±‚å€¼ï¼Œè¿™æ ·å¯ä»¥åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­å°†ä¸€äº›è¡¨è¾¾å¼æ¶ˆæ‰ã€‚ æƒ°æ€§æ±‚å€¼æ˜¯ç›¸å¯¹äºåŠæ—©æ±‚å€¼ï¼ˆeager evaluationï¼‰çš„ã€‚ æ¯”å¦‚å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œå‚æ•°ä¸­çš„è¡¨è¾¾å¼éƒ½ä¼šè¢«å…ˆæ±‚å€¼ï¼Œè¿™ä¹Ÿç§°ä¸ºåº”ç”¨åºè¯­è¨€ã€‚ æ¯”å¦‚çœ‹ä¸‹é¢è¿™æ ·ä¸€ä¸ª JavaScript çš„å‡½æ•°ï¼š 1wholeNameOf(getFirstName(), getLastName()) getFirstName ä¸ getLastName ä¼šä¾æ¬¡æ‰§è¡Œï¼Œè¿”å›å€¼ä½œä¸º wholeNameOf å‡½æ•°çš„å‚æ•°ï¼Œ wholeNameOf å‡½æ•°æœ€åæ‰è¢«è°ƒç”¨ã€‚ å¦å¤–ï¼Œå¯¹äºæ•°ç»„æ“ä½œæ—¶ï¼Œå¤§éƒ¨åˆ†è¯­è¨€ä¹ŸåŒæ ·é‡‡ç”¨çš„æ˜¯åº”ç”¨åºã€‚ 1[1, 2, 3, 4].map(x =&gt; x + 1) æ‰€ä»¥ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ç«‹åˆ»ä¼šè¿”å›ç»“æœ [2, 3, 4, 5] ã€‚ å½“ç„¶è¿™å¹¶ä¸æ˜¯è¯´ JavaScript è¯­è¨€ä½¿ç”¨åº”ç”¨åºæœ‰é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›æƒ°æ€§åºåˆ—çš„æ”¯æŒå°±æ˜¯ JavaScript çš„ä¸å¯¹äº†ã€‚å¦‚æœ map ä¸€ä¸ªå¤§æ•°ç»„åæˆ‘ä»¬å‘ç°å…¶å®åªéœ€è¦å‰ 10 ä¸ªå…ƒç´ æ—¶ï¼Œå»è®¡ç®—æ‰€æœ‰å…ƒç´ å°±æ˜¾å¾—æ˜¯å¤šä½™çš„äº†ã€‚ 3.å‡½æ•°ç»„åˆé¢å‘å¯¹è±¡é€šå¸¸è¢«æ¯”å–»ä¸ºåè¯ï¼Œè€Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯åŠ¨è¯ã€‚é¢å‘å¯¹è±¡æŠ½è±¡çš„æ˜¯å¯¹è±¡ï¼Œå¯¹äºå¯¹è±¡çš„çš„æè¿°è‡ªç„¶æ˜¯åè¯ã€‚ é¢å‘å¯¹è±¡æŠŠæ‰€æœ‰æ“ä½œå’Œæ•°æ®éƒ½å°è£…åœ¨å¯¹è±¡å†…ï¼Œé€šè¿‡æ¥å—æ¶ˆæ¯åšç›¸åº”çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œå¯¹è±¡ Kittyï¼Œå®ƒä»¬å¯ä»¥æ¥å—â€œæ‰“æ‹›å‘¼â€çš„æ¶ˆæ¯ï¼Œç„¶ååšç›¸åº”çš„åŠ¨ä½œã€‚ è€Œå‡½æ•°å¼çš„æŠ½è±¡æ–¹å¼åˆšå¥½ç›¸åï¼Œæ˜¯æŠŠåŠ¨ä½œæŠ½è±¡å‡ºæ¥ï¼Œæ¯”å¦‚â€œæ‰“æ‹›å‘¼â€å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œå‡½æ•°å‚æ•°å°±æ˜¯ä½œä¸ºæ•°æ®ä¼ å…¥çš„ Kittyï¼ˆå³ Kitty è¿›å…¥å‡½æ•°â€œæ‰“æ‹›å‘¼â€ï¼Œå‡ºæ¥çš„åº”è¯¥æ˜¯ Hello Kittyï¼‰ã€‚ é¢å‘å¯¹è±¡å¯ä»¥é€šè¿‡ç»§æ‰¿å’Œç»„åˆåœ¨å¯¹è±¡ä¹‹é—´åˆ†äº«ä¸€äº›è¡Œä¸ºæˆ–è€…è¯´å±æ€§ï¼Œå‡½æ•°å¼çš„æ€è·¯å°±æ˜¯é€šè¿‡ç»„åˆå·²æœ‰çš„å‡½æ•°å½¢æˆä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚ ç„¶è€Œ JavaScript è¯­è¨€è™½ç„¶æ”¯æŒé«˜é˜¶å‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¸€ä¸ªåŸç”Ÿçš„åˆ©äºç»„åˆå‡½æ•°äº§ç”Ÿæ–°å‡½æ•°çš„æ–¹å¼ã€‚è€Œè¿™äº›å¼ºå¤§çš„å‡½æ•°ç»„åˆæ–¹å¼å´å¾€å¾€è¢«ç±»ä¼¼ Underscoreï¼ŒLodash ç­‰å·¥å…·åº“çš„å…‰èŠ’æ©ç›–æ‰ï¼ˆåé¢ä¼šè¯´åˆ°è¿™äº›åº“çš„é—®é¢˜ï¼‰ã€‚ 4.å°¾é€’å½’ä¼˜åŒ– å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­å› ä¸ºä¸å¯å˜æ•°æ®ç»“æ„çš„åŸå› ï¼Œæ²¡åŠæ³•å®ç°å¾ªç¯ã€‚æ‰€ä»¥éƒ½æ˜¯é€šè¿‡é€’å½’æ¥å®ç°å¾ªç¯ã€‚ ç„¶è€Œé€’å½’ä½¿ç”¨ä¸å½“å¾ˆå®¹æ˜“æ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨å°¾é€’å½’çš„æ–¹å¼æ¥ä¼˜åŒ–ã€‚ è™½ç„¶ ES6 è§„èŒƒä¸­è§„å®šäº†å°¾é€’å½’ä¼˜åŒ–è§„èŒƒï¼Œç„¶è€Œæä¾›å®ç°çš„è§£é‡Šå™¨è¿˜éå¸¸çš„å°‘ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥é˜…è¿™ä¸ªé“¾æ¥ 5.ä»£æ•°ç±»å‹ç³»ç»ŸJavaScript ä½œä¸ºä¸€ç§å¼±ç±»å‹çš„è¯­è¨€ï¼Œæ²¡æœ‰é™æ€ç±»å‹ç³»ç»Ÿã€‚ä¸è¿‡ä½¿ç”¨ä¸€äº› TypeScript ç­‰é¢„ç¼–è¯‘çš„è¯­è¨€å¯ä»¥ä½œä¸ºè¡¥å……~ äºŒã€å£°æ˜å¼ VS å‘½ä»¤å¼Declarative VS Imperativeï¼Œè¿™ä¸¤è€…çš„åŒºåˆ«ç®€å•æ¥è¯´å…¶å®å°±æ˜¯ What VS Howã€‚ 2.1.â€œæ„è¯†å½¢æ€â€ä¸Šçš„åŒºåˆ«~å£°æ˜å¼ï¼š ç¨‹åºæŠ½è±¡äº†æ§åˆ¶æµè¿‡ç¨‹ï¼Œä»£ç æè¿°çš„æ˜¯ â€”â€” æ•°æ®æµï¼šå³åšä»€ä¹ˆã€‚ æ›´å¤šä¾èµ–è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼æ˜¯æŒ‡ä¸€å°æ®µä»£ç ï¼Œå®ƒç”¨æ¥è®¡ç®—æŸä¸ªå€¼ã€‚è¡¨è¾¾å¼é€šå¸¸æ˜¯æŸäº›å‡½æ•°è°ƒç”¨çš„å¤åˆã€ä¸€äº›å€¼å’Œæ“ä½œç¬¦ï¼Œç”¨æ¥è®¡ç®—å‡ºç»“æœå€¼ã€‚ å‘½ä»¤å¼ï¼š ä»£ç æè¿°ç”¨æ¥è¾¾æˆæœŸæœ›ç»“æœçš„ç‰¹å®šæ­¥éª¤ â€”â€” æ§åˆ¶æµï¼šå³å¦‚ä½•åšã€‚ é¢‘ç¹ä½¿ç”¨è¯­å¥ã€‚ è¯­å¥æ˜¯æŒ‡ä¸€å°æ®µä»£ç ï¼Œå®ƒç”¨æ¥å®ŒæˆæŸä¸ªè¡Œä¸ºã€‚é€šç”¨çš„è¯­å¥ä¾‹å­åŒ…æ‹¬ forã€ifã€switchã€throwï¼Œç­‰ç­‰â€¦â€¦ 2.2.ä¸¾ä¸€äº›æ —å­ğŸŒ°â€¦ä¾‹1ï¼šå¸Œæœ›å¾—åˆ°ä¸€ä¸ªæ•°ç»„æ¯ä¸ªæ•°æ®å¹³æ–¹åçš„å’Œ12345678910111213141516171819202122// å‘½ä»¤å¼function mysteryFn (nums) &#123; let squares = [] let sum = 0 // 1. åˆ›å»ºä¸­é—´å˜é‡ for (let i = 0; i &lt; nums.length; i++) &#123; squares.push(nums[i] * nums[i]) // 2. å¾ªç¯è®¡ç®—å¹³æ–¹ &#125; for (let i = 0; i &lt; squares.length; i++) &#123; sum += squares[i] // 3. å¾ªç¯ç´¯åŠ  &#125; return sum&#125;// ä»¥ä¸Šä»£ç éƒ½æ˜¯ how è€Œä¸æ˜¯ what...// å‡½æ•°å¼const mysteryFn = (nums) =&gt; nums .map(x =&gt; x * x) // a. å¹³æ–¹ .reduce((acc, cur) =&gt; acc + cur, 0) // b. ç´¯åŠ  ä¾‹2ï¼šå¸Œæœ›å¾—åˆ°ä¸€ä¸ªæ•°ç»„æ‰€æœ‰å¶æ•°å€¼çš„ä¸€åŠçš„å¹³å‡å€¼123456789101112131415161718192021222324// å‘½ä»¤å¼function mysteryFn(nums) &#123; let sum = 0 let tally = 0 // 1. åˆ›å»ºä¸­é—´å˜é‡ for (let i = 0; i &lt; nums.length; i++) &#123; if (nums[i] % 2 === 0) &#123; // 2. å¾ªç¯ï¼Œå€¼ä¸ºå¶æ•°æ—¶ç´¯åŠ è¯¥å€¼çš„ä¸€åŠå¹¶è®°å½•æ•°é‡ sum += nums[i] / 2 tally++ &#125; &#125; return tally === 0 ? 0 : sum / tally // 3. è¿”å›å¹³å‡å€¼&#125;// å‡½æ•°å¼const mysteryFn = (nums) =&gt; nums .filter(x =&gt; x % 2 === 0) // a. è¿‡æ»¤éå¶æ•° .map(x =&gt; x / 2) // b. æŠ˜åŠ .reduce((acc, cur, idx, &#123; length: len &#125;) =&gt; ( idx &lt; len - 1 ? acc + cur // c. ç´¯åŠ  : (acc + cur) / length // d. è®¡ç®—å¹³å‡å€¼ ), 0) å‚è€ƒèµ„æ–™ JSå‡½æ•°å¼ç¼–ç¨‹æŒ‡å— Pointfree ç¼–ç¨‹é£æ ¼æŒ‡å— Hey Underscore, Youâ€™re Doing It Wrong! Functional Concepts with JavaScript: Part I Professor Frisby Introduces Composable Functional JavaScript å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨æ•™ç¨‹ ä»¥ä¸Š to be continuedâ€¦","tags":[{"name":"FP","slug":"FP","permalink":"https://buptsteve.github.io/blog/tags/FP/"},{"name":"JavaScript","slug":"JavaScript","permalink":"https://buptsteve.github.io/blog/tags/JavaScript/"},{"name":"å‡½æ•°å¼","slug":"å‡½æ•°å¼","permalink":"https://buptsteve.github.io/blog/tags/å‡½æ•°å¼/"}]},{"title":"ã€Œ8ã€Redux è¿›é˜¶ - react å…¨å®¶æ¡¶å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰","date":"2017-01-01T16:48:29.000Z","path":"2017/01/02/8.advanced-redux/","text":"é›¶ã€å‰è¨€åœ¨ä¸Šä¸€ç¯‡ä¸­ä»‹ç»äº† Redux çš„å„é¡¹åŸºç¡€ apiã€‚æ¥ç€ä¸€æ­¥ä¸€æ­¥åœ°ä»‹ç»å¦‚ä½•ä¸ React è¿›è¡Œç»“åˆï¼Œå¹¶ä»å¼•å…¥è¿‡ç¨‹ä¸­é‡åˆ°çš„å„ä¸ªç—›ç‚¹å¼•å‡º react-redux çš„ä½œç”¨å’ŒåŸç†ã€‚ ä¸è¿‡ç›®å‰ä¸ºæ­¢è¿˜éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼Œåœ¨æ—¥å¸¸çš„å¼€å‘ä¸­æœ€å¸¸è§å¼‚æ­¥æ“ä½œï¼ˆå¦‚é€šè¿‡ ajaxã€jsonp ç­‰æ–¹æ³• è·å–æ•°æ®ï¼‰ï¼Œåœ¨å­¦ä¹ å®Œä¸Šä¸€ç¯‡åä½ å¯èƒ½ä¾ç„¶æ²¡æœ‰å¤´ç»ªã€‚å› æ­¤æœ¬æ–‡å°†æ·±å…¥æµ…å‡ºåœ°å¯¹äº redux çš„è¿›é˜¶ç”¨æ³•è¿›è¡Œä»‹ç»ã€‚ ä¸€ã€ä¸­é—´ä»¶ï¼ˆMiddleWareï¼‰ It provides a third-party extension point between dispatching an action, and the moment it reaches the reducer. â€”â€”â€”â€” by Dan Abramov è¿™æ˜¯ redux ä½œè€…å¯¹ middleware çš„æè¿°ï¼Œmiddleware æä¾›äº†ä¸€ä¸ªåˆ†ç±»å¤„ç† action çš„æœºä¼šï¼Œåœ¨ middleware ä¸­ä½ å¯ä»¥æ£€é˜…æ¯ä¸€ä¸ªæµè¿‡çš„ actionï¼ŒæŒ‘é€‰å‡ºç‰¹å®šç±»å‹çš„ action è¿›è¡Œç›¸åº”æ“ä½œï¼Œç»™ä½ ä¸€æ¬¡æ”¹å˜ action çš„æœºä¼šã€‚ è¯´å¾—å¥½åƒå¾ˆåŠâ€¦ä¸è¿‡æœ‰å•¥ç”¨å’§â€¦ï¼Ÿ 1.1. æ—¥å¿—åº”ç”¨åœºæ™¯[2]å› ä¸ºæ”¹å˜ store çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯ dispatch ä¸€ä¸ª actionï¼Œæ‰€ä»¥æœ‰æ—¶éœ€è¦å°†æ¯æ¬¡ dispatch æ“ä½œéƒ½æ‰“å°å‡ºæ¥ä½œä¸ºæ“ä½œæ—¥å¿—ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹å‡ºæ˜¯å“ªä¸€æ¬¡ dispatch å¯¼è‡´äº†å¼‚å¸¸ã€‚ 1.1. ç¬¬ä¸€æ¬¡å°è¯•ï¼šå¼ºè¡Œæ€¼â€¦12345const action = addTodo('Use Redux');console.log('dispatching', action);store.dispatch(action);console.log('next state', store.getState()); æ˜¾ç„¶è¿™ç§åœ¨æ¯ä¸€ä¸ª dispatch æ“ä½œçš„å‰åéƒ½æ‰‹åŠ¨åŠ ä»£ç çš„æ–¹æ³•ï¼Œç®€ç›´è®©äººä¸å¿ç›´è§†â€¦ 1.2. ç¬¬äºŒæ¬¡å°è¯•ï¼šå°è£… dispatchèªæ˜çš„ä½ ä¸€å®šé©¬ä¸Šæƒ³åˆ°äº†ï¼Œä¸å¦‚å°†ä¸Šè¿°ä»£ç å°è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œç„¶åç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚ 1234567function dispatchAndLog(store, action) &#123; console.log('dispatching', action); store.dispatch(action); console.log('next state', store.getState());&#125;dispatchAndLog(store, addTodo('Use Redux')); çŸ®æ²¹ï¼Œçœ‹èµ·æ¥ä¸é”™å“Ÿã€‚ ä¸è¿‡æ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦å¯¼å…¥è¿™ä¸ªé¢å¤–çš„æ–¹æ³•ï¼Œä¸€æ—¦ä¸æƒ³ä½¿ç”¨åˆè¦å…¨éƒ¨æ›¿æ¢å›å»ï¼Œå¥½éº»çƒ¦å•Šâ€¦ 1.3. ç¬¬ä¸‰æ¬¡å°è¯•ï¼šçŒ´å­è¡¥ä¸ï¼ˆMonkey Patchï¼‰åœ¨æ­¤æš‚ä¸æ¢ç©¶ä¸ºå•¥å«çŒ´å­è¡¥ä¸è€Œä¸æ˜¯ä»€ä¹ˆå…¶ä»–è¡¥ä¸ã€‚ ç®€å•æ¥è¯´çŒ´å­è¡¥ä¸æŒ‡çš„å°±æ˜¯ï¼šä»¥æ›¿æ¢åŸå‡½æ•°çš„æ–¹å¼ä¸ºå…¶æ·»åŠ æ–°ç‰¹æ€§æˆ–ä¿®å¤ bugã€‚ 123456789let next = store.dispatch; // æš‚å­˜åŸæ–¹æ³•store.dispatch = function dispatchAndLog(action) &#123; console.log('dispatching', action); let result = next(action); // åº”ç”¨åŸæ–¹æ³• console.log('next state', store.getState()); return result;&#125;; è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±â€œå·æ¢æ¢æŸ±â€èˆ¬çš„ä¸ºåŸ dispatch æ·»åŠ äº†è¾“å‡ºæ—¥å¿—çš„åŠŸèƒ½ã€‚ 1.4. ç¬¬å››æ¬¡å°è¯•ï¼šéšè—çŒ´å­è¡¥ä¸ç›®å‰çœ‹èµ·æ¥å¾ˆä¸é”™ï¼Œç„¶é¹…å‡è®¾æˆ‘ä»¬åˆè¦æ·»åŠ åˆ«çš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œé‚£ä¹ˆä»£ç ä¸­å°†ä¼šæœ‰é‡å¤çš„ let next = store.dispatch; ä»£ç ã€‚ å¯¹äºè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’ï¼Œè¿”å›æ–°çš„ dispatch æ¥è§£å†³ã€‚ 1234567891011121314function logger(store) &#123; const next = store.dispatch; return function dispatchAndLog(action) &#123; console.log('dispatching', action); const result = next(action); // åº”ç”¨åŸæ–¹æ³• console.log('next state', store.getState()); return result; &#125;&#125;store.dispatch = logger(store);store.dispatch = anotherMiddleWare(store); æ³¨æ„åˆ°æœ€ååº”ç”¨ä¸­é—´ä»¶çš„ä»£ç å…¶å®å°±æ˜¯ä¸€ä¸ªé“¾å¼çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿˜å¯ä»¥æ›´è¿›ä¸€æ­¥ä¼˜åŒ–ç»‘å®šä¸­é—´ä»¶çš„è¿‡ç¨‹ã€‚ 1234567891011121314151617function applyMiddlewareByMonkeypatching(store, middlewares) &#123; // å› ä¸ºä¼ å…¥çš„æ˜¯åŸå¯¹è±¡å¼•ç”¨çš„å€¼ï¼Œslice æ–¹æ³•ä¼šç”Ÿæˆä¸€ä»½æ‹·è´ï¼Œ // æ‰€ä»¥ä¹‹åè°ƒç”¨çš„ reverse æ–¹æ³•ä¸ä¼šæ”¹å˜åŸæ•°ç»„ middlewares = middlewares.slice(); // æˆ‘ä»¬å¸Œæœ›æŒ‰ç…§æ•°ç»„åŸæœ¬çš„å…ˆåé¡ºåºè§¦å‘å„ä¸ªä¸­é—´ä»¶ï¼Œ // æ‰€ä»¥æœ€åçš„ä¸­é—´ä»¶åº”å½“æœ€æ¥è¿‘åŸæœ¬çš„ dispatchï¼Œ // å°±åƒæ´‹è‘±ä¸€æ ·ä¸€å±‚ä¸€å±‚åœ°åŒ…è£¹åŸ dispatch middlewares.reverse(); // åœ¨æ¯ä¸€ä¸ª middleware ä¸­å˜æ¢ store.dispatch æ–¹æ³•ã€‚ middlewares.forEach((middleware) =&gt; store.dispatch = middleware(store); );&#125;// å…ˆè§¦å‘ loggerï¼Œå†è§¦å‘ anotherMiddleWare ä¸­é—´ä»¶ï¼ˆç±»ä¼¼äº koa çš„ä¸­é—´ä»¶æœºåˆ¶ï¼‰applyMiddlewareByMonkeypatching(store, [ logger, anotherMiddleWare ]); so far so good~! ç°åœ¨ä¸ä»…éšè—äº†æ˜¾å¼åœ°ç¼“å­˜åŸ dispatch çš„ä»£ç ï¼Œè€Œä¸”è°ƒç”¨èµ·æ¥ä¹Ÿå¾ˆä¼˜é›…~ï¼Œç„¶é¹…è¿™æ ·å°±å¤Ÿäº†ä¹ˆï¼Ÿ 1.5. ç¬¬äº”æ¬¡å°è¯•ï¼šç§»é™¤çŒ´å­è¡¥ä¸æ³¨æ„åˆ°ï¼Œä»¥ä¸Šå†™æ³•ä»ç„¶æ˜¯é€šè¿‡ store.dispatch = middleware(store); æ”¹å†™åŸæ–¹æ³•ï¼Œå¹¶åœ¨ä¸­é—´ä»¶å†…éƒ¨é€šè¿‡ const next = store.dispatch; è¯»å–å½“å‰æœ€æ–°çš„æ–¹æ³•ã€‚ æœ¬è´¨ä¸Šå…¶å®è¿˜æ˜¯ monkey patchï¼Œåªä¸è¿‡å°†å…¶å°è£…åœ¨äº†å†…éƒ¨ï¼Œä¸è¿‡è‹¥æ˜¯å°† dispatch æ–¹æ³•é€šè¿‡å‚æ•°ä¼ é€’è¿›æ¥ï¼Œè¿™æ ·åœ¨ applyMiddleware å‡½æ•°ä¸­å°±å¯ä»¥æš‚å­˜ store.dispatchï¼ˆè€Œä¸æ˜¯ä¸€æ¬¡åˆä¸€æ¬¡çš„æ”¹å†™ï¼‰ï¼Œå²‚ä¸ç¾å“‰ï¼Ÿ 123456789101112131415161718// é€šè¿‡å‚æ•°ä¼ é€’function logger(store, next) &#123; return function dispatchAndLog(action) &#123; // ... &#125;&#125;function applyMiddleware(store, middlewares) &#123; // ... // æš‚å­˜åŸæ–¹æ³• let dispatch = store.dispatch; // middleware ä¸­é€šè¿‡é—­åŒ…è·å– dispatchï¼Œå¹¶ä¸”æ›´æ–° dispatch middlewares.forEach((middleware) =&gt; dispatch = middleware(store, dispatch); );&#125; æ¥ç€åº”ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ curry åŒ–ï¼ˆä¸€ç§ä½¿ç”¨åŒ¿åå•å‚æ•°å‡½æ•°æ¥å®ç°å¤šå‚æ•°å‡½æ•°çš„æ–¹æ³•ã€‚ï¼‰ï¼Œè¿˜å¯ä»¥å†è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ï¼ˆå…¶å®æ˜¯ä¸ºäº†ä½¿ç”¨ compose å°†ä¸­é—´ä»¶å‡½æ•°å…ˆç»„åˆå†ç»‘å®šï¼‰ 1234567891011121314151617181920212223242526272829303132function logger(store) &#123; return function(next) &#123; return function(action) &#123; console.log('dispatching', action); const result = next(action); // åº”ç”¨åŸæ–¹æ³• console.log('next state', store.getState()); return result; &#125; &#125;&#125;// -- ä½¿ç”¨ es6 çš„ç®­å¤´å‡½æ•°å¯ä»¥è®©ä»£ç æ›´åŠ ä¼˜é›…æ›´å‡½æ•°å¼... --const logger = (store) =&gt; (next) =&gt; (action) =&gt; &#123; console.log('dispatching', action); const result = next(action); // åº”ç”¨åŸæ–¹æ³• console.log('next state', store.getState()); return result;&#125;;function applyMiddleware(store, middlewares) &#123; // ... let dispatch = store.dispatch; middlewares.forEach((middleware) =&gt; dispatch = middleware(store)(dispatch); // æ³¨æ„è°ƒç”¨äº†ä¸¤æ¬¡ ); // ...&#125; ä»¥ä¸Šæ–¹æ³•ç¦» Redux ä¸­æœ€ç»ˆçš„ applyMiddleware å®ç°å·²ç»å¾ˆæ¥è¿‘äº†ï¼Œ 1.6. ç¬¬å…­æ¬¡å°è¯•ï¼šç»„åˆï¼ˆcomposeï¼Œå‡½æ•°å¼æ–¹æ³•ï¼‰åœ¨ Redux çš„æœ€ç»ˆå®ç°ä¸­ï¼Œå¹¶æ²¡æœ‰é‡‡ç”¨æˆ‘ä»¬ä¹‹å‰çš„ slice + reverse çš„æ–¹æ³•æ¥å€’ç€ç»‘å®šä¸­é—´ä»¶ã€‚è€Œæ˜¯é‡‡ç”¨äº† map + compose + reduce çš„æ–¹æ³•ã€‚ å…ˆæ¥è¯´è¿™ä¸ª compose å‡½æ•°ï¼Œåœ¨æ•°å­¦ä¸­ä»¥ä¸‹ç­‰å¼ååˆ†çš„è‡ªç„¶ã€‚ f(g(x)) = (f o g)(x)f(g(h(x))) = (f o g o h)(x) ç”¨ä»£ç æ¥è¡¨ç¤ºè¿™ä¸€è¿‡ç¨‹å°±æ˜¯è¿™æ ·ã€‚ 123456// ä¼ å…¥å‚æ•°ä¸ºå‡½æ•°æ•°ç»„function compose(...funcs) &#123; // è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œ // å°†å³è¾¹çš„å‡½æ•°ä½œä¸ºå†…å±‚å‡½æ•°æ‰§è¡Œï¼Œå¹¶å°†æ‰§è¡Œç»“æœä½œä¸ºå¤–å±‚å‡½æ•°å†æ¬¡æ‰§è¡Œ return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)));&#125; ä¸äº†è§£ reduce å‡½æ•°çš„äººå¯èƒ½å¯¹äºä»¥ä¸Šä»£ç ä¼šæ„Ÿåˆ°æœ‰äº›è´¹è§£ï¼Œä¸¾ä¸ªæ —å­æ¥è¯´ï¼Œæœ‰å‡½æ•°æ•°ç»„ [f, g, h]ä¼ å…¥ compose å‡½æ•°æ‰§è¡Œã€‚ é¦–æ¬¡ reduce æ‰§è¡Œçš„ç»“æœæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•° (...args) =&gt; f(g(...args)) æ¥ç€è¯¥å‡½æ•°ä½œä¸ºä¸‹ä¸€æ¬¡ reduce å‡½æ•°æ‰§è¡Œæ—¶çš„å‚æ•° aï¼Œè€Œå‚æ•° b æ˜¯ h å†æ¬¡æ‰§è¡Œæ—¶ h(...args) ä½œä¸ºå‚æ•°ä¼ å…¥ aï¼Œå³æœ€åè¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªå‡½æ•° (...args) =&gt; f(g(h(...args))) å› æ­¤æœ€ç»ˆç‰ˆ applyMiddleware å®ç°ä¸­å¹¶éä¾æ¬¡æ‰§è¡Œç»‘å®šï¼Œè€Œæ˜¯é‡‡ç”¨å‡½æ•°å¼çš„æ€ç»´ï¼Œå°†ä½œç”¨äº dispatch çš„å‡½æ•°é¦–å…ˆè¿›è¡Œç»„åˆï¼Œå†è¿›è¡Œç»‘å®šã€‚ï¼ˆæ‰€ä»¥è¦ä¸­é—´ä»¶è¦ curry åŒ–ï¼‰ 12345678910111213141516171819202122232425262728293031// ä¼ å…¥ä¸­é—´ä»¶å‡½æ•°çš„æ•°ç»„function applyMiddleware(...middlewares) &#123; // è¿”å›ä¸€ä¸ªå‡½æ•°çš„åŸå› åœ¨ createStore éƒ¨åˆ†å†è¿›è¡Œä»‹ç» return (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; &#123; const store = createStore(reducer, preloadedState, enhancer) let dispatch = store.dispatch let chain = [] // ä¿å­˜ç»‘å®šäº† middlewareAPI åçš„å‡½æ•°æ•°ç»„ const middlewareAPI = &#123; getState: store.getState, dispatch: (action) =&gt; dispatch(action) &#125; chain = middlewares.map(middleware =&gt; middleware(middlewareAPI)) // ä½¿ç”¨ compose å‡½æ•°æŒ‰ç…§ä»å³å‘å·¦çš„é¡ºåºç»‘å®šï¼ˆæ‰§è¡Œé¡ºåºæ˜¯ä»å·¦å¾€å³ï¼‰ dispatch = compose(...chain)(store.dispatch) return &#123; ...store, dispatch &#125; &#125;&#125;// store -&gt; &#123; getState &#125; ä»ä¼ é€’æ•´ä¸ª store æ”¹ä¸ºä¼ é€’éƒ¨åˆ† apiconst logger = (&#123; getState &#125;) =&gt; (next) =&gt; (action) =&gt; &#123; console.log('dispatching', action); const result = next(action); // åº”ç”¨åŸæ–¹æ³• console.log('next state', getState()); return result;&#125;; ç»¼ä¸Šå¦‚ä¸‹å›¾æ‰€ç¤ºæ•´ä¸ªä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ç±»ä¼¼äºæ´‹è‘±ä¸€æ ·é¦–å…ˆæŒ‰ç…§ä»å¤–åˆ°å†…çš„é¡ºåºæ‰§è¡Œ dispatch ä¹‹å‰çš„ä¸­é—´ä»¶ä»£ç ï¼Œåœ¨ dispatchï¼ˆæ´‹è‘±çš„å¿ƒï¼‰æ‰§è¡Œååˆåè¿‡æ¥ï¼ŒæŒ‰ç…§ä»å†…åˆ°å·¦å¤–çš„é¡ºåºæ‰§è¡Œ dispatch ä¹‹åçš„ä¸­é—´ä»¶ä»£ç ã€‚ æ¡¥éƒ½éº»è¢‹ï¼ ä½ çœŸçš„éƒ½ç†è§£äº†ä¹ˆï¼Ÿ åœ¨ä¹‹å‰çš„å®ç°ä¸­ç›´æ¥ä¼ é€’ storeï¼Œä¸ºå•¥åœ¨æœ€ç»ˆå®ç°ä¸­ä¼ é€’çš„æ˜¯ middlewareAPIï¼Ÿ middlewareAPI é‡Œçš„ dispatch æ˜¯ä¸ºå•¥ä¸€ä¸ªåŒ¿åå‡½æ•°è€Œä¸ç›´æ¥ä¼ é€’ dispatchï¼Ÿ å¦‚ä¸‹åˆ—ä»£ç æ‰€ç¤ºï¼Œå¦‚æœåœ¨ä¸­é—´ä»¶é‡Œä¸ç”¨ next è€Œæ˜¯è°ƒç”¨ store.dispatch ä¼šæ€æ ·å‘¢ï¼Ÿ 12345678const logger = (store) =&gt; (next) =&gt; (action) =&gt; &#123; console.log('dispatching', action); // è°ƒç”¨åŸå§‹ dispatchï¼Œè€Œä¸æ˜¯ä¸Šä¸€ä¸ªä¸­é—´ä»¶ä¼ è¿›æ¥çš„ const result = store.dispatch(action); // &lt;- è¿™é‡Œ console.log('next state', store.getState()); return result;&#125;; 1.7. middleware ä¸­è°ƒç”¨ store.dispatch[6] æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚å›¾å·¦ï¼Œå½“æˆ‘ä»¬ dispatch ä¸€ä¸ª action æ—¶ï¼Œmiddleware é€šè¿‡ next(action) ä¸€å±‚ä¸€å±‚å¤„ç†å’Œä¼ é€’ action ç›´åˆ° redux åŸç”Ÿçš„ dispatchã€‚å¦‚æœæŸä¸ª middleware ä½¿ç”¨ store.dispatch(action) æ¥åˆ†å‘ actionï¼Œå°±å‘ç”Ÿäº†å³å›¾çš„æƒ…å†µï¼Œç›¸å½“äºä»å¤–å±‚é‡æ–°æ¥ä¸€éï¼Œå‡å¦‚è¿™ä¸ª middleware ä¸€ç›´ç®€å•ç²—æš´åœ°è°ƒç”¨ store.dispatch(action)ï¼Œå°±ä¼šå½¢æˆæ— é™å¾ªç¯äº†ã€‚ï¼ˆå…¶å®å°±ç›¸å½“äºçŒ´å­è¡¥ä¸æ²¡è¡¥ä¸Šï¼Œä¸åœåœ°è°ƒç”¨åŸæ¥çš„å‡½æ•°ï¼‰ å› æ­¤æœ€ç»ˆç‰ˆé‡Œä¸æ˜¯ç›´æ¥ä¼ é€’ storeï¼Œè€Œæ˜¯ä¼ é€’ getState å’Œ dispatchï¼Œä¼ é€’ getState çš„åŸå› æ˜¯å¯ä»¥é€šè¿‡ getState è·å–å½“å‰çŠ¶æ€ã€‚å¹¶ä¸”è¿˜å°† dispatch ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°åŒ…è£¹ dispatch: (action) =&gt; dispatch(action)ï¼Œè¿™æ ·ä¸ä½†å¯ä»¥é˜²æ­¢ dispatch è¢«ä¸­é—´ä»¶ä¿®æ”¹ï¼Œè€Œä¸”åªè¦ dispatch æ›´æ–°äº†ï¼ŒmiddlewareAPI ä¸­çš„ dispatch ä¹Ÿä¼šéšä¹‹å‘ç”Ÿå˜åŒ–ã€‚ 1.8. createStore è¿›é˜¶åœ¨ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬ä½¿ç”¨ createStore æ–¹æ³•åªç”¨åˆ°äº†å®ƒå‰ä¸¤ä¸ªå‚æ•°ï¼Œå³ reducer å’Œ preloadedStateï¼Œç„¶é¹…å…¶å®å®ƒè¿˜æ‹¥æœ‰ç¬¬ä¸‰ä¸ªå‚æ•° enhancerã€‚ enhancer å‚æ•°å¯ä»¥å®ç°ä¸­é—´ä»¶ã€æ—¶é—´æ—…è¡Œã€æŒä¹…åŒ–ç­‰åŠŸèƒ½ï¼ŒRedux ä»…æä¾›äº† applyMiddleware ç”¨äºåº”ç”¨ä¸­é—´ä»¶ï¼ˆå°±æ˜¯ 1.6. ä¸­çš„é‚£ä¸ªï¼‰ã€‚ åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œè¦åº”ç”¨ä¸­é—´ä»¶å¯ä»¥è¿™ä¹ˆå†™ã€‚ 1234567891011121314151617181920212223242526import &#123; createStore, combineReducers, applyMiddleware,&#125; from 'redux';// ç»„åˆ reducerconst rootReducer = combineReducers(&#123; todos: todosReducer, filter: filterReducer,&#125;);// ä¸­é—´ä»¶æ•°ç»„const middlewares = [logger, anotherMiddleWare];const store = createStore( rootReducer, initialState, applyMiddleware(...middlewares),);// å¦‚æœä¸éœ€è¦ initialState çš„è¯ä¹Ÿå¯ä»¥å¿½ç•¥const store = createStore( rootReducer, applyMiddleware(...middlewares),); åœ¨ä¸Šæ–‡ applyMiddleware çš„å®ç°ä¸­ç•™äº†ä¸ªæ‚¬å¿µï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸º enhancer è¢«å®šä¹‰ä¸ºä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ createStore å‡½æ•°ä½œä¸ºå‚æ•°ã€‚ 12345678910111213141516171819202122232425262728293031/** * åˆ›å»ºä¸€ä¸ª redux store ç”¨äºä¿å­˜çŠ¶æ€æ ‘ï¼Œ * å”¯ä¸€æ”¹å˜ store ä¸­æ•°æ®çš„æ–¹æ³•å°±æ˜¯å¯¹å…¶è°ƒç”¨ dispatch * * åœ¨ä½ çš„åº”ç”¨ä¸­åº”è¯¥åªæœ‰ä¸€ä¸ª storeï¼Œæƒ³è¦é’ˆå¯¹ä¸åŒçš„éƒ¨åˆ†çŠ¶æ€å“åº” actionï¼Œ * ä½ åº”è¯¥ä½¿ç”¨ combineReducers å°†å¤šä¸ª reducer åˆå¹¶ã€‚ * * @param &#123;å‡½æ•°&#125; reducer ä¸å¤šè§£é‡Šäº† * @param &#123;å¯¹è±¡&#125; preloadedState ä¸»è¦ç”¨äºå‰åç«¯åŒæ„æ—¶çš„æ•°æ®åŒæ­¥ * @param &#123;å‡½æ•°&#125; enhancer å¾ˆç‰›é€¼ï¼Œå¯ä»¥å®ç°ä¸­é—´ä»¶ã€æ—¶é—´æ—…è¡Œï¼ŒæŒä¹…åŒ–ç­‰ * â€» Redux ä»…æä¾› applyMiddleware è¿™ä¸ª Store Enhancer â€» * @return &#123;Store&#125; */export default function createStore(reducer, preloadedState, enhancer) &#123; if (typeof preloadedState === 'function' &amp;&amp; typeof enhancer === 'undefined') &#123; enhancer = preloadedState preloadedState = undefined &#125; if (typeof enhancer !== 'undefined') &#123; if (typeof enhancer !== 'function') &#123; throw new Error('Expected the enhancer to be a function.') &#125; // enhancer æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ createStore å‡½æ•°ä½œä¸ºå‚æ•° return enhancer(createStore)(reducer, preloadedState) &#125; // ... // åç»­å†…å®¹æ¨èçœ‹çœ‹å‚è€ƒèµ„æ–™éƒ¨åˆ†çš„ã€Redux èå¼æ•™ç¨‹ã€‘&#125; æ€»çš„æ¥è¯´ Redux æœ‰äº”ä¸ª APIï¼Œåˆ†åˆ«æ˜¯ï¼š createStore(reducer, [initialState], enhancer) combineReducers(reducers) applyMiddleware(â€¦middlewares) bindActionCreators(actionCreators, dispatch) compose(â€¦functions) createStore ç”Ÿæˆçš„ store æœ‰å››ä¸ª APIï¼Œåˆ†åˆ«æ˜¯ï¼š getState() dispatch(action) subscribe(listener) replaceReducer(nextReducer) ä»¥ä¸Š API æˆ‘ä»¬è¿˜æ²¡ä»‹ç»çš„åº”è¯¥å°±å‰© bindActionCreators äº†ã€‚è¿™ä¸ª API å…¶å®å°±æ˜¯ä¸ªè¯­æ³•ç³–èµ·äº†æ–¹ä¾¿åœ°ç»™ action creator ç»‘å®š dispatch çš„ä½œç”¨ã€‚ 12345678910111213141516171819202122232425// ä¸€èˆ¬å†™æ³•function mapDispatchToProps(dispatch) &#123; return &#123; onPlusClick: () =&gt; dispatch(increment()), onMinusClick: () =&gt; dispatch(decrement()), &#125;;&#125;// ä½¿ç”¨ bindActionCreatorsimport &#123; bindActionCreators &#125; from 'redux';function mapDispatchToProps(dispatch) &#123; return bindActionCreators(&#123; onPlusClick: increment, onMinusClick: decrement, // è¿˜å¯ä»¥ç»‘å®šæ›´å¤šå‡½æ•°... &#125;, dispatch);&#125;// ç”šè‡³å¦‚æœå®šä¹‰çš„å‡½æ•°è¾“å…¥éƒ½ç›¸åŒçš„è¯è¿˜èƒ½æ›´åŠ ç®€æ´export default connect( mapStateToProps, // ç›´æ¥ä¼ ä¸€ä¸ªå¯¹è±¡ï¼Œconnect è‡ªåŠ¨å¸®ä½ ç»‘å®š dispatch &#123; onPlusClick: increment, onMinusClick: decrement &#125;,)(App); äºŒã€å¼‚æ­¥æ“ä½œä¸‹é¢è®©æˆ‘ä»¬å‘Šåˆ«å¹²å‡€çš„åŒæ­¥ä¸–ç•Œï¼Œè¿›å…¥â€œè‚®è„â€çš„å¼‚æ­¥ä¸–ç•Œ~ã€‚ åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå¼‚æ­¥æ“ä½œã€ä¿®æ”¹å…¨å±€å˜é‡ç­‰ä¸å‡½æ•°å¤–éƒ¨ç¯å¢ƒå‘ç”Ÿçš„äº¤äº’å«åšå‰¯ä½œç”¨ï¼ˆSide Effectï¼‰é€šå¸¸è®¤ä¸ºè¿™äº›æ“ä½œæ˜¯é‚ªæ¶ï¼ˆevilï¼‰è‚®è„ï¼ˆdirtyï¼‰çš„ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å¯¼è‡´ bug çš„æºå¤´ã€‚å› ä¸ºä¸ä¹‹ç›¸å¯¹çš„æ˜¯çº¯å‡½æ•°ï¼ˆpure functionï¼‰ï¼Œå³å¯¹äºåŒæ ·çš„è¾“å…¥æ€»æ˜¯è¿”å›åŒæ ·çš„è¾“å‡ºçš„å‡½æ•°ï¼Œä½¿ç”¨è¿™æ ·çš„å‡½æ•°å¾ˆå®¹æ˜“åšç»„åˆã€æµ‹è¯•ç­‰æ“ä½œï¼Œå¾ˆå®¹æ˜“éªŒè¯å’Œä¿è¯å…¶æ­£ç¡®æ€§ã€‚ï¼ˆå®ƒä»¬å°±åƒæ•°å­¦å…¬å¼ä¸€èˆ¬å‡†ç¡®ï¼‰ 2.1. é€šçŸ¥åº”ç”¨åœºæ™¯[3]ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªæ˜¾ç¤ºé€šçŸ¥çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨é€šçŸ¥æ˜¾ç¤ºå5ç§’é’Ÿéšè—è¯¥é€šçŸ¥ã€‚ é¦–å…ˆå½“ç„¶æ˜¯ç¼–å†™ action æ˜¾ç¤ºï¼šSHOW_NOTIFICATION éšè—ï¼šHIDE_NOTIFICATION 2.1.1. æœ€ç›´è§‚çš„å†™æ³•æœ€ç›´è§‚çš„å†™æ³•å°±æ˜¯é¦–å…ˆæ˜¾ç¤ºé€šçŸ¥ï¼Œç„¶åä½¿ç”¨ setTimeout åœ¨5ç§’åéšè—é€šçŸ¥ã€‚ 1234store.dispatch(&#123; type: 'SHOW_NOTIFICATION', text: 'You logged in.' &#125;);setTimeout(() =&gt; &#123; store.dispatch(&#123; type: 'HIDE_NOTIFICATION' &#125;);&#125;, 5000); ç„¶é¹…ï¼Œä¸€èˆ¬åœ¨ç»„ä»¶ä¸­å°¤å…¶æ˜¯å±•ç¤ºç»„ä»¶ä¸­æ²¡æ³•ä¹Ÿæ²¡å¿…è¦è·å– storeï¼Œå› æ­¤ä¸€èˆ¬å°†å…¶åŒ…è£…æˆ action creatorã€‚ 123456789101112131415// actions.jsexport function showNotification(text) &#123; return &#123; type: 'SHOW_NOTIFICATION', text &#125;;&#125;export function hideNotification() &#123; return &#123; type: 'HIDE_NOTIFICATION' &#125;;&#125;// component.jsimport &#123; showNotification, hideNotification &#125; from '../actions';this.props.dispatch(showNotification('You just logged in.'));setTimeout(() =&gt; &#123; this.props.dispatch(hideNotification());&#125;, 5000); æˆ–è€…æ›´è¿›ä¸€æ­¥åœ°å…ˆä½¿ç”¨ connect æ–¹æ³•åŒ…è£…ã€‚ 1234this.props.showNotification('You just logged in.');setTimeout(() =&gt; &#123; this.props.hideNotification();&#125;, 5000); åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ²¡æœ‰ç”¨ä»»ä½• middleware æˆ–è€…åˆ«çš„æ¦‚å¿µã€‚ 2.1.2. å¼‚æ­¥ action creatorä¸Šä¸€ç§ç›´è§‚å†™æ³•æœ‰ä¸€äº›é—®é¢˜ æ¯å½“æˆ‘ä»¬éœ€è¦æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥å°±éœ€è¦æ‰‹åŠ¨å…ˆæ˜¾ç¤ºï¼Œç„¶åå†æ‰‹åŠ¨åœ°è®©å…¶æ¶ˆå¤±ã€‚å…¶å®æˆ‘ä»¬æ›´å¸Œæœ›é€šçŸ¥åˆ°æ—¶é—´åè‡ªåŠ¨åœ°æ¶ˆå¤±ã€‚ é€šçŸ¥ç›®å‰æ²¡æœ‰è‡ªå·±çš„ idï¼Œæ‰€ä»¥æœ‰äº›åœºæ™¯ä¸‹å­˜åœ¨ç«äº‰æ¡ä»¶ï¼ˆrace conditionï¼‰ï¼Œå³å‡å¦‚åœ¨ç¬¬ä¸€ä¸ªé€šçŸ¥ç»“æŸå‰è§¦å‘ç¬¬äºŒä¸ªé€šçŸ¥ï¼Œå½“ç¬¬ä¸€ä¸ªé€šçŸ¥ç»“æŸæ—¶ï¼Œç¬¬äºŒä¸ªé€šçŸ¥ä¹Ÿä¼šè¢«æå‰å…³é—­ã€‚ æ‰€ä»¥ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºé€šçŸ¥åŠ ä¸Š idï¼Œå¹¶å°†æ˜¾ç¤ºå’Œæ¶ˆå¤±çš„ä»£ç åŒ…èµ·æ¥ã€‚ 1234567891011121314151617181920212223242526// actions.jsconst showNotification = (text, id) =&gt; (&#123; type: 'SHOW_NOTIFICATION', id, text,&#125;);const hideNotification = (id) =&gt; (&#123; type: 'HIDE_NOTIFICATION', id,&#125;);let nextNotificationId = 0;export function showNotificationWithTimeout(dispatch, text) &#123; const id = nextNotificationId++; dispatch(showNotification(id, text)); setTimeout(() =&gt; &#123; dispatch(hideNotification(id)); &#125;, 5000);&#125;// component.jsshowNotificationWithTimeout(this.props.dispatch, 'You just logged in.');// otherComponent.jsshowNotificationWithTimeout(this.props.dispatch, 'You just logged out.'); ä¸ºå•¥ showNotificationWithTimeout å‡½æ•°è¦æ¥æ”¶ dispatch ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å‘¢ï¼Ÿè™½ç„¶é€šå¸¸ä¸€ä¸ªç»„ä»¶éƒ½æ‹¥æœ‰è§¦å‘ dispatch çš„æƒé™ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æƒ³è®©ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼ˆshowNotificationWithTimeoutï¼‰æ¥è§¦å‘ dispatchï¼Œæ‰€ä»¥éœ€è¦å°† dispatch ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ 2.1.3. å•ä¾‹ storeå¯èƒ½ä½ ä¼šè¯´å¦‚æœæœ‰ä¸€ä¸ªä»å…¶ä»–æ¨¡å—ä¸­å¯¼å‡ºçš„å•ä¾‹ storeï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯åŒæ ·ä¹Ÿå¯ä»¥ä¸ä¼ é€’ dispatch ä»¥ä¸Šä»£ç ä¹Ÿå¯ä»¥è¿™æ ·å†™ã€‚ 1234567891011121314151617181920212223// store.jsexport default createStore(reducer);// actions.jsimport store from './store';// ...let nextNotificationId = 0;export function showNotificationWithTimeout(text) &#123; const id = nextNotificationId++; store.dispatch(showNotification(id, text)); setTimeout(() =&gt; &#123; store.dispatch(hideNotification(id)); &#125;, 5000);&#125;// component.jsshowNotificationWithTimeout('You just logged in.');// otherComponent.jsshowNotificationWithTimeout('You just logged out.'); è¿™æ ·çœ‹èµ·æ¥ä¼¼ä¹æ›´ç®€å•ä¸€äº›ï¼Œä¸è¿‡å¢™è£‚ä¸æ¨èè¿™æ ·çš„å†™æ³•ã€‚ä¸»è¦çš„åŸå› æ˜¯è¿™æ ·çš„å†™æ³•å¼ºåˆ¶è®© store æˆä¸ºä¸€ä¸ªå•ä¾‹ã€‚è¿™æ ·ä¸€æ¥è¦å®ç°æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆServer Renderingï¼‰å°†ååˆ†å›°éš¾ã€‚å› ä¸ºåœ¨æœåŠ¡ç«¯ï¼Œä¸ºäº†è®©ä¸åŒçš„ç”¨æˆ·å¾—åˆ°ä¸åŒçš„é¢„å…ˆè·å–çš„æ•°æ®ï¼Œä½ éœ€è¦è®©æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰è‡ªå·±çš„ storeã€‚ å¹¶ä¸”å•ä¾‹ store ä¹Ÿå°†è®©æµ‹è¯•å˜å¾—å›°éš¾ã€‚å½“æµ‹è¯• action creator æ—¶ä½ å°†æ— æ³•è‡ªå·±æ¨¡æ‹Ÿä¸€ä¸ª storeï¼Œå› ä¸ºå®ƒä»¬éƒ½å¼•ç”¨äº†ä»å¤–éƒ¨å¯¼å…¥çš„é‚£ä¸ªç‰¹å®šçš„ storeï¼Œæ‰€ä»¥ä½ ç”šè‡³æ— æ³•ä»å¤–éƒ¨é‡ç½®çŠ¶æ€ã€‚ 2.1.4. redux-thunk ä¸­é—´ä»¶é¦–å…ˆå£°æ˜ redux-thunk è¿™ç§æ–¹æ¡ˆå¯¹äºå°å‹çš„åº”ç”¨æ¥è¯´è¶³å¤Ÿæ—¥å¸¸ä½¿ç”¨ï¼Œç„¶é¹…å¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ï¼Œä½ å¯èƒ½ä¼šå‘ç°ä¸€äº›ä¸æ–¹ä¾¿çš„åœ°æ–¹ã€‚ï¼ˆä¾‹å¦‚å¯¹äº action éœ€è¦ç»„åˆã€å–æ¶ˆã€ç«äº‰ç­‰å¤æ‚æ“ä½œçš„åœºæ™¯ï¼‰ é¦–å…ˆæ¥æ˜ç¡®ä»€ä¹ˆæ˜¯ thunkâ€¦ A thunk is a function that wraps an expression to delay its evaluation. ç®€å•æ¥è¯´ thunk å°±æ˜¯å°è£…äº†è¡¨è¾¾å¼çš„å‡½æ•°ï¼Œç›®çš„æ˜¯å»¶è¿Ÿæ‰§è¡Œè¯¥è¡¨è¾¾å¼ã€‚ä¸è¿‡æœ‰å•¥åº”ç”¨åœºæ™¯å‘¢ï¼Ÿ ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ä¸Šæ–‡ä¸­çš„ 2.1.2. å¼‚æ­¥ action creator éƒ¨åˆ†ï¼Œæœ€åå¾—å‡ºçš„æ–¹æ¡ˆæœ‰ä»¥ä¸‹æ˜æ˜¾çš„ç¼ºç‚¹ æˆ‘ä»¬å¿…é¡»å°† dispatch ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ è¿™æ ·ä¸€æ¥ä»»ä½•ä½¿ç”¨äº†å¼‚æ­¥æ“ä½œçš„ç»„ä»¶éƒ½å¿…é¡»ç”¨ props ä¼ é€’ dispatchï¼ˆä¸ç®¡æœ‰å¤šæ·±â€¦ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿæ²¡æ³•åƒä¹‹å‰å„ç§åŒæ­¥æ“ä½œä¸€æ ·ä½¿ç”¨ connect å‡½æ•°æ¥ç»‘å®šå›è°ƒå‡½æ•°ï¼Œå› ä¸º showNotificationWithTimeout å‡½æ•°è¿”å›çš„ä¸æ˜¯ä¸€ä¸ª actionã€‚ æ­¤å¤–ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŒºåˆ†å“ªäº›å‡½æ•°æ˜¯åŒæ­¥çš„ action creatorï¼Œé‚£äº›æ˜¯å¼‚æ­¥çš„ action creatorã€‚ï¼ˆå¼‚æ­¥çš„éœ€è¦ä¼  dispatchâ€¦ï¼‰ åŒæ­¥çš„æƒ…å†µ: store.dispatch(actionCreator(payload)) å¼‚æ­¥çš„æƒ…å†µ: asyncActionCreator(store.dispatch, payload) è®¡å°†å®‰å‡ºï¼Ÿ å…¶å®é—®é¢˜çš„æœ¬è´¨åœ¨äº Redux â€œæœ‰çœ¼ä¸è¯† functionâ€ï¼Œç›®å‰ä¸ºæ­¢ dispatch å‡½æ•°æ¥æ”¶çš„å‚æ•°åªèƒ½æ˜¯ action creator è¿”å›çš„æ™®é€šçš„ actionã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è®© dispatch å¯¹äº function ç½‘å¼€ä¸€é¢ï¼Œèµ°èµ°åé—¨æ½œè§„åˆ™ä¸€ä¸‹ä¸å°±è¡Œå•¦~ å®ç°æ–¹å¼å¾ˆç®€å•ï¼Œæƒ³æƒ³ç¬¬ä¸€èŠ‚ä»‹ç»çš„ä¸º dispatch æ·»åŠ æ—¥å¿—åŠŸèƒ½çš„è¿‡ç¨‹ã€‚ 123456789101112131415// redux-thunk æºç function createThunkMiddleware(extraArgument) &#123; return (&#123; dispatch, getState &#125;) =&gt; next =&gt; action =&gt; &#123; if (typeof action === 'function') &#123; return action(dispatch, getState, extraArgument); &#125; return next(action); &#125;;&#125;const thunk = createThunkMiddleware();thunk.withExtraArgument = createThunkMiddleware;export default thunk; ä»¥ä¸Šå°±æ˜¯ redux-thunk çš„æºç ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œåˆ¤æ–­ä¸‹å¦‚æœä¼ å…¥çš„ action æ˜¯å‡½æ•°çš„è¯ï¼Œå°±æ‰§è¡Œè¿™ä¸ªå‡½æ•°â€¦ï¼ˆwithExtraArgument æ˜¯ä¸ºäº†æ·»åŠ é¢å¤–çš„å‚æ•°ï¼Œè¯¦æƒ…è§ redux-thunk çš„ README.mdï¼‰ è¿™æ ·ä¸€æ¥å¦‚æœæˆ‘ä»¬ dispatch äº†ä¸€ä¸ªå‡½æ•°ï¼Œredux-thunk ä¼šä¼ ç»™å®ƒä¸€ä¸ª dispatch å‚æ•°ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨ thunk è§£å†³äº†ç»„ä»¶ä¸­ä¸æ–¹ä¾¿è·å– dispatch çš„é—®é¢˜ã€‚ å¹¶ä¸”ç”±äº redux-thunk æ‹¦æˆªäº†å‡½æ•°ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢ reducer æ¥æ”¶åˆ°å‡½æ•°è€Œå‡ºç°å¼‚å¸¸ã€‚ æ·»åŠ äº† redux-thunk ä¸­é—´ä»¶åä»£ç å¯ä»¥è¿™ä¹ˆå†™ã€‚ 123456789101112131415161718192021// actions.js// ...let nextNotificationId = 0;export function showNotificationWithTimeout(text) &#123; // è¿”å›ä¸€ä¸ªå‡½æ•° return function(dispatch) &#123; const id = nextNotificationId++; dispatch(showNotification(id, text)); setTimeout(() =&gt; &#123; dispatch(hideNotification(id)); &#125;, 5000); &#125;;&#125;// component.js åƒåŒæ­¥å‡½æ•°ä¸€æ ·çš„å†™æ³•this.props.dispatch(showNotificationWithTimeout('You just logged in.'));// æˆ–è€… connect åç›´æ¥è°ƒç”¨this.props.showNotificationWithTimeout('You just logged in.'); 2.2. æ¥å£åº”ç”¨åœºæ™¯ç›®å‰æˆ‘ä»¬å¯¹äºç®€å•çš„å»¶æ—¶å¼‚æ­¥æ“ä½œçš„å¤„ç†å·²ç»äº†ç„¶äºèƒ¸äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹é€šè¿‡ ajax æˆ– jsonp ç­‰æ¥å£æ¥è·å–æ•°æ®çš„å¼‚æ­¥åœºæ™¯ã€‚ å¾ˆè‡ªç„¶çš„ï¼Œæˆ‘ä»¬ä¼šå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åç­‰å¾…è¯·æ±‚çš„å“åº”ï¼ˆè¯·æ±‚å¯èƒ½æˆåŠŸæˆ–æ˜¯å¤±è´¥ï¼‰ã€‚ å³æœ‰åŸºæœ¬çš„ä¸‰ç§çŠ¶æ€å’Œä¸ä¹‹å¯¹åº”çš„ actionï¼š è¯·æ±‚å¼€å§‹çš„ actionï¼šisFetching ä¸ºçœŸï¼ŒUI æ˜¾ç¤ºåŠ è½½ç•Œé¢{ type: &#39;FETCH_POSTS_REQUEST&#39; } è¯·æ±‚æˆåŠŸçš„ actionï¼šisFetching ä¸ºå‡ï¼Œéšè—åŠ è½½ç•Œé¢å¹¶æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®{ type: &#39;FETCH_POSTS_SUCCESS&#39;, response: { ... } } è¯·æ±‚å¤±è´¥çš„ actionï¼šisFetching ä¸ºå‡ï¼Œéšè—åŠ è½½ç•Œé¢ï¼Œå¯èƒ½ä¿å­˜å¤±è´¥ä¿¡æ¯å¹¶åœ¨ UI ä¸­æ˜¾ç¤ºå‡ºæ¥{ type: &#39;FETCH_POSTS_FAILURE&#39;, error: &#39;Oops&#39; } æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œä¸¾ä¸€ä¸ªç®€å•çš„æ —å­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445// Constantsconst FETCH_POSTS_REQUEST = 'FETCH_POSTS_REQUEST';const FETCH_POSTS_SUCCESS = 'FETCH_POSTS_SUCCESS';const FETCH_POSTS_FAILURE = 'FETCH_POSTS_FAILURE';// Actionsconst requestPosts = (id) =&gt; (&#123; type: FETCH_POSTS_REQUEST, payload: id,&#125;);const receivePosts = (res) =&gt; (&#123; type: FETCH_POSTS_SUCCESS, payload: res,&#125;);const catchPosts = (err) =&gt; (&#123; type: FETCH_POSTS_FAILURE, payload: err,&#125;);const fetchPosts = (id) =&gt; (dispatch, getState) =&gt; &#123; dispatch(requestPosts(id)); return api.getData(id) .then(res =&gt; dispatch(receivePosts(res))) .catch(error =&gt; dispatch(catchPosts(error)));&#125;;// reducerconst reducer = (oldState, action) =&gt; &#123; switch (action.type) &#123; case FETCH_POSTS_REQUEST: return requestState; case FETCH_POSTS_SUCCESS: return successState; case FETCH_POSTS_FAILURE: return errorState; default: return oldState; &#125;&#125;; å°½ç®¡è¿™å·²ç»æ˜¯æœ€ç®€å•çš„è°ƒç”¨æ¥å£åœºæ™¯ï¼Œæˆ‘ä»¬ç”šè‡³è¿˜æ²¡å†™ä¸€è¡Œä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œä½†è®²é“ç†çš„è¯ä»£ç è¿˜æ˜¯æ¯”è¾ƒç¹ççš„ã€‚ è€Œä¸”å…¶å®ä»£ç æ˜¯æœ‰ä¸€å®šçš„â€œå¥—è·¯â€çš„ï¼Œæ¯”å¦‚å…¶å®æ•´ä¸ªä»£ç éƒ½æ˜¯é’ˆå¯¹è¯·æ±‚ã€æˆåŠŸã€å¤±è´¥ä¸‰éƒ¨åˆ†æ¥å¤„ç†çš„ï¼Œè¿™è®©æˆ‘ä»¬è‡ªç„¶è”æƒ³åˆ° Promiseï¼ŒåŒæ ·ä¹Ÿæ˜¯åˆ†ä¸º pendingã€fulfilledã€rejected ä¸‰ç§çŠ¶æ€ã€‚ é‚£ä¹ˆè¿™ä¸¤è€…å¯ä»¥ç»“åˆèµ·æ¥è®©æ¨¡ç‰ˆä»£ç ç²¾ç®€ä¸€ä¸‹ä¹ˆï¼Ÿ 2.2.1. redux-promise ä¸­é—´ä»¶[8]é¦–å…ˆå¼€é—¨è§å±±åœ°ä½¿ç”¨ redux-promise ä¸­é—´ä»¶æ¥æ”¹å†™ä¹‹å‰çš„ä»£ç çœ‹çœ‹æ•ˆæœã€‚ 12345678910111213141516171819202122232425// Constantsconst FETCH_POSTS_REQUEST = 'FETCH_POSTS_REQUEST';// Actionsconst fetchPosts = (id) =&gt; (&#123; type: FETCH_POSTS_REQUEST, payload: api.getData(id), // payload ä¸º Promise å¯¹è±¡&#125;);// reducerconst reducer = (oldState, action) =&gt; &#123; switch (action.type) &#123; case FETCH_POSTS_REQUEST: // requestState è¢«â€œåƒæ‰â€äº† // è€ŒæˆåŠŸã€å¤±è´¥çš„çŠ¶æ€é€šè¿‡ status æ¥åˆ¤æ–­ if (action.status === 'success') &#123; return successState; &#125; else &#123; return errorState; &#125; default: return oldState; &#125;&#125;; å¯ä»¥çœ‹å‡º redux-promise ä¸­é—´ä»¶æ¯”è¾ƒæ¿€è¿›ã€æ¯”è¾ƒåŸæ•™æ—¨ã€‚ ä¸ä½†å°†å‘èµ·è¯·æ±‚çš„åˆå§‹çŠ¶æ€è¢«æ‹¦æˆªäº†ï¼ˆåŸå› è§ä¸‹æ–‡æºç ï¼‰ï¼Œè€Œä¸”ä½¿ç”¨ action.status è€Œä¸æ˜¯ action.type æ¥åŒºåˆ†ä¸¤ä¸ª action è¿™ä¸€åšæ³•ä¹Ÿå€¼å¾—å•†æ¦·ï¼ˆä¸ªäººå€¾å‘ä½¿ç”¨ action.type æ¥åˆ¤æ–­ï¼‰ã€‚ 1234567891011121314151617181920212223242526272829// redux-promise æºç import &#123; isFSA &#125; from 'flux-standard-action';function isPromise(val) &#123; return val &amp;&amp; typeof val.then === 'function';&#125;export default function promiseMiddleware(&#123; dispatch &#125;) &#123; return next =&gt; action =&gt; &#123; if (!isFSA(action)) &#123; return isPromise(action) ? action.then(dispatch) : next(action); &#125; return isPromise(action.payload) // ç›´æ¥è°ƒç”¨ Promise.thenï¼ˆæ‰€ä»¥å‘ä¸å‡ºè¯·æ±‚å¼€å§‹çš„ actionï¼‰ ? action.payload.then( // è‡ªåŠ¨ dispatch result =&gt; dispatch(&#123; ...action, payload: result &#125;), // è‡ªåŠ¨ dispatch error =&gt; &#123; dispatch(&#123; ...action, payload: error, error: true &#125;); return Promise.reject(error); &#125; ) : next(action); &#125;;&#125; ä»¥ä¸Šæ˜¯ redux-promise çš„æºç ï¼Œååˆ†ç®€å•ã€‚ä¸»è¦é€»è¾‘æ˜¯åˆ¤æ–­å¦‚æœæ˜¯ Promise å°±æ‰§è¡Œ then æ–¹æ³•ã€‚æ­¤å¤–è¿˜æ ¹æ®æ˜¯ä¸æ˜¯ FSA å†³å®šè°ƒç”¨çš„æ˜¯ action æœ¬èº«è¿˜æ˜¯ action.payload å¹¶ä¸”å¯¹äº FSA ä¼šè‡ªåŠ¨ dispatch æˆåŠŸå’Œå¤±è´¥çš„ FSAã€‚ 2.2.2. redux-promise-middleware ä¸­é—´ä»¶å°½ç®¡ redux-promise ä¸­é—´ä»¶èŠ‚çœäº†å¤§é‡ä»£ç ï¼Œç„¶é¹…å®ƒçš„ç¼ºç‚¹é™¤äº†æ‹¦æˆªè¯·æ±‚å¼€å§‹çš„ actionï¼Œä»¥åŠä½¿ç”¨ action.status æ¥åˆ¤æ–­æˆåŠŸå¤±è´¥çŠ¶æ€ä»¥å¤–ï¼Œè¿˜æœ‰å°±æ˜¯ç”±æ­¤å¼•ç”³å‡ºçš„ä¸€ä¸ªæ— æ³•å®ç°çš„åœºæ™¯â€”â€”â€”â€”ä¹è§‚æ›´æ–°ï¼ˆOptimistic Updateï¼‰ã€‚ ä¹è§‚æ›´æ–°æ¯”è¾ƒç›´è§‚çš„æ —å­å°±æ˜¯åœ¨å¾®ä¿¡ã€QQç­‰é€šè®¯è½¯ä»¶ä¸­ï¼Œå‘é€çš„æ¶ˆæ¯ç«‹å³åœ¨å¯¹è¯çª—å£ä¸­å±•ç¤ºï¼Œå¦‚æœå‘é€å¤±è´¥äº†ï¼Œåœ¨æ¶ˆæ¯æ—è¾¹å±•ç¤ºæç¤ºå³å¯ã€‚ç”±äºåœ¨è¿™ç§äº¤äº’æ–¹å¼ä¸­â€œä¹è§‚â€åœ°ç›¸ä¿¡æ“ä½œä¼šæˆåŠŸï¼Œå› æ­¤ç§°ä½œä¹è§‚æ›´æ–°ã€‚ å› ä¸ºä¹è§‚æ›´æ–°å‘ç”Ÿåœ¨ç”¨æˆ·å‘èµ·æ“ä½œæ—¶ï¼Œæ‰€ä»¥è¦å®ç°å®ƒï¼Œæ„å‘³ç€å¿…é¡»æœ‰è¡¨ç¤ºç”¨æˆ·åˆå§‹åŠ¨ä½œçš„ actionã€‚ å› æ­¤ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç›¸å¯¹äºæ¯”è¾ƒåŸæ•™æ—¨çš„ redux-promise æ¥è¯´ï¼Œæ›´åŠ æ¸©å’Œæ´¾ä¸€ç‚¹çš„ redux-promise-middleware ä¸­é—´ä»¶åº”è¿è€Œç”Ÿã€‚å…ˆçœ‹çœ‹ä»£ç æ€ä¹ˆè¯´ã€‚ 12345678910111213141516171819202122232425262728// Constantsconst FETCH_POSTS = 'FETCH_POSTS'; // å‰ç¼€// Actionsconst fetchPosts = (id) =&gt; (&#123; type: FETCH_POSTS, // ä¼ é€’çš„æ˜¯å‰ç¼€ï¼Œä¸­é—´ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸­é—´çŠ¶æ€ payload: &#123; promise: api.getData(id), data: id, &#125;,&#125;);// reducerconst reducer = (oldState, action) =&gt; &#123; switch (action.type) &#123; case `$&#123;FETCH_POSTS&#125;_PENDING`: return requestState; // å¯é€šè¿‡ action.payload.data è·å– id case `$&#123;FETCH_POSTS&#125;_FULFILLED`: return successState; case `$&#123;FETCH_POSTS&#125;_REJECTED`: return errorState; default: return oldState; &#125;&#125;; å¦‚æœä¸éœ€è¦ä¹è§‚æ›´æ–°ï¼ŒfetchPosts å‡½æ•°å¯ä»¥æ›´åŠ ç®€æ´ã€‚12345// æ­¤æ—¶åˆå§‹ actionGET_DATA_PENDING ä»ç„¶ä¼šè§¦å‘ï¼Œä½†æ˜¯ payload ä¸ºç©ºã€‚const fetchPosts = (id) =&gt; (&#123; type: FETCH_POSTS, // ä¼ é€’çš„æ˜¯å‰ç¼€ payload: api.getData(id), // ç­‰ä»·äº payload: &#123; promise: api.getData(id) &#125;,&#125;); ç›¸å¯¹äº redux-promise ç®€å•ç²—æš´åœ°ç›´æ¥è¿‡æ»¤åˆå§‹ actionï¼Œä» reducer å¯ä»¥çœ‹å‡ºï¼Œredux-promise-middleware ä¼šé¦–å…ˆè‡ªåŠ¨è§¦å‘ä¸€ä¸ª FETCH_POSTS_PENDING çš„ actionï¼Œä»¥æ­¤ä¿ç•™ä¹è§‚æ›´æ–°çš„èƒ½åŠ›ã€‚ å¹¶ä¸”ï¼Œåœ¨çŠ¶æ€çš„åŒºåˆ†ä¸Šï¼Œå›å½’äº†é€šè¿‡ action.type æ¥åˆ¤æ–­çŠ¶æ€çš„â€œæ­£é€”â€ï¼Œå…¶ä¸­ _PENDINGã€_FULFILLEDã€_REJECTED åç¼€å€Ÿç”¨äº† Promise è§„èŒƒ (å½“ç„¶å®ƒä»¬æ˜¯å¯é…ç½®çš„) ã€‚ åç¼€å¯ä»¥é…ç½®å…¨å±€æˆ–å±€éƒ¨ç”Ÿæ•ˆï¼Œä¾‹å¦‚å…¨å±€é…ç½®å¯ä»¥è¿™ä¹ˆå†™ã€‚12345applyMiddleware( promiseMiddleware(&#123; promiseTypeSuffixes: ['LOADING', 'SUCCESS', 'ERROR'] &#125;)) æºç åœ°å€ç‚¹æˆ‘ï¼Œç±»ä¼¼ redux-promise ä¹Ÿæ˜¯åœ¨ä¸­é—´ä»¶ä¸­æ‹¦æˆªäº† payload ä¸­æœ‰ Promise çš„ actionï¼Œå¹¶ä¸»åŠ¨ dispatch ä¸‰ç§çŠ¶æ€çš„ actionï¼Œæ³¨é‡Šä¹Ÿå¾ˆè¯¦ç»†åœ¨æ­¤å°±ä¸èµ˜è¿°äº†ã€‚ æ³¨æ„ï¼šredux-promiseã€redux-promise-middleware ä¸ redux-thunk ä¹‹é—´å¹¶ä¸æ˜¯äº’ç›¸æ›¿ä»£çš„å…³ç³»ï¼Œè€Œæ›´åƒä¸€ç§è¡¥å……ä¼˜åŒ–ã€‚ 2.3. redux-loop ä¸­é—´ä»¶ç®€å•å°ç»“ä¸€ä¸‹ï¼ŒRedux çš„æ•°æ®æµå¦‚ä¸‹æ‰€ç¤ºï¼š UI =&gt; action =&gt; action creator =&gt; reducer =&gt; store =&gt; react =&gt; v-dom =&gt; UI redux-thunk çš„æ€è·¯æ˜¯ä¿æŒ action å’Œ reducer ç®€å•çº¯ç²¹ï¼Œç„¶é¹…å‰¯ä½œç”¨æ“ä½œï¼ˆåœ¨å‰ç«¯ä¸»è¦ä½“ç°åœ¨å¼‚æ­¥æ“ä½œä¸Šï¼‰çš„å¤æ‚åº¦æ˜¯ä¸å¯é¿å…çš„ï¼Œå› æ­¤å®ƒå°†å…¶æ”¾åœ¨äº† action creator æ­¥éª¤ï¼Œé€šè¿‡ thunk å‡½æ•°æ‰‹åŠ¨æ§åˆ¶æ¯ä¸€æ¬¡çš„ dispatchã€‚ redux-promise å’Œ redux-promise-middleware åªæ˜¯åœ¨å…¶åŸºç¡€ä¸Šåšä¸€äº›è¾…åŠ©æ€§çš„å¢å¼ºï¼Œå¤„ç†å¼‚æ­¥çš„é€»è¾‘æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå³å°†ç»´æŠ¤å¤æ‚å¼‚æ­¥æ“ä½œçš„è´£ä»»æ¨åˆ°äº†ç”¨æˆ·çš„èº«ä¸Šã€‚ è¿™ç§å®ç°æ–¹å¼å›ºç„¶å¾ˆå¥½ç†è§£ï¼Œè€Œä¸”ç†è®ºä¸Šå¯ä»¥åº”ä»˜æ‰€æœ‰å¼‚æ­¥åœºæ™¯ï¼Œä½†æ˜¯ç”±æ­¤å¸¦æ¥çš„é—®é¢˜å°±æ˜¯æ¨¡ç‰ˆä»£ç å¤ªå¤šï¼Œä¸€æ—¦æµç¨‹å¤æ‚é‚£ä¹ˆå¼‚æ­¥ä»£ç å°±ä¼šåˆ°å¤„éƒ½æ˜¯ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´å‡ºç° bugã€‚ å› æ­¤æœ‰ä¸€äº›å…¶ä»–çš„ä¸­é—´ä»¶ï¼Œä¾‹å¦‚ redux-loop å°±å°†å¼‚æ­¥å¤„ç†é€»è¾‘æ”¾åœ¨ reducer ä¸­ã€‚ï¼ˆRedux çš„æ€æƒ³å€Ÿé‰´äº† Elmï¼Œæ³¨æ„å¹¶ä¸æ˜¯â€œé¥¿äº†ä¹ˆâ€ï¼Œè€Œ Elm å°±æ˜¯å°†å¼‚æ­¥å¤„ç†æ”¾åœ¨ updateï¼ˆreducerï¼‰ å±‚ä¸­ï¼‰ã€‚ Synchronous state transitions caused by returning a new state from the reducer in response to an action are just one of all possible effects an action can have on application state.è¿™ç§é€šè¿‡å“åº”ä¸€ä¸ª actionï¼Œåœ¨ reducer ä¸­è¿”å›ä¸€ä¸ªæ–° stateï¼Œä»è€Œå¼•èµ·åŒæ­¥çŠ¶æ€è½¬æ¢çš„æ–¹å¼ï¼Œåªæ˜¯åœ¨åº”ç”¨çŠ¶æ€ä¸­ä¸€ä¸ª action èƒ½æ‹¥æœ‰çš„æ‰€æœ‰å¯èƒ½å½±å“çš„ä¸€ç§ã€‚ï¼ˆå¯èƒ½æ²¡ç¿»å¥½~æ¬¢è¿å‹˜è¯¯~ï¼‰ redux-loop è®¤ä¸ºè®¸å¤šå…¶ä»–çš„å¤„ç†å¼‚æ­¥çš„ä¸­é—´ä»¶ï¼Œå°¤å…¶æ˜¯é€šè¿‡ action creator æ–¹å¼å®ç°çš„ä¸­é—´ä»¶ï¼Œé”™è¯¯åœ°è®©ç”¨æˆ·è®¤ä¸ºå¼‚æ­¥æ“ä½œä»æ ¹æœ¬ä¸Šä¸åŒæ­¥æ“ä½œå¹¶ä¸ç›¸åŒã€‚è¿™æ ·ä¸€æ¥æ— å½¢ä¸­é¼“åŠ±äº†ä¸­é—´ä»¶ä»¥è®¸å¤šç‰¹æ®Šçš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥çŠ¶æ€ã€‚ ä¸ä¹‹ç›¸åï¼Œredux-loop ä¸“æ³¨äºè®© reducer å˜å¾—è¶³å¤Ÿå¼ºå¤§ä»¥ä¾¿å¤„ç†åŒæ­¥å’Œå¼‚æ­¥æ“ä½œã€‚åœ¨å…·ä½“å®ç°ä¸Š reducer ä¸ä»…èƒ½å¤Ÿæ ¹æ®ç‰¹å®šçš„ action å†³å®šå½“å‰çš„è½¬æ¢çŠ¶æ€ï¼Œè€Œä¸”è¿˜èƒ½å†³å®šæ¥ç€å‘ç”Ÿçš„æ“ä½œã€‚ åº”ç”¨ä¸­æ‰€æœ‰è¡Œä¸ºéƒ½å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹ï¼ˆreducerï¼‰ä¸­è¢«è¿½è¸ªï¼Œå¹¶ä¸”è¿™äº›è¡Œä¸ºå¯ä»¥è½»æ˜“åœ°åˆ†å‰²å’Œç»„åˆã€‚ï¼ˆredux ä½œè€… Dan å¼€äº†ä¸ªè‡³ä»Šä¾ç„¶ open çš„ issueï¼šReducer Composition with Effects in JavaScriptï¼Œè®¨è®ºå…³äºå¯¹ reducer è¿›è¡Œåˆ†å‰²ç»„åˆçš„é—®é¢˜ã€‚ï¼‰ redux-loop æ¨¡ä»¿ Elm çš„æ¨¡å¼ï¼Œå¼•å…¥äº† Effect çš„æ¦‚å¿µï¼Œåœ¨ reducer ä¸­å¯¹äºå¼‚æ­¥ç­‰æ“ä½œä½¿ç”¨ Effect æ¥å¤„ç†ã€‚å¦‚ä¸‹å®˜æ–¹ç¤ºä¾‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324import &#123; Effects, loop &#125; from 'redux-loop';function fetchData(id) &#123; return fetch(`endpoint/$&#123;id&#125;`) .then((r) =&gt; r.json()) .then((data) =&gt; (&#123; type: 'FETCH_SUCCESS', payload: data &#125;)) .catch((error) =&gt; (&#123; type: 'FETCH_FAILURE', payload: error.message &#125;));&#125;function reducer(state, action) &#123; switch(action.type) &#123; case 'FETCH_START': return loop( // &lt;- å¹¶æ²¡æœ‰ç›´æ¥è¿”å› stateï¼Œå®é™…ä¸Šäº†è¿”å›æ•°ç»„ [state, effect] &#123; ...state, loading: true &#125;, Effects.promise(fetchData, action.payload.id) ); case 'FETCH_SUCCESS': return &#123; ...state, loading: false, data: action.payload &#125;; case 'FETCH_FAILURE': return &#123; ...state, loading: false, errorMessage: action.payload &#125;; &#125;&#125; è™½ç„¶è¿™ä¸ªæƒ³æ³•å¾ˆ Elm å¾ˆå‡½æ•°å¼ï¼Œä¸è¿‡ç”±äºä¿®æ”¹äº† reducer çš„è¿”å›ç±»å‹ï¼Œè¿™æ ·ä¸€æ¥ä¼šå¯¼è‡´è®¸å¤šå·²æœ‰çš„ Api å’Œç¬¬ä¸‰æ–¹åº“æ— æ³•ä½¿ç”¨ï¼Œç”šè‡³è¿ redux åº“ä¸­çš„ combineReducers æ–¹æ³•éƒ½éœ€è¦ä½¿ç”¨ redux-loop æä¾›çš„å®šåˆ¶ç‰ˆæœ¬ã€‚å› æ­¤è¿™ä¹Ÿæ˜¯ redux-loop æœ€ç»ˆæ— æ³•è½¬æ­£çš„åŸå› ï¼š â€œIf a solution doesnâ€™t work with vanilla combineReducers(), it wonâ€™t get into Redux core.â€ ä¸‰ã€å¤æ‚å¼‚æ­¥æ“ä½œ3.1. æ›´å¤æ‚çš„é€šçŸ¥åœºæ™¯[9]è®©æˆ‘ä»¬çš„æ€è·¯é‡æ–°å›åˆ°é€šçŸ¥çš„åœºæ™¯ï¼Œä¹‹å‰çš„ä»£ç å®ç°äº†ï¼š å±•ç¤ºä¸€ä¸ªé€šçŸ¥å¹¶åœ¨æ•°ç§’åæ¶ˆå¤± å¯ä»¥åŒæ—¶å±•ç¤ºå¤šä¸ªé€šçŸ¥ã€‚ ç°åœ¨å‡è®¾å¯äº²å¯çˆ±çš„äº§å“åˆæå‡ºäº†æ–°éœ€æ±‚ï¼š åŒæ—¶ä¸å±•ç¤ºå¤šäº3ä¸ªçš„é€šçŸ¥ å¦‚æœå·²æœ‰3ä¸ªé€šçŸ¥æ­£åœ¨å±•ç¤ºï¼Œæ­¤æ—¶çš„æ–°é€šçŸ¥è¯·æ±‚å°†æ’é˜Ÿå»¶è¿Ÿå±•ç¤ºã€‚ â€œè¿™ä¸ªå®ç°ä¸äº†â€¦â€ï¼ˆå…¨æ–‡å®Œï¼‰ è¿™ä¸ªå½“ç„¶å¯ä»¥å®ç°ï¼Œåªä¸è¿‡å¦‚æœåªç”¨ä¹‹å‰çš„ redux-thunk å®ç°èµ·æ¥ä¼šå¾ˆéº»çƒ¦ã€‚ä¾‹å¦‚å¯ä»¥åœ¨ store ä¸­å¢åŠ ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«è¡¨ç¤ºå½“å‰å±•ç¤ºåˆ—è¡¨å’Œç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶ååœ¨ reducer ä¸­æ‰‹åŠ¨æ§åˆ¶å„ä¸ªçŠ¶æ€æ—¶è¿™ä¿©æ•°ç»„çš„å˜åŒ–ã€‚ 3.2. redux-saga ä¸­é—´ä»¶é¦–å…ˆæ¥çœ‹çœ‹ä½¿ç”¨äº† redux-saga åä»£ç ä¼šå˜æˆæ€æ ·~ï¼ˆä»£ç æ¥è‡ªç”Ÿäº§ç¯å¢ƒçš„æŸ appï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768function* toastSaga() &#123; const MaxToasts = 3; const ToastDisplayTime = 4000; let pendingToasts = []; // ç­‰å¾…é˜Ÿåˆ— let activeToasts = []; // å±•ç¤ºåˆ—è¡¨ function* displayToast(toast) &#123; if ( activeToasts &gt;= MaxToasts ) &#123; throw new Error(\"can't display more than \" + MaxToasts + \" at the same time\"); &#125; activeToasts = [...activeToasts, toast]; // æ–°å¢é€šçŸ¥åˆ°å±•ç¤ºåˆ—è¡¨ yield put(events.toastDisplayed(toast)); // å±•ç¤ºé€šçŸ¥ yield call(delay, ToastDisplayTime); // é€šçŸ¥çš„å±•ç¤ºæ—¶é—´ yield put(events.toastHidden(toast)); // éšè—é€šçŸ¥ activeToasts = _.without(activeToasts,toast); // ä»å±•ç¤ºåˆ—è¡¨ä¸­åˆ é™¤ &#125; function* toastRequestsWatcher() &#123; while (true) &#123; const event = yield take(Names.TOAST_DISPLAY_REQUESTED); // ç›‘å¬é€šçŸ¥å±•ç¤ºè¯·æ±‚ const newToast = event.data.toastData; pendingToasts = [...pendingToasts, newToast]; // å°†æ–°é€šçŸ¥æ”¾å…¥ç­‰å¾…é˜Ÿåˆ— &#125; &#125; function* toastScheduler() &#123; while (true) &#123; if (activeToasts.length &lt; MaxToasts &amp;&amp; pendingToasts.length &gt; 0) &#123; const [firstToast,...remainingToasts] = pendingToasts; pendingToasts = remainingToasts; yield fork(displayToast, firstToast); // å–å‡ºé˜Ÿå¤´çš„é€šçŸ¥è¿›è¡Œå±•ç¤º // å¢åŠ ä¸€ç‚¹å»¶è¿Ÿï¼Œè¿™æ ·ä¸€æ¥ä¸¤ä¸ªå¹¶å‘çš„é€šçŸ¥è¯·æ±‚ä¸ä¼šåŒæ—¶å±•ç¤º yield call(delay, 300); &#125; else &#123; yield call(delay, 50); &#125; &#125; &#125; yield [ call(toastRequestsWatcher), call(toastScheduler) ]&#125;// reducerconst reducer = (state = &#123;toasts: []&#125;, event) =&gt; &#123; switch (event.name) &#123; case Names.TOAST_DISPLAYED: return &#123; ...state, toasts: [...state.toasts, event.data.toastData] &#125;; case Names.TOAST_HIDDEN: return &#123; ...state, toasts: _.without(state.toasts, event.data.toastData) &#125;; default: return state; &#125;&#125;; å…ˆä¸è¦åœ¨æ„ä»£ç çš„ç»†èŠ‚ï¼Œç®€å•åˆ†æä¸€ä¸‹ä¸Šè¿°ä»£ç çš„é€»è¾‘ï¼š store ä¸Šåªæœ‰ä¸€ä¸ª toasts èŠ‚ç‚¹ï¼Œä¸” reducer ååˆ†å¹²å‡€ æ’é˜Ÿç­‰å…·ä½“çš„ä¸šåŠ¡é€»è¾‘éƒ½æ”¾åˆ°äº† toastSaga å‡½æ•°ä¸­ displayToast å‡½æ•°è´Ÿè´£å•ä¸ªé€šçŸ¥çš„å±•ç¤ºå’Œæ¶ˆå¤±é€»è¾‘ toastRequestsWatcher å‡½æ•°è´Ÿè´£ç›‘å¬è¯·æ±‚ï¼Œå°†å…¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ— toastScheduler å‡½æ•°è´Ÿè´£å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…ƒç´ åŠ å…¥å±•ç¤ºåˆ—è¡¨ åŸºäºè¿™æ ·é€»è¾‘åˆ†ç¦»çš„å†™æ³•ï¼Œè¿˜å¯ä»¥ç»§ç»­æ»¡è¶³æ›´åŠ å¤æ‚çš„éœ€æ±‚ï¼š å¦‚æœåœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰å¤ªå¤šé€šçŸ¥ï¼ŒåŠ¨æ€å‡å°‘é€šçŸ¥çš„å±•ç¤ºæ—¶é—´ æ ¹æ®çª—å£å¤§å°çš„å˜åŒ–ï¼Œæ”¹å˜æœ€å¤šå±•ç¤ºçš„é€šçŸ¥æ•°é‡ â€¦ redux-saga V.S. redux-thunk[11]redux-saga çš„ä¼˜ç‚¹ï¼š æ˜“äºæµ‹è¯•ï¼Œå› ä¸º redux-saga ä¸­æ‰€æœ‰æ“ä½œéƒ½ yield ç®€å•å¯¹è±¡ï¼Œæ‰€ä»¥æµ‹è¯•åªè¦åˆ¤æ–­è¿”å›çš„å¯¹è±¡æ˜¯å¦æ­£ç¡®å³å¯ï¼Œè€Œæµ‹è¯• thunk é€šå¸¸éœ€è¦ä½ åœ¨æµ‹è¯•ä¸­å¼•å…¥ä¸€ä¸ª mockStore redux-saga æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„è¾…åŠ©æ–¹æ³•ã€‚ï¼ˆtakeLatestã€cancelã€race ç­‰ï¼‰ åœ¨ saga å‡½æ•°ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘å’Œå¼‚æ­¥æ“ä½œï¼Œè¿™æ ·ä¸€æ¥é€šå¸¸ä»£ç æ›´åŠ æ¸…æ™°ï¼Œæ›´å®¹æ˜“å¢åŠ å’Œæ›´æ”¹åŠŸèƒ½ ä½¿ç”¨ ES6 çš„ generatorï¼Œä»¥åŒæ­¥çš„æ–¹å¼å†™å¼‚æ­¥ä»£ç  redux-saga çš„ç¼ºç‚¹ï¼š generator çš„è¯­æ³•ï¼ˆâ€åˆæ˜¯ * åˆæ˜¯ yield çš„ï¼Œå¾ˆéš¾ç†è§£è¯¶~â€ï¼‰ å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œæœ‰è®¸å¤šæ¦‚å¿µéœ€è¦å­¦ä¹ ï¼ˆâ€forkã€join è¿™ä¸æ˜¯è¿›ç¨‹çš„æ¦‚å¿µä¹ˆï¼Ÿè¿™äº› yield æ˜¯ä»¥ä»€ä¹ˆé¡ºåºæ‰§è¡Œçš„ï¼Ÿâ€ï¼‰ API çš„ç¨³å®šæ€§ï¼Œä¾‹å¦‚æ–°å¢äº† channel ç‰¹æ€§ï¼Œå¹¶ä¸”ç¤¾åŒºä¹Ÿä¸æ˜¯å¾ˆå¤§ã€‚ é€šçŸ¥åœºæ™¯å„ç§ä¸­é—´ä»¶å†™æ³•çš„å®Œæ•´ä»£ç å¯ä»¥çœ‹è¿™é‡Œ 3.3. ç†è§£ Saga Pattern[14]3.3.1. Saga æ˜¯ä»€ä¹ˆSagas çš„æ¦‚å¿µæ¥æºäºè¿™ç¯‡è®ºæ–‡ï¼Œè¯¥è®ºæ–‡ä»æ•°æ®åº“çš„è§’åº¦è°ˆäº† Saga Patternã€‚ Saga å°±æ˜¯èƒ½å¤Ÿæ»¡è¶³ç‰¹å®šæ¡ä»¶çš„é•¿äº‹åŠ¡ï¼ˆLong Lived Transactionï¼‰ æš‚ä¸”ä¸æè¿™ä¸ªç‰¹å®šæ¡ä»¶æ˜¯ä»€ä¹ˆï¼Œé¦–å…ˆä¸€èˆ¬å­¦è¿‡æ•°æ®åº“çš„éƒ½çŸ¥é“äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯å•¥~ å¦‚æœä¸çŸ¥é“çš„è¯å¯ä»¥ç”¨è½¬è´¦æ¥ç†è§£ï¼ŒA è½¬ç»™ B 100 å—é’±çš„æ“ä½œéœ€è¦ä¿è¯å®Œæˆ A å…ˆå‡ 100 å—é’±ç„¶å B åŠ  100 å—é’±è¿™ä¸¤ä¸ªæ“ä½œï¼Œè¿™æ ·æ‰èƒ½ä¿è¯è½¬è´¦å‰å A å’Œ B çš„å­˜æ¬¾æ€»é¢ä¸å˜ã€‚å¦‚æœåœ¨ç»™ B åŠ  100 å—é’±çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±è¦è¿”å›è½¬è´¦å‰çš„çŠ¶æ€ï¼Œå³ç»™ A å†åŠ ä¸Šä¹‹å‰å‡çš„ 100 å—é’±(ä¸ç„¶é’±å°±ä¸ç¿¼è€Œé£äº†)ï¼Œè¿™æ ·çš„ä¸€æ¬¡è½¬è´¦ï¼ˆè¦ä¹ˆè½¬æˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥è¿”å›è½¬è´¦å‰çš„çŠ¶æ€ï¼‰å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ã€‚ 3.3.2. é•¿äº‹åŠ¡çš„é—®é¢˜ é•¿äº‹åŠ¡é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªé•¿æ—¶é—´çš„äº‹åŠ¡ã€‚ ä¸€èˆ¬æ¥è¯´æ˜¯é€šè¿‡ç»™æ­£åœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œçš„å¯¹è±¡åŠ é”ï¼Œæ¥ä¿è¯äº‹åŠ¡å¹¶å‘æ—¶ä¸ä¼šå‡ºé”™ã€‚ ä¾‹å¦‚ A å’Œ B éƒ½ç»™ C è½¬ 100 å—é’±ã€‚ å¦‚æœä¸åŠ é”ï¼Œæç«¯æƒ…å†µä¸‹ A å…ˆè½¬ç»™ C 100 å—ï¼Œè€Œ B è¯»å–åˆ°äº† C è½¬è´¦å‰çš„æ•°å€¼ï¼Œè¿™æ—¶ B çš„è½¬è´¦ä¼šè¦†ç›– A çš„è½¬è´¦ï¼ŒC åªåŠ äº† 100 å—é’±ï¼Œå¦ 100 å—ä¸ç¿¼è€Œé£äº†ã€‚ å¦‚æœåŠ äº†é”ï¼Œè¿™æ—¶ B çš„è½¬è´¦ä¼šç­‰å¾… A çš„è½¬è´¦å®Œæˆåå†è¿›è¡Œã€‚æ‰€ä»¥ C èƒ½æ­£ç¡®åœ°æ”¶åˆ° 200 å—é’±ã€‚ ä»¥æŠ¼å°¾å…‰å¤ªéƒçš„æŒ‡å¼¹æ¼”å¥ä¼šå”®ç¥¨ä¸¾ä¾‹ï¼Œåœ¨ä¸€ä¸ªå”®ç¥¨çš„æ—¶é—´æ®µåï¼Œæœ€ç»ˆä¸¾åŠæ–¹éœ€è¦ç¡®å®šå”®ç¥¨æ•°é‡ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªé•¿äº‹åŠ¡ã€‚ ç„¶é¹…ï¼Œå¯¹äºé•¿äº‹åŠ¡æ¥è¯´æ€»ä¸èƒ½ä¸€ç›´é”ä½å¯¹åº”æ•°æ®å§ï¼Ÿ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡è®¾ä¸€ä¸ªé•¿äº‹åŠ¡ï¼šTï¼Œ å¯ä»¥è¢«æ‹†åˆ†æˆè®¸å¤šç›¸äº’ç‹¬ç«‹çš„å­äº‹åŠ¡ï¼ˆsubtransactionï¼‰ï¼št_1 ~ t_nã€‚ ä»¥ä¸Šè¿°æŠ¼å°¾æ¡‘çš„è¡¨æ¼”ä¸ºä¾‹ï¼Œæ¯ä¸ª t å°±æ˜¯ä¸€ç¬”å”®ç¥¨è®°å½•ã€‚ å‡å¦‚æ¯æ¬¡è´­ç¥¨éƒ½ä¸€æ¬¡æˆåŠŸï¼Œä¸”æ²¡æœ‰é€€ç¥¨çš„è¯ï¼Œæ•´ä¸ªæµç¨‹å°±å¦‚ä¸‹å›¾ä¸€èˆ¬è¢«æ­£å¸¸åœ°æ‰§è¡Œã€‚ é‚£å‡å¦‚æœ‰æŸæ¬¡è´­ç¥¨å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ 3.3.3. Saga çš„ç‰¹æ®Šæ¡ä»¶ A LLT is a saga if it can be written as a sequence of transactions that can be interleaved with other transactions.Saga å°±æ˜¯èƒ½å¤Ÿè¢«å†™æˆäº‹åŠ¡çš„åºåˆ—ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«å…¶ä»–äº‹åŠ¡æ’å…¥æ‰§è¡Œçš„é•¿äº‹åŠ¡ã€‚ Saga é€šè¿‡å¼•å…¥è¡¥å¿äº‹åŠ¡ï¼ˆCompensating Transactionï¼‰çš„æ¦‚å¿µï¼Œè§£å†³äº‹åŠ¡å¤±è´¥çš„é—®é¢˜ã€‚ å³ä»»ä½•ä¸€ä¸ª saga ä¸­çš„å­äº‹åŠ¡ t_iï¼Œéƒ½æœ‰ä¸€ä¸ªè¡¥å¿äº‹åŠ¡ c_i è´Ÿè´£å°†å…¶æ’¤é”€ï¼ˆundoï¼‰ã€‚ æ³¨æ„æ˜¯æ’¤é”€è¯¥å­äº‹åŠ¡ï¼Œè€Œä¸æ˜¯å›åˆ°å­äº‹åŠ¡å‘ç”Ÿå‰çš„æ—¶é—´ç‚¹ã€‚ æ ¹æ®ä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥æ¨å‡ºå¾ˆç®€å•çš„å…¬å¼ï¼š Saga å¦‚æœå…¨éƒ¨æ‰§è¡ŒæˆåŠŸé‚£ä¹ˆå­äº‹åŠ¡åºåˆ—çœ‹èµ·æ¥åƒè¿™æ ·ï¼št_1, t_2, t_3, ..., t_n Saga å¦‚æœæ‰§è¡Œå…¨éƒ¨å¤±è´¥é‚£ä¹ˆå­äº‹åŠ¡åºåˆ—çœ‹èµ·æ¥åƒè¿™æ ·ï¼št_1, t_2, t_3, ..., t_n, c_n, ..., c_1 æ³¨æ„åˆ°å›¾ä¸­çš„ c_4 å…¶å®å¹¶æ²¡æœ‰å¿…è¦ï¼Œä¸è¿‡å› ä¸ºæ¯æ¬¡æ’¤é”€æ‰§è¡Œéƒ½åº”è¯¥æ˜¯å¹‚ç­‰ï¼ˆIdempotentï¼‰çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šå‡ºé”™ã€‚ ç¯‡å¹…æœ‰é™åœ¨æ­¤å°±ä¸ç»§ç»­æ·±å…¥ä»‹ç»â€¦ æ¨èçœ‹çœ‹ä»åˆ†å¸ƒå¼ç³»ç»Ÿæ–¹é¢è®² Saga Pattern çš„è§†é¢‘ï¼šGOTO 2015 â€¢ Applying the Saga Pattern â€¢ Caitie McCaffrey MSDN çš„æ–‡ç« ï¼šA Saga on Sagas 3.4. å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰[15]redux-saga ä¸­é—´ä»¶åŸºäº Sagas çš„ç†è®ºï¼Œé€šè¿‡ç›‘å¬ actionï¼Œç”Ÿæˆå¯¹åº”çš„å„ç§å­ sagaï¼ˆå­äº‹åŠ¡ï¼‰è§£å†³äº†å¤æ‚å¼‚æ­¥é—®é¢˜ã€‚ è€Œæ¥ä¸‹æ¥è¦ä»‹ç»çš„ redux-observable ä¸­é—´ä»¶èƒŒåçš„ç†è®ºæ˜¯å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰ã€‚ In computing, reactive programming is a programming paradigm oriented around data flows and the propagation of change. ç®€å•æ¥è¯´ï¼Œå“åº”å¼ç¼–ç¨‹æ˜¯é’ˆå¯¹å¼‚æ­¥æ•°æ®æµçš„ç¼–ç¨‹å¹¶ä¸”è®¤ä¸ºï¼šä¸‡ç‰©çš†æµï¼ˆEverything is Streamï¼‰ã€‚ æµï¼ˆStreamï¼‰å°±æ˜¯éšç€æ—¶é—´çš„æµé€è€Œå‘ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ã€‚ ä¾‹å¦‚ç‚¹å‡»äº‹ä»¶çš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·ã€‚ ç”¨å­—ç¬¦è¡¨ç¤ºã€ä¸Šä¸Šä¸‹ä¸‹å·¦å³å·¦å³BABAã€‘å¯ä»¥åƒè¿™æ ·ã€‚ï¼ˆæ³¨æ„é¡ºåºæ˜¯ä»å·¦å¾€å³ï¼‰ 123456--ä¸Š----ä¸Š-ä¸‹---ä¸‹----å·¦---å³-B--A-B--A---X-|-&gt;ä¸Š, ä¸‹, å·¦, å³, B, A æ˜¯æ•°æ®æµå‘å°„çš„å€¼X æ˜¯æ•°æ®æµå‘å°„çš„é”™è¯¯| æ˜¯å®Œæˆä¿¡å·---&gt; æ˜¯æ—¶é—´çº¿ é‚£ä¹ˆæˆ‘ä»¬è¦æ ¹æ®ä¸€ä¸ªç‚¹å‡»æµæ¥è®¡ç®—ç‚¹å‡»æ¬¡æ•°çš„è¯å¯ä»¥è¿™æ ·ã€‚ï¼ˆä¸€èˆ¬å“åº”å¼ç¼–ç¨‹åº“éƒ½ä¼šæä¾›è®¸å¤šè¾…åŠ©æ–¹æ³•å¦‚ mapã€filterã€scan ç­‰ï¼‰ 12345 clickStream: ---c----c--c----c------c--&gt; map(c becomes 1) ---1----1--1----1------1--&gt; scan(+)counterStream: ---1----2--3----4------5--&gt; å¦‚ä¸Šæ‰€ç¤ºï¼ŒåŸå§‹çš„ clickStream ç»è¿‡ map åäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„æµï¼ˆæ³¨æ„åŸå§‹æµä¸å˜ï¼‰ï¼Œå†å¯¹è¯¥æµè¿›è¡Œ scan(+) çš„æ“ä½œå°±ç”Ÿæˆäº†æœ€ç»ˆçš„ counterStreamã€‚ å†æ¥ä¸ªæ —å­~ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä»ç‚¹å‡»æµä¸­å¾—åˆ°å…³äºåŒå‡»çš„æµï¼ˆ250ms ä»¥å†…ï¼‰ï¼Œå¹¶ä¸”å¯¹äºå¤§äºä¸¤æ¬¡çš„ç‚¹å‡»ä¹Ÿè®¤ä¸ºæ˜¯åŒå‡»ã€‚å…ˆæƒ³ä¸€æƒ³åº”è¯¥æ€ä¹ˆç”¨ä¼ ç»Ÿçš„å‘½ä»¤å¼ã€çŠ¶æ€å¼çš„æ–¹å¼æ¥å†™ï¼Œç„¶åå†æƒ³æƒ³ç”¨æµçš„æ€è€ƒæ–¹å¼åˆä¼šæ˜¯æ€ä¹ˆæ ·çš„~ã€‚ è¿™é‡Œæˆ‘ä»¬ç”¨äº†ä»¥ä¸‹è¾…åŠ©æ–¹æ³•ï¼š èŠ‚æµï¼šthrottle(250ms)ï¼Œå°†åŸå§‹æµåœ¨ 250ms å†…çš„æ‰€æœ‰æ•°æ®å½“ä½œä¸€æ¬¡äº‹ä»¶å‘å°„ ç¼“å†²ï¼ˆä¸é€ ç¿»è¯‘æˆå•¥æ¯”è¾ƒå¥½ï¼‰ï¼šbufferï¼Œå°† 250ms å†…æ”¶é›†çš„æ•°æ®æ”¾å…¥ä¸€ä¸ªæ•°æ®åŒ…è£¹ä¸­ï¼Œç„¶åå‘å°„è¿™äº›åŒ…è£¹ æ˜ å°„ï¼šmapï¼Œè¿™ä¸ªä¸è§£é‡Š è¿‡æ»¤ï¼šfilterï¼Œè¿™ä¸ªä¹Ÿä¸è§£é‡Š æ›´å¤šå†…å®¹è¯·ç»§ç»­å­¦ä¹  RxJSã€‚ 3.5. redux-observable ä¸­é—´ä»¶[16]redux-observable å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ RxJS ç›‘å¬æ¯ä¸ª action å¹¶å°†å…¶å˜æˆå¯è§‚æµ‹æµï¼ˆobservable streamï¼‰çš„ä¸­é—´ä»¶ã€‚ å…¶ä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µå«åš epicï¼Œå°±æ˜¯ä¸€ä¸ªç›‘å¬æµä¸Š action çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ¥æ”¶ action å¹¶è¿›è¡Œä¸€äº›æ“ä½œåå¯ä»¥å†è¿”å›æ–°çš„ actionã€‚ At the highest level, epics are â€œactions in, actions outâ€ redux-observable é€šè¿‡åœ¨åå°æ‰§è¡Œ .subscribe(store.dispatch) å®ç°ç›‘å¬ã€‚ Epic åƒ Saga ä¸€æ ·ä¹Ÿæ˜¯ Long Livedï¼Œå³åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶å¯åŠ¨ï¼ŒæŒç»­è¿è¡Œåˆ°åº”ç”¨å…³é—­ã€‚è™½ç„¶ redux-observable æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä½†æ˜¯ç±»ä¼¼äº redux-sagaï¼Œå¯ä»¥æƒ³è±¡å®ƒå°±åƒæ–°å¼€çš„è¿›/çº¿ç¨‹ï¼Œç›‘å¬ç€ actionã€‚ åœ¨è¿™ä¸ªè¿è¡Œæµç¨‹ä¸­ï¼Œepic ä¸åƒ thunk ä¸€æ ·æ‹¦æˆª actionï¼Œæˆ–é˜»æ­¢ã€æ”¹å˜ä»»ä½•åŸæœ¬ redux çš„ç”Ÿå‘½å‘¨æœŸçš„å…¶ä»–ä¸œè¥¿ã€‚è¿™æ„å‘³ç€æ¯ä¸ª dispatch çš„ action æ€»ä¼šç»è¿‡ reducer å¤„ç†ï¼Œå®é™…ä¸Šåœ¨ epic ç›‘å¬åˆ° action å‰ï¼Œaction å·²ç»è¢« reducer å¤„ç†è¿‡äº†ã€‚ æ‰€ä»¥ epic çš„åŠŸèƒ½å°±æ˜¯ç›‘å¬æ‰€æœ‰çš„ actionï¼Œè¿‡æ»¤å‡ºéœ€è¦è¢«ç›‘å¬çš„éƒ¨åˆ†ï¼Œå¯¹å…¶æ‰§è¡Œä¸€äº›å¸¦å‰¯ä½œç”¨çš„å¼‚æ­¥æ“ä½œï¼Œç„¶åæ ¹æ®ä½ çš„éœ€è¦å¯ä»¥å†å‘å°„ä¸€äº›æ–°çš„ actionã€‚ ä¸¾ä¸ªè‡ªåŠ¨ä¿å­˜çš„æ —å­ï¼Œç•Œé¢ä¸Šæœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæ¯æ¬¡ç”¨æˆ·è¾“å…¥äº†æ•°æ®åï¼Œå»æŠ–åŠ¨åè¿›è¡Œè‡ªåŠ¨ä¿å­˜ï¼Œå¹¶åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ­£åœ¨ä¿å­˜çš„ UIï¼Œæœ€åæ˜¾ç¤ºæˆåŠŸæˆ–å¤±è´¥çš„ UIã€‚ ä½¿ç”¨ redux-observable ä¸­é—´ä»¶ç¼–å†™ä»£ç ï¼Œå¯ä»¥ä»…ç”¨åå‡ è¡Œå…³é”®ä»£ç å°±å®ç°ä¸Šè¿°åŠŸèƒ½ã€‚ 123456789101112131415161718192021222324252627282930import &#123; Observable &#125; from 'rxjs/Observable';import 'rxjs/add/observable/dom/ajax';import 'rxjs/add/observable/of';import 'rxjs/add/operator/catch';import 'rxjs/add/operator/debounceTime';import 'rxjs/add/operator/map';import 'rxjs/add/operator/mergeMap';import 'rxjs/add/operator/startWith';import &#123; isSaving, savingSuccess, savingError,&#125; from '../actions/autosave-actions.js';const saveField = (action$) =&gt; // ä¸€èˆ¬åœ¨å˜é‡åé¢åŠ  $ è¡¨ç¤ºæ˜¯ä¸ª stream action$ .ofType('SAVE_FIELD') // ä½¿ç”¨ ofType ç›‘å¬ 'SAVE_FIELD' action .debounceTime(500) // é˜²æŠ–åŠ¨ // å³ map + mergeAll å› ä¸ºå¼‚æ­¥å¯¼è‡´ map åæœ‰å¤šä¸ªæµéœ€è¦ merge .mergeMap((&#123; payload &#125;) =&gt; Observable.ajax(&#123; // å‘èµ·è¯·æ±‚ method: 'PATCH', url: payload.url, body: JSON.stringify(payload), &#125;) .map(res =&gt; savingSuccess(res)) // å‘å‡ºæˆåŠŸçš„ action .catch(err =&gt; Observable.of(savingError(err))) // æ•æ‰é”™è¯¯å¹¶å‘å‡º action .startWith(isSaving()) // å‘å‡ºè¯·æ±‚å¼€å§‹çš„ action );export default saveField; ç¯‡å¹…æœ‰é™åœ¨æ­¤å°±ä¸ç»§ç»­æ·±å…¥ä»‹ç»â€¦ å…³äº redux-observable çš„å‰ä¸–ä»Šç”Ÿæ¨èçœ‹çœ‹ Netfix å·¥ç¨‹å¸ˆçš„è¿™ä¸ªè§†é¢‘ï¼šNetflix JavaScript Talks - RxJS + Redux + React = Amazing! å¦‚æœè§‰å¾—çœ‹è§†é¢‘å¬è‹±è¯­éº»çƒ¦çš„è¯çŸ¥ä¹æœ‰äººç¿»è¯‘äº†â€¦ RxJS + Redux + React = Amazing!ï¼ˆè¯‘ä¸€ï¼‰ RxJS + Redux + React = Amazing!ï¼ˆè¯‘äºŒï¼‰ å››ã€æ€»ç»“æœ¬æ–‡ä»ä¸º Redux åº”ç”¨æ·»åŠ æ—¥å¿—åŠŸèƒ½ï¼ˆè®°å½•æ¯ä¸€æ¬¡çš„ dispatchï¼‰å…¥æ‰‹ï¼Œå¼•å‡º redux çš„ä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰çš„æ¦‚å¿µå’Œå®ç°æ–¹æ³•ã€‚ æ¥ç€ä»æœ€ç®€å•çš„ setTimeout çš„å¼‚æ­¥æ“ä½œå¼€å§‹ï¼Œé€šè¿‡å¯¹æ¯”å„ç§å®ç°æ–¹æ³•å¼•å‡º redux æœ€åŸºç¡€çš„å¼‚æ­¥ä¸­é—´ä»¶ redux-thunkã€‚ é’ˆå¯¹ redux-thunk ä½¿ç”¨æ—¶æ¨¡ç‰ˆä»£ç è¿‡å¤šçš„é—®é¢˜ï¼Œæœ‰ä»‹ç»äº†ç”¨äºä¼˜åŒ–çš„ redux-promise å’Œ redux-promise-middleware ä¸¤æ¬¾ä¸­é—´ä»¶ã€‚ ç”±äºæœ¬è´¨ä¸Šä»¥ä¸Šä¸­é—´ä»¶éƒ½æ˜¯åŸºäº thunk çš„æœºåˆ¶æ¥è§£å†³å¼‚æ­¥é—®é¢˜ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°å°†ç»´æŠ¤å¼‚æ­¥çŠ¶æ€çš„è´£ä»»æ¨ç»™äº†å¼€å‘è€…ï¼Œå¹¶ä¸”ä¹Ÿå› ä¸ºéš¾ä»¥æµ‹è¯•çš„åŸå› ã€‚åœ¨å¤æ‚çš„å¼‚æ­¥åœºæ™¯ä¸‹ä½¿ç”¨èµ·æ¥éš¾å…åŠ›ä¸ä»å¿ƒï¼Œå®¹æ˜“å‡ºç° bugã€‚ æ‰€ä»¥è¿˜ç®€å•ä»‹ç»äº†ä¸€ä¸‹å°†å¤„ç†å‰¯ä½œç”¨çš„æ­¥éª¤æ”¾åˆ° reducer ä¸­å¹¶é€šè¿‡ Effect è¿›è¡Œè§£å†³çš„ redux-loop ä¸­é—´ä»¶ã€‚ç„¶é¹…å› ä¸ºå…¶æ— æ³•ä½¿ç”¨å®˜æ–¹ combineReducers çš„åŸå› è€Œæ— æ³•è¢«çº³å…¥ redux æ ¸å¿ƒä»£ç ä¸­ã€‚ æ­¤å¤–ç¤¾åŒºæ ¹æ® Saga çš„æ¦‚å¿µï¼Œåˆ©ç”¨ ES6 çš„ generator å®ç°äº† redux-saga ä¸­é—´ä»¶ã€‚è™½ç„¶é€šè¿‡ saga å‡½æ•°å°†ä¸šåŠ¡ä»£ç åˆ†ç¦»ï¼Œå¹¶ä¸”å¯ä»¥ç”¨åŒæ­¥çš„æ–¹å¼æµç¨‹æ¸…æ™°åœ°ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä½†æ˜¯è¾ƒå¤šçš„æ–°æ¦‚å¿µå’Œ generator çš„è¯­æ³•å¯èƒ½è®©éƒ¨åˆ†å¼€å‘è€…æœ›è€Œå´æ­¥ã€‚ åŒæ ·æ˜¯åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œé€šè¿‡ç›‘å¬ action æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„ redux-observable ä¸­é—´ä»¶ï¼ŒèƒŒåçš„æ€æƒ³æ˜¯å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰ã€‚ç±»ä¼¼äº sagaï¼Œè¯¥ä¸­é—´ä»¶æå‡ºäº† epic çš„æ¦‚å¿µæ¥å¤„ç†å‰¯ä½œç”¨ã€‚å³ç›‘å¬ action æµï¼Œä¸€æ—¦ç›‘å¬åˆ°ç›®æ ‡ actionï¼Œå°±å¤„ç†ç›¸å…³å‰¯ä½œç”¨ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åœ¨å¤„ç†åå†å‘å°„æ–°çš„ actionï¼Œç»§ç»­è¿›è¡Œå¤„ç†ã€‚å°½ç®¡åœ¨å¤„ç†å¼‚æ­¥æµç¨‹æ—¶åŒæ ·ååˆ†æ–¹ä¾¿ï¼Œä½†å¯¹äºå¼€å‘è€…çš„è¦æ±‚åŒæ ·å¾ˆé«˜ï¼Œéœ€è¦å¼€å‘è€…å­¦ä¹ å…³äºå‡½æ•°å¼çš„ç›¸å…³ç†è®ºã€‚ äº”ã€å‚è€ƒèµ„æ–™ Redux è‹±æ–‡åŸç‰ˆæ–‡æ¡£ Redux ä¸­æ–‡æ–‡æ¡£ Dan Abramov - how to dispatch a redux action with a timeout é˜®ä¸€å³° - Redux å…¥é—¨æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šä¸­é—´ä»¶ä¸å¼‚æ­¥æ“ä½œ Redux èå¼æ•™ç¨‹ redux middleware è¯¦è§£ Thunk å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³• Reduxå¼‚æ­¥æ–¹æ¡ˆé€‰å‹ Sebastien Lorber - how to dispatch a redux action with a timeout Sagas è®ºæ–‡ Pros/cons of using redux-saga with ES6 generators vs redux-thunk with ES7 async/await Redux-saga è‹±æ–‡æ–‡æ¡£ Redux-saga ä¸­æ–‡æ–‡æ¡£ Saga Pattern åœ¨å‰ç«¯çš„æ‡‰ç”¨ The introduction to Reactive Programming youâ€™ve been missing Epic Middleware in Redux ä»¥ä¸Š to be continuedâ€¦","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://buptsteve.github.io/blog/tags/JavaScript/"},{"name":"Redux","slug":"Redux","permalink":"https://buptsteve.github.io/blog/tags/Redux/"},{"name":"React","slug":"React","permalink":"https://buptsteve.github.io/blog/tags/React/"}]},{"title":"ã€Œ7ã€Redux åŸºç¡€ - react å…¨å®¶æ¡¶å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰","date":"2016-10-25T15:00:35.000Z","path":"2016/10/25/7.redux-basis/","text":"é›¶ã€ç¯å¢ƒæ­å»ºå‚è€ƒèµ„æ–™ è‹±æ–‡åŸç‰ˆæ–‡æ¡£ ä¸­æ–‡æ–‡æ¡£ å¢™è£‚æ¨èä½œè€…å‡ºçš„æ•™å­¦è§†é¢‘ åŸºç¡€ç¯‡ å¢™è£‚æ¨èä½œè€…å‡ºçš„æ•™å­¦è§†é¢‘ é«˜çº§ç¯‡ é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œè™½ç„¶ redux æ˜¯ç”± flux æ¼”å˜è€Œæ¥ï¼Œä½†æˆ‘ä»¬å®Œå…¨å¯ä»¥å¹¶ä¸”ä¹Ÿåº”è¯¥æŠ›å¼€ react è¿›è¡Œå­¦ä¹ ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€å¼€å§‹å°±é™·å…¥å„ç§ç»†èŠ‚ä¹‹ä¸­ã€‚ æ‰€ä»¥æ¨èä½¿ç”¨ jsbin è¿›è¡Œè°ƒè¯•å­¦ä¹ ï¼Œæˆ–è€…ä½¿ç”¨ react-create-app ä½œä¸ºé¡¹ç›®è„šæ‰‹æ¶ã€‚ ä¸€ã€Redux æ˜¯ä»€ä¹ˆï¼Ÿ Redux is a predictable state container for JavaScript apps.Redux æ˜¯ä¸€ä¸ª JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚ å…ˆä¸è¦åœ¨æ„é‚£äº›ç»†èŠ‚ æ€»çš„æ¥è¯´ï¼Œredux ä½¿ç”¨ store ä¿å­˜å¹¶ç®¡ç†é¡µé¢ä¸­çš„å„ç§çŠ¶æ€ï¼ˆstateï¼‰ å½“éœ€è¦æ”¹å˜ state æ—¶ï¼Œä½¿ç”¨ dispatch è°ƒç”¨ action creators è§¦å‘ action æ¥ç€ä½¿ç”¨çº¯å‡½æ•°ï¼ˆpure functionï¼‰reducer æ¥å¤„ç†è¿™äº› actionï¼Œå®ƒä¼šæ ¹æ®å½“å‰ state å’Œ action è¿”å›ï¼ˆæ³¨æ„è¿™é‡Œä¸æ˜¯ä¿®æ”¹ï¼‰æ–°çš„ state view å±‚å¯ä»¥å¯¹äº state è¿›è¡Œè®¢é˜…ï¼ˆsubscribeï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æ–°çš„ stateï¼Œä»è€Œå¯ä»¥åˆ·æ–°ç•Œé¢ï¼ˆæ‰€ä»¥ååˆ†é€‚åˆæ•°æ®é©±åŠ¨çš„å‰ç«¯æ¡†æ¶ï¼‰ çº¯å‡½æ•°ï¼šç®€å•çš„è¯´å°±æ˜¯å¯¹äºåŒæ ·çš„è¾“å…¥æ€»æ˜¯è¿”å›åŒæ ·çš„è¾“å‡ºï¼Œå¹¶ä¸”æ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ã€‚ï¼ˆæ¨èå­¦ä¹ äº†è§£ä¸‹å‡½æ•°å¼ç¼–ç¨‹ï¼‰ 1.1. ä¸ºä»€ä¹ˆé€‰æ‹© reduxï¼Ÿ éšç€ JavaScript å•é¡µåº”ç”¨å¼€å‘æ—¥è¶‹å¤æ‚ï¼ŒJavaScript éœ€è¦ç®¡ç†æ¯”ä»»ä½•æ—¶å€™éƒ½è¦å¤šçš„ state ï¼ˆçŠ¶æ€ï¼‰ã€‚ è¿™äº› state å¯èƒ½åŒ…æ‹¬æœåŠ¡å™¨å“åº”ã€ç¼“å­˜æ•°æ®ã€æœ¬åœ°ç”Ÿæˆå°šæœªæŒä¹…åŒ–åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œä¹ŸåŒ…æ‹¬ UI çŠ¶æ€ï¼Œå¦‚æ¿€æ´»çš„è·¯ç”±ï¼Œè¢«é€‰ä¸­çš„æ ‡ç­¾ï¼Œæ˜¯å¦æ˜¾ç¤ºåŠ è½½åŠ¨æ•ˆæˆ–è€…åˆ†é¡µå™¨ç­‰ç­‰ã€‚ ç®¡ç†ä¸æ–­å˜åŒ–çš„ state éå¸¸å›°éš¾ã€‚å¦‚æœä¸€ä¸ª model çš„å˜åŒ–ä¼šå¼•èµ·å¦ä¸€ä¸ª model å˜åŒ–ï¼Œé‚£ä¹ˆå½“ view å˜åŒ–æ—¶ï¼Œå°±å¯èƒ½å¼•èµ·å¯¹åº” model ä»¥åŠå¦ä¸€ä¸ª model çš„å˜åŒ–ï¼Œä¾æ¬¡åœ°ï¼Œå¯èƒ½ä¼šå¼•èµ·å¦ä¸€ä¸ª view çš„å˜åŒ–ã€‚ç›´è‡³ä½ æä¸æ¸…æ¥šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚state åœ¨ä»€ä¹ˆæ—¶å€™ï¼Œç”±äºä»€ä¹ˆåŸå› ï¼Œå¦‚ä½•å˜åŒ–å·²ç„¶ä¸å—æ§åˆ¶ã€‚ å½“ç³»ç»Ÿå˜å¾—é”™ç»¼å¤æ‚çš„æ—¶å€™ï¼Œæƒ³é‡ç°é—®é¢˜æˆ–è€…æ·»åŠ æ–°åŠŸèƒ½å°±ä¼šå˜å¾—ä¸¾æ­¥ç»´è‰°ã€‚ å¦‚æœè¿™è¿˜ä¸å¤Ÿç³Ÿç³•ï¼Œè€ƒè™‘ä¸€äº›æ¥è‡ªå‰ç«¯å¼€å‘é¢†åŸŸçš„æ–°éœ€æ±‚ï¼Œå¦‚æ›´æ–°è°ƒä¼˜ã€æœåŠ¡ç«¯æ¸²æŸ“ã€è·¯ç”±è·³è½¬å‰è¯·æ±‚æ•°æ®ç­‰ç­‰ã€‚å‰ç«¯å¼€å‘è€…æ­£åœ¨ç»å—å‰æ‰€æœªæœ‰çš„å¤æ‚æ€§ï¼Œéš¾é“å°±è¿™ä¹ˆæ”¾å¼ƒäº†å—ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚ è¿™é‡Œçš„å¤æ‚æ€§å¾ˆå¤§ç¨‹åº¦ä¸Šæ¥è‡ªäºï¼šæˆ‘ä»¬æ€»æ˜¯å°†ä¸¤ä¸ªéš¾ä»¥å˜æ¸…çš„æ¦‚å¿µæ··æ·†åœ¨ä¸€èµ·ï¼šå˜åŒ–å’Œå¼‚æ­¥ã€‚ æˆ‘ç§°å®ƒä»¬ä¸ºæ›¼å¦¥æ€å’Œå¯ä¹ã€‚å¦‚æœæŠŠäºŒè€…åˆ†å¼€ï¼Œèƒ½åšçš„å¾ˆå¥½ï¼Œä½†æ··åˆ°ä¸€èµ·ï¼Œå°±å˜å¾—ä¸€å›¢ç³Ÿã€‚ä¸€äº›åº“å¦‚ React è¯•å›¾åœ¨è§†å›¾å±‚ç¦æ­¢å¼‚æ­¥å’Œç›´æ¥æ“ä½œ DOM æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼ŒReact ä¾æ—§æŠŠå¤„ç† state ä¸­æ•°æ®çš„é—®é¢˜ç•™ç»™äº†ä½ ã€‚Reduxå°±æ˜¯ä¸ºäº†å¸®ä½ è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è·Ÿéš Fluxã€CQRS å’Œ Event Sourcing çš„è„šæ­¥ï¼Œé€šè¿‡é™åˆ¶æ›´æ–°å‘ç”Ÿçš„æ—¶é—´å’Œæ–¹å¼ï¼ŒRedux è¯•å›¾è®© state çš„å˜åŒ–å˜å¾—å¯é¢„æµ‹ã€‚è¿™äº›é™åˆ¶æ¡ä»¶åæ˜ åœ¨ Redux çš„ ä¸‰å¤§åŸåˆ™ä¸­ã€‚ ç®€å•æ€»ç»“å°±æ˜¯ä½¿ç”¨ Redux æˆ‘ä»¬å°±å¯ä»¥æ²¡æœ‰è›€ç‰™ï¼ˆå¤§é›¾ï¼‰ æ‹¥æœ‰å¯é¢„æµ‹ï¼ˆpredictableï¼‰çš„åº”ç”¨çŠ¶æ€ï¼Œæ‰€ä»¥åº”ç”¨çš„è¡Œä¸ºä¹Ÿæ˜¯å¯é¢„æµ‹çš„ å› ä¸º reducer æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥æ–¹ä¾¿å¯¹äºçŠ¶æ€è¿ç§»è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯• æ–¹ä¾¿åœ°è®°å½•æ—¥å¿—ï¼Œç”šè‡³å®ç°æ—¶é—´æ—…è¡Œï¼ˆtime travelï¼‰ 1.2. ä¸‰å¤§åŸåˆ™ï¼ˆå“²â™‚å­¦ï¼‰1.2.1. å•ä¸€æ•°æ®æºï¼ˆSingle source of truthï¼‰æ•´ä¸ªåº”ç”¨çš„ state è¢«å‚¨å­˜åœ¨ä¸€æ£µ object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª store ä¸­ã€‚ æ¥è‡ªæœåŠ¡ç«¯çš„ state å¯ä»¥åœ¨æ— éœ€ç¼–å†™æ›´å¤šä»£ç çš„æƒ…å†µä¸‹è¢«åºåˆ—åŒ–å¹¶æ³¨å…¥åˆ°å®¢æˆ·ç«¯ä¸­ ä¾¿äºè°ƒè¯•ï¼Œåœ¨å¼€å‘æ—¶å¯ä»¥å°†çŠ¶æ€ä¿å­˜åœ¨æœ¬åœ° Undo/Redo å¯ä»¥è½»æ¾å®ç°ï¼Œä»è€Œå®ç°æ—¶é—´æ—…è¡Œ 1.2.2. State æ˜¯åªè¯»çš„ï¼ˆState is read-onlyï¼‰æƒŸä¸€æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯è§¦å‘ actionï¼Œaction æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚ å› ä¸ºæ‰€æœ‰çš„ä¿®æ”¹éƒ½è¢«é›†ä¸­åŒ–å¤„ç†ï¼Œä¸”ä¸¥æ ¼æŒ‰ç…§ä¸€ä¸ªæ¥ä¸€ä¸ªçš„é¡ºåºæ‰§è¡Œï¼Œï¼ˆdispatch åŒæ­¥è°ƒç”¨ reduce å‡½æ•°ï¼‰å› æ­¤ä¸ç”¨æ‹…å¿ƒ race condition çš„å‡ºç°ã€‚ Action å°±æ˜¯æ™®é€šå¯¹è±¡è€Œå·²ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥è¢«æ—¥å¿—æ‰“å°ã€åºåˆ—åŒ–ã€å‚¨å­˜ã€åæœŸè°ƒè¯•æˆ–æµ‹è¯•æ—¶å›æ”¾å‡ºæ¥ã€‚ 1.2.3. ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹ï¼ˆChanges are made with pure functionsï¼‰ä¸ºäº†æè¿° action å¦‚ä½•æ”¹å˜ state tree ï¼Œä½ éœ€è¦ç¼–å†™ reducerã€‚ Reducer åªæ˜¯çº¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶å…ˆå‰çš„ state å’Œ actionï¼Œå¹¶è¿”å›æ–°çš„ stateã€‚åˆšå¼€å§‹ä½ å¯ä»¥åªæœ‰ä¸€ä¸ª reducerï¼Œéšç€åº”ç”¨å˜å¤§ï¼Œä½ å¯ä»¥æŠŠå®ƒæ‹†æˆå¤šä¸ªå°çš„ reducersï¼Œåˆ†åˆ«ç‹¬ç«‹åœ°æ“ä½œ state tree çš„ä¸åŒéƒ¨åˆ†ã€‚ äºŒã€Redux åŸºç¡€2.1. actionAction å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript Objectã€‚ redux å”¯ä¸€é™åˆ¶çš„ä¸€ç‚¹æ˜¯å¿…é¡»æœ‰ä¸€ä¸ª type å±æ€§ç”¨æ¥è¡¨ç¤ºæ‰§è¡Œå“ªç§æ“ä½œï¼Œå€¼æœ€å¥½ç”¨å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ Symbolsï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯å¯è¢«åºåˆ—åŒ–çš„ã€‚ å…¶ä»–å±æ€§ç”¨æ¥ä¼ é€’æ­¤æ¬¡æ“ä½œæ‰€éœ€ä¼ é€’çš„æ•°æ®ï¼Œredux å¯¹æ­¤ä¸ä½œé™åˆ¶ï¼Œä½†æ˜¯åœ¨è®¾è®¡æ—¶å¯ä»¥å‚ç…§ Flux æ ‡å‡† Actionã€‚ ç®€å•æ€»ç»“ Flux Standard action å°±æ˜¯ ä¸€ä¸ª action å¿…é¡»æ˜¯ä¸€ä¸ª JavaScript Objectï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª type å±æ€§ã€‚ ä¸€ä¸ª action å¯ä»¥æœ‰ payload/error/meta å±æ€§ã€‚ ä¸€ä¸ª action ä¸èƒ½æœ‰å…¶ä»–å±æ€§ã€‚ 2.2. reducerReducer çš„å·¥ä½œå°±æ˜¯æ¥æ”¶æ—§çš„ state å’Œ actionï¼Œè¿”å›æ–°çš„ stateã€‚ (previousState, action) =&gt; newState ä¹‹æ‰€ä»¥ç§°ä½œ reducer æ˜¯å› ä¸ºå®ƒå°†è¢«ä¼ é€’ç»™ Array.prototype.reduce(reducer, ?initialValue) æ–¹æ³•ã€‚ä¿æŒ reducer çº¯å‡€éå¸¸é‡è¦ã€‚æ°¸è¿œä¸è¦åœ¨ reducer é‡Œåšè¿™äº›æ“ä½œï¼š ä¿®æ”¹ä¼ å…¥å‚æ•°ï¼› æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œå¦‚ API è¯·æ±‚å’Œè·¯ç”±è·³è½¬ï¼› è°ƒç”¨éçº¯å‡½æ•°ï¼Œå¦‚ Date.now() æˆ– Math.random()ã€‚ 2.3. storeStore å°±æ˜¯ç”¨æ¥ç»´æŒåº”ç”¨æ‰€æœ‰çš„ state æ ‘çš„ä¸€ä¸ªå¯¹è±¡ã€‚ åœ¨ redux ä¸­åªæœ‰ä¸€ä¸ª storeï¼ˆåŒºåˆ«äº flux çš„å¤šä¸ª storeï¼‰ï¼Œåœ¨ store ä¸­ä¿å­˜æ‰€æœ‰çš„ stateï¼Œå¯ä»¥æŠŠå®ƒå½“æˆä¸€ä¸ªå°è£…äº† state çš„ç±»ã€‚è€Œé™¤äº†å¯¹å…¶ dispatch ä¸€ä¸ª action ä»¥å¤–æ— æ³•æ”¹å˜å†…éƒ¨çš„ stateã€‚ åœ¨å®é™…æ“ä½œä¸­æˆ‘ä»¬åªéœ€è¦æŠŠæ ¹éƒ¨çš„ reducer å‡½æ•°ä¼ é€’ç»™ createStore å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª storeã€‚ 12345678910111213import &#123; createStore &#125; from 'redux';function reducer(state, action) &#123; switch (action.type) &#123; case 'SOME_ACTION': // ä¸€äº›æ“ä½œ return newState; // è¿”å›æ–°çŠ¶æ€ default: return state; &#125;&#125;const store = createStore(reducer); redux ä¸­æä¾›äº†è¿™å‡ ä¸ª api æ“ä½œ store 2.3.1. getStateè¿”å›å½“å‰çš„æ•´ä¸ª state æ ‘ã€‚ 2.3.2. dispatch(action)åˆ†å‘ action ç»™å¯¹åº”çš„ reducerã€‚ è¯¥å‡½æ•°ä¼šè°ƒç”¨ getState() å’Œä¼ å…¥çš„ action ä»¥ã€åŒæ­¥ã€‘çš„æ–¹å¼è°ƒç”¨ store çš„ reduce å‡½æ•°ï¼Œç„¶åè¿”å›æ–°çš„ stateã€‚ä»è€Œ state å¾—åˆ°äº†æ›´æ–°ï¼Œå¹¶ä¸”å˜åŒ–ç›‘å¬å™¨ï¼ˆchange listenerï¼‰ä¼šè¢«è§¦å‘ã€‚ï¼ˆå¯¹äºå¼‚æ­¥æ“ä½œåˆ™å°†å…¶æ”¾åˆ°äº† action creator è¿™ä¸ªæ­¥éª¤ï¼‰ 2.3.3. subscribe(listener)ä¸º store æ·»åŠ ä¸€ä¸ªå˜åŒ–ç›‘å¬å™¨ï¼Œæ¯å½“ dispatch çš„æ—¶å€™å°±ä¼šæ‰§è¡Œï¼Œä½ å¯ä»¥åœ¨ listenerï¼ˆå›è°ƒå‡½æ•°ï¼‰ä¸­ä½¿ç”¨ getState() æ¥å¾—åˆ°å½“å‰çš„ stateã€‚ è¿™ä¸ª api è®¾è®¡çš„æŒºæœ‰æ„æ€ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä½ æ‰§è¡Œè¿™ä¸ªå‡½æ•°åå°±å¯ä»¥å–æ¶ˆè®¢é˜…ã€‚ 2.3.4. replaceReducer(nextReducer)æ›¿æ¢ store å½“å‰ç”¨æ¥è®¡ç®— state çš„ reducerã€‚ è¿™æ˜¯ä¸€ä¸ªé«˜çº§ APIã€‚åªæœ‰åœ¨ä½ éœ€è¦å®ç°ä»£ç åˆ†éš”ï¼Œè€Œä¸”éœ€è¦ç«‹å³åŠ è½½ä¸€äº› reducer çš„æ—¶å€™æ‰å¯èƒ½ä¼šç”¨åˆ°å®ƒã€‚åœ¨å®ç° Redux çƒ­åŠ è½½æœºåˆ¶çš„æ—¶å€™ä¹Ÿå¯èƒ½ä¼šç”¨åˆ°ã€‚ 2.4. createStoreå¿½ç•¥å„ç§ç±»å‹åˆ¤æ–­ï¼Œå®ç°ä¸€ä¸ªæœ€ç®€çš„ createStore å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç ã€‚å‚è€ƒèµ„æ–™ 123456789101112131415161718192021222324const createStore = (reducer) =&gt; &#123; let state; let listeners = []; const getState = () =&gt; state; const dispatch = (action) =&gt; &#123; state = reducer(state, action); // è°ƒç”¨ reducer listeners.forEach(listener =&gt; listener()); // è°ƒç”¨æ‰€æœ‰å˜åŒ–ç›‘å¬å™¨ &#125;; const subscribe = (listener) =&gt; &#123; listeners.push(listener); return () =&gt; &#123; // è¿”å›è§£é™¤ç›‘å¬å‡½æ•° listeners = listeners.filter(l =&gt; l !== listener); &#125;; &#125; dispatch(&#123;&#125;); // åˆå§‹åŒ– return &#123; getState, dispatch, subscribe &#125;;&#125;; 2.5. è®¡æ•°å™¨ä¾‹å­ çº¯ JavaScript ä¸æ¶‰åŠç•Œé¢ï¼ˆå¯ä»¥åœ¨å³ä¾§ console ä¸­å°è¯• store.dispatchï¼‰ å¢åŠ ç•Œé¢ ä¸‰ã€ä¸ React è¿›è¡Œç»“åˆ3.1. é€šè¿‡ script æ ‡ç­¾å¯¼å…¥ reactå®ç°åŒæ ·åŠŸèƒ½çš„ Counter 3.2. ç”¨ Redux å’Œ React å®ç° TodoAppåœ¨æ·»åŠ  react-redux ä¹‹å‰ï¼Œä¸ºäº†ä½“ä¼šä¸‹ react-redux çš„ä½œç”¨ï¼Œé¦–å…ˆæ¥å®ç°ä¸€ä¸ªæ¯”è®¡æ•°å™¨æ›´å¤æ‚ä¸€ç‚¹å„¿çš„ TodoApp æ —å­~ 3.2.1. åˆ†æä¸è®¾è®¡1. å®¹å™¨ç»„ä»¶ V.S. å±•ç¤ºç»„ä»¶ç»„ä»¶ä¸€èˆ¬åˆ†ä¸º å®¹å™¨ç»„ä»¶ï¼ˆSmart/Container Componentsï¼‰ å±•ç¤ºç»„ä»¶ï¼ˆDumb/Presentational Componentsï¼‰ å®¹å™¨ç»„ä»¶ å±•ç¤ºç»„ä»¶ Location æœ€é¡¶å±‚ï¼Œè·¯ç”±å¤„ç† ä¸­é—´å’Œå­ç»„ä»¶ Aware of Redux æ˜¯ å¦ è¯»å–æ•°æ® ä» Redux è·å– state ä» props è·å–æ•°æ® ä¿®æ”¹æ•°æ® å‘ Redux æ´¾å‘ actions ä» props è°ƒç”¨å›è°ƒå‡½æ•° æœ€ä½³å®è·µä¸€èˆ¬æ˜¯ç”±å®¹å™¨ç»„ä»¶è´Ÿè´£ä¸€äº›æ•°æ®çš„è·å–ï¼Œè¿›è¡Œ dispatch ç­‰æ“ä½œã€‚è€Œå±•ç¤ºç»„ä»¶ç»„ä»¶ä¸åº”è¯¥å…³å¿ƒé€»è¾‘ï¼Œæ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ props ä¼ å…¥ã€‚ è¿™æ ·æ‰èƒ½è¾¾åˆ°å±•ç¤ºç»„ä»¶å¯ä»¥åœ¨å¤šå¤„å¤ç”¨ï¼Œåœ¨å…·ä½“å¤ç”¨æ—¶å°±æ˜¯é€šè¿‡å®¹å™¨ç»„ä»¶å°†å…¶åŒ…è£…ï¼Œä¸ºå…¶æä¾›æ‰€éœ€çš„å„ç§æ•°æ®ã€‚ 2. åº”ç”¨è®¾è®¡ ä¸€ä¸ª TodoApp åŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š é¡¶éƒ¨çš„ AddTodo è¾“å…¥éƒ¨åˆ† ä¸­é—´çš„ TodoList å±•ç¤ºéƒ¨åˆ† åº•éƒ¨çš„ Footer è¿‡æ»¤éƒ¨åˆ† State åº”è¯¥åŒ…å«ï¼š filterï¼šè¿‡æ»¤ todos çš„æ¡ä»¶ SHOW_ALL SHOW_ACTIVE SHOW_COMPLETED todosï¼šæ‰€æœ‰çš„ todo todoï¼šåŒ…å« idã€text å’Œ completed ç„¶è€Œä¼ åˆ°åº”ç”¨ä¸­çš„ props åªéœ€è¦ï¼š visibleTodosï¼šè¿‡æ»¤åçš„ todos filterï¼šè¿‡æ»¤æ¡ä»¶ Action åº”è¯¥æœ‰ä¸‰ç§ï¼š ADD_TODO TOGGLE_TODO SET_VISIBILITY_FILTER 3.2.2. ç¼–ç å®ç°1. action éƒ¨åˆ†123456789101112131415// æš‚ä¸”ä½¿ç”¨æ•°å­—ä½œä¸º idlet nextTodoId = 0;/*-- action creators --*/const addTodo = (text) =&gt; ( &#123; type: 'ADD_TODO', id: nextTodoId++, text &#125;);const toggleTodo = (id) =&gt; ( &#123; type: 'TOGGLE_TODO', id &#125;);const setVisibilityFilter = (filter) =&gt; ( &#123; type: 'SET_VISIBILITY_FILTER', filter &#125;); 2. reducer éƒ¨åˆ†12345678910111213141516171819202122232425262728293031323334353637383940// é»˜è®¤åˆå§‹çŠ¶æ€const initialState = &#123; filter: 'SHOW_ALL', todos: [] &#125;;function rootReducer(state = initialState, action) &#123; switch (action.type) &#123; case 'ADD_TODO': // å¯¹è±¡è§£æ„ const &#123; id, text &#125; = action; return &#123; ...state, todos: [ ...state.todos, &#123; id, text, completed: false &#125;, ], &#125;; case 'TOGGLE_TODO': return &#123; ...state, todos: state.todos.map(todo =&gt; &#123; if (todo.id !== action.id) return todo; return &#123; ...todo, completed: !todo.completed, &#125;; &#125;), &#125;; case 'SET_VISIBILITY_FILTER': return &#123; ...state, filter: action.filter, &#125;; default: return state; &#125;&#125; æ³¨æ„! ä¸è¦ç›´æ¥ä¿®æ”¹åŸæœ‰çš„ stateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ stateã€‚å¯ä»¥ä½¿ç”¨ Object.assign() æ–°å»ºä¸€ä¸ªæ–°çš„ stateã€‚ä¸èƒ½è¿™æ ·ä½¿ç”¨ Object.assign(state, { visibilityFilter: action.filter })ï¼Œå› ä¸ºå®ƒä¼šæ”¹å˜ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚ä½ å¿…é¡»æŠŠç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºå¯¹è±¡ã€‚ä½ ä¹Ÿå¯ä»¥å¼€å¯å¯¹ ES7 ææ¡ˆå¯¹è±¡å±•å¼€è¿ç®—ç¬¦çš„æ”¯æŒ, ä»è€Œä½¿ç”¨ { â€¦state, â€¦newState } è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚ åœ¨ default çš„æƒ…å†µä¸‹è¿”å›æ—§çš„ stateï¼Œç”¨æ¥å…¼å®¹é‡åˆ°æœªçŸ¥çš„ action è¿™æ ·çš„é”™è¯¯ã€‚ æ‹†åˆ† reducerç›®å‰ä»£ç çœ‹ç€æ¯”è¾ƒå†—é•¿ï¼Œå…¶å®åœ¨é€»è¾‘ä¸Š todos çš„å¤„ç†å’Œ filter çš„å¤„ç†åº”è¯¥åˆ†å¼€ï¼Œæ‰€ä»¥åœ¨ state æ²¡æœ‰äº’ç›¸è€¦åˆæ—¶ï¼Œå¯ä»¥å°†å…¶æ‹†åˆ†ï¼Œä»è€Œè®© reducer ç²¾ç»†åœ°å¯¹äºå¯¹åº” state çš„å­æ ‘è¿›è¡Œå¤„ç†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// å¤„ç†å•ä¸ª todoconst todoReducer = (state, action) =&gt; &#123; switch (action.type) &#123; case 'ADD_TODO': return &#123; id: action.id, text: action.text, completed: false, &#125;; case 'TOGGLE_TODO': if (state.id !== action.id) return state; return &#123; ...state, completed: !state.completed, &#125;; default: return state; &#125;&#125;;// å¤„ç† todosconst todosReducer = (state = [], action) =&gt; &#123; switch (action.type) &#123; case 'ADD_TODO': return [ ...state, todoReducer(undefined, action), ]; case 'TOGGLE_TODO': return state.map(t =&gt; todoReducer(t, action)); default: return state; &#125;;&#125;;// å¤„ç† filterconst filterReducer = (state = 'SHOW_ALL', action) =&gt; &#123; switch (action.type) &#123; case 'SET_VISIBILITY_FILTER': return action.filter; default: return state; &#125;;&#125;;const rootReducer = (state = initialState, action) =&gt; (&#123; todos: todosReducer(state.todos, action), filter: filterReducer(state.filter, action),&#125;); æ³¨æ„è§‚å¯Ÿæœ€åçš„ rootReducer å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªç»è¿‡å„ç§ reducer å¤„ç†è¿‡å¹¶åˆå¹¶åçš„æ–° stateã€‚ ç„¶é¹…ï¼Œæ³¨æ„è¿™é‡Œ todos: todos(state.todos, action), ä¼ å…¥ state.todosï¼Œè¿”å›çš„ä¸€å®šä¹Ÿæ˜¯ todosï¼ˆå› ä¸ºéƒ½æ˜¯ state æ ‘ä¸Šçš„èŠ‚ç‚¹ï¼‰ã€‚ æ‰€ä»¥ redux æä¾›äº†å¾ˆå®ç”¨çš„ combineReducers apiï¼Œç”¨äºç®€åŒ– reducer çš„åˆå¹¶ã€‚ 123456789import &#123; combineReducers &#125; from 'redux';const rootReducer = combineReducers(&#123; todos: todosReducer, filter: filterReducer,&#125;);// initialState å¯ä»¥ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥const store = createStore(rootReducer, initialState); å¹¶ä¸”å¦‚æœ reducer ä¸ state èŠ‚ç‚¹åŒåçš„è¯ï¼ˆå³ todosReducer -&gt; todosï¼‰è¿˜èƒ½é€šè¿‡ es6 çš„è¯­æ³•æ›´è¿›ä¸€æ­¥åœ°ç®€åŒ– 123456import &#123; combineReducers &#125; from 'redux';const rootReducer = combineReducers(&#123; todos, filter &#125;);// initialState å¯ä»¥ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥const store = createStore(rootReducer, initialState); éšç€åº”ç”¨çš„è†¨èƒ€ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†æ‹†åˆ†åçš„ reducer æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­, ä»¥ä¿æŒå…¶ç‹¬ç«‹æ€§å¹¶ç”¨äºä¸“é—¨å¤„ç†ä¸åŒçš„æ•°æ®åŸŸã€‚ 3. view éƒ¨åˆ†1. åªæœ‰æ ¹ç»„ä»¶é¦–å…ˆåªå†™ä¸€ä¸ªæ ¹ç»„ä»¶ &lt;TodoApp /&gt;ï¼Œstore é€šè¿‡ props ä¼ å…¥ TodoAppï¼Œå¹¶åœ¨ç”Ÿå‘½å‘¨æœŸçš„ componentDidMount å’Œ componentWillUnmount æ—¶åˆ†åˆ«è®¢é˜…ä¸å–æ¶ˆè®¢é˜…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113import React, &#123; Component &#125; from 'react';class TodoApp extends Component &#123; // è®¢é˜… store çš„å˜åŒ– componentDidMount() &#123; const &#123; store &#125; = this.props; this.unsubscribe = store.subscribe( this.forceUpdate.bind(this) ); &#125; // å–æ¶ˆè®¢é˜… componentWillUnmount() &#123; this.unsubscribe(); &#125; // æ¸²æŸ“å•ä¸ª todo _renderTodo(todo) &#123; const &#123; store &#125; = this.props; return ( &lt;li key=&#123;todo.id&#125; onClick=&#123;() =&gt; store.dispatch(toggleTodo(todo.id))&#125; style=&#123;&#123; textDecoration: todo.completed ? 'line-through' : 'none', cursor: todo.completed ? 'default' : 'pointer', &#125;&#125; &gt; &#123;todo.text&#125; &lt;/li&gt; ); &#125; // æ ¹æ®å½“å‰ filter æ˜¯å¦åŒ¹é…ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–æ˜¯ a é“¾æ¥ _renderFilter(renderFilter, name) &#123; const &#123; store &#125; = this.props; const &#123; filter &#125; = store.getState(); if (renderFilter === filter) return name; return ( &lt;a href='#' onClick=&#123;e =&gt; &#123; e.preventDefault(); store.dispatch(setVisibilityFilter(renderFilter)) &#125;&#125;&gt; &#123;name&#125; &lt;/a&gt; ); &#125; // æ ¹æ®å½“å‰ filter è¿‡æ»¤éœ€è¦æ¸²æŸ“çš„ todos _getVisibleTodos(todos, filter) &#123; switch (filter) &#123; case 'SHOW_ALL': return todos; case 'SHOW_COMPLETED': return todos.filter(todo =&gt; todo.completed); case 'SHOW_ACTIVE': return todos.filter(todo =&gt; !todo.completed); default: return todos; &#125; &#125; render() &#123; const &#123; store &#125; = this.props; const &#123; todos, filter &#125; = store.getState(); let input; return ( &lt;div&gt; &#123;/* AddTodo */&#125; &lt;input type=\"text\" ref=&#123;node =&gt; input = node&#125; /&gt; &lt;button onClick=&#123;() =&gt; &#123; if (!input.value) return; store.dispatch(addTodo(input.value)); input.value = ''; &#125;&#125;&gt; addTodo &lt;/button&gt; &#123;/* TodoList */&#125; &lt;ul&gt; &#123;this._getVisibleTodos(todos, filter) .map(this._renderTodo.bind(this)) &#125; &lt;/ul&gt; &#123;/* Footer */&#125; &lt;p&gt; Show: &#123;' '&#125; &#123;this._renderFilter('SHOW_ALL', 'all')&#125; &#123;', '&#125; &#123;this._renderFilter('SHOW_COMPLETED', 'completed')&#125; &#123;', '&#125; &#123;this._renderFilter('SHOW_ACTIVE', 'active')&#125; &lt;/p&gt; &lt;/div&gt; ); &#125;&#125; TodoApp åªæœ‰æ ¹ç»„ä»¶ 2. ç»„ä»¶æ‹†åˆ†å°†æ‰€æœ‰ç•Œé¢å†…å®¹å…¨å†™åœ¨ TodoApp ä¸­å®åœ¨æ˜¯å¤ªè‡ƒè‚¿äº†ï¼Œæ¥ä¸‹æ¥æ ¹æ®ä¹‹å‰çš„åˆ†æç»“æœå°†å…¶åˆ†ä¸ºä»¥ä¸‹å­ç»„ä»¶ï¼ˆå…¨æ˜¯å±•ç¤ºç»„ä»¶ï¼‰ AddTodo TodoList Todo Footer FilterLink 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586const AddTodo = (&#123; onAddClick &#125;) =&gt; &#123; let input; return ( &lt;div&gt; &lt;input type=\"text\" ref=&#123;node =&gt; input = node&#125; /&gt; &lt;button onClick=&#123;() =&gt; &#123; onAddClick(input.value); input.value = ''; &#125;&#125;&gt; addTodo &lt;/button&gt; &lt;/div&gt; );&#125;;const Todo = (&#123; text, onClick, completed &#125;) =&gt; ( &lt;li onClick=&#123;onClick&#125; style=&#123;&#123; textDecoration: completed ? 'line-through' : 'none', cursor: completed ? 'default' : 'pointer', &#125;&#125; &gt; &#123;text&#125; &lt;/li&gt;);const TodoList = (&#123; todos, onTodoClick &#125;) =&gt; ( &lt;ul&gt; &#123;todos.map(todo =&gt; &lt;Todo key=&#123;todo.id&#125; &#123;...todo&#125; onClick=&#123;() =&gt; onTodoClick(todo.id)&#125; /&gt; )&#125; &lt;/ul&gt;);const FilterLink = (&#123; filter, onClick, renderFilter, children &#125;) =&gt; &#123; if (renderFilter === filter) return (&lt;span&gt;&#123;children&#125;&lt;/span&gt;); return ( &lt;a href='#' onClick=&#123;e =&gt; &#123; e.preventDefault(); onClick(renderFilter); &#125;&#125;&gt; &#123;children&#125; &lt;/a&gt; );&#125;;const Footer = (&#123; filter, onFilterClick &#125;) =&gt; ( &lt;p&gt; Show: &#123;' '&#125; &lt;FilterLink filter=&#123;filter&#125; renderFilter=\"SHOW_ALL\" onClick=&#123;onFilterClick&#125; &gt; all &lt;/FilterLink&gt; &#123;', '&#125; &lt;FilterLink filter=&#123;filter&#125; renderFilter=\"SHOW_COMPLETED\" onClick=&#123;onFilterClick&#125; &gt; completed &lt;/FilterLink&gt; &#123;', '&#125; &lt;FilterLink filter=&#123;filter&#125; renderFilter=\"SHOW_ACTIVE\" onClick=&#123;onFilterClick&#125; &gt; active &lt;/FilterLink&gt; &lt;/p&gt;); æ‰€ä»¥ TodoApp ç²¾ç®€åæ˜¯è¿™æ ·~ 1234567891011121314151617181920212223242526272829303132class TodoApp extends Component &#123; // ... render() &#123; const &#123; store &#125; = this.props; const &#123; todos, filter &#125; = store.getState(); return ( &lt;div&gt; &lt;AddTodo onAddClick=&#123;text =&gt; &#123; if (!text) return; store.dispatch(addTodo(text)); &#125;&#125; /&gt; &lt;TodoList todos=&#123;this._getVisibleTodos(todos, filter)&#125; onTodoClick=&#123;id =&gt; store.dispatch(toggleTodo(id))&#125; /&gt; &lt;Footer filter=&#123;filter&#125; onFilterClick=&#123;filter =&gt; &#123; store.dispatch(setVisibilityFilter(filter)); &#125;&#125; /&gt; &lt;/div&gt; ); &#125;&#125; 3. å¢åŠ å®¹å™¨ç»„ä»¶ç°åœ¨æˆ‘ä»¬ä»ç„¶æ˜¯ä»¥ TodoApp ä½œä¸ºå®¹å™¨ç»„ä»¶ï¼Œå…¶ä¸­å„ä¸ªå­ç»„ä»¶éƒ½æ˜¯å±•ç¤ºç»„ä»¶ã€‚ ä½†æ˜¯è¿™æ ·åšçš„è¯ä¸€æ—¦å­ç»„ä»¶éœ€è¦æŸä¸ªå±æ€§ï¼Œå°±éœ€è¦ä»æ ¹ç»„ä»¶å±‚å±‚ä¼ é€’ä¸‹æ¥ï¼Œæ¯”å¦‚ FilterLink ä¸­çš„ filter å±æ€§ã€‚ æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å¢åŠ å®¹å™¨ç»„ä»¶ï¼Œè®©å±•ç¤ºç»„ä»¶é€šè¿‡å®¹å™¨ç»„ä»¶è·å¾—æ‰€éœ€å±æ€§ã€‚ AddTodo(container) VisibleTodoList(container) TodoList Todo Footer FilterLink(container) Link 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182// store.dispatch åˆè¢«æ”¾å›æ¥äº†ï¼Œ// å› ä¸ºæš‚æ—¶æˆ‘ä»¬åªåœ¨ AddTodo ç»„ä»¶ä¸­ä½¿ç”¨ addTodo è¿™ä¸ª action// ä»¥åå¢åŠ äº†æ–°çš„ form ä¹‹åå¯ä»¥è€ƒè™‘å†å°† store.dispatch ç§»å‡ºå»const AddTodo = (&#123; store &#125;) =&gt; &#123; let input; return ( &lt;div&gt; &lt;input type=\"text\" ref=&#123;node =&gt; input = node&#125; /&gt; &lt;button onClick=&#123;() =&gt; &#123; if (!input.value) return; store.dispatch(addTodo(input.value)); input.value = ''; &#125;&#125;&gt; addTodo &lt;/button&gt; &lt;/div&gt; );&#125;;const Todo = (&#123; text, onClick, completed &#125;) =&gt; ( &lt;li onClick=&#123;onClick&#125; style=&#123;&#123; textDecoration: completed ? 'line-through' : 'none', cursor: completed ? 'default' : 'pointer', &#125;&#125; &gt; &#123;text&#125; &lt;/li&gt;);const TodoList = (&#123; todos, onTodoClick &#125;) =&gt; ( &lt;ul&gt; &#123;todos.map(todo =&gt; &lt;Todo key=&#123;todo.id&#125; &#123;...todo&#125; onClick=&#123;() =&gt; onTodoClick(todo.id)&#125; /&gt; )&#125; &lt;/ul&gt;);// å®¹å™¨ç»„ä»¶class VisibleTodoList extends Component &#123; // è®¢é˜… store çš„å˜åŒ– componentDidMount() &#123; const &#123; store &#125; = this.props; this.unsubscribe = store.subscribe( this.forceUpdate.bind(this) ); &#125; // å–æ¶ˆè®¢é˜… componentWillUnmount() &#123; this.unsubscribe(); &#125; // æ ¹æ®å½“å‰ filter è¿‡æ»¤éœ€è¦æ¸²æŸ“çš„ todos _getVisibleTodos(todos, filter) &#123; switch (filter) &#123; case 'SHOW_ALL': return todos; case 'SHOW_COMPLETED': return todos.filter(todo =&gt; todo.completed); case 'SHOW_ACTIVE': return todos.filter(todo =&gt; !todo.completed); default: return todos; &#125; &#125; render() &#123; const &#123; store &#125; = this.props; const &#123; todos, filter &#125; = store.getState(); return ( &lt;TodoList todos=&#123;this._getVisibleTodos(todos, filter)&#125; onTodoClick=&#123;id =&gt; &#123; store.dispatch(toggleTodo(id)) &#125;&#125; /&gt; ); &#125;&#125;// åŸæœ¬çš„ FilterLink æ”¹æˆ Linkï¼Œå»æ‰ filter å’Œ renderFilter å±æ€§ï¼Œæ”¹ä¸ºä¼ å…¥ activeconst Link = (&#123; active, onClick, children &#125;) =&gt; &#123; if (active) return (&lt;span&gt;&#123;children&#125;&lt;/span&gt;); return ( &lt;a href='#' onClick=&#123;e =&gt; &#123; e.preventDefault(); onClick(); &#125;&#125;&gt; &#123;children&#125; &lt;/a&gt; );&#125;;// å®¹å™¨ç»„ä»¶class FilterLink extends Component &#123; // è®¢é˜… store çš„å˜åŒ– componentDidMount() &#123; const &#123; store &#125; = this.props; this.unsubscribe = store.subscribe( this.forceUpdate.bind(this) ); &#125; // å–æ¶ˆè®¢é˜… componentWillUnmount() &#123; this.unsubscribe(); &#125; render() &#123; const &#123; store, renderFilter, children &#125; = this.props; const &#123; filter &#125; = store.getState(); return ( &lt;Link active=&#123;filter === renderFilter&#125; onClick=&#123;() =&gt; store.dispatch( setVisibilityFilter(renderFilter) )&#125; &gt; &#123;children&#125; &lt;/Link&gt; ); &#125;&#125;// å±•ç¤ºç»„ä»¶const Footer = (&#123; store &#125;) =&gt; ( &lt;p&gt; Show: &#123;' '&#125; &lt;FilterLink store=&#123;store&#125; renderFilter=\"SHOW_ALL\" &gt; all &lt;/FilterLink&gt; &#123;', '&#125; &lt;FilterLink store=&#123;store&#125; renderFilter=\"SHOW_COMPLETED\" &gt; completed &lt;/FilterLink&gt; &#123;', '&#125; &lt;FilterLink store=&#123;store&#125; renderFilter=\"SHOW_ACTIVE\" &gt; active &lt;/FilterLink&gt; &lt;/p&gt;);// åœ¨ä¸ä½¿ç”¨å…¨å±€å˜é‡ store çš„æƒ…å†µä¸‹ï¼Œ// æš‚æ—¶åªèƒ½é€šè¿‡ props ä¼ é€’è¿›æ¥ï¼Œ// Don't worry~å¾ˆå¿«å°±ä¸ä¼šè¿™ä¹ˆéº»çƒ¦äº†~const TodoApp = (&#123; store &#125;) =&gt; ( &lt;div&gt; &lt;AddTodo store=&#123;store&#125; /&gt; &lt;VisibleTodoList store=&#123;store&#125; /&gt; &lt;Footer store=&#123;store&#125; /&gt; &lt;/div&gt;); é€šè¿‡è§‚å¯Ÿé‡æ„åçš„ä»£ç å¯ä»¥å‘ç°æœ‰ä¸‰ç‚¹éº»çƒ¦çš„åœ°æ–¹ æ ¹ç»„ä»¶éœ€è¦é€šè¿‡ props å°† store ä¼ ç»™å„ä¸ªå­ç»„ä»¶ å®¹å™¨ç»„ä»¶éƒ½è¦å®šä¹‰ componentDidMount è¿›è¡Œè®¢é˜…å’Œ componentWillUnmount å–æ¶ˆè®¢é˜… åº”ç”¨å…¶å®å¹¶ä¸éœ€è¦æ¸²æŸ“æ‰€æœ‰çš„ todosï¼Œæ‰€ä»¥å†…éƒ¨å¾ˆéº»çƒ¦åœ°å®šä¹‰äº† _getVisibleTodos å‡½æ•° 4. Providerè®©æˆ‘ä»¬å…ˆæ¥è§£å†³ç¬¬ä¸€ä¸ªéº»çƒ¦~ï¼Œåˆ©ç”¨ React æä¾›çš„ context ç‰¹æ€§ 123456789101112131415class Provider extends Component &#123; // é€šè¿‡è¯¥æ–¹æ³•å‘ children çš„ context æ³¨å…¥ store getChildContext() &#123; return &#123; store: this.props.store &#125;; &#125; render() &#123; return this.props.children; &#125;&#125;// å¿…é¡»è¦å£°æ˜ä¼ å…¥ context çš„ store çš„ç±»å‹Provider.childContextTypes = &#123; store: React.PropTypes.object,&#125;; è‡ªé¡¶å‘ä¸‹åœ°çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨åˆ° TodoApp ä¸­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798// 1. ä½¿ç”¨ Provider åŒ…è£¹ TodoAppï¼Œå¹¶å°† store ä½œä¸º props ä¼ å…¥ReactDOM.render( &lt;Provider store=&#123;createStore(rootReducer, initialState)&#125;&gt; &lt;TodoApp /&gt; &lt;/Provider&gt;, document.getElementById('container'),);// 2. æ ¹ç»„ä»¶ TodoApp: å’Œ store say goodbye~ï¼Œ// å› ä¸º TodoApp å¹¶ä¸æ˜¯å®¹å™¨ç»„ä»¶~const TodoApp = () =&gt; ( &lt;div&gt; &lt;AddTodo /&gt; &lt;VisibleTodoList /&gt; &lt;Footer /&gt; &lt;/div&gt;);// 3. AddTodo: ç”±äº props å›ºå®šä½œä¸ºç¬¬ä¸€ä¸ªä¼ å…¥å­ç»„ä»¶çš„å‚æ•°ï¼Œ// æ‰€ä»¥ &#123; store &#125; è¦å£°æ˜åœ¨ç¬¬äºŒä½ï¼Œç„¶é¹…éœ€è¦å£°æ˜ contextTypes...const AddTodo = (props, &#123; store &#125;) =&gt; &#123; // ...&#125;;// å¿…é¡»å£°æ˜AddTodo.contextTypes = &#123; store: React.PropTypes.object,&#125;;// 4. VisibleTodoList: ä» props æ”¹æˆä» context ä¸­è·å– storeï¼Œ// åŒæ ·å£°æ˜ contextTypes...class VisibleTodoList extends Component &#123; // è®¢é˜… store çš„å˜åŒ– componentDidMount() &#123; const &#123; store &#125; = this.context; // props -&gt; context // ... &#125; // ... render() &#123; const &#123; store &#125; = this.context; // props -&gt; context const &#123; todos, filter &#125; = store.getState(); // ... &#125;&#125;// å¿…é¡»å£°æ˜VisibleTodoList.contextTypes = &#123; store: React.PropTypes.object,&#125;;// -- TodoList å’Œ Todo ä¸å˜ --// 5. Footerï¼šå’Œ store say goodbye...const Footer = () =&gt; ( &lt;p&gt; Show: &#123;' '&#125; &lt;FilterLink renderFilter=\"SHOW_ALL\"&gt; all &lt;/FilterLink&gt; &#123;', '&#125; &lt;FilterLink renderFilter=\"SHOW_COMPLETED\"&gt; completed &lt;/FilterLink&gt; &#123;', '&#125; &lt;FilterLink renderFilter=\"SHOW_ACTIVE\"&gt; active &lt;/FilterLink&gt; &lt;/p&gt;);// 6. FilterLink: åŒ VisibleTodoListï¼ˆprops + contextTypes...ï¼‰class FilterLink extends Component &#123; // è®¢é˜… store çš„å˜åŒ– componentDidMount() &#123; const &#123; store &#125; = this.context; // props -&gt; context // ... &#125; // ... render() &#123; const &#123; renderFilter, children &#125; = this.props; const &#123; store &#125; = this.context; // props -&gt; context const &#123; filter &#125; = store.getState(); // ... &#125;&#125;// å¿…é¡»å£°æ˜FilterLink.contextTypes = &#123; store: React.PropTypes.object,&#125;;// -- Link ä¸å˜ -- ç°åœ¨ä¸­é—´çš„éå®¹å™¨ç»„ä»¶å®Œå…¨ä¸ç”¨ä¸ºäº†è‡ªå·±çš„å­©å­è€Œè´¹åŠ²åœ°ä¼ é€’ store={store}æ‰€ä»¥ä»¥ä¸Šæˆ‘ä»¬å°±å®ç°äº†ç®€åŒ–ç‰ˆçš„ç”± react-redux æä¾›çš„ç¬¬ä¸€ä¸ªç»„ä»¶ &lt;Provider /&gt;ã€‚ ç„¶é¹…ï¼Œæœ‰æœ¨æœ‰è§‰å¾—è€å†™ contextTypes å¥½çƒ¦å•Šï¼Œè€Œä¸” context ç‰¹æ€§å¹¶ä¸ç¨³å®šï¼Œæ‰€ä»¥ context å¹¶ä¸åº”è¯¥ç›´æ¥å†™åœ¨æˆ‘ä»¬çš„åº”ç”¨ä»£ç é‡Œã€‚ è®¡å°†å®‰å‡ºï¼Ÿ 5. connect OOPæ€ç»´ï¼šè¿™è¿˜ä¸ç®€å•ï¼Ÿå†™ä¸ªå‡½æ•°æŠŠå®¹å™¨ç»„ä»¶ä¼ è¿›å»ä½œä¸ºçˆ¶ç±»ï¼Œç„¶åè¿”å›å†™å¥½äº† componentDidMountï¼ŒcomponentWillUnmount å’Œ contextTypes çš„å­ç±»ä¸å°±å¥½å•¦~ æ­å–œä½ ~é¢å‘å¯¹è±¡çš„æ€æƒ³å­¦çš„å¾ˆä¸é”™~ è™½ç„¶ JavaScript åº•å±‚å„ç§ä¸œè¥¿éƒ½æ˜¯é¢å‘å¯¹è±¡ï¼Œç„¶è€Œåœ¨å‰ç«¯ä¸€æ—¦ä¸ç•Œé¢ç›¸å…³ï¼Œç…§æ¬é¢å‘å¯¹è±¡çš„æ–¹æ³•å®ç°èµ·æ¥ä¼šå¾ˆéº»çƒ¦â€¦ React æ—©æœŸç”¨æˆ·ï¼šè¿™è¿˜ä¸ç®€å•ï¼Ÿå†™ä¸ª mixin å²‚ä¸ç¾å“‰~~ï¼Ÿ ä½œä¸º react äº²ç”Ÿçš„ mixin ç¡®å®åœ¨å¤šç»„ä»¶é—´å…±äº«æ–¹æ³•æä¾›äº†ä¸€äº›ä¾¿åˆ©ï¼Œç„¶è€Œä½¿ç”¨ mixin çš„ç»„ä»¶éœ€è¦äº†è§£ç»†èŠ‚ï¼Œä»è€Œé¿å…çŠ¶æ€æ±¡æŸ“ï¼Œæ‰€ä»¥ä¸€æ—¦ mixin æ•°é‡å¤šäº†ä¹‹åä¼šè¶Šæ¥è¶Šéš¾ç»´æŠ¤ã€‚ Unfortunately, we will not launch any mixin support for ES6 classes in React. That would defeat the purpose of only using idiomatic JavaScript concepts. æ‰€ä»¥å®˜æ–¹ä¹Ÿæ”¾å¼ƒäº†åœ¨ ES6 class ä¸­å¯¹ mixin çš„æ”¯æŒã€‚ å‡½æ•°å¼ï¼ˆFPï¼‰ï¼šé«˜é˜¶ç»„ä»¶ High Order Componentï¼ˆä¸‹ç§° hocï¼‰æ‰æ˜¯ç»ˆæè§£å†³æ–¹æ¡ˆ~~ hocFactory:: W: React.Component =&gt; E: React.Component å¦‚ä¸Šæ‰€ç¤º hoc çš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª Wï¼ˆä»£è¡¨ WrappedComponentï¼‰è¿”å›ä¸€ä¸ª Eï¼ˆä»£è¡¨ Enhanced Componentï¼‰ï¼Œè€Œ E å°±æ˜¯è¿™ä¸ªé«˜é˜¶ç»„ä»¶ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ—§ç»„ä»¶ Compï¼Œç„¶é¹…ç°åœ¨æ¥æ”¶å‚æ•°æœ‰äº›å˜åŠ¨ã€‚ å½“ç„¶ä½ å¯ä»¥å¤åˆ¶ç²˜è´´å†ä¿®æ”¹æ—§ç»„ä»¶çš„ä»£ç â€¦ï¼ˆå¤§ä¾ å—çªä¸€æ‹œï¼‰ ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼Œè¿”å›ä¸€ä¸ªæ–°ç»„ä»¶æ¥åŒ…è£¹æ—§ç»„ä»¶ã€‚ 123456789class NewComp extends Component &#123; mapProps(props) &#123; return &#123;/* new props */&#125;; &#125; render() &#123; return (&lt;Comp &#123;...this.mapProps(this.props)&#125; /&gt;); &#125;&#125; ç„¶é¹…ï¼Œå¦‚æœæœ‰åŒæ ·é€»è¾‘çš„æ›´å¤šçš„ç»„ä»¶éœ€è¦é€‚é…å‘¢ï¼Ÿï¼Ÿï¼Ÿæ€»ä¸èƒ½æœ‰å‡ ä¸ªæŠ„å‡ éå§â€¦ æ‰€ä»¥éªšå¹´ä½ å¬è¯´è¿‡é«˜é˜¶ç»„ä»¶ä¹ˆ~ï¼Ÿ 12345678910// å…ˆè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè€Œé‚£ä¸ªå‡½æ•°å†è¿”å›æ–°ç»„ä»¶const mapProps = mapFn =&gt; Comp =&gt; &#123; return class extends Component &#123; render() &#123; return (&lt;Comp &#123;...this.mapFn(this.props)&#125; /&gt;); &#125; &#125;;&#125;;const NewComp = mapProps(mapFn)(Comp); // æ³¨æ„è°ƒç”¨äº†ä¸¤æ¬¡ å¯ä»¥çœ‹åˆ°å€ŸåŠ©é«˜é˜¶ç»„ä»¶æˆ‘ä»¬å°† mapFn å’Œ Comp è§£è€¦åˆï¼Œè¿™æ ·å°±ç®—éœ€è¦å†åµŒå¥—å¤šå°‘ä¿®æ”¹é€»è¾‘éƒ½æ²¡é—®é¢˜~å¤©é»‘éƒ½ä¸æ€•~ okï¼Œæ‰¯äº†è¿™ä¹ˆå¤šçš„æ·¡ï¼Œç»ˆäºè¦è¯´åˆ° connect äº†æ˜¯å“’ï¼Œä½ æœ¨æœ‰çŒœé”™ï¼Œreact-redux æä¾›çš„ç¬¬äºŒä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ª api â€”â€” connect è¿”å›çš„å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ã€‚ ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦ connect()(WrappedComponent) è¿”å›çš„ component è‡ªåŠ¨å°±å®Œæˆäº†åœ¨ componentDidMount ä¸­è®¢é˜… storeï¼Œåœ¨ componentWillUnmount ä¸­å–æ¶ˆè®¢é˜…å’Œå£°æ˜ contextTypesã€‚ è¿™æ ·å°±åªå‰©ä¸‹æœ€åä¸€ä¸ªéº»çƒ¦ 3.åº”ç”¨å…¶å®å¹¶ä¸éœ€è¦æ¸²æŸ“æ‰€æœ‰çš„ todosï¼Œæ‰€ä»¥å†…éƒ¨å¾ˆéº»çƒ¦åœ°å®šä¹‰äº† _getVisibleTodos å‡½æ•° å…¶å® connect å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å«åš mapStateToPropsï¼Œä½œç”¨å°±æ˜¯å°† store ä¸­çš„æ•°æ®æå‰å¤„ç†æˆ–è¿‡æ»¤åä½œä¸º props ä¼ å…¥å†…éƒ¨ç»„ä»¶ï¼Œä»¥ä¾¿å†…éƒ¨ç»„ä»¶é«˜æ•ˆåœ°ç›´æ¥è°ƒç”¨ã€‚è¿™æ ·æœ€åä¸€ä¸ªéº»çƒ¦ä¹Ÿè§£å†³äº†~ ç„¶é¹…ï¼Œæˆ‘ä»¬é—®è‡ªå·±è¿™æ ·å°±å¤Ÿäº†ä¹ˆï¼Ÿå¹¶æ²¡æœ‰â€¦ è¿˜æœ‰æœ€åä¸€ä¸ªç»†èŠ‚ï¼Œä»¥ FilterLink ä¸ºä¾‹ã€‚ 12345678910111213141516171819class FilterLink extends Component &#123; // ... render() &#123; const &#123; store, renderFilter, children &#125; = this.props; const &#123; filter &#125; = store.getState(); return ( &lt;Link active=&#123;filter === renderFilter&#125; onClick=&#123;() =&gt; store.dispatch( setVisibilityFilter(renderFilter) )&#125; &gt; &#123;children&#125; &lt;/Link&gt; ); &#125;&#125; é™¤äº†ä» store ä¸­è·å–æ•°æ®ï¼ˆfilterï¼‰ï¼Œæˆ‘ä»¬è¿˜ä»ä¸­è·å–äº† dispatchï¼Œä»¥ä¾¿è§¦å‘ actionã€‚å¦‚æœå°†å›è°ƒå‡½æ•° onClick çš„å†…å®¹ä¹ŸåŠ åˆ° props ä¸­ï¼Œé‚£ä¹ˆå€ŸåŠ© connect æ•´ä¸ª FilterLink çš„é€»è¾‘å²‚ä¸æ˜¯éƒ½è¢«æˆ‘ä»¬æŠ½è±¡å®Œäº†ï¼Ÿ æ˜¯å“’ï¼Œconnect çš„ç¬¬äºŒä¸ªå‚æ•°å«åš mapDispatchToPropsï¼Œä½œç”¨å°±æ˜¯å°†å„ä¸ªè°ƒç”¨åˆ° dispatch çš„åœ°æ–¹éƒ½æŠ½è±¡æˆå‡½æ•°åŠ åˆ° props ä¸­çš„ä¼ ç»™å†…éƒ¨ç»„ä»¶ã€‚è¿™æ ·æœ€åä¸€ä¸ªéº»çƒ¦ç»ˆäºçœŸçš„è¢«è§£å†³äº†~ 12345678910111213141516171819const mapStateToLinkProps = (state, ownProps) =&gt; (&#123; // ownProps æ˜¯åŸç»„ä»¶çš„ propsï¼Œ // è¿™é‡Œä¸ºäº†å’Œé«˜é˜¶ç»„ä»¶çš„ props åŒºåˆ† active: ownProps.renderFilter === state.filter,&#125;);const mapDispatchToLinkProps = (dispatch, ownProps) =&gt; (&#123; onClick() &#123; dispatch( setVisibilityFilter(ownProps.renderFilter) ); &#125;,&#125;);// æ³¨æ„åŸ FilterLink æ•´ä¸ªéƒ½è¢«æˆ‘ä»¬åˆ äº†const FilterLink = connect( mapStateToLinkProps, mapDispatchToLinkProps)(Link); TodoApp ä½¿ç”¨ react-redux å››ã€æ€»ç»“æœ¬æ–‡ä» Redux çš„ç†è®ºåŸºç¡€å’Œæºç å‡ºå‘ï¼Œä»‹ç»äº† Redux çš„å„é¡¹åŸºç¡€ apiã€‚ æ¥ç€ä¸€æ­¥ä¸€æ­¥åœ°ä»‹ç»å¦‚ä½•ä¸ React è¿›è¡Œç»“åˆï¼Œä»è¿‡ç¨‹ä¸­çš„å„ä¸ªç—›ç‚¹å¼•å‡º react-redux çš„ä½œç”¨å’ŒåŸç†ã€‚ ç„¶é¹…ï¼Œè¿˜æœ‰å¥½å¤šçš„å‘æ²¡å¡«ï¼Œæ¯”å¦‚ï¼šå¤§å‹é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ã€å‰ç«¯è·¯ç”±ï¼ˆreact-routerï¼‰ã€ä¸­é—´ä»¶ï¼ˆmiddlewaresï¼‰ã€ç½‘ç»œè¯·æ±‚ç­‰å„ç±»å¼‚æ­¥æ“ä½œã€æœåŠ¡å™¨ç«¯åŒæ„ç›´å‡ºâ€¦ ä»¥ä¸Š to be continuedâ€¦","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://buptsteve.github.io/blog/tags/JavaScript/"},{"name":"Redux","slug":"Redux","permalink":"https://buptsteve.github.io/blog/tags/Redux/"},{"name":"React","slug":"React","permalink":"https://buptsteve.github.io/blog/tags/React/"}]},{"title":"ã€Œ6ã€JavaScript å‡½æ•°è¡¨è¾¾å¼å­¦ä¹ ç¬”è®°","date":"2016-03-23T07:27:58.000Z","path":"2016/03/23/6.js-function-chapter7/","text":"é›¶ã€å‰è¨€ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹ç¬¬7ç«  å‡½æ•°è¡¨è¾¾å¼ï¼Œå­¦ä¹ ç¬”è®°æ•´ç†ã€‚ ä¸»è¦å†…å®¹æœ‰å¦‚ä¸‹ä¸‰éƒ¨åˆ† å‡½æ•°è¡¨è¾¾å¼çš„ç‰¹å¾ ä½¿ç”¨å‡½æ•°å®ç°é€’å½’ ä½¿ç”¨é—­åŒ…å®šä¹‰ç§æœ‰å˜é‡ ä¸€ã€ç¬¬7ç«  å‡½æ•°è¡¨è¾¾å¼7.0. å‡½æ•°å®šä¹‰åœ¨ JavaScript ä¸­å®šä¹‰å‡½æ•°æœ‰ä¸¤ç§æ–¹æ³•ï¼š å‡½æ•°å£°æ˜ å‡½æ•°è¡¨è¾¾å¼ 7.0.1. å‡½æ•°å£°æ˜123456function functionName(arg0, arg1, arg2) &#123; // å‡½æ•°ä½“&#125;// åªåœ¨ Firefoxã€Safariã€Chrome å’Œ Opera æœ‰æ•ˆalert(functionName.name); // functionNameï¼Œå‡½æ•°åç§° å‡½æ•°å£°æ˜ä¸€ä¸ªé‡è¦ç‰¹å¾å°±æ˜¯ï¼šå‡½æ•°å£°æ˜æå‡ï¼ˆfunction declaration hoistingï¼‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯ JS å¼•æ“ä¼šåœ¨æ‰§è¡Œé˜¶æ®µä¹‹å‰è¯»å–å‡½æ•°å£°æ˜ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨å‡½æ•°å£°æ˜ä¹‹å‰å°±è°ƒç”¨å®ƒçš„åŸå› ã€‚ 7.0.2. å‡½æ•°è¡¨è¾¾å¼1234567// æœ‰å¤šç§å½¢å¼ï¼Œä»¥ä¸‹ä¸ºæœ€å¸¸è§çš„ä¸€ç§ï¼Œå³åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°å¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ functionNamevar functionName = function(arg0, arg1, arg2) &#123; // å‡½æ•°ä½“&#125;;// åªåœ¨ Firefoxã€Safariã€Chrome å’Œ Opera æœ‰æ•ˆalert(functionName.name); // ç©ºå­—ç¬¦ä¸² å½“ç„¶å‡½æ•°è¡¨è¾¾å¼å°±æ²¡æœ‰å£°æ˜æå‡è¿™ç§ç‰¹å¾äº†ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„å‘â€¦ 1234567891011121314151617181920212223242526// åƒä¸‡åˆ«è¿™æ ·åšï¼// å› ä¸ºæœ‰çš„æµè§ˆå™¨ä¼šè¿”å› first çš„è¿™ä¸ª functionï¼Œè€Œæœ‰çš„æµè§ˆå™¨è¿”å›çš„å´æ˜¯ç¬¬äºŒä¸ªif (true) &#123; function foo() &#123; return 'first'; &#125;&#125; else &#123; function foo() &#123; return 'second'; &#125;&#125;foo();// ç›¸åï¼Œè¿™æ ·æƒ…å†µï¼Œæˆ‘ä»¬è¦ç”¨å‡½æ•°è¡¨è¾¾å¼var foo;if (true) &#123; foo = function() &#123; return 'first'; &#125;;&#125; else &#123; foo = function() &#123; return 'second'; &#125;;&#125;foo(); 7.1. é€’å½’ å…ˆè¯´ä¸ªæ®µå­ï¼šè¦æƒ³ç†è§£é€’å½’ï¼Œé¦–å…ˆè¦ç†è§£â€¦é€’å½’ã€‚ è¯´æ­£ç»çš„ï¼Œé€’å½’å°±æ˜¯å‡½æ•°è‡ªå·±è°ƒç”¨è‡ªå·±ã€‚ 12345678910111213function factorial(num) &#123; // é€’å½’ç»“æŸæ¡ä»¶ if (num &lt;= 1) return 1; // é€šè¿‡åœ¨å…¨å±€ VO ä¸­ï¼Œæ‰¾åˆ°è‡ªèº«å‡½æ•°çš„æŒ‡é’ˆåè°ƒç”¨è‡ªèº« return num * factorial(num-1);&#125;var anotherFactorial = factorial;factorial = null;// æŠ¥é”™ï¼å› ä¸ºä¿®æ”¹äº†å…¨å±€ VO ä¸­ factorial æŒ‡é’ˆçš„æŒ‡å‘ï¼ˆnullï¼‰alert(anotherFactorial(4)); è¿™ä¹ˆå†™ä¸»è¦é—®é¢˜å°±æ˜¯é€’å½’å‡½æ•°ä¸è‡ªèº«çš„å‡½æ•°åè€¦åˆï¼Œä¸€æ—¦ä¿®æ”¹äº†åŸæœ¬çš„å‡½æ•°åï¼Œåˆ™ä¼šå¯¼è‡´é”™è¯¯ã€‚ è¿™æ—¶å¯ä»¥åˆ©ç”¨ arguments.callee æŒ‡é’ˆæ¥æˆåŠŸå¯»æ‰¾åˆ°æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ã€‚ æ¥ä¸‹æ¥åˆæœ‰ä¸€ä¸ªå‘ï¼šarguments åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ— æ³•ä½¿ç”¨ã€‚ ä¸è¿‡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½åå‡½æ•°è¡¨è¾¾å¼æ¥å®Œç¾è§£å†³ï¼š 123456789var factorial = function f(num) &#123; // é€’å½’ç»“æŸæ¡ä»¶ if (num &lt;= 1) return 1; // å‡½æ•°å f åªåœ¨å†…éƒ¨ä½œç”¨åŸŸé‡Œæœ‰æ•ˆ return num * f(num-1);&#125;;typeof f; // undefined 7.2. é—­åŒ… å…ˆä¸‹å®šä¹‰ï¼šé—­åŒ…æ˜¯æŒ‡ã€æœ‰æƒã€‘è®¿é—®ï¼ˆå¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸï¼‰ä¸­çš„ã€Œå˜é‡ã€çš„ã€Œå‡½æ•°ã€ã€‚ é—­åŒ…é¦–å…ˆæ˜¯ä¸€ä¸ªå‡½æ•° èƒ½åŠ›å°±æ˜¯æœ‰æƒè®¿é—®å˜é‡ èŒƒå›´åœ¨å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸå†… æˆ‘ä»¬æ—¥å¸¸åœ¨ä½¿ç”¨ JavaScript ä¸­ï¼Œåœ¨å¤–éƒ¨å‡½æ•°ä¸­å®šä¹‰çš„å†…éƒ¨å‡½æ•°èƒ½å¤Ÿè®¿é—®å¤–éƒ¨å‡½æ•°ä¸­çš„å˜é‡ã€‚ æ‰€ä»¥ï¼Œæœ€å¸¸è§çš„é—­åŒ…æ–¹å¼å°±æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨åˆ›å»ºå¹¶è¿”å›å¦ä¸€ä¸ªå‡½æ•°ã€‚ 12345678910function foo(arg0, arg1) &#123; return function bar() &#123; // å†…éƒ¨çš„ bar å‡½æ•°èƒ½å¤Ÿè®¿é—®å¤–éƒ¨å‡½æ•° foo çš„ arg0 å’Œ arg1 å˜é‡ã€‚ return arg0 + arg1; &#125;&#125;var test = foo('a', 'b'); // test æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¿”å›çš„ bar å‡½æ•°test(); // abï¼Œè°ƒç”¨é—­åŒ…åï¼Œå¾—åˆ° arg0 + arg1 çš„å€¼typeof bar; // undefinedï¼Œå½“ç„¶è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•° é‚£ä¹ˆå†…éƒ¨çš„ bar å‡½æ•°æ˜¯æ€ä¹ˆä¿å­˜å¤–éƒ¨ foo å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°çš„å‘¢ï¼Ÿ é¦–å…ˆåœ¨æµè§ˆå™¨ç«¯çš„ JavaScript ä»£ç ï¼Œæœ‰ä¸€ä¸ªå…¨å±€çš„æ‰§è¡Œç¯å¢ƒï¼ˆExecution Contextï¼‰å³ window å¯¹è±¡ã€‚ æ¯ä¸ªæ‰§è¡Œç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å˜é‡å¯¹è±¡ï¼ˆVariable Objectï¼‰ï¼šå®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½ä¿å­˜å…¶ä¸­ã€‚ å½“æŸä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼ˆECï¼‰åŠç›¸åº”çš„ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰ï¼ˆå…¶å®æ˜¯è¢«æ¨å…¥ä¸€ä¸ªç¯å¢ƒæ ˆä¸­ï¼Œæ‰§è¡Œä¹‹åæ ˆå°†ä¹‹å¼¹å‡ºï¼‰ã€‚ ä½œç”¨åŸŸé“¾ï¼ˆSCï¼‰å°±æ˜¯ä¸€ä¸ªæŒ‡å‘å„ä¸ªå˜é‡å¯¹è±¡çš„æŒ‡é’ˆåˆ—è¡¨ï¼ˆå…¨å±€ VO æ˜¯å…¶ä¸­çš„æœ€åä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚ ä¸€èˆ¬æ¥è¯´æŸä¸ªæ‰§è¡Œç¯å¢ƒï¼ˆECï¼‰çš„æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥ç¯å¢ƒè¢«é”€æ¯ï¼Œä¿å­˜å…¶ä¸­çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°å®šä¹‰ä¹Ÿéšä¹‹é”€æ¯ã€‚ å¦‚æœæ‰§è¡Œç¯å¢ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒçš„å˜é‡å¯¹è±¡ï¼ˆVOï¼‰åˆå«åšæ´»åŠ¨å¯¹è±¡ï¼ˆActivation Objectï¼‰ã€‚ å› æ­¤åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è§£ææ ‡è¯†ç¬¦çš„è¿‡ç¨‹ï¼Œç±»ä¼¼äºä¸Šä¸€ç¯‡ä¸­æåˆ°çš„åŸå‹é“¾æŸ¥æ‰¾ã€‚ä¹Ÿæ˜¯æ²¿ç€ SC ä¸€çº§ä¸€çº§åœ°å¾€ä¸Šæ‰¾ã€‚å¦‚æœç›´åˆ°å…¨å±€ VO è¿˜æ²¡æ‰¾åˆ°ï¼Œå°±ä¼šæŠ¥é”™ã€‚ æ‰€ä»¥æ¥ä¸‹æ¥ä¸¾å‡ ä¸ªæ —å­ï¼š 1. æ™®é€šå‡½æ•°12345678function compare(value1, value2) &#123; if (value1 &lt; value2) return -1; if (value1 &gt; value2) return 1; return 0;&#125;var result = compare(5, 10); 1234567891011121314 ______________________________________________________________ | | V _____________________ | _____________________ _________________ |--&gt; | global VO | | |---&gt;| compare AO || compare EC | | |---------------------| | | |---------------------||-------â€”---------| _______ | | compare | *----|--| | | arguments | [5, 10] || Scope Chain | *-|----&gt; | SC | | |---------------------| | |---------------------||-----------------| |-------| | | result | undefined | | | value1 | 5 | | 1 | *-|----| |---------------------| | |---------------------| |-------| | | value2 | 10 | | 0 | *-|----------------------------------------| |---------------------| |-------| by çµé­‚ç”»å¸ˆ...(ç´¯æ­»æˆ‘äº†) åœ¨åˆ›å»º compare å‡½æ•°æ—¶ï¼Œå°±å·²ç»åˆ›å»ºä¸€ä¸ªé¢„å…ˆåŒ…å«å…¨å±€ VO çš„ä½œç”¨åŸŸé“¾ï¼ˆä¿å­˜åœ¨å†…éƒ¨çš„ [[Scope]] å±æ€§ä¸­ï¼‰ã€‚ åœ¨æ‰§è¡Œ compare å‡½æ•°æ—¶ï¼Œå°±åˆ›å»º ECï¼Œç„¶åå¤åˆ¶å¹¶æ„å»º [[Scope]] å±æ€§ä¸­çš„ä½œç”¨åŸŸé“¾ SC æ­¤æ—¶åˆ›å»º compare AOï¼Œå¹¶å°†å…¶æ”¾å…¥ SC çš„é¡¶ç«¯ã€‚ æ‰€ä»¥åœ¨å‡½æ•°ä¸­è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼Œä¼šä»ä½œç”¨åŸŸé¡¶ç«¯ï¼ˆå°±æ˜¯ compare AOï¼‰å¼€å§‹æ‰¾èµ·ã€‚ æ‰€ä»¥ä¸€èˆ¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå› ä¸º AO è¢«é”€æ¯ï¼Œæ‰€ä»¥åœ¨å‡½æ•°å¤–éƒ¨æ— æ³•è®¿é—®åˆ°å‡½æ•°å†…éƒ¨çš„å˜é‡ã€‚ 2. é—­åŒ…ç¤ºä¾‹123456789101112131415161718192021function createCompFunc(propName) &#123; return function(obj1, obj2) &#123; var value1 = obj1[propName]; var value2 = obj2[propName]; if (value1 &lt; value2) &#123; return -1; &#125; else if (value1 &gt; value2) &#123; return 1; &#125; else &#123; return 0; &#125; &#125;&#125;var compare = createCompFunc(\"name\"); // åˆ›å»ºå‡½æ•°var result = compare(&#123;name: \"steve\"&#125;, &#123;name: \"young\"&#125;); // è°ƒç”¨å‡½æ•°compare = null; // è§£é™¤å¯¹åŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼ˆé‡Šæ”¾å†…å­˜ï¼‰ 1234567891011121314151617181920212223242526 __________________________________________________________________ | _____________________ | | |-----&gt; | global VO | | | | |---------------------| | | | | createCompFunc | *--|--| | | |---------------------| V | | result | undefined | ___________________ _______ | |---------------------|| createCompFunc EC | |---&gt; | SC1 | | ______________________|-------â€”-----------| | |-------| | |---&gt; | createCompFunc AO || Scope Chain | *--|------| | 1 | *-|-| | |----------------------||-------------------| |-------| | | | arguments | [&quot;name&quot;] | | 0 | *-|-(-| |----------------------| ________________________ |-------| | | | propName | &quot;name&quot; || anoymous function EC | | | |----------------------||-------â€”----------------| _______ | | _______________________________| Scope Chain | *-----|-----&gt; | SC2 | | | |-&gt; | anoymous function AO ||------------------------| |-------| | | | |-------------------------------| | 2 | *-|-| | | | arguments | [&#123;name: &quot;steve&quot;&#125;, | |-------| | | | | &#123;name: &quot;young&quot;&#125;] | | 1 | *-|---| | |-------------------------------| |-------| | | obj1 | &#123;name: &quot;steve&quot;&#125; | | 0 | *-|-----| |-------------------------------| |-------| | obj2 | &#123;name: &quot;young&quot;&#125; | |-------------------------------| by çµé­‚ç”»å¸ˆ...(ç´¯æ­»æˆ‘äº†) å¦‚å›¾æ‰€ç¤ºï¼Œé¦–å…ˆçœ‹å…¨å±€å˜é‡å¯¹è±¡ï¼ˆglobal VOï¼‰ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ createCompFunc å‡½æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªå£°æ˜æå‡åè¿˜æœªè®¡ç®—å®Œæ¯•çš„ result ç­‰å˜é‡ã€‚ é¦–å…ˆæ‰§è¡Œå¤–éƒ¨çš„ createCompFunc å‡½æ•°ï¼Œåˆ›å»ºäº†å®ƒçš„ ECï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä½œç”¨åŸŸé“¾æŒ‡é’ˆæŒ‡å‘å®ƒçš„ä½œç”¨åŸŸé“¾ SC1ã€‚ é‚£ä¹ˆæ˜¾ç„¶ SC1 ä¸­ä¼šæœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ createCompFunc AO å’Œ global VOï¼ˆè¿™å°±æ˜¯åœ¨å‡½æ•°å†…éƒ¨èƒ½å¤Ÿè®¿é—®åˆ°å…¨å±€å˜é‡çš„åŸå› ï¼‰ã€‚ åœ¨ createCompFunc AO ä¸­å­˜æ”¾çš„å°±æ˜¯å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ã€‚ æœ€åæ¥çœ‹ createCompFunc å‡½æ•°å†…éƒ¨è¿”å›çš„åŒ¿åå‡½æ•°ï¼Œå½“ç„¶å®ƒä¹Ÿæœ‰è‡ªå·±çš„æ‰§è¡Œç¯å¢ƒ ECï¼Œä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨åŸŸé“¾ SC2ã€‚ åªä¸è¿‡ç”±äºå®ƒæ˜¯ createCompFunc å‡½æ•°å†…éƒ¨çš„å‡½æ•°ï¼Œå½“ç„¶å®ƒä¹Ÿèƒ½è®¿é—®å¤–éƒ¨ createCompFunc å‡½æ•°å®šä¹‰çš„å˜é‡ï¼Œè¿™æ­£æ˜¯å› ä¸º SC2 ä¸­ä½äºç¬¬äºŒçš„æŒ‡é’ˆæŒ‡å‘ createCompFunc AOï¼ˆè¿™å°±æ˜¯é—­åŒ…çš„åŸç†ï¼‰ã€‚ æ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œåœ¨ createCompFunc å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå› ä¸ºåŒ¿åå‡½æ•°ä»ç„¶å¼•ç”¨ç€ createCompFunc AOï¼Œæ‰€ä»¥å…¶æ´»åŠ¨å¯¹è±¡ä¸ä¼šè¢«é”€æ¯ï¼ˆè¿™æ¶‰åŠåˆ°å†…å­˜å›æ”¶æœºåˆ¶ï¼‰ã€‚ ä»ä¸Šè¿°è®¨è®ºæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹å‡ºï¼šé—­åŒ…çš„åŸç†å°±æ˜¯å†…éƒ¨çš„å‡½æ•°ä»ç„¶å¼•ç”¨ç€å¤–éƒ¨å‡½æ•°çš„ AOï¼Œä½¿å¾—å¤–éƒ¨å‡½æ•°çš„ AO ä»ç„¶ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†é—­åŒ…è®¾ç½®ä¸º null æ¥è§£é™¤å¯¹è¯¥å‡½æ•°çš„å¼•ç”¨ï¼Œå›æ”¶å…¶å ç”¨çš„å†…å­˜ã€‚ 7.2.1. é—­åŒ…ä¸å˜é‡ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•è®¨è®ºä¸‹ä½œç”¨åŸŸé“¾æœºåˆ¶çš„å‰¯ä½œç”¨ï¼ˆå‘ï¼‰ï¼šé—­åŒ…åªèƒ½å–å¾—å¤–éƒ¨å‡½æ•°ä¸­ä»»ä½•å˜é‡çš„æœ€åä¸€ä¸ªå€¼ã€‚ å…ˆæ¥çœ‹ä¸€ä¸ªæ —å­ï¼š 1234567891011121314function createFunc() &#123; var result = []; for (var i = 0; i &lt; 10; i++) &#123; result[i] = function() &#123; return i; // å¸Œæœ›ä¿å­˜ä¸åŒçš„ iï¼Œä½†æ˜¯æœ€å i éƒ½æ˜¯ 10 &#125;; &#125; return result;&#125;var test = createFunc();alert(test[0]()); // 10 å…¶å®å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºé—­åŒ…åœ¨ SC ä¸­ä¿å­˜çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆè€Œå·²ï¼Œå¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•å AO ä¸­çš„å˜é‡è‡ªç„¶æ›´æ–°ä¸ºæœ€åä¸€ä¸ªå€¼å•¦â•®(â•¯â–½â•°)â•­ã€‚ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°å¼ºåˆ¶è®©é—­åŒ…çš„è¡Œä¸ºç¬¦åˆé¢„æœŸï¼š 12345678910111213141516function createFunc() &#123; var result = []; for (var i = 0; i &lt; 10; i++) &#123; result[i] = function(num) &#123; return function() &#123; return num; &#125; &#125;(i); &#125; return result;&#125;var test = createFunc();alert(test[0]()); // 0 åœ¨è¿™é‡Œæˆ‘ä»¬ç›¸å½“äºæœ‰3å±‚å‡½æ•°ã€‚ ä¸­é—´é‚£å±‚çš„åŒ¿åå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•° numï¼Œæˆ‘ä»¬å°† i ä¼ å…¥ç«‹å³æ‰§è¡Œã€‚ å› ä¸ºç®€å•ç±»å‹æ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥ä¸­é—´é‚£å±‚çš„åŒ¿åå‡½æ•°çš„ AO ä¸­ num ä¿å­˜çš„æ˜¯ä¸åŒçš„ iã€‚ è€Œæœ€å†…å±‚çš„åŒ¿åå‡½æ•°è¯»å–çš„æ­£æ˜¯ä¸­é—´å±‚åŒ¿åå‡½æ•°çš„ AOã€‚ 7.2.2. å…³äº this å¯¹è±¡æˆ‘ä»¬çŸ¥é“ï¼Œthis æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®å‡½æ•°çš„æ‰§è¡Œç¯å¢ƒåŠ¨æ€ç»‘å®šçš„ï¼š åœ¨å…¨å±€å‡½æ•°ä¸­ï¼Œthis ç­‰äº windowã€‚ è€Œå‡½æ•°è¢«ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œthis åˆæŒ‡å‘é‚£ä¸ªå¯¹è±¡ã€‚ ä½¿ç”¨ call() å’Œ apply() æ–¹æ³•æ—¶ï¼Œthis åˆä¼šæŒ‡å‘ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡ï¼ˆè¿˜æœ‰ bind()ï¼‰ã€‚ ä¸è¿‡ï¼ŒåŒ¿åå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒå…·æœ‰å…¨å±€æ€§ï¼Œå› æ­¤å†…éƒ¨çš„ this é€šå¸¸æŒ‡å‘ windowï¼Œè§ä¸‹ä¾‹ï¼š 12345678910111213var name = \"The Window\";var object = &#123; name: \"My Object\", getNameFunc: function() &#123; return function() &#123; return this.name; &#125;; &#125;&#125;;alert(object.getNameFunc()()); // The Window (éä¸¥æ ¼æ¨¡å¼ä¸‹)ï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ªæ‹¬å·ï¼Œå› ä¸º object.getNameFunc() æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œåä¸€ä¸ªæ‹¬å·æ˜¯åŒ¿åå‡½æ•°è°ƒç”¨ã€‚ ä¸ºä»€ä¹ˆåŒ¿åå‡½æ•°æ²¡æœ‰å–å¾—å…¶åŒ…å«ä½œç”¨åŸŸï¼ˆæˆ–å¤–éƒ¨ä½œç”¨åŸŸï¼‰çš„ this å¯¹è±¡å‘¢ï¼Ÿ å‰é¢æ›¾ç»æåˆ°è¿‡ï¼Œæ¯ä¸ªå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶éƒ½ä¼šè‡ªåŠ¨å–å¾—ä¸¤ä¸ªç‰¹æ®Šå˜é‡ï¼šthis å’Œ argumentsã€‚è€Œå†…éƒ¨å‡½æ•°åœ¨æœç´¢è¿™ä¸¤ä¸ªå˜é‡æ—¶ï¼Œåªä¼šæœç´¢åˆ°å…¶ AO ä¸ºæ­¢ï¼Œæ‰€ä»¥æ°¸è¿œä¸èƒ½ç›´æ¥è®¿é—®åˆ°å¤–éƒ¨å‡½æ•°ä¸­çš„ this å’Œ argumentsã€‚ ä¸è¿‡è‹¥æ˜¯æˆ‘ä»¬å°†å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„ this å¯¹è±¡ä¿å­˜åœ¨ä¸€ä¸ªé—­åŒ…èƒ½å¤Ÿè®¿é—®åˆ°çš„å˜é‡é‡Œï¼Œå°±å¯ä»¥è®©é—­åŒ…è®¿é—®åˆ°è¯¥å¯¹è±¡äº†ï¼š 123456789101112131415var name = \"The Window\";var object = &#123; name: \"My Object\", getNameFunc: function() &#123; var that = this; // ä½¿ç”¨ that ä¿å­˜å¤–éƒ¨å‡½æ•°çš„ thisï¼ˆé˜²æ­¢è¢«å†…éƒ¨å‡½æ•°çš„ this å±è”½ï¼‰ return function() &#123; return that.name; // ç”±äºè®¿é—®çš„æ˜¯å†…éƒ¨ AO ä¸­æ²¡æœ‰çš„å˜é‡ thatï¼Œæ‰€ä»¥åœ¨ SC ä¸­å¤–éƒ¨çš„ AO ä¸Šæœç´¢ï¼Œå¾—åˆ°å¤–éƒ¨å‡½æ•°çš„ thisã€‚ &#125;; &#125;&#125;;alert(object.getNameFunc()()); // My Object æ¥ä¸‹æ¥å†çœ‹å‡ ä¸ªç‰¹æ®Šçš„æ —å­ï¼š 123456789101112131415var name = \"The Window\";var object = &#123; name: \"My Object\", getName: function() &#123; return this.name; &#125;&#125;;object.getName(); // My Objectï¼Œå¾ˆå¥½ç†è§£ this å°±æ˜¯æŒ‡å‘ object(object.getName)(); // My Objectï¼Œå°†å‡½æ•°åŒ…äº†èµ·æ¥ï¼Œä½†è¿˜æ˜¯é€šè¿‡ object.getName è°ƒç”¨ï¼Œthis è¿˜æ˜¯æŒ‡å‘ object(object.getName = object.getName)(); // The Window(éä¸¥æ ¼æ¨¡å¼ä¸‹)ï¼Œçœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œå°†å‡½æ•° getName èµ‹å€¼ä¸º getNameï¼Œå†è°ƒç”¨èµ‹å€¼åçš„ç»“æœ// å› ä¸ºèµ‹å€¼è¡¨è¾¾å¼æ“ä½œçš„æ˜¯ getName å‡½æ•°æœ¬èº«ï¼Œæ‰€ä»¥ this çš„å€¼æ²¡æœ‰å¾—åˆ°ç»´æŒï¼Œè°ƒç”¨æ—¶æŒ‡å‘äº† widnowã€‚ 7.2.3. å†…å­˜æ³„æ¼å› ä¸º IE9 ä¹‹å‰å¯¹äº JScript å¯¹è±¡å’Œ COM å¯¹è±¡ä½¿ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†æœºåˆ¶ã€‚æ‰€ä»¥å¦‚æœé—­åŒ…çš„ä½œç”¨åŸŸä¸­ä¿å­˜ä¸€ä¸ª HTML å…ƒç´ ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ å°†æ— æ³•è¢«é”€æ¯â•®(â•¯â–½â•°)â•­ã€‚ 7.3. æ¨¡ä»¿å—çº§ä½œç”¨åŸŸæˆ‘ä»¬éƒ½çŸ¥é“åœ¨ ES6 ä¹‹å‰æ˜¯æœ¨æœ‰å—çº§ä½œç”¨åŸŸçš„â•®(â•¯â–½â•°)â•­ï¼Œåœ¨å—è¯­å¥ä¸­å®šä¹‰çš„å˜é‡å®é™…ä¸Šæ˜¯å®šä¹‰åœ¨å‡½æ•° AO ä¸Šçš„ã€‚ å¦‚æœå®åœ¨éœ€è¦å—çº§ä½œç”¨åŸŸï¼Œå¯ä»¥é€šè¿‡ç«‹å³æ‰§è¡Œå‡½æ•°è¿›è¡Œæ¨¡æ‹Ÿã€‚ 1234// è¿™åªæ˜¯å…¶ä¸­ä¸€ç§å†™æ³•...é‡ç‚¹æ˜¯ä¸è¦ä½¿ç”¨å‡½æ•°å£°æ˜ï¼Œè¿™æ ·ç”±äºå£°æ˜æå‡ä¼šæŠ¥é”™ã€‚(function() &#123; // è¿™é‡Œæ˜¯å—çº§ä½œç”¨åŸŸ&#125;)(); åœ¨ä¸€ä¸ªå¤§å‹ç¨‹åºä¸­è¿‡å¤šçš„å…¨å±€å˜é‡å’Œå‡½æ•°å¾ˆå®¹æ˜“é€ æˆå‘½åå†²çªï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘åœ¨å…¨å±€ä½œç”¨åŸŸä¸­æ·»åŠ å˜é‡å’Œå‡½æ•°ã€‚ä¹Ÿå¯ä»¥è¯´æ˜¯æ¨¡å—åŒ–çš„åŸºç¡€ã€‚ps jQuery æºç ä¸­æœ€å¤–å±‚å‡½æ•°å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°â€¦ 7.4. ç§æœ‰å˜é‡ä¸¥æ ¼æ¥è¯´ï¼ŒJavaScript ä¸­æ²¡æœ‰ç§æœ‰æˆå‘˜çš„æ¦‚å¿µâ€¦â•®(â•¯â–½â•°)â•­ï¼Œä¸è¿‡åœ¨ä»»ä½•å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ï¼Œå¤–éƒ¨éƒ½æ— æ³•è®¿é—®åˆ°ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ç§æœ‰å˜é‡ã€‚ ç§æœ‰å˜é‡åŒ…æ‹¬ï¼š å‡½æ•°çš„å‚æ•° å±€éƒ¨å˜é‡ å†…éƒ¨å®šä¹‰çš„å…¶ä»–å‡½æ•° é‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦è®¿é—®è¿™äº›ç§æœ‰å˜é‡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåœ¨æ­¤å°±è¦å¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šç‰¹æƒæ–¹æ³•ï¼ˆprivileged methodï¼‰æœ‰æƒè®¿é—®ç§æœ‰å˜é‡å’Œç§æœ‰å‡½æ•°çš„å…¬æœ‰æ–¹æ³•ã€‚ è¿™ä¸ªæ¦‚å¿µæ˜¯ä¸æ˜¯å’Œé—­åŒ…ç‚’é¸¡åƒï¼ï¼Ÿ å…¶å®æœ‰ä¸¤ç§åœ¨å¯¹è±¡ä¸Šåˆ›å»ºç‰¹æƒæ–¹æ³•çš„æ–¹å¼ï¼Œç¬¬ä¸€ç§å°±æ˜¯åˆ©ç”¨é—­åŒ…åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ç‰¹æƒæ–¹æ³•ã€‚åŸºæœ¬æ¨¡å¼å¦‚ä¸‹ï¼š 123456789101112131415function MyObject() &#123; // ç§æœ‰å˜é‡å’Œå‡½æ•° var privateVar = 10; function privateFunc() &#123; return false; &#125; // ç‰¹æƒæ–¹æ³• this.publicMethod = function() &#123; privateVar++; return privateFunc(); &#125;;&#125; ä½†æ˜¯ï¼Œè¿™æ ·å®šä¹‰ç‰¹æƒæ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¿…é¡»ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€‚è€Œä¹‹å‰å·²ç»è®¨è®ºè¿‡äº†æ„é€ å‡½æ•°ä¼šä¸ºæ¯ä¸ªå®ä¾‹éƒ½åˆ›å»ºä¸€ç»„æ–°æ–¹æ³•ï¼Œæµªè´¹å†…å­˜ï¼Œè€Œæ¥ä¸‹æ¥ä»‹ç»çš„ç¬¬äºŒç§æ–¹æ³•ï¼Œä½¿ç”¨é™æ€ç§æœ‰å˜é‡å°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ 7.4.1. é™æ€ç§æœ‰å˜é‡åŸºæœ¬æ€æƒ³å°±æ˜¯ï¼šåœ¨ç§æœ‰ä½œç”¨åŸŸï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰ä¸­å®šä¹‰ç§æœ‰å˜é‡æˆ–å‡½æ•°ï¼Œå¹¶åœ¨å†…éƒ¨é€šè¿‡å‡½æ•°è¡¨è¾¾å¼å®šä¹‰æ„é€ å‡½æ•°å’Œå®ƒçš„å…¬æœ‰æ–¹æ³•ã€‚åŸºæœ¬æ¨¡å¼å¦‚ä¸‹ï¼š 12345678910111213141516171819(function() &#123; // ç§æœ‰å˜é‡å’Œç§æœ‰å‡½æ•° var privateVar = 10; function privateFunc() &#123; return false; &#125; // æ„é€ å‡½æ•° MyObject = function() &#123;&#125;; // æ²¡æœ‰ä½¿ç”¨ varï¼Œæ‰€ä»¥æ˜¯åœ¨ window ä¸Šåˆ›å»ºï¼ˆæ‰€ä»¥æ˜¯éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰ã€‚ // å…¬æœ‰/ç‰¹æƒæ–¹æ³• MyObject.prototype.publicMethod = function() &#123; privateVar++; return privateFunc(); &#125;;&#125;)(); æ˜¾ç„¶ï¼Œé€šè¿‡ä¸Šä¸€ç¯‡å¯¹äºå¯¹è±¡ç»§æ‰¿çš„è®¨è®ºæˆ‘ä»¬çŸ¥é“ï¼šå®šä¹‰åœ¨åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•æ˜¯æ‰€æœ‰å®ä¾‹å…±äº«çš„ï¼Œè€Œè¿™äº›æ–¹æ³•ï¼ˆå¦‚ publicMethodï¼‰æ‰€æ“ä½œçš„å¯¹è±¡ï¼Œå³ç§æœ‰å˜é‡å’Œå‡½æ•°ä¹Ÿæ˜¯åŒä¸€ä¸ªã€‚æ‰€ä»¥é€šè¿‡ MyObject æ„é€ å‡½æ•°åˆ›é€ çš„å®ä¾‹éƒ½æœ‰æƒè®¿é—®ç§æœ‰å˜é‡ï¼ˆè€Œä¸”æ˜¯åŒä¸€ä¸ªï¼‰ï¼Œè¿™å°±æ˜¯é™æ€ç§æœ‰å˜é‡ã€‚ 7.4.2. æ¨¡å—æ¨¡å¼æ¨¡å—æ¨¡å¼ï¼ˆmodule patternï¼‰æ˜¯ä¸ºã€Œå•ä¾‹ã€åˆ›å»ºç§æœ‰å˜é‡å’Œç‰¹æƒæ–¹æ³•ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå•ä¾‹æ˜¯å•¥ï¼Ÿ å•ä¾‹ï¼ˆsingletonï¼‰æŒ‡çš„å°±æ˜¯åªæœ‰ä¸€ä¸ªå®ä¾‹çš„å¯¹è±¡ã€‚æ¯”å¦‚ JavaScript ä¸­å°±æ˜¯ä»¥å¯¹è±¡å­—é¢é‡æ¥åˆ›å»ºå•ä¾‹å¯¹è±¡çš„ã€‚ 123456var singleton = &#123; name : value, method: function() &#123; // æ–¹æ³•çš„ä»£ç  &#125;&#125;; æ¨¡å—æ¨¡å¼é€šè¿‡ä¸ºå•ä¾‹æ·»åŠ ç§æœ‰å˜é‡å’Œç‰¹æƒæ–¹æ³•ä½¿å…¶å¾—åˆ°å¢å¼ºï¼š 1234567891011121314151617181920var singleton = function() &#123; // ç§æœ‰å˜é‡å’Œç§æœ‰å‡½æ•° var privateVar = 10; function privateFunc() &#123; return false; &#125; // å…¬æœ‰/ç‰¹æƒæ–¹æ³• return &#123; publicProperty: true, publicMethod: function() &#123; privateVar++; return privateFunc(); &#125;; &#125;;&#125;(); å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œæ¨¡å—æ¨¡å¼å°±æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªè¿”å›å¯¹è±¡çš„åŒ¿åå‡½æ•°ï¼š åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰äº†ç§æœ‰å˜é‡å’Œå‡½æ•° ç„¶åå°†å¯¹è±¡å­—é¢é‡è¿”å›ã€‚ å› ä¸ºå¯¹è±¡æ˜¯å‡½æ•°å†…éƒ¨å®šä¹‰çš„ï¼Œæ‰€ä»¥å®ƒçš„æ–¹æ³•æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚ æ¨¡å—æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä¸»è¦æ˜¯åœ¨éœ€è¦å¯¹å•ä¾‹è¿›è¡ŒæŸäº›åˆå§‹åŒ–ï¼ŒåŒæ—¶åˆéœ€è¦ç»´æŠ¤å…¶ç§æœ‰å˜é‡æ—¶æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ 7.4.3. å¢å¼ºçš„æ¨¡å—æ¨¡å¼åº”ç”¨åœºæ™¯ï¼šå•ä¾‹å¿…é¡»æ˜¯æŸç§ç±»å‹çš„å®ä¾‹ï¼ŒåŒæ—¶è¿˜å¿…é¡»æ·»åŠ æŸäº›å±æ€§å’Œï¼ˆæˆ–ï¼‰æ–¹æ³•å¯¹å…¶è¿›è¡ŒåŠ å¼ºçš„æƒ…å†µã€‚ 12345678910111213141516171819202122var singleton = function() &#123; // ç§æœ‰å˜é‡å’Œç§æœ‰å‡½æ•° var privateVar = 10; function privateFunc() &#123; return false; &#125; // åˆ›å»ºå¯¹è±¡ var object = new CustomType(); // æ·»åŠ å…¬æœ‰/ç‰¹æƒå±æ€§å’Œæ–¹æ³• object.publicProperty = true; object.publicMethod = function() &#123; privateVar++; return privateFunc(); &#125;; return object;&#125;(); 7.5. å°ç»“1. åœ¨ JavaScript ä¸­ï¼Œä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼å¯ä»¥æ— é¡»å¯¹å‡½æ•°å‘½åï¼Œä»è€Œå®ç°åŠ¨æ€ç¼–ç¨‹ï¼Œè¿˜æœ‰å¼ºå¤§çš„åŒ¿åå‡½æ•°ï¼Œä»¥ä¸‹æ˜¯å‡½æ•°è¡¨è¾¾å¼çš„ç‰¹ç‚¹ï¼š å‡½æ•°å£°æ˜å¿…é¡»è¦æœ‰åå­—ï¼Œè¿˜ä¼šå£°æ˜æå‡ï¼Œè€Œå‡½æ•°è¡¨è¾¾å¼ä¸éœ€è¦ï¼Œæ²¡æœ‰åå­—çš„å‡½æ•°è¡¨è¾¾å¼åˆå«åŒ¿åå‡½æ•° åœ¨é€’å½’å‡½æ•°ä¸­ä½¿ç”¨å‡½æ•°åè°ƒç”¨è‡ªèº«å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚å‡½æ•°åå‘ç”Ÿäº†å˜åŒ–ã€‚ åœ¨é€’å½’å‡½æ•°ä¸­è¦æŒæ¡è°ƒç”¨å‡½æ•°è‡ªèº«çš„æŠ€å·§ï¼Œå¦‚ arguments.callee ç­‰ã€‚ 2. é—­åŒ…ï¼šåœ¨å¤–éƒ¨å‡½æ•°ä¸­åˆå®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œè¿™ä¸ªå†…éƒ¨å‡½æ•°æœ‰æƒè®¿é—®å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰å˜é‡ï¼ŒåŸç†å¦‚ä¸‹ï¼š åœ¨ JavaScript å¼•æ“æ‰§è¡Œæ—¶ï¼Œé—­åŒ…çš„ SC åŒ…å«äº†è‡ªå·±çš„ AOã€å¤–éƒ¨å‡½æ•°çš„ AO è¿˜æœ‰å…¨å±€ VOã€‚ é€šå¸¸ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸå’Œæ‰€æœ‰å˜é‡ä¼šåœ¨å‡½æ•°æ‰§è¡Œåè¢«é”€æ¯ã€‚ ä½†æ˜¯ï¼Œå½“å‡½æ•°è¿”å›äº†ä¸€ä¸ªé—­åŒ…æ—¶ï¼Œå¤–éƒ¨å‡½æ•°çš„ AO ä¼šä¸€ç›´ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°è§£é™¤é—­åŒ…çš„å¼•ç”¨ï¼Œå¦‚è®¾ä¸º nullã€‚ 3. ä½¿ç”¨é—­åŒ…å¯ä»¥æ¨¡ä»¿å—çº§ä½œç”¨åŸŸï¼š ç«‹å³æ‰§è¡Œå‡½æ•°æ—¢å¯ä»¥æ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œåˆä¸ä¼šåœ¨å†…å­˜ä¸­ç•™ä¸‹å¯¹è¯¥å‡½æ•°çš„å¼•ç”¨ã€‚ æ‰€ä»¥å‡½æ•°å†…éƒ¨çš„æ‰€æœ‰å˜é‡éƒ½ä¼šè¢«ç«‹å³é”€æ¯ï¼Œé™¤éå°†æŸäº›å˜é‡èµ‹å€¼ç»™å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚ 4. é—­åŒ…è¿˜å¯ä»¥ç”¨äºåœ¨å¯¹è±¡ä¸­åˆ›å»ºç§æœ‰å˜é‡ï¼š å‡½æ•°å†…éƒ¨çš„å˜é‡ã€æ–¹æ³•ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ã€‚ ä½†é€šè¿‡é—­åŒ…å¯ä»¥å®ç°å…¬æœ‰æ–¹æ³•ï¼Œå³è®¿é—®åœ¨åŒ…å«ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡ã€‚ æœ‰æƒè®¿é—®ç§æœ‰å˜é‡çš„å…¬æœ‰æ–¹æ³•å«åšç‰¹æƒæ–¹æ³•ã€‚ å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€åŸå‹æ¨¡å¼æ¥å®ç°è‡ªå®šä¹‰ç±»å‹çš„ç‰¹æƒæ–¹æ³•ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡å—æ¨¡å¼ã€å¢å¼ºæ¨¡å—æ¨¡å¼æ¥å®ç°å•ä¾‹çš„ç‰¹æƒæ–¹æ³•ã€‚ ç»¼ä¸Šï¼šJavaScript ä¸­å‡½æ•°è¡¨è¾¾å¼å’Œé—­åŒ…éƒ½æ˜¯å¾ˆç»™åŠ›çš„ç‰¹æ€§ã€‚ä¸è¿‡ï¼Œå› ä¸ºåˆ›å»ºé—­åŒ…å¿…é¡»ç»´æŠ¤é¢å¤–çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥è¿‡åº¦ä½¿ç”¨å¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://buptsteve.github.io/blog/tags/JavaScript/"}]},{"title":"ã€Œ5ã€JavaScript é¢å‘å¯¹è±¡æ·±å…¥ç†è§£","date":"2016-03-17T08:27:58.000Z","path":"2016/03/17/5.js-oo-chapter6/","text":"é›¶ã€å‰è¨€æœ€è¿‘ä¸ºäº†æ‰¾æš‘å‡å®ä¹ ï¼Œæ­£åœ¨æ¶è¡¥åŸºç¡€ï¼Œä»”ç»†ç ”è¯»äº†ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹ç¬¬6ç«  é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡ã€‚æ„Ÿè§‰æ”¶è·é¢‡å¤šï¼Œåœ¨æ­¤çŒ®ä¸‘åˆ†äº«ä¸€ç‚¹å„¿è‡ªå·±çš„ç†è§£ã€‚ åŒæ ·æŒ‰ç…§ä¹¦æœ¬çš„é¡ºåºåˆ†ä¸ºå¦‚ä¸‹ä¸‰éƒ¨åˆ† ç†è§£å¯¹è±¡å±æ€§ ç†è§£å¹¶åˆ›å»ºå¯¹è±¡ ç†è§£ç»§æ‰¿ ä¸€ã€ç¬¬6ç«  é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡6.1. ç†è§£å¯¹è±¡ECMA-262 æŠŠå¯¹è±¡å®šä¹‰ä¸ºï¼šâ€œæ— åºå±æ€§çš„é›†åˆï¼Œå…¶å±æ€§å¯ä»¥åŒ…å«åŸºæœ¬å€¼ã€å¯¹è±¡æˆ–è€…å‡½æ•°ã€‚â€ç®€å•æ¥è¯´ï¼Œå¯¹è±¡å°±æ˜¯ä¸€äº›åå€¼å¯¹ï¼ˆKey-Valueï¼‰ï¼Œè€Œå¯¹è±¡çš„åå­—å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚ 6.1.1. å±æ€§ç±»å‹ECMAScript ä¸­æœ‰ä¸¤ç§å±æ€§ï¼šæ•°æ®å±æ€§å’Œè®¿é—®å™¨å±æ€§ã€‚ 6.1.2. æ•°æ®å±æ€§ [[Configurable]]ï¼šè¡¨ç¤ºèƒ½å¦é€šè¿‡ delete åˆ é™¤å±æ€§ä»è€Œé‡æ–°å®šä¹‰å±æ€§ï¼Œèƒ½å¦ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼Œèƒ½å¦æŠŠå±æ€§ä¿®æ”¹ä¸ºè®¿é—®å™¨å±æ€§ï¼Œé»˜è®¤ä¸º trueã€‚ [[Enumerable]]ï¼šè¡¨ç¤ºèƒ½å¦é€šè¿‡ for-in å¾ªç¯è¿”å›å±æ€§ï¼Œä»¥åŠ console.log æ—¶æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤ä¸º trueã€‚ [[Writable]]ï¼šè¡¨ç¤ºèƒ½å¦ä¿®æ”¹å±æ€§çš„å€¼ï¼Œé»˜è®¤ä¸º trueã€‚ [[Value]]ï¼šåŒ…å«è¿™ä¸ªå±æ€§çš„æ•°æ®å€¼ï¼Œé»˜è®¤ä¸º undefinedã€‚ è¦ä¿®æ”¹ä»¥ä¸Šå±æ€§ï¼Œå¿…é¡»ä½¿ç”¨ ES5 ä¸­çš„ Object.defineProperty()ã€‚ 12345678910111213141516171819202122232425// ä¾‹1var person = &#123;&#125;;Object.defineProperty(person, \"name\", &#123; writable: false, value : \"steve\"&#125;);alert(person.name); // steveperson.name = \"abc\";alert(person.name); // steve// ä¾‹2var person = &#123;&#125;;Object.defineProperty(person, \"name\", &#123; configurable: false, value : \"steve\"&#125;);// æŠ›å‡ºé”™è¯¯Object.defineProperty(person, \"name\", &#123; configurable: true, value : \"steve\"&#125;); ps åœ¨è°ƒç”¨ Object.defineProperty() æ–¹æ³•æ—¶ï¼Œé»˜è®¤å€¼ä¸º false(å°±æ˜¯è¯´å…¶ä»–æ²¡å†™çš„å±æ€§éƒ½æ˜¯ false)ã€‚ 6.1.3. è®¿é—®å™¨å±æ€§è®¿é—®å™¨å±æ€§ä¸åŒ…æ‹¬æ•°æ®å€¼(Value)ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€å¯¹å„¿ getter å’Œ setter å‡½æ•°(éå¿…é¡»)ã€‚ [[Configurable]]ï¼šè¡¨èƒ½å¦é€šè¿‡ delete åˆ é™¤å±æ€§ä»è€Œé‡æ–°å®šä¹‰å±æ€§ï¼Œèƒ½å¦ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼Œèƒ½å¦æŠŠå±æ€§ä¿®æ”¹ä¸ºè®¿é—®å™¨å±æ€§ï¼Œé»˜è®¤ä¸º trueã€‚ [[Enumerable]]ï¼šè¡¨èƒ½å¦é€šè¿‡ for-in å¾ªç¯è¿”å›å±æ€§ï¼Œä»¥åŠ console.log æ—¶æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤ä¸º trueã€‚ [[Get]]ï¼šåœ¨è¯»å–å±æ€§æ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œé»˜è®¤ä¸º trueã€‚ [[Set]]ï¼šåœ¨å†™å…¥å±æ€§æ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œé»˜è®¤ä¸º undefinedã€‚ è®¿é—®å™¨å±æ€§ä¸èƒ½ç›´æ¥å®šä¹‰ï¼Œå¿…é¡»ä½¿ç”¨ Object.defineProperty() æ¥å®šä¹‰ã€‚ 1234567891011121314151617181920var book = &#123; _year : 2004, edition: 1&#125;;Object.defineProperty(book, \"year\", &#123; get: function() &#123; return this._year; &#125;, set: function(newValue) &#123; if (newValue &gt; 2004) &#123; this._year = newValue; this.edition += newValue - 2004; &#125; &#125;&#125;);book.year = 2005;alert(book.edition); // 2 ps å¦‚æœåªå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•çš„å…¶ä¸­ä¹‹ä¸€ï¼Œé‚£ä¹ˆå¦ä¸€ç§æ–¹å¼åˆ™æ— æ³•ä½¿ç”¨ï¼Œä¾‹å¦‚åªå®šä¹‰äº† getterï¼Œåˆ™å±æ€§ä¸å¯å†™ã€‚ 6.1.4. å®šä¹‰å¤šä¸ªå±æ€§12345678910111213141516171819202122var book = &#123;&#125;;Object.defineProperties(book, &#123; _year: &#123; value: 2004 &#125;, year: &#123; get: function() &#123; return this._year; &#125;, set: function(newValue) &#123; if (newValue &gt; 2004) &#123; this._year = newValue; &#125; &#125; &#125;&#125;);book.year = 2005;alert(book.edition); // 2 6.1.5. è¯»å–å±æ€§çš„ç‰¹æ€§12345var desc = Object.getOwnPropertyDescriptor(book, \"_year\");alert(desc.value); // 2004alert(desc.configurable); // falsealert(typeof desc.get); // undefined 6.2. åˆ›å»ºå¯¹è±¡ä½¿ç”¨ Object æ„é€ å‡½æ•°å’Œå­—é¢é‡åˆ›å»ºå¯¹è±¡ï¼Œä¼šäº§ç”Ÿå¤§é‡é‡å¤ä»£ç ï¼Œæ‰€ä»¥ä»¥ä¸‹ä»£ç é‡ç”¨æœºåˆ¶åº”è¿è€Œç”Ÿã€‚ 6.2.1. å·¥å‚æ¨¡å¼ç‰¹ç‚¹ï¼šä½¿ç”¨å‡½æ•°å°è£…ç‰¹å®šæ¥å£åˆ›å»ºå¯¹è±¡çš„ç»†èŠ‚ã€‚ ç®€å•æ¥è¯´å°±æ˜¯åœ¨å‡½æ•°çš„å†…éƒ¨åˆ›å»ºå¯¹è±¡ï¼Œä¸ºå…¶æ·»åŠ å±æ€§å’Œæ–¹æ³•åï¼Œç”¨ return è¿”å›ï¼Œåœ¨å®ä¾‹åŒ–æ—¶ä¸ä½¿ç”¨ new æ“ä½œç¬¦ã€‚ 12345678910111213141516function createPerson(name, age, job) &#123; var o = &#123; name: name, age : age, job : job, sayName: function() &#123; alert(this.name); &#125; &#125;; return o;&#125;var person1 = createPerson(\"steve\", 24, \"fe\");var person2 = createPerson(\"young\", 25, \"fs\"); é—®é¢˜ï¼šæ²¡æœ‰è§£å†³å¯¹è±¡è¯†åˆ«çš„é—®é¢˜ï¼ˆå³æ€æ ·çŸ¥é“ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ï¼‰ï¼Œé‡å¤æ„é€ ç›¸åŒçš„æ–¹æ³•é€ æˆå†…å­˜æµªè´¹ï¼Œä¹Ÿæ— æ³•è¿›è¡Œç»§æ‰¿å¤ç”¨ã€‚ 6.2.2. æ„é€ å‡½æ•°æ¨¡å¼ç‰¹ç‚¹ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ this å¯¹è±¡åœ¨è¿è¡Œæ—¶åŸºäºå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒåŠ¨æ€ç»‘å®šï¼Œä½¿ç”¨ new æ“ä½œç¬¦å®ä¾‹åŒ–ã€‚ ps é€šè¿‡ new å…³é”®å­—æ–¹å¼è°ƒç”¨çš„å‡½æ•°éƒ½è¢«è®¤ä¸ºæ˜¯æ„é€ å‡½æ•°ã€‚ 123456789101112131415function Person(name, age, job) &#123; this.name = name; this.age = age; this.job = job; this.sayName = function() &#123; alert(this.name); &#125;;&#125;var person1 = new Person(\"steve\", 24, \"fe\");var person2 = new Person(\"young\", 25, \"fs\");alert(person1.constructor === Person); // truealert(person2.constructor === Person); // true 1. ä¸å·¥å‚æ¨¡å¼çš„ä¸åŒä¹‹å¤„ æ²¡æœ‰æ˜¾å¼åœ°åˆ›å»ºå¯¹è±¡ ç›´æ¥å°†å±æ€§å’Œæ–¹æ³•èµ‹å€¼ç»™äº† this å¯¹è±¡ æ²¡æœ‰ return è¯­å¥ 2. å¿…é¡»ä½¿ç”¨ new æ“ä½œç¬¦åˆ›å»ºæ–°å®ä¾‹è¿™ä¸ªè¿‡ç¨‹ç»å†ä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ å°†æ„é€ å‡½æ•°çš„ä½œç”¨åŸŸèµ‹ç»™æ–°å¯¹è±¡ï¼ˆthis æŒ‡å‘æ–°å¯¹è±¡ï¼‰ æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç ï¼ˆä¸ºä¹‹æ·»åŠ å±æ€§ï¼‰ è¿”å›æ–°å¯¹è±¡ è¿™ç§æ–¹å¼èƒœè¿‡å·¥å‚æ¨¡å¼çš„åœ°æ–¹å°±åœ¨äºï¼šå¯ä»¥å°†å®ä¾‹æ ‡è¯†ä¸ºä¸€ç§ç‰¹å®šçš„ç±»å‹ã€‚ 3. æ„é€ å‡½æ•°å½“ä½œæ™®é€šå‡½æ•°æ—¢ç„¶å®ä¾‹åŒ–éœ€è¦ä½¿ç”¨ new æ“ä½œç¬¦ï¼Œä¸‡ä¸€ä¸ä½¿ç”¨åˆä¼šæ€ä¹ˆæ ·çš„ï¼Ÿ 123456789101112// å½“ä½œæ„é€ å‡½æ•°ä½¿ç”¨var person = new Person(\"steve\", 24, \"fe\");person.sayName(); // steve// å½“ä½œæ™®é€šå‡½æ•°ä½¿ç”¨Person(\"young\", 24, \"fe\"); // æ·»åŠ åˆ° window å¯¹è±¡ä¸­window.sayName(); // young// åœ¨å¦ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨åŸŸä¸­è°ƒç”¨var o = new Object();Person.call(o, \"sasuke\", 24, \"fe\");o.sayName(); // sasuke 4. æ„é€ å‡½æ•°çš„é—®é¢˜æ¯ä¸ªæ–¹æ³•æœ‰ç‹¬ç«‹çš„å†…å­˜ï¼Œé€ æˆæµªè´¹ã€‚ 1234567891011121314alert(person1.sayName == person2.sayName); // false// è™½ç„¶å¯ä»¥æŠŠå‡½æ•°å®šä¹‰è½¬ç§»åˆ°æ„é€ å‡½æ•°å¤–function Person(name, age, job) &#123; this.name = name; this.age = age; this.job = job; this.sayName = sayName;&#125;function sayName() &#123; alert(this.Name);&#125; è™½ç„¶è¿™æ ·å°†å…¶è®¾ç½®æˆäº†å…¨å±€å‡½æ•°ï¼Œä½†æ˜¯æ–°é—®é¢˜å°±æ˜¯ï¼šå…¨å±€å‡½æ•°å´åªèƒ½è¢«æŸä¸ªå¯¹è±¡è°ƒç”¨ï¼Œå¹¶ä¸”å¦‚æœéœ€è¦å®šä¹‰å¾ˆå¤šæ–¹æ³•ï¼Œå°±éœ€è¦å®šä¹‰å¾ˆå¤šå…¨å±€å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯«æ— å°è£…æ€§å¯è¨€ã€‚ 6.2.3. åŸå‹æ¨¡å¼é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªå±æ€§å«åš prototypeï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚ åŸå‹å¯¹è±¡çš„ç”¨é€”ï¼šåŒ…å«å¯ä»¥ç”±ç‰¹å®šç±»å‹çš„ã€Œæ‰€æœ‰å®ä¾‹ã€[å…±äº«]çš„å±æ€§å’Œæ–¹æ³•ã€‚ æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼šæ‰€æœ‰å¯¹è±¡å®ä¾‹å¯ä»¥ä¸€èµ·é€šè¿‡è¿™ä¸ª prototype æ¥å…±äº«å±æ€§å’Œæ–¹æ³•ï½ã€‚ 12345678910111213141516171819function Person() &#123;&#125;// å±æ€§Person.prototype.name = \"steve\";Person.prototype.age = 24;Person.prototype.job = \"Web Developer\";// æ–¹æ³•Person.prototype.sayName = function() &#123; alert(this.name);&#125;;var person1 = new Person();person1.sayName(); // stevevar person2 = new Person();person2.sayName(); // stevealert(person1.sayName === person2.sayName); // true å…±äº«åŒä¸€ä¸ªæ–¹æ³• 1. æ·±å…¥ç†è§£åŸå‹å¯¹è±¡ åªè¦æ˜¯å‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ª prototype æŒ‡é’ˆï¼ŒæŒ‡å‘åŸå‹å¯¹è±¡ã€‚ è€ŒåŸå‹å¯¹è±¡é»˜è®¤ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª constructor æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸Šä¸€æ¡ä¸­çš„å‡½æ•°ã€‚ï¼ˆä½ æŒ‡æˆ‘ï¼Ÿæˆ‘ä¹ŸæŒ‡ä½ â†’_â†’ï¼‰ è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹åï¼Œå®ä¾‹å†…éƒ¨ä¹Ÿä¼šè·å¾—ä¸€ä¸ª [[prototype]] æŒ‡é’ˆï¼ˆES5 ä¸­è¿™ä¹ˆå«ï¼‰ï¼ŒæŒ‡å‘åŸå‹å¯¹è±¡ï¼ˆä¸æ˜¯åˆ›é€ å®ƒçš„æ„é€ å‡½æ•°ï¼ï¼‰ã€‚ ä¸‹é¢è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼š ç¬¬ä¸€æ¡å¾ˆå¥½ç†è§£ï¼Œå½“ä½œå¤§è‡ªç„¶çš„è§„å¾‹æ¥è®°å°±å¥½å•¦ï¼Œä½ å¦è®¤ä¹Ÿæ²¡ç”¨â€¦ ç¬¬äºŒæ¡å°±æ˜¯è¯´åŸå‹å¯¹è±¡ä¸ä¸€èˆ¬çš„å¯¹è±¡æœ€å¤§çš„ä¸åŒå°±æ˜¯è¿™ä¸ª constructor æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨é‡å†™æ„é€ å‡½æ•°çš„ prototype æ—¶ï¼Œè¦æƒ³ä¸ä¹‹å‰çš„åŸå‹å¯¹è±¡ä¿æŒä¸€è‡´ï¼Œæœ€å¥½ä¹ŸåŠ ä¸Šè¿™ä¸ª constructor æŒ‡é’ˆï¼ˆæ˜¾å¾—ä¸“ä¸šå˜›ï½ï¼‰ã€‚ ç¬¬ä¸‰æ¡ï¼Œå…¶å®åœ¨ Firefoxã€Safari å’Œ Chrome ä¸­ï¼Œ[[prototype]] å°±æ˜¯ __proto__ æŒ‡é’ˆã€‚ ps æ— è®ºæœ‰æ²¡æœ‰ __proto__ æŒ‡é’ˆï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡ isPrototypeOf() æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡ä¹‹é—´æ˜¯å¦å­˜åœ¨åŸå‹å…³ç³»ã€‚ï¼ˆPerson.prototype.isPrototypeOf(person1) // trueï¼‰ pps ES5 ä¸­å¢åŠ äº†ä¸€ä¸ªæ–°æ–¹æ³• Object.getPrototypeOf() ï¼ˆObject.getPrototypeOf(person1) === Person.prototype // trueï¼‰ æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šæ„é€ å‡½æ•°æœ‰æŒ‡å‘åŸå‹å¯¹è±¡çš„æŒ‡é’ˆ(prototype)ï¼ŒåŸå‹å¯¹è±¡ä¹Ÿæœ‰æŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆ(constructor)ï¼Œå®ä¾‹åŒæ ·ä¹Ÿæœ‰æŒ‡å‘åŸå‹å¯¹è±¡çš„æŒ‡é’ˆ([[prototype]]) é‚£ä¹ˆè¿™ç©æ„å„¿æè¿™ä¹ˆå¤æ‚æœ‰å•¥ç”¨å’§â€¦? ç®€å•ä¸¾ä¸ªæ —å­ï¼Œä¸Šæ–‡ä¸­ 6.2.3.åŸå‹æ¨¡å¼ä¸€èŠ‚ä¸­çš„ä¸¤ä¸ªå®ä¾‹(person1,person2)å¹¶ä¸åŒ…å«ä»»ä½•å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥è°ƒç”¨ person1.sayName() æ–¹æ³•ï¼Œè¿™å°±æ˜¯é€šè¿‡æŸ¥æ‰¾å¯¹è±¡å±æ€§çš„è¿‡ç¨‹å®ç°çš„ã€‚ è¿˜æœ‰æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„å„ç§æ•°ç»„æ–¹æ³•(slice,splice,sortâ€¦)ï¼ŒåŒæ ·ä¹Ÿæ˜¯å®šä¹‰åœ¨ Array.prototype è¿™ä¸ªå¯¹è±¡ä¸Šçš„ã€‚ å…¶å®æ¯å½“è¯»å–æŸä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æœç´¢ï¼Œç›®æ ‡å°±æ˜¯ç»™å®šçš„å±æ€§åã€‚é¦–å…ˆå½“ç„¶å…ˆæœç´¢å¯¹è±¡å®ä¾‹è‡ªèº«ï¼Œå¦‚æœæ²¡æ‰¾åˆ°å†ç»§ç»­æœç´¢ [[prototype]] æŒ‡é’ˆæŒ‡å‘çš„åŸå‹å¯¹è±¡ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†å‘ä¸ŠæŸ¥æ‰¾â€¦ æ‰€ä»¥å®ä¾‹çš„å±æ€§å¯ä»¥â€œå±è”½â€œåŸå‹é“¾ä¸Šçš„åŒåå±æ€§ã€‚ï¼ˆé€šè¿‡ delete å¯ä»¥åˆ é™¤å®åŠ›å±æ€§ï¼Œæ¶ˆé™¤å±è”½ï¼‰ a. å¦‚ä½•åˆ¤æ–­å±æ€§å±äºå®ä¾‹è¿˜æ˜¯åŸå‹é“¾ï¼Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨ hasOwnProperty() çŠ¯æ³•ã€‚ b. å¦‚æœåŸå‹é“¾ä¸Šä¹Ÿæ²¡æœ‰å’‹åŠï¼Ÿè¿˜è®°å¾— JavaScript ä¸­çš„æ•°æ®ç±»å‹ä¹ˆï¼Œä¸å¹³å‡¡çš„é‚£ä¸ªå¼•ç”¨ç±»å‹ Objectã€‚æˆ‘ä»¬ä½¿ç”¨çš„ Arrayã€Functionã€Dateã€RegExpâ€¦ éƒ½æ˜¯ç”± Object æ´¾ç”Ÿè€Œæˆã€‚æ¢å¥è¯è¯´ä»–ä»¬çš„åŸå‹å¯¹è±¡éƒ½æŒ‡å‘äº† Object.prototypeã€‚æœ€å Object.prototype åˆæŒ‡å‘äº† nullã€‚ æ‰€ä»¥å¦‚æœå¯»æ‰¾å±æ€§ç›´åˆ° Object.prototype ä¸­éƒ½æ²¡æœ‰ï¼Œä»è€Œæ‰¾åˆ° nullã€‚é‚£ä¹ˆ JS å¼•æ“å°±ä¼šæŠ›å‡º undefinedã€‚ 2. åŸå‹ä¸ in æ“ä½œç¬¦in æ“ä½œç¬¦ç”¨æ¥åˆ¤æ–­å¯¹è±¡èƒ½å¦è®¿é—®ç»™å®šå±æ€§ï¼ˆå‰ææ˜¯ enumerable ä¸º trueï¼‰ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ä½¿ç”¨ in æ“ä½œç¬¦ï¼š å•ç‹¬ä½¿ç”¨ åœ¨ for-in å¾ªç¯ä¸­ä½¿ç”¨ ä½†ç”±äº in æ“ä½œç¬¦ä¸åŒºåˆ†å®ä¾‹å’ŒåŸå‹é“¾ï¼Œæ‰€ä»¥æ—¥å¸¸ä½¿ç”¨ä¸­éœ€è¦ç»“åˆ hasOwnProperty() æ–¹æ³• 1234function hasPrototypeProperty(object, name) &#123; // åˆ¤æ–­æ˜¯å¦æ˜¯åŸå‹é“¾ä¸Šçš„å±æ€§ return !object.hasOwnProperty(name) &amp;&amp; (name in object);&#125; æ­¤å¤–è¦å–å¾—å¯¹è±¡ä¸Šæ‰€æœ‰å¯æšä¸¾çš„å®ä¾‹å±æ€§ï¼Œå¯ä»¥ç”¨ ES5 ä¸­çš„ Object.keys() æ–¹æ³•ï¼ˆè¿”å›æ•°ç»„ï¼‰ã€‚ å½“ç„¶å¦‚æœè¦å–å¾—æ‰€æœ‰å®ä¾‹å±æ€§ï¼Œæ— è®ºæ˜¯å¦å¯æšä¸¾ï¼Œå¯ä»¥ç”¨ Object.getOwnPropertyNames() æ–¹æ³•ã€‚ 3. æ›´ç®€å•çš„åŸå‹æ–¹æ³•æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæ¯å½“è¦ä¸ºåŸå‹å¯¹è±¡æ·»åŠ ä¸€ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œéƒ½è¦æ•²ä¸€é Person.prototypeï¼Œè¿™æ ·å¤ªä¸ä¼˜é›…äº†â€¦ æ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨å¯¹è±¡å­—é¢é‡å°†å±æ€§å’Œæ–¹æ³•éƒ½åŒ…èµ·æ¥ã€‚ 12345678910111213function Person() &#123;&#125;Person.prototype = &#123; constructor: Person, // åˆ«å¿˜äº†ä¹‹å‰è¯´è¿‡çš„ constructor æŒ‡é’ˆã€‚ name: \"steve\", age : 24, job : \"Web Developer\", sayName: function() &#123; alert(this.name); &#125;&#125;; ä½†æ˜¯ï¼Œå¦‚æœä½ æ˜¯ä¸ªå®Œç¾ä¸»ä¹‰è€…ï¼Œè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šåŸç”Ÿ constructor å±æ€§æ˜¯ä¸å¯æšä¸¾çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ Object.defineProperty() å°†å…¶æ”¹å†™å›æ¥ã€‚ 123456789101112131415161718function Person() &#123;&#125;Person.prototype = &#123; name: \"steve\", age : 24, job : \"Web Developer\", sayName: function() &#123; alert(this.name); &#125;&#125;;Object.defineProperty(Person.prototype, \"constructor\", &#123; enumerable : false, // é»˜è®¤å€¼ï¼Œå…¶å®å¯ä»¥ä¸å†™ writable : true, configurable: true, value : Person&#125;); 4. åŸå‹çš„åŠ¨æ€æ€§ç•¥ï¼Œåªè¦ä½ äº†æ¦‚ï¼ˆè§£ï¼‰äº†æŒ‡é’ˆæ˜¯å’©ï¼ˆä»€ä¹ˆï¼‰å°±å¤§ä¸ˆå¤«ï¼ˆæ²¡é—®é¢˜ï¼‰ã€‚ 5. åŸå‹å¯¹è±¡çš„åŸå‹ç•¥ï¼Œå¤§æ¦‚å†…å®¹å°±æ˜¯è¯´äº†ä¸‹ä¿ºä»¬åŸç”Ÿçš„å¯¹è±¡å’Œä¹ƒä»¬â€œé‡ç”Ÿâ€å¯¹è±¡ä¸€æ ·ä¹Ÿæ˜¯æœ‰åŸå‹çš„â•®(â•¯â–½â•°)â•­ã€‚ 6. åŸå‹å¯¹è±¡çš„é—®é¢˜é—®é¢˜å…¶å®æ˜¯æ¥è‡ªäºè‡ªèº«å…±äº«çš„æœ¬æ€§ã€‚ ä¾‹å¦‚ï¼ŒåŒ…å«å¼•ç”¨ç±»å‹çš„å±æ€§ã€‚ç”±äºå¼•ç”¨ç±»å‹å®é™…ä¸Šå°±æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥æ‰€æœ‰å®ä¾‹æ“ä½œçš„éƒ½æ˜¯åŒä¸€ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œè§ä¸‹ä¾‹ï¼š 1234567891011121314151617181920212223function Person() &#123;&#125;Person.prototype = &#123; constructor: Person, name : \"steve\", age : 24, job : \"Web Developer\", friends: [\"shirley\", \"jame\"], sayName: function() &#123; alert(this.name); &#125;&#125;;var person1 = new Person();var person2 = new Person();person1.friends.push(\"van\");alert(person1.friends); // [\"shirley\", \"jame\",\"van\"]alert(person2.friends); // [\"shirley\", \"jame\",\"van\"]alert(person1.friends === person2.friends); // true 6.2.4. ç»„åˆä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼å’ŒåŸå‹æ¨¡å¼ç»è¿‡ä¸Šæ–‡çš„è®¨è®ºæˆ‘ä»¬çŸ¥é“ï¼š æ„é€ å‡½æ•°æ¨¡å¼å¯ä»¥ä¸ºæ¯ä¸ªå®ä¾‹ç”Ÿæˆå•ç‹¬çš„å±æ€§ï¼Œä½†æ— æ³•å…±äº«ã€‚ åŸå‹æ¨¡å¼å¯ä»¥å…±äº«ï¼Œä½†æ— æ³•ä¸ºå®ä¾‹ç”Ÿæˆå•ç‹¬çš„å±æ€§ã€‚ æ—¢ç„¶æ„é€ å‡½æ•°æ¨¡å¼å’ŒåŸå‹æ¨¡å¼çš„ä¼˜ç¼ºç‚¹æ­£å¥½äº’è¡¥ï¼Œé‚£ä¹ˆä¸ºä½•ä¸å°†ä¸¤è€…ç»“åˆï¼Œå‘æŒ¥å„è‡ªçš„é•¿å¤„ï¼Ÿ ç»„åˆæ¨¡å¼å°±æ˜¯åŸºäºè¿™ä¸€æœ´ç´ çš„æ€æƒ³ï¼š æ„é€ å‡½æ•°ç”¨äºå®šä¹‰å®ä¾‹å±æ€§ åŸå‹æ¨¡å¼ç”¨äºå®šä¹‰å…±äº«çš„å±æ€§å’Œæ–¹æ³• è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å®ä¾‹å±æ€§å‰¯æœ¬ï¼Œä½†åŒæ—¶åˆå…±äº«ç€åŸå‹å¯¹è±¡ä¸­çš„æ–¹æ³•å’Œå±æ€§ï¼Œæœ€å¤§é™åº¦åœ°èŠ‚çœäº†å†…å­˜ï¼Œè¿˜æ”¯æŒå‘æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•°ï¼Œå¯è°“åšé‡‡ä¼—é•¿ä¹Ÿï½=ï¿£Ï‰ï¿£=ï½ã€‚ 123456789101112131415161718192021222324function Person(name, age, job) &#123; this.name = name; this.age = age; this.job = job; this.friends = [\"shirley\", \"jame\"];&#125;Person.prototype = &#123; constructor: Person, sayName: function() &#123; alert(this.name); &#125;&#125;;var person1 = new Person(\"steve\", 24, \"Web Developer\");var person2 = new Person(\"nicholas\", 29, \"Soft Engineer\");person1.friends.push(\"van\");alert(person1.friends); // [\"shirley\", \"jame\",\"van\"]alert(person2.friends); // [\"shirley\", \"jame\"]alert(person1.friends === person2.friends); // falsealert(person1.sayName === person2.sayName); // true 6.2.5. åŠ¨æ€åŸå‹æ¨¡å¼æœ¬è´¨å…¶å®è¿˜æ˜¯ç»„åˆæ¨¡å¼ï¼Œåªä¸è¿‡æŠŠåŸå‹å¯¹è±¡ä¸­å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå°è£…åœ¨æ„é€ å‡½æ•°é‡Œâ€¦ 1234567891011121314151617181920212223function Person(name, age, job) &#123; this.name = name; this.age = age; this.job = job; this.friends = [\"shirley\", \"jame\"]; if (typeof this.sayName != \"function\") &#123; // ä¸èƒ½ä½¿ç”¨å¯¹è±¡å­—é¢é‡ Person.prototype = &#123;...&#125;; Person.prototype.sayName = function() &#123; alert(this.name); &#125;; &#125;&#125;var person1 = new Person(\"steve\", 24, \"Web Developer\");var person2 = new Person(\"nicholas\", 29, \"Soft Engineer\");person1.friends.push(\"van\");alert(person1.friends); // [\"shirley\", \"jame\",\"van\"]alert(person2.friends); // [\"shirley\", \"jame\"]alert(person1.friends === person2.friends); // falsealert(person1.sayName === person2.sayName); // true 6.2.6. å¯„ç”Ÿæ„é€ å‡½æ•°æ¨¡å¼é¦–å…ˆä¸€èˆ¬æ¥è¯´ï¼Œç»„åˆæ¨¡å¼å·²ç»è¶³å¤Ÿåº”ä»˜æ—¥å¸¸éœ€æ±‚ï¼Œæ‰€ä»¥è¿™ä¸ªæ¨¡å¼æ˜¯ä¸ºäº†åº”å¯¹ç‰¹æ®Šéœ€æ±‚ï¼šä¾‹å¦‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå…·æœ‰é¢å¤–æ–¹æ³•çš„ç‰¹æ®Šæ•°ç»„ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä¿®æ”¹ Array çš„æ„é€ å‡½æ•°ï¼ˆè§ä¸‹ä¾‹ï¼‰ã€‚ å…·ä½“å½¢å¼ä¸Šé™¤äº†ä½¿ç”¨ new æ“ä½œç¬¦åˆ›å»ºå®ä¾‹ä»¥å¤–ï¼Œå’Œå·¥å‚æ¨¡å¼ä¸€æ¯›ï¼ˆæ¨¡ï¼‰ä¸€æ ·ï¼ˆåŒæ ·çš„é—®é¢˜ï¼‰ã€‚ 1234567891011121314151617function SpecialArray() &#123; // å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ var values = new Array(); // æ·»åŠ å€¼ values.push.apply(values, arguments); // æ·»åŠ æ–¹æ³• values.toPipedString = function() &#123; return this.join(\"|\"); &#125;; return values;&#125;var colors = new SpecialArray(\"red\", \"blue\", \"green\"); // æ³¨æ„ï¼šä½¿ç”¨ new åˆ›å»ºå®ä¾‹alert(colors.toPipedString()); // red|blue|green è¿™ä¸ªæ¨¡å¼å…¶å®åˆ©ç”¨äº†æ„é€ å‡½æ•°çš„ç‰¹æ€§ï¼š å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°æ²¡æœ‰æ˜¾å¼çš„ return è¡¨è¾¾å¼ï¼Œåˆ™éšå¼åœ°ä¼šè¿”å› this å¯¹è±¡ - ä¹Ÿå°±æ˜¯æ–°åˆ›å»ºçš„éšå¼å¯¹è±¡ã€‚ æ˜¾å¼çš„ return è¡¨è¾¾å¼å°†ä¼šå½±å“è¿”å›ç»“æœï¼Œä½†ä»…é™äºè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ 1234567891011121314151617function Foo() &#123; return 2;&#125;function Bar() &#123; return new Number(2);&#125;new Foo().constructor === Number // falseï¼Œè¿”å›æ–°åˆ›å»ºçš„éšå¼å¯¹è±¡new Bar().constructor === Number // trueï¼Œè¿”å› Number å¯¹è±¡function Test() &#123; this.value = 2; return &#123; foo: 1 &#125;;&#125;console.log(new Test()); // &#123;foo: 1&#125;ï¼Œè¿”å›çš„å¯¹è±¡ï¼Œthis å¯¹è±¡è¢«é”€æ¯äº†ï¼Œvalue ä¸¢å¤±äº† 6.2.7. ç¨³å¦¥æ„é€ å‡½æ•°æ¨¡å¼é¦–å…ˆè¦ä»‹ç» Douglas Crockford å‘æ˜çš„ã€Œç¨³å¦¥å¯¹è±¡ã€(durable objects) è¿™ä¸ªæ¦‚å¿µï¼šæ²¡æœ‰å…¬å…±å±æ€§ï¼Œè€Œä¸”æ–¹æ³•ä¹Ÿä¸å¼•ç”¨ this çš„å¯¹è±¡ã€‚ ä¸»è¦ç”¨åœ¨éœ€è¦å®‰å…¨çš„ç¯å¢ƒï¼ˆç¦æ­¢ this å’Œ newï¼‰ï¼Œæˆ–è€…åœ¨é˜²æ­¢æ•°æ®è¢«å…¶ä»–ç¨‹åºï¼ˆå¦‚ Mashupï¼‰æ”¹åŠ¨æ—¶ä½¿ç”¨ã€‚ 1234567891011121314151617function Person(name, age, job) &#123; //åˆ›å»ºè¦è¿”å›çš„å¯¹è±¡ var o = new Object(); //å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰ç§æœ‰å˜é‡å’Œå‡½æ•° //æ·»åŠ æ–¹æ³• o.sayName = function() &#123; alert(name); // æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰ä½¿ç”¨ thisï¼Œå› æ­¤æˆ‘çš„ç†è§£æ˜¯ç›¸å½“äºé—­åŒ…ï¼Œä¿å­˜ä½äº†å¤–éƒ¨ Person çš„ AOï¼ˆæ´»åŠ¨å¯¹è±¡ï¼‰ &#125;; //è¿”å›å¯¹è±¡ return o;&#125;var person = Person(\"steve\", 24, \"web developer\");person.sayName(); //\"steve\" è¿™é‡Œå˜é‡ person ä¸­ä¿å­˜çš„å°±æ˜¯ä¸€ä¸ªç¨³å¦¥å¯¹è±¡ï¼Œå› ä¸ºé™¤äº†è°ƒç”¨ sayName() æ–¹æ³•ä»¥å¤–ï¼Œæ²¡æœ‰åˆ«çš„æ–¹æ³•å¯ä»¥è®¿é—®å†…éƒ¨çš„æ•°æ®ã€‚ å³ä½¿æœ‰å…¶ä»–ä»£ç ä¼šç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ æ–¹æ³•æˆ–æ•°æ®ï¼Œä¹Ÿæ— æ³•è®¿é—®ä¼ å…¥åˆ°æ„é€ å‡½æ•°ä¸­çš„åŸå§‹æ•°æ®ã€‚ 6.3. ç»§æ‰¿è®¸å¤šé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒä¸¤ç§ç»§æ‰¿æ–¹å¼ï¼š æ¥å£ç»§æ‰¿ï¼šåªç»§æ‰¿æ–¹æ³•ç­¾å å®ç°ç»§æ‰¿ï¼šç»§æ‰¿å®é™…çš„æ–¹æ³• åœ¨ ECMAScript ä¸­ç”±äºå‡½æ•°æ²¡æœ‰ç­¾åï¼Œæ‰€ä»¥æ— æ³•å®ç°æ¥å£ç»§æ‰¿ï¼Œåªæ”¯æŒå®ç°ç»§æ‰¿ï¼Œè€Œè¿™æ­£æ˜¯ä¾é ã€ŒåŸå‹é“¾ã€æ¥å®ç°çš„ã€‚ 6.3.1. åŸå‹é“¾æ—¢ç„¶è¿™ç»§æ‰¿çš„å…³é”®åœ¨äºã€ŒåŸå‹é“¾ã€ï¼Œæˆ‘ä»¬å°±å…ˆæ¥äº†æ¦‚ï¼ˆè§£ï¼‰ä¸‹åŸå‹é“¾çš„æ¦‚å¿µç©¶ç«Ÿæ˜¯ç¥é©¬â€¦ åŸºæœ¬æ€æƒ³ï¼šåˆ©ç”¨ prototypeï¼ˆåŸå‹å¯¹è±¡ï¼‰ï¼Œè®©ä¸€ä¸ªå¼•ç”¨ç±»å‹ç»§æ‰¿å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚ ç®€å•å›é¡¾ä¸€ä¸‹ä¹‹å‰è®¨è®ºè¿‡çš„å…³äºï¼Œæ„é€ å‡½æ•°ã€åŸå‹å¯¹è±¡å’Œå®ä¾‹çš„å…³ç³»ï¼š æ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘è‡ªå·±åŸå‹å¯¹è±¡çš„ prototype æŒ‡é’ˆã€‚ åŸå‹å¯¹è±¡åˆéƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„ constructor æŒ‡é’ˆã€‚ å®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘åŸå‹å¯¹è±¡çš„ [[prototype]] å†…éƒ¨æŒ‡é’ˆï¼ˆ__proto__ï¼‰ã€‚ å‡å¦‚æˆ‘ä»¬è®©ã€ŒåŸå‹å¯¹è±¡ã€ç­‰äºå¦ä¸€ä¸ªç±»å‹çš„ã€Œå®ä¾‹ã€ï¼Œç»“æœä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ 123456function foo() &#123;&#125;function bar() &#123;&#125;var a = new foo(); // a æ˜¯çˆ¶ç±» foo çš„å®ä¾‹bar.prototype = a; // ã€ŒåŸå‹å¯¹è±¡ bar.prototypeã€ç­‰äºå¦ä¸€ä¸ªç±»å‹çš„ã€Œå®ä¾‹ aã€var b = new bar(); // b æ˜¯å­ç±» bar çš„å®ä¾‹ ç®€å•åˆ†æä¸€ä¸‹ä»¥ä¸Šä»£ç ï¼š ã€Œ1ã€a ä½œä¸º foo çš„å®ä¾‹ï¼Œa çš„å†…éƒ¨æŒ‡é’ˆ [[prototype]] æŒ‡å‘åŸå‹å¯¹è±¡ foo.prototypeã€‚ ã€Œ2ã€bar.prototype è¢«èµ‹å€¼ä¸º aï¼Œæ‰€ä»¥ç›¸å½“äº bar.prototype æœ‰å†…éƒ¨æŒ‡é’ˆ [[prototype]] æŒ‡å‘åŸå‹å¯¹è±¡ foo.prototypeã€‚ ã€Œ3ã€b ä½œä¸º bar çš„å®ä¾‹ï¼Œb çš„å†…éƒ¨æŒ‡é’ˆ [[prototype]] æŒ‡å‘åŸå‹å¯¹è±¡ bar.prototypeã€‚ ã€Œ4ã€ç»¼ä¸Šï¼Œè¿™æ ·ä¾¿å½¢æˆäº†ä¸€æ¡ï¼šb -&gt; bar.prototype -&gt; foo.prototype çš„åŸå‹é“¾ã€‚ ã€Œ5ã€å‡å¦‚å¦ä¸€ä¸ªåŸå‹åˆæ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆä¸Šè¿°å…³ç³»ä»ç„¶æˆç«‹ï¼Œå¦‚æ­¤å±‚å±‚é€’è¿›ï¼Œå¯ä»¥ç”Ÿæˆæ›´é•¿çš„åŸå‹é“¾ã€‚ ä»¥ä¸Šå°±æ˜¯åŸå‹é“¾çš„åŸºæœ¬æ¦‚å¿µâ€¦ ä¸‹é¢å†æ¥çœ‹çœ‹ä¸€ç§å®ç°åŸå‹é“¾çš„åŸºæœ¬æ¨¡å¼ 12345678910111213141516171819202122function SuperType() &#123; this.property = true;&#125;SuperType.prototype.getSuperValue = function() &#123; return this.property;&#125;;function SubType() &#123; this.subproperty = false;&#125;SubType.prototype = new SuperType(); // æ³¨æ„ï¼šä½¿ç”¨ new ç”Ÿæˆçˆ¶ç±»å®ä¾‹ï¼Œé‡å†™äº†åŸå‹å¯¹è±¡// å¿…é¡»åæ·»åŠ æ–¹æ³•ï¼ˆä¸ç„¶æ–¹æ³•å°±åŠ åˆ°ä¹‹å‰çš„å¯¹è±¡ä¸Šå»äº†_(:Ğ·ã‚âˆ )_ï¼Œè¦ç†è§£æŒ‡é’ˆï¼‰SubType.prototype.getSubValue = function() &#123; return this.subproperty;&#125;;var instance = new SubType();alert(instance.getSuperValue()); // trueï¼ŒæˆåŠŸç»§æ‰¿çˆ¶ç±»åŸå‹å¯¹è±¡ä¸Šçš„æ–¹æ³•alert(instance.constructor); // SuperTypeï¼Œå› ä¸ºè®¿é—®çš„æ˜¯ Super.prototype ä¸­çš„ constructor 1. åˆ«å¿˜è®°é»˜è®¤çš„åŸå‹å…¶å®ï¼Œæ‰€æœ‰çš„å¼•ç”¨ç±»å‹éƒ½é»˜è®¤ç»§æ‰¿è‡ª Objectï¼Œè€Œè¿™ä¸ªç»§æ‰¿ä¹Ÿæ˜¯é€šè¿‡åŸå‹é“¾å®ç°çš„ã€‚æ‰€ä»¥æ‰€æœ‰è‡ªå®šä¹‰ç±»å‹éƒ½èƒ½å¤Ÿä½¿ç”¨ toString()ã€valueOf() ç­‰æ–¹æ³•ã€‚ 2. ç¡®å®šåŸå‹å’Œå®ä¾‹çš„å…³ç³»æœ‰ä¸¤ç§æ–¹æ³•ç¡®å®šåŸå‹å’Œå®ä¾‹çš„å…³ç³»ï¼š instanceof æ“ä½œç¬¦ isPrototypeof() æ–¹æ³• 1234567alert(instance instanceof Object); // truealert(instance instanceof SuperType); // truealert(instance instanceof SubType); // truealert(Object.prototype.isPrototypeof(instance)); // truealert(SuperType.prototype.isPrototypeof(instance)); // truealert(SubType.prototype.isPrototypeof(instance)); // true 3. è°¨æ…åœ°å®šä¹‰æ–¹æ³•å­ç±»å‹æœ‰æ—¶å€™éœ€è¦è¦†ç›–è¶…ç±»å‹çš„æŸä¸ªæ–¹æ³•ï¼Œæˆ–è€…éœ€è¦æ·»åŠ è¶…ç±»å‹ä¸­ä¸å­˜åœ¨çš„æŸä¸ªæ–¹æ³•ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œç»™åŸå‹æ·»åŠ æ–¹æ³•çš„ä»£ç ä¸€å®šè¦æ”¾åœ¨æ›¿æ¢åŸå‹çš„è¯­å¥ä¹‹åï¼Œè¿™ç‚¹å¾ˆå¥½ç†è§£ã€‚ è¿˜è¦æ³¨æ„ä»¥ä¸‹è¿™ç§ä½¿ç”¨å¯¹è±¡å­—é¢é‡åˆ›å»ºåŸå‹æ–¹æ³•çš„æƒ…å†µã€‚ 1234567891011121314// blabla...SubType.prototype = new SuperType(); // æ³¨æ„ï¼šä½¿ç”¨ new ç”Ÿæˆçˆ¶ç±»å®ä¾‹ï¼Œé‡å†™äº†åŸå‹å¯¹è±¡// éšå¼åœ°åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ”¹å†™äº† SubType.prototype çš„æŒ‡é’ˆæŒ‡å‘SubType.prototype = &#123; getSubValue: function() &#123; return this.subproperty; &#125;, someOtherMethod: function() &#123; return false; &#125;&#125;; 4. åŸå‹é“¾çš„é—®é¢˜ å¼•ç”¨ç±»å‹å±æ€§çš„é—®é¢˜ï¼šç›¸å½“äºå°†çˆ¶ç±»å±æ€§æ·»åŠ åˆ°å­ç±»åŸå‹å¯¹è±¡ä¸Šå½¢æˆå…±äº«ã€‚ åˆ›å»ºå­ç±»å®ä¾‹æ—¶ï¼Œä¸èƒ½å‘è¶…ç±»å‹çš„æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•°ï¼šå‡†ç¡®çš„è¯´æ˜¯æ— æ³•åœ¨ä¸å½±å“æ‰€æœ‰å¯¹è±¡å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œç»™çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¼ é€’å‚æ•°ã€‚ 6.3.2. å€Ÿç”¨æ„é€ å‡½æ•°åœ¨è§£å†³åŸå‹é“¾ä»¥ä¸Šé—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº†ä¸€ç§å«åšã€Œå€Ÿç”¨æ„é€ å‡½æ•°ï¼ˆä¼ªé€ å¯¹è±¡ã€ç»å…¸ç»§æ‰¿ï¼‰ã€çš„æŠ€æœ¯ã€‚ åŸºæœ¬æ€æƒ³æ˜¯ï¼šåœ¨å­ç±»æ„é€ å‡½æ•°å†…éƒ¨è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œä¸»è¦é€šè¿‡ call() å’Œ apply() æ–¹æ³•å®ç°ã€‚ 1. ä¼ é€’å‚æ•°ç›¸å¯¹äºåŸå‹é“¾è€Œè¨€ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯è§£å†³äº†ä¼ é€’å‚æ•°çš„é—®é¢˜ã€‚ 12345678910111213function SuperType(name) &#123; this.name = name;&#125;function SubType() &#123; SuperType.call(this, 'steve'); this.age = 24;&#125;var instance = new SubType();alert(instance.name); // stevealert(instance.age); // 24 2. å€Ÿç”¨æ„é€ å‡½æ•°çš„é—®é¢˜æºè‡ªäºæ„é€ å‡½æ•°çš„é—®é¢˜ï¼šæ–¹æ³•éƒ½åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ï¼Œæ— æ³•å‡½æ•°å¤ç”¨ï¼Œå­ç±»æ–¹æ³•ä¹Ÿæ— æ³•ä½¿ç”¨çˆ¶ç±»åŸå‹å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ 6.3.3. ç»„åˆç»§æ‰¿é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°ç»“åˆã€‚ 12345678910111213141516171819function SuperType(name) &#123; this.name = name; this.colors = [\"red\", \"blue\", \"green\"];&#125;SuperType.prototype.sayName = function() &#123; return this.name;&#125;;function SubType(name, age) &#123; // å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿å±æ€§ SuperType.call(this, name); this.age = age;&#125;// ä½¿ç”¨åŸå‹é“¾ç»§æ‰¿äº†æ–¹æ³•SubType.prototype = new SuperType(); è™½ç„¶çœ‹èµ·æ¥ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼Œæ—¢èƒ½å¤Ÿä¼ é€’å‚æ•°ï¼Œåˆèƒ½å®ç°åŸå‹é“¾ç»§æ‰¿ï¼Œä½†æ˜¯åº”è¯¥æ³¨æ„åˆ° SubType.prototype = new SuperType(); ä¸€å¥ã€‚ æˆ‘ä»¬çš„é¢„æœŸåªæ˜¯å­ç±» SubType æ‹¥æœ‰çˆ¶ç±»çš„å±æ€§ï¼Œå³ SuperType.call(this, name); çš„å·¥ä½œã€‚ ä½†æ˜¯ SubType.prototype ä¸Šä¹Ÿæ‹¥æœ‰äº†ä¸€ä¸ªå€¼ä¸º undefined çš„ name å±æ€§å’Œ colors æ•°ç»„ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬çš„æœ¬æ„ï¼Œè¿™å°±æ˜¯ç›´æ¥ä½¿ç”¨ new æ“ä½œç¬¦å°†çˆ¶ç±»å®ä¾‹èµ‹å€¼ç»™å­ç±»åŸå‹å¯¹è±¡çš„å‰¯ä½œç”¨â•®(â•¯â–½â•°)â•­ã€‚ è¦è§£å†³ç»„åˆæ¨¡å¼å­˜åœ¨çš„é—®é¢˜ï¼Œé¦–å…ˆæ¥çœ‹å‡ ä¸ªå…¶ä»–æ–¹å¼çš„ç»§æ‰¿ã€‚ 6.3.4. åŸå‹å¼ç»§æ‰¿ç”± Douglas Crockfordï¼ˆåˆæ˜¯ä½ â†’_â†’ï¼‰åœ¨2006å¹´çš„ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯ï¼šåŸºäºå·²æœ‰å¯¹è±¡ï¼Œå€ŸåŠ©åŸå‹åˆ›å»ºæ–°å¯¹è±¡ã€‚ 1234567function object(o) &#123; function F() &#123;&#125; F.prototype = o; return new F();&#125; å³å…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ€§çš„æ„é€ å‡½æ•° Fï¼Œç„¶åå°†ä¼ å…¥çš„å¯¹è±¡ o ä½œä¸ºè¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹ F.prototypeï¼Œæœ€åè¿”å›è¿™ä¸ªä¸´æ—¶ç±»å‹çš„ä¸€ä¸ªæ–°å®ä¾‹ new F()ã€‚ä»æœ¬è´¨ä¸Šå°†å°±æ˜¯å¯¹äºä¼ å…¥çš„å¯¹è±¡ o è¿›è¡Œäº†ä¸€æ¬¡æµ…å¤åˆ¶ã€‚ 1234567891011121314var person = &#123; name: \"steve\", friends: [\"shirley\", \"jame\"]&#125;;var anotherPerson = object(person);anotherPerson.name = \"young\";anotherPerson.friends.push(\"sasuke\");var yetAnotherPerson = object(person);yetAnotherPerson.name = \"nicholas\";yetAnotherPerson.friends.push(\"jobs\");alert(person.friends); // shirley,jame,sasuke,jobsï¼Œfriends è¢«å…±äº«äº† ES5 ä¸­æ–°å¢äº† Object.create() æ–¹æ³•è§„èŒƒåŒ–äº†åŸå‹å¼ç»§æ‰¿ã€‚å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¦ç»§æ‰¿çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå¯¹è±¡æ˜¯å¯é€‰çš„ä¸€ä¸ªä¸ºæ–°å¯¹è±¡å®šä¹‰é¢å¤–å±æ€§çš„å¯¹è±¡ã€‚å…¶å®åªä¼ ä¸€ä¸ªå‚æ•°æ—¶ï¼Œä¸¤ä¸ªæ–¹æ³•è¡Œä¸ºç›¸åŒã€‚ ç¬¬äºŒä¸ªå‚æ•°ä¸ Object.defineProperties() æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ ¼å¼ç›¸åŒï¼ˆè¦†ç›–åŒåå±æ€§ï¼‰ï¼Œè§ä¸‹ä¾‹ã€‚ 12345678910111213var person = &#123; name: \"steve\", friends: [\"shirley\", \"jame\"]&#125;;var anotherPerson = Object.create(person, &#123; name: &#123; value: \"greg\", configurable: false &#125;&#125;);alert(anotherPerson.name); // greg 6.3.5. å¯„ç”Ÿå¼ç»§æ‰¿åŸºæœ¬æ€è·¯ç±»ä¼¼ç”¨å·¥å‚æ¨¡å¼åŒ…è£…åŸå‹å¼ç»§æ‰¿ï¼šåˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œåœ¨å†…éƒ¨ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åè¿”å›è¯¥å¯¹è±¡ã€‚ 123456789101112131415161718var person = &#123; name: \"steve\", friends: [\"shirley\", \"jame\"]&#125;;function createAnother(original) &#123; var clone = object(original); // åŸå‹å¼ç»§æ‰¿å¯¹è±¡ original // å¢å¼ºå¯¹è±¡ clone.sayHi = function() &#123; alert(\"Hi\"); &#125;; return clone; // è¿”å›å¯¹è±¡&#125;var anotherPerson = createAnother(person);anotherPerson.sayHi(); // Hi 6.3.6. å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿é¦–å…ˆå®åŠ›å¹ä¸€æ³¢ï¼šä½œä¸ºå‹è½´å‡ºåœºçš„ç»ˆæç»§æ‰¿æ–¹å¼ï¼Œå‡ ä¹æ˜¯æœ€ç†æƒ³çš„ç»§æ‰¿èŒƒå¼ã€‚ å‰é¢åœ¨ä»‹ç»ç»„åˆç»§æ‰¿çš„æ—¶å€™è¯´åˆ°äº†ä¸»è¦é—®é¢˜å‡ºåœ¨ SubType.prototype = new SuperType(); è¿™å¥ã€‚å®ƒå°†çˆ¶ç±»æ„é€ å‡½æ•°ä¸­çš„å±æ€§ä¹Ÿæ·»åŠ åˆ°äº†å­ç±»åŸå‹å¯¹è±¡ä¸­ï¼Œè€Œè¿™ä¸ç¬¦åˆæˆ‘ä»¬çš„æœŸæœ›ã€‚ å…¶å®è®©æˆ‘ä»¬å›åˆ°éœ€æ±‚æœ¬èº«ï¼šæˆ‘ä»¬å¸Œæœ›å­ç±»çš„åŸå‹å¯¹è±¡èƒ½å¤ŸæŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼Œå®ç°åŸå‹é“¾ç»§æ‰¿ã€‚ é‚£ä¹ˆæƒ³ä¸€æƒ³ 6.3.4. åŸå‹å¼ç»§æ‰¿ï¼Œæˆ‘ä»¬è®©å­ç±»åŸå‹å¼ç»§æ‰¿çˆ¶ç±»çš„åŸå‹å¯¹è±¡ä¸å°±å®Œç¾äº†ä¹ˆï¼Ÿ 12345678910111213141516171819202122232425262728function SuperType(name) &#123; this.name = name; this.colors = [\"red\", \"blue\"];&#125;SuperType.prototype.sayName = function() &#123; alert(this.name);&#125;;function SubType(name, age) &#123; SuperType.call(this, name); // å€Ÿç”¨æ„é€ å‡½æ•°ï¼Œç»§æ‰¿çˆ¶ç±»å±æ€§ï¼ˆè§£å†³äº†ä¼ å‚ï¼‰ this.age = age;&#125;SubType.prototype = Object.create(SuperType.prototype, &#123; constructor: &#123; value : SubType, // æŒ‡å›å­ç±»æ„é€ å‡½æ•° enumerable : false, // é»˜è®¤å€¼ï¼Œå…¶å®å¯ä»¥ä¸å†™ writable : true, configurable: true, &#125;&#125;);// å¿…é¡»åæ·»åŠ æ–¹æ³•ï¼ˆä¸ç„¶æ–¹æ³•å°±åŠ åˆ°ä¹‹å‰çš„å¯¹è±¡ä¸Šå»äº†_(:Ğ·ã‚âˆ )_ï¼Œè¦ç†è§£æŒ‡é’ˆï¼‰SubType.prototype.sayAge = function() &#123; alert(this.age);&#125;; 6.4. å°ç»“åˆ›å»ºå¯¹è±¡ å·¥å‚æ¨¡å¼ï¼šç®€å•åœ°åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºå¯¹è±¡ï¼Œæ·»åŠ å±æ€§å’Œæ–¹æ³•ï¼Œç„¶åè¿”å›å¯¹è±¡ã€‚ æ„é€ å‡½æ•°æ¨¡å¼ï¼šåœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ this æ·»åŠ å±æ€§å’Œæ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ new æ“ä½œç¬¦åˆ›å»ºå®ä¾‹ã€‚ä½†æ˜¯æ— æ³•å®ç°å‡½æ•°å¤ç”¨ï¼Œé€ æˆå†…å­˜æµªè´¹ç­‰é—®é¢˜ã€‚ åŸå‹æ¨¡å¼ï¼šä½¿ç”¨æ„é€ å‡½æ•°çš„ prototype å±æ€§æ¥æŒ‡å®šå…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸ºäº†å…±äº«è€Œç”Ÿã€‚ ç»„åˆæ¨¡å¼ï¼šç»“åˆæ„é€ å‡½æ•°å’ŒåŸå‹æ¨¡å¼çš„ä¼˜ç‚¹ã€‚ å¯¹è±¡ç»§æ‰¿ åŸå‹é“¾ï¼šå°†çˆ¶ç±»çš„å®ä¾‹èµ‹å€¼ç»™å­ç±»æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚ä½†è¿™æ ·ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä¼ å‚å’Œå­ç±»åŸå‹ä¸Šæœ‰å¤šä½™çš„çˆ¶ç±»æ„é€ å‡½æ•°ä¸­çš„å±æ€§ã€‚ å€Ÿç”¨æ„é€ å‡½æ•°ï¼šä¸ºäº†è§£å†³ä¼ å‚é—®é¢˜ï¼Œé‡‡ç”¨åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°çš„æ–¹æ³•ã€‚ åŸå‹å¼ï¼šå¯ä»¥åœ¨ä¸å¿…é¢„å…ˆå®šä¹‰æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹å®ç°ç»§æ‰¿ï¼Œæœ¬è´¨æ˜¯æ‰§è¡Œå¯¹ç»™å®šå¯¹è±¡çš„æµ…å¤åˆ¶ã€‚ å¯„ç”Ÿç»„åˆå¼ï¼šå·§å¦™åˆ©ç”¨åŸå‹å¼ç»§æ‰¿è§£å†³åŸå‹é“¾ä¸­çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ˜¯åŸºäºç±»å‹ç»§æ‰¿çš„æœ€å¥½æ–¹å¼ã€‚","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://buptsteve.github.io/blog/tags/JavaScript/"}]},{"title":"ã€Œ4ã€Byrs-News å»ºç«™ç¬”è®°ï¼ˆä¸€ï¼‰","date":"2016-03-16T03:27:58.000Z","path":"2016/03/16/4.byrs-news notes 1/","text":"é›¶ã€å‰è¨€å·®ä¸å¤šç»“æŸäº†åœ¨ç§»åŠ¨ç ”ç©¶é™¢å¿«ä¸€å¹´çš„å®ä¹ ï¼ŒåŠ ä¸Šé©¬ä¸Šåˆ°æ¥çš„å¯’å‡ï¼Œæƒ³ç€é—²ç€ä¹Ÿæ˜¯é—²ç€ä¸ç„¶åšä¸ªç½‘ç«™ç»ƒç»ƒæ‰‹å§â•®(â•¯â–½â•°)â•­ äºæ˜¯åœ¨å¯’å‡é‡Œå°±æ£é¼“äº†è¿™ä¹ˆä¸ªç½‘ç«™ Byrs-News | å¼€æºåœ°å€ï¼Œä¸»è¦å†…å®¹æ˜¯é€šè¿‡çˆ¬è™« Byr-Crawler å¯¹äºåŒ—é‚®äººè®ºå›å¸–å­è¿›è¡Œå®šæ—¶çˆ¬å–ï¼Œåœ¨æ”¶é›†æ•´ç†ä¹‹åå¸Œæœ›å¤§å®¶èƒ½å¤Ÿæ›´åŠ â€œä¼˜é›…åœ°â€æµè§ˆè®ºå›ï½=ï¿£Ï‰ï¿£=ï½ã€‚ ä¸€ã€æŠ€æœ¯æ ˆ ç½‘ç«™é‡‡ç”¨äº† Meteor.js å…¨æ ˆå¼å¼€å‘ æ•°æ®åº“é€‰æ‹©äº† MongoDB è¿›è¡Œå­˜å‚¨ å†…å®¹è·å–æ¥è‡ªè‡ªå·±ç¼–å†™çš„ Node.js çˆ¬è™« é‚£ä¹ˆé¦–å…ˆé—®é¢˜æ¥äº†â€¦ 1.1. Meteor æ˜¯ä¸ªä»€ä¹ˆç©æ„å„¿ï¼ŸMeteor æ˜¯ä¸€ä¸ªåªä½¿ç”¨ JavaScript å°±å¯ä»¥å¼€å‘ Web å’Œç§»åŠ¨ç«¯åº”ç”¨çš„å…¨æ ˆæ¡†æ¶ã€‚ä¸»è¦ç‰¹ç‚¹æœ‰ï¼š ä¸€ç§è¯­è¨€(One Language)ï¼šJavaScriptï¼ˆå°±å¯ä»¥æå®šæœåŠ¡å™¨ã€æµè§ˆå™¨ã€ç§»åŠ¨è®¾å¤‡ï¼‰ã€‚ ä¼ é€’æ•°æ®(Data on the wire)ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’çš„æ˜¯æ•°æ®ï¼ˆè€Œä¸æ˜¯ htmlï¼‰ï¼Œç”±å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®çš„æ¸²æŸ“ã€‚ æ— å¤„ä¸åœ¨çš„æ•°æ®åº“(Database everywhere)ï¼šä»å®¢æˆ·æœºæˆ–æœåŠ¡å™¨ä¸Šä½¿ç”¨ç›¸åŒã€é€æ˜çš„ API è®¿é—®æ•°æ®åº“ã€‚ï¼ˆåœ¨æµè§ˆå™¨ç«¯å®ç°äº† Minimongoï¼‰ å»¶è¿Ÿè¡¥å¿(Latency Compensation)ï¼šä½¿ç”¨é¢„è¯»å’Œæ¨¡å¼æ¨¡æ‹ŸæŠ€æœ¯ï¼Œä½¿ä¹‹çœ‹èµ·æ¥ä¸æ•°æ®åº“çš„è¿æ¥æ˜¯é›¶å»¶è¿Ÿçš„ã€‚ å…¨æ ˆå“åº”å¼(Full Stack Reactivity)ï¼šä»£ç æ‰€ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»“æœ ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ã€‚ï¼ˆå¹¶ä¸æ˜¯æŒ‡å“åº”å¼ï¼‰ æ‹¥æŠ±ç”Ÿæ€(Embrace the Ecosystem)ï¼šå¼€æºã€ä¸ç°æœ‰å·¥å…·å’Œæ¡†æ¶æ•´åˆï¼Œè€Œä¸æ˜¯å–ä»£ã€‚ ç®€å•ç­‰äºç”Ÿäº§åŠ›(Simplicity Equals Productivity)ï¼šè®©ä¸€ä»¶äº‹çœ‹èµ·æ¥ç®€å•çš„æœ€ä½³æ–¹å¼å°±æ˜¯ã€ŒçœŸæ­£ã€è®©å®ƒå˜å¾—ç®€å•ã€‚ æˆ‘çš„æ„Ÿå—æ˜¯ä½¿ç”¨ Meteor.js å¯ä»¥åœ¨åªç”¨ä¸€ç§è¯­è¨€ï¼ˆJavaScriptï¼‰çš„æƒ…å†µä¸‹ï¼Œã€Œè¶…å¿«é€Ÿã€åœ°å¼€å‘å‡ºä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç°ä»£ç½‘ç«™ã€‚ è¿˜æœ‰ç–‘é—®ï¼ŸTake it easy.ä¸”çœ‹æˆ‘åæ–‡æ…¢æ…¢é“æ¥â€¦ 1.2. ä¸ºä»€ä¹ˆé€‰æ‹© MongoDBï¼Ÿ é¦–å…ˆå½“ç„¶æ˜¯å› ä¸ºå®ƒæ˜¯ Meteor çš„é»˜è®¤æ•°æ®åº“å‘€â•®(â•¯â–½â•°)â•­ å…¶æ¬¡ä½œä¸ºä¸€ä¸ª NoSQL æ•°æ®åº“æ¯”ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ›´åŠ çµæ´»ï¼Œæ›´åŠ é€‚ç”¨äºäº’è”ç½‘åº”ç”¨åœºæ™¯ æˆ‘å¯ä»¥åœ¨çˆ¬è™«è¿è¡Œè¿‡ç¨‹ä¸­å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°ä¿®æ”¹æ–‡æ¡£ç»“æ„ â€¦ 1.3. ä¸ºä»€ä¹ˆæ˜¯ Node.js çˆ¬è™«ï¼Ÿå› ä¸ºæ­£å¥½æœ€è¿‘åœ¨å­¦ä¹  Node.jsï¼Œè¿˜æœ‰ä¿æŒé¡¹ç›®åªæœ‰ä¸€ç§è¯­è¨€ã€‚ äºŒã€é¡¹ç›®è§„èŒƒ2.1. å‘½åè§„èŒƒ æ–‡ä»¶å¤¹å’Œæ–‡ä»¶é‡‡ç”¨å°å†™å­—æ¯ï¼Œç”¨ä¸‹åˆ’çº¿ _ è¿æ¥ã€‚ JavaScript æ–‡ä»¶ä¸­çš„å†…å®¹é‡‡ç”¨é©¼å³°å‘½åæ³•ï¼ˆå› ä¸ºæ¯•ç«Ÿå®ƒè‡ªå·±å°±æ˜¯ç”¨çš„é©¼å³°â•®(â•¯â–½â•°)â•­ï¼‰ã€‚ CSS æ–‡ä»¶ä¸­çš„å†…å®¹é‡‡ç”¨è¿å­—ç¬¦ - è¿æ¥ï¼ˆå› ä¸ºæœ¬æ¥ CSS è¯­æ³•å°±æ˜¯ç”¨è¿å­—ç¬¦ï¼Œå¦‚ font-family ç­‰ï¼‰ã€‚ 2.2. æ–‡ä»¶å¤¹è§„èŒƒç”±äºæ˜¯ä¸€ä¸ªå…¨æ ˆå¼æ¡†æ¶ï¼ˆä»£ç å†™ä¸€å—å„¿â•®(â•¯â–½â•°)â•­ï¼‰ï¼Œæ‰€ä»¥æ–‡ä»¶å¤¹çš„åå­—ååˆ†åœ°é‡è¦ã€‚å› ä¸ºä¼šå½±å“ Meteor å¯¹å…¶åŠ è½½çš„é¡ºåºï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚ ä¸€èˆ¬æ¥è¯´æœ‰åœ¨é¡¶çº§é¡¹ç›®ç›®å½•ä¸‹æœ‰ä»¥ä¸‹è§„èŒƒçš„å‘½åï¼š client/ : æ”¾ç½®æ‰€æœ‰çš„å®¢æˆ·ç«¯ä»£ç ï¼ŒMeteor ä¹Ÿä¸ä¼šå°†å…¶åœ¨æœåŠ¡ç«¯åŠ è½½ã€‚ server/ : æ”¾ç½®æ‰€æœ‰çš„æœåŠ¡ç«¯ä»£ç ï¼ŒMeteor ä¹Ÿä¸ä¼šå°†å…¶åœ¨å®¢æˆ·ç«¯åŠ è½½ã€‚ public/ : æ”¾ç½®é™æ€èµ„æºï¼Œä¾‹å¦‚ favicon.ico, robots.txt ç­‰ã€‚ node_modules/ : Node.js æ¨¡å—ä»£ç ã€‚ï¼ˆæ¯”å¦‚ cz-conventional-changelogï¼‰ tests/ : æœ¬åœ°æµ‹è¯•ä»£ç ã€‚ private/ : åªèƒ½è¢«æœåŠ¡å™¨ç«¯ä»£ç è·å–ï¼Œå¯ä»¥é€šè¿‡ Assets API è¯»å–ã€‚ï¼ˆä¸å¸¸ç”¨ï¼‰ client/compatibility/ : åªèƒ½è¢«æœåŠ¡å™¨ç«¯ä»£ç è·å–ï¼Œå¯ä»¥é€šè¿‡ Assets API è¯»å–ã€‚ï¼ˆä¸å¸¸ç”¨ï¼‰ lib/ : æ”¾ç½®æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å…±ç”¨çš„ä»£ç ï¼Œæ¯”å¦‚ config.jsã€æ•°æ®åº“æ–‡ä»¶å¤¹ collections/ã€‚ åŠ è½½é¡ºåºï¼ˆäº†è§£å³å¯ï¼‰ åº”ç”¨æ ¹ç›®å½•å†… lib æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶é¦–å…ˆåŠ è½½ã€‚ ç¬¦åˆ main.* è¿™ä¸ªæ ¼å¼çš„æ–‡ä»¶æœ€ååŠ è½½ã€‚ å­ç›®å½•ä¸­çš„æ–‡ä»¶åœ¨æ¯ç›®å½•ä¸­çš„æ–‡ä»¶ä¹‹å‰åŠ è½½ï¼Œå³æœ€æ·±å±‚å­ç›®å½•ä¸­çš„æ–‡ä»¶é¦–å…ˆåŠ è½½ï¼ˆåœ¨ lib ä¹‹åï¼‰ï¼Œæ ¹ç›®å½•çš„æ–‡ä»¶æœ€ååŠ è½½ï¼ˆåœ¨ main.* ä¹‹å‰ï¼‰ã€‚ åŒç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ŒæŒ‰æ–‡ä»¶åçš„å­—æ¯é¡ºåºæ¥åŠ è½½ã€‚ ä¸‰ã€é‡è¦å‚è€ƒèµ„æ–™ å®˜ç½‘ å®˜æ–¹å¿«é€Ÿå…¥é—¨æ•™ç¨‹: å­¦ä¹ ç‚¹è¿™ StackOverflow: ç¢°åˆ°é—®é¢˜ç‚¹è¿™ å®˜æ–¹è®ºå› Github","tags":[{"name":"meteor","slug":"meteor","permalink":"https://buptsteve.github.io/blog/tags/meteor/"}]},{"title":"ã€Œ3ã€å‰ç«¯å¼€å‘åˆ©å™¨ webpack","date":"2015-12-29T07:12:58.000Z","path":"2015/12/29/3.js-webpack/","text":"é›¶ã€å‰è¨€åœ¨ç¼–å†™æ„å»ºå‰ç«¯é¡¹ç›®æ—¶ï¼Œä»¥ä¸‹è¿™äº›éœ€æ±‚æƒ³å¿…ååˆ†å¸¸è§ï¼š html/css/js ä»£ç çš„é¢„ç¼–è¯‘ï¼š Jade, Ejsâ€¦ Sass, Less, Stylusâ€¦ Dart, CoffeeScript, TypeScript, ES6/7â€¦ æ‹¯æ•‘ä½ çš„ F5 æˆ–è€… Command/Ctrl + Rï¼ˆå³è‡ªåŠ¨ç›‘å¬ã€ç¼–è¯‘å¹¶åˆ·æ–°æµè§ˆå™¨ï¼‰ å‘å¸ƒæ—¶çš„ä»£ç å‹ç¼©ã€æ··æ·†ï¼Œå›¾ç‰‡çš„å‹ç¼©å’Œ base64 åµŒå…¥ ä»¥ä¸Šè¿™äº›ã€Œä½“åŠ›â™‚æ´»å„¿ã€æ˜¾ç„¶ä¸èƒ½è‡ªå·±æµªè´¹æ—¶é—´æ‰‹åŠ¨å®Œæˆï¼Œæ‰€ä»¥ä¼˜é›…çš„è§£å†³æ–¹å¼å°±æ˜¯ï¼šè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï½ï¼ è¯è¯´æˆ‘æœ€æ—©äº†è§£åˆ°å‰ç«¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæ˜¯é€šè¿‡æ…•è¯¾ç½‘å­¦ä¹ çš„æ—¶å€™çœ‹åˆ°çš„ grunt æ•™ç¨‹ï¼Œéšæ„æµè§ˆäº†ç‚¹å„¿å‘ç°ä¸Šæ‰‹æœ‰ç‚¹å„¿éš¾ _(:Ğ·ã‚âˆ )_ åŒæ—¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆéœ€æ±‚å°±æ²¡æœ‰å­¦ä¸‹å»ã€‚ ç„¶åå­¦ä¹ äº† less/sass/stylus ç­‰é¢„ç¼–è¯‘è¯­è¨€ï¼Œå…ˆæ˜¯ä½¿ç”¨äº† koala è¿›è¡Œ less æ–‡ä»¶çš„ç¼–è¯‘ã€‚ä¹‹ååˆæœ‰äº†ã€Œæ‹¯æ•‘ F5ã€çš„éœ€æ±‚ï¼Œè§‰å¾—å†ä½¿ç”¨ livereload è¿™æ ·ä¸å¤Ÿç»…å£«(Â´ï½¥Ï‰ï½¥`)ã€‚äºæ˜¯å¼€å§‹å­¦ä¹  gulpï¼Œ gulp æ˜¯åŸºäº Unix çš„å“²â™‚å­¦ï¼Œå³ Do one thing and do it well. ç±»ä¼¼äº Unix çš„ç®¡é“å‘½ä»¤ï¼ˆpipeï¼š| ï¼‰ï¼Œgulp åŸºäº Node.js ä¸­çš„ stream æœºåˆ¶ã€‚Gulp çš„æ¯ä¸ªæ’ä»¶ä» stream ä¸­è¯»å–è¾“å…¥ï¼Œåšä¸€äº›å¤„ç†ï¼Œå†è¾“å‡ºåˆ° stream ä¸­ã€‚åŒæ—¶ä½¿ç”¨ browser-sync æ’ä»¶èƒ½å¤Ÿè§£å†³æˆ‘çš„é‡å¤åˆ·æ–°çš„ç¹é‡åŠ³åŠ¨ã€‚ æ— å¥ˆå‰ç«¯å˜åŒ–å¤ªå¿«_(:Ğ·ã‚âˆ )_ï¼Œä½¿ç”¨ gulp æ²¡å¤šä¹…ã€‚é€šè¿‡ vue.js ä¸€ä¸ª MVVM æ¡†æ¶ï¼ŒçŸ¥é“äº† webpack è¿™ä¸€æ–°çš„å‰ç«¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚ä½¿ç”¨ webpack å¯ä»¥æ–¹ä¾¿åœ°å°† *.vueæ–‡ä»¶ç¼–è¯‘æ‰“åŒ…åˆ°å·¥ç¨‹ä¸­ï¼Œå¹¶ä¸” react çš„å¤§éƒ¨åˆ†é¡¹ç›®ä¹Ÿä½¿ç”¨ webpack è¿›è¡Œæ„å»ºã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œwebpack ç©¶ç«Ÿé ä»€ä¹ˆç«èµ·æ¥äº†å‘¢ï¼Ÿ ä¸€ã€webpack1.1. ä¸ºä»€ä¹ˆé€‰æ‹© webpack ? å‚è€ƒé“¾æ¥a. æ¨¡å—åŒ–é¦–å…ˆè¦æ˜ç¡®ï¼šéšç€å‰ç«¯è¶Šæ¥è¶Šã€Œé‡ã€ï¼Œé¡¹ç›®å˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œå›¢é˜Ÿäººæ•°å¢åŠ ã€åŠŸèƒ½å¢åŠ åœ°è¶Šå¤šï¼ŒåŠ¿å¿…å¼•èµ·å‡ºé”™ã€ä¾èµ–æƒ…å†µçš„å‡ºç°ã€‚é‚£ä¹ˆæƒ³æƒ³æœåŠ¡å™¨ç«¯ã€æ¡Œé¢å¤§å‹ç¨‹åºç­‰æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ ç­”æ¡ˆåªæœ‰ä¸€ä¸ªï¼šæ¨¡å—åŒ–å¼€å‘ï¼ ç„¶è€Œæµè§ˆå™¨æœ¬èº«å¹¶ä¸æä¾›æ¨¡å—ç®¡ç†çš„æœºåˆ¶ï¼ˆES6 ç»ˆäºå¼•å…¥ Moduleï¼‰ï¼Œä¸ºäº†è°ƒç”¨å„ä¸ªæ¨¡å—ï¼Œæœ‰æ—¶ä¸å¾—ä¸åœ¨ç½‘é¡µä¸­ï¼ŒåŠ å…¥ä¸€å¤§å †scriptæ ‡ç­¾ã€‚è¿™æ ·å°±ä½¿å¾—ç½‘é¡µä½“ç§¯è‡ƒè‚¿ï¼Œéš¾ä»¥ç»´æŠ¤ï¼Œè¿˜äº§ç”Ÿå¤§é‡çš„HTTPè¯·æ±‚ï¼Œæ‹–æ…¢æ˜¾ç¤ºé€Ÿåº¦ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚ åœ¨æ­¤å¯¹äºæ¨¡å—åŒ–å°±ä¸ç»§ç»­å±•å¼€äº†â€¦Require.js/Sea.js/Common.js/AMD/CMD/ES6â€¦etc. b. ä»£ç ä¼ è¾“æ˜ç¡®äº†æ¨¡å—åŒ–å¼€å‘è¿™ä¸€å‰æä¹‹åï¼Œé‚£ä¹ˆæ–°çš„é—®é¢˜åˆæ¥äº†â€¦æ¨¡å—åŒ–ä¹‹åçš„æ–‡ä»¶æ€ä¹ˆä»æœåŠ¡å™¨ä¼ é€’åˆ°å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Ÿ æœ‰ä¸¤ç§ã€Œæç«¯ã€çš„æ–¹å¼ï¼š æ¯ä¸€ä¸ªè¯·æ±‚ä¼ é€ä¸€ä¸ªæ¨¡å—ï¼ˆç±»ä¼¼äºä¸€å †çš„ &lt;srcipt&gt; æ ‡ç­¾â€¦ï¼‰ ä¸€ä¸ªè¯·æ±‚ä¼ é€æ‰€æœ‰æ¨¡å—ï¼ˆä¾‹å¦‚ browserify çš„æ‰“åŒ…æ–¹å¼ï¼‰ è¿™ä¸¤ç§æ–¹å¼æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ï¼š ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªæ¨¡å— ä¼˜ç‚¹ï¼šåªåŠ è½½éœ€è¦çš„æ¨¡å—ï¼› ç¼ºç‚¹ï¼šå¤§é‡è¯·æ±‚ä¼šä½¿å¾—å¯åŠ¨ç¼“æ…¢â€¦ ä¸€ä¸ªè¯·æ±‚æ‰€æœ‰æ¨¡å— ä¼˜ç‚¹ï¼šè¯·æ±‚æ•°å°‘ï¼Œç­‰å¾…æ—¶é—´å°‘ï¼› ç¼ºç‚¹ï¼šä¸éœ€è¦çš„æ¨¡å—åŒæ ·è¢«ä¼ é€äº†â€¦ å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹æœ€ä½³å®è·µåº”è¯¥æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼š åœ¨ç¼–è¯‘æ‰€æœ‰æ¨¡å—æ—¶ï¼Œå°†æ¨¡å—ç»†åˆ†æˆä¸ºå¤šä¸ªå°çš„ batches(chunks)ï¼Œäºæ˜¯æˆ‘ä»¬åˆ†è§£å¾—åˆ°äº†è®¸å¤šè¯·æ±‚ã€‚æ¨¡å—çš„ chunks åˆå§‹çŠ¶æ€æ—¶å¹¶æ²¡æœ‰å…¨éƒ¨åŠ è½½ï¼Œåªåœ¨éœ€è¦çš„æ—¶å€™å‘èµ·è¯·æ±‚ã€‚å› æ­¤åˆå§‹è¯·æ±‚ä¸ä¼šåŒ…å«æ‰€æœ‰çš„ä»£ç ï¼Œæ˜¾ç„¶åŠ è½½çš„ä»£ç é‡æ›´å°ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ å…¶ä¸­å…³é”®çš„ã€Œåˆ†å‰²ç‚¹ã€å³ chunks çš„åˆ’åˆ†è¾¹ç•Œï¼Œæ˜¯å–å†³äºå¼€å‘è€…å¹¶ä¸”æ˜¯å¯é€‰çš„ã€‚ c. æ¨¡å—çƒ­æ›¿æ¢ï¼ˆHMRï¼‰æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªé‡è¦åŸå› ï¼šwebpack æ”¯æŒæ¨¡å—çƒ­æ›¿æ¢ï¼ˆHMRï¼‰ï¼ˆä¾‹å¦‚ react-hot-loaderï¼‰ é’ˆå¯¹æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°ï¼ŒLiveReload å’Œ Browser-sync æ˜¯ä¸¤æ¬¾å¸¸ç”¨çš„å·¥å…·ï¼Œç„¶è€Œ HMR æ›´è¿›äº†ä¸€æ­¥ã€‚æˆ‘ä»¬çŸ¥é“ React å‡ºç°çš„åŸå› ä¹‹ä¸€å°±æ˜¯ç§¯ç´¯ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­çš„çŠ¶æ€ï¼Œè€Œ HMR èƒ½å¤Ÿåœ¨ä¿®æ”¹ä»£ç ä¿å­˜ä¹‹åä»ç„¶ä¿å­˜ä¹‹å‰çš„çŠ¶æ€ï¼Œå°±æ˜¯ä¿—ç§°çš„ã€Œçƒ­æ›¿æ¢ã€ã€‚ 1.2. æ€ä¹ˆä½¿ç”¨ webpackï¼Ÿäº†è§£äº†ä¸ºä»€ä¹ˆï¼ˆwhyï¼‰ä¹‹åï¼Œæ¥ç€å­¦ä¹ æ€ä¹ˆåšï¼ˆhowï¼‰ã€‚ a. webpack çš„å®‰è£… é¦–å…ˆä½¿ç”¨ npm å…¨å±€å®‰è£… webpackï¼š 1$ npm i(nstall) -g webpack æ¥ç€å±€éƒ¨å®‰è£… webpackï¼š 1$ npm i(nstall) --save-dev webpack b. webpack çš„é…ç½® å®˜æ–¹æ–‡æ¡£ Pete Hunt webpack é…ç½®çš„æœ¬è´¨å°±æ˜¯ï¼šä¸€ä¸ªé…ç½®çš„ Objectã€‚ å› æ­¤æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•é…ç½® webpack: ä¸€ç§æ˜¯ Cliï¼ˆå³ Command Line Interfaceï¼‰æ–¹æ³•ï¼šè¯»å– webpack.config.js æ–‡ä»¶ï¼› å¦ä¸€ç§æ˜¯ Node.js API çš„æ–¹æ³•ï¼šä¼ é€’é…ç½®å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ å‰ç«¯ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸€ç§ï¼Œå³é…ç½® webpack.config.js æ–‡ä»¶ï¼Œç®€å•ä¾‹å­å¦‚ä¸‹ï¼š 1234567// webpack.config.jsmodule.exports = &#123; entry: './main.js', output: &#123; filename: 'bundle.js' &#125;&#125;; å°±æ˜¯è®¾ç½®å…¥å£ã€å‡ºå£æ–‡ä»¶ï¼Œç‚’é¸¡ç®€å•æœ‰æœ¨æœ‰~ æ¥ç€æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›é¢„ç¼–è¯‘å·¥ä½œï¼Œä¾‹å¦‚æŠŠ CoffeeScript æˆ– ES6 çš„ä»£ç ç¼–è¯‘ä¸º ES5 çš„ JavaScriptï¼Œä¾‹å­å¦‚ä¸‹ï¼š 12345678910111213141516// webpack.config.jsmodule.exports = &#123; entry: './main.js', output: &#123; filename: 'bundle.js' &#125;, module: &#123; loaders: [&#123; test: /\\.coffee$/, loader: 'coffee-loader' &#125;, &#123; test: /\\.js$/, loader: 'babel-loader' &#125;] &#125;&#125;; åªéœ€è¦åŠ å…¥ loaderï¼Œloader ä¸­çš„ test è¡¨ç¤ºå“ªäº›æ–‡ä»¶éœ€è¦ç»è¿‡ loader è¿›è¡Œå¤„ç†ã€‚ å¯¹äº css å’Œ å›¾ç‰‡èµ„æºåŒæ ·ä¹Ÿæœ‰ loaderï¼Œè¿™æ ·å°±å¯ä»¥åƒå¼•ç”¨ js ä¸€æ ·åœ¨ä»£ç ä¸­å¼•ç”¨ï¼Œä¾‹å¦‚ï¼š 12345require('./bootstrap.css');require('./myapp.less');var img = document.createElement('img');img.src = require('./glyph.png'); loader çš„ç¼–å†™ç±»ä¼¼äºä¹‹å‰çš„ä¾‹å­ï¼šï¼ˆ!ç”¨äºé“¾å¼æ“ä½œï¼Œä¸”ä»å³å¾€å·¦æ‰§è¡Œï¼‰ 1234567891011121314151617181920212223// webpack.config.jsmodule.exports = &#123; entry: './main.js', output: &#123; path: './build', // This is where images AND js will go publicPath: 'http://mycdn.com/', // This is used to generate URLs to e.g. images filename: 'bundle.js' &#125;, module: &#123; loaders: [&#123; test: /\\.less$/, loader: 'style-loader!css-loader!less-loader' &#125;, // use ! to chain loaders &#123; test: /\\.css$/, loader: 'style-loader!css-loader' &#125;, &#123; test: /\\.(png|jpg)$/, loader: 'url-loader?limit=8192' &#125; // inline base64 URLs for &lt;=8k images, direct URLs for the rest ] &#125;&#125;; last but not the least: æ·»åŠ  webpack-dev-server ä½œä¸ºå®æ—¶ä»£ç æ›´æ–°å®‰è£…å®Œæˆååªéœ€æ·»åŠ ä¸¤è¡Œä»£ç åˆ° webpack.config.js ä¸­ï¼š 123456789module.exports = &#123; ... entry: [ 'webpack-dev-server/client?http://0.0.0.0:8080', 'webpack/hot/only-dev-server', './app/main.js' ], ...&#125;; å¹¶ä¸”åœ¨ package.json ä¸­çš„ scripts æ·»åŠ ä¸€è¡Œä»£ç ï¼š 12345&#123; \"scripts\": &#123; \"dev\": \"webpack-dev-server --devtool eval --progress --colors --hot --content-base build\" &#125;,&#125; è¿™æ ·åœ¨æ—¥å¸¸å¼€å‘ä¸­åªéœ€è¦æ‰§è¡Œï¼š 1$ npm run dev åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:8080 å³å¯çœ‹åˆ°ç¼–è¯‘ç»“æœï¼Œå¹¶ä¸”æ›´æ”¹ä»£ç åèƒ½å¤Ÿè‡ªåŠ¨åˆ·æ–°ã€‚","tags":[{"name":"æ•ˆç‡","slug":"æ•ˆç‡","permalink":"https://buptsteve.github.io/blog/tags/æ•ˆç‡/"},{"name":"webpack","slug":"webpack","permalink":"https://buptsteve.github.io/blog/tags/webpack/"}]},{"title":"ã€Œ2ã€å¦‚ä½•æ­å»ºè‡ªå·±çš„æœåŠ¡å™¨ï¼Ÿ","date":"2015-11-03T05:04:58.000Z","path":"2015/11/03/2.centos-server/","text":"é›¶ã€é—®é¢˜çš„ç”±æ¥ï¼Ÿå¹³æ—¶é€› åŒ—é‚®äººè®ºå› çœ‹åˆ°å„ç§å¤§ç¥åšçš„å„ç§ä½œå“ï¼ŒæŠ€ç—’éš¾è€ï¼Œä¹Ÿæƒ³è‡ªå·±æ£é¼“æ£é¼“ã€å­¦ä¹ æœåŠ¡å™¨ã€‚æ­£å¥½å®éªŒå®¤æœ‰ç©ºé—²ç”µè„‘ï¼Œå°±è‡ªå·±æ­ä¸€ä¸ªç©å„¿å•¦ï½ã€‚åœ¨çº ç»“åŠå¤©ï¼Œçœ‹äº†å¥½å¤šèµ„(si)æ–™(bi)åï¼Œå†³å®šé€‰ç”¨ CentOS ä½œä¸ºæ“ä½œç³»ç»Ÿï¼Œ ä¸»è¦å¼€å‘ç¯å¢ƒä¸º Python å’Œ Node.jsã€‚ ä¸€ã€ç³»ç»Ÿå®‰è£…ï¼ˆæ€ä¹ˆè·å–é•œåƒå°±ä¸èµ˜è¿°äº†ï½ï¼‰ åˆ©ç”¨ ultraISO å°†é•œåƒæ–‡ä»¶æ‹·å…¥ u ç›˜å†… è®¾ç½® BIOSï¼Œä¼˜å…ˆä» u ç›˜å¯åŠ¨ æŒ‰ç…§æ­¥éª¤å®‰è£…â€¦ äºŒã€ç½‘å…³é—®é¢˜ç”±äºåŒ—é‚®æ ¡å†…ä½¿ç”¨ ipv4 æµé‡éœ€è¦ç™»å½•ç½‘å…³ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§æ–¹æ³•ï¼š 2.1. VNCCentOS å¯ä»¥ä½¿ç”¨ tigervncï¼Œä½¿ç”¨ yum å³å¯å®‰è£…ï¼š 12$ yum install tigervnc$ yum install tigervnc-server å®‰è£…å®Œæˆåï¼Œä½¿ç”¨å‘½ä»¤vncserver :n æ‰“å¼€ç›¸åº”ç«¯å£nï¼ˆè¿™é‡Œçš„næ˜¯sessionnumberï¼Œä¸æŒ‡å®šé»˜è®¤ä¸º1ï¼Œä¹Ÿå¯ä»¥æ˜¯2ã€3ç­‰ç­‰ã€‚ç¬¬ä¸€æ¬¡ä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œä»¥åå¯ä»¥ä½¿ç”¨vncpasswdå‘½ä»¤ä¿®æ”¹å¯†ç ã€‚ï¼‰ å½“ç„¶åˆ«å¿˜äº†è®¾ç½® iptablesâ€¦å°ç™½å°± iptables -F å§ ä¹‹åå°±å¯ä»¥ä»æœ¬åœ° vncviewer è¿æ¥å•¦â€¦ 2.2. å‘½ä»¤è¡Œï¼ˆæ¨èï¼‰ç½‘å…³ç™»å½•è¿˜å¯ä»¥ä½¿ç”¨ curl å‘½ä»¤ï¼š ç™»å½•ï¼š 1$ curl -d 'DDDDD=ã€Œä½ çš„å¸å·ã€&amp;upass=ã€Œä½ çš„å¯†ç ã€&amp;AMKKey=' 10.3.8.211 æ³¨é”€ï¼š 1$ curl 10.3.8.211/F.htm è¿˜å¯ä»¥å†™å…¥å‘½ä»¤è¡Œçš„ alias ä¸­ 12345$ vi ~/.bashrc (è¿™é‡Œçœ‹ä½ å…·ä½“ç”¨çš„å•¥)# æ·»åŠ ä»¥ä¸‹ aliasalias ibu='curl -d \"DDDDD=ã€Œä½ çš„å¸å·ã€&amp;upass=ã€Œä½ çš„å¯†ç ã€&amp;AMKKey=\" 10.3.8.211 &amp;&amp; clear'alias obu='curl 10.3.8.211/F.htm &amp;&amp; clear' è¿™æ ·è¦ç™»å½•ç½‘å…³åªéœ€è¦è¾“å…¥ ibuï¼ŒåŒç†é€€å‡ºå°±æ˜¯ obuã€‚ ä¸‰ã€Python 3 ç¯å¢ƒç”±äº CentOS è‡ªå¸¦ Python ä¸º 2.7.5 ç‰ˆæœ¬ï¼ˆæœ€å¥½ä¸è¦å¸è½½ï¼Œå› ä¸ºä¼šè¢« yum ä½¿ç”¨ï¼‰ï¼Œè€Œæˆ‘æ—¥å¸¸ä½¿ç”¨ 3.0+ æ‰€ä»¥éœ€è¦æ›´æ–° Python ç‰ˆæœ¬ã€‚ä¸‹é¢ä»‹ç»ä¸€ç§ä¸¤ä¸ªç¯å¢ƒå…±å­˜çš„æ–¹æ³•ï¼ˆä»¥ 3.5 ç‰ˆæœ¬ä¸ºä¾‹ï¼‰ï¼š 1$ wget https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz ä¸‹è½½ Python 3.5.0 ï¼Œä¹‹åè§£å‹ï¼Œå®‰è£…â€¦ C Complieré—®é¢˜ï¼šåœ¨ä¸Šä¸€æ­¥å®‰è£… Python3 çš„è¿‡ç¨‹ä¸­æ‰§è¡Œ ./configure æ—¶æŠ¥é”™ï¼ŒåŸæ¥æ˜¯æ²¡æœ‰ C Complierâ€¦ 1$ yum install gcc ç»§ç»­å®‰è£… Python3 123$ ./configure --prefix=/opt/python3$ make$ sudo make install éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ 1$ /opt/python3/bin/python3 -V é‡è¦äº‹é¡¹ï¼ ç”±äºæ­¤ç§æ–¹æ³•ä»ä¿ç•™äº†åŸç³»ç»Ÿä¸­çš„ Python2 ï¼Œå› æ­¤åˆ«å¿˜äº†åœ¨è‡ªå·±ç¼–å†™çš„ Python3 è„šæœ¬ä¸­åŠ å…¥ 1#!/opt/python3/bin/python3 å³ï¼Œé€‰æ‹© python3 è¿›è¡Œè§£æã€‚ å››ã€Node.js ç¯å¢ƒ4.1. å®‰è£…æ¨èä½¿ç”¨ nvm è¿›è¡Œå®‰è£…å’Œç‰ˆæœ¬åˆ‡æ¢ã€‚ 4.2. ä»“åº“é—®é¢˜ç”±äº GFW çš„åŸå› ï¼Œå¯èƒ½ä½¿ç”¨è‡ªå¸¦ registry ä¼šå¤ªæ…¢æˆ–è€…å¤±è´¥ï¼Œå› æ­¤å¯ä»¥è¯•è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆ æ¨èä¸€ä¸ªåˆ‡æ¢ä»“åº“çš„ npm åŒ… nrm 1$ npm i(nstall) -g nrm nrm ä½¿ç”¨ä»‹ç»12345678910111213141516// åˆ—å‡ºå¯ç”¨ä»“åº“$ nrm ls* npm ---- https://registry.npmjs.org/ cnpm --- http://r.cnpmjs.org/ taobao - http://registry.npm.taobao.org/ eu ----- http://registry.npmjs.eu/ au ----- http://registry.npmjs.org.au/ sl ----- http://npm.strongloop.com/ nj ----- https://registry.nodejitsu.com/ pt ----- http://registry.npmjs.pt/// åˆ‡æ¢ä»“åº“åˆ° cnpm$ nrm use cnpm Registry has been set to: http://r.cnpmjs.org/ å½“ç„¶å«Œéº»çƒ¦å¯ä»¥ç›´æ¥ç”¨ æ·˜å® npm é•œåƒ 3. åˆ‡æ¢ Node.js ç‰ˆæœ¬ç›´æ¥ä½¿ç”¨ nvm æˆ–è€… tj çš„ä½œå“ n 1$ npm i(nstall) -g n ä½¿ç”¨ä»‹ç»12345678910111213// å®‰è£… 0.8.14/0.8.17/0.9.6 ä¸‰ä¸ªç‰ˆæœ¬çš„ nodejs$ n 0.8.14$ n 0.8.17$ n 0.9.6// é€‰æ‹©ç‰ˆæœ¬ï¼ˆç§»åŠ¨ä¸Šä¸‹ç®­å¤´ï¼Œå›è½¦æˆ–å³é”®å¤´é€‰æ‹©ï¼ŒCtrl+C å–æ¶ˆï¼‰$ n 0.8.14Î¿ 0.8.17 0.9.6// åˆ é™¤ 0.9.4 ç‰ˆæœ¬$ n - 0.9.4","tags":[{"name":"Linux","slug":"Linux","permalink":"https://buptsteve.github.io/blog/tags/Linux/"},{"name":"Server","slug":"Server","permalink":"https://buptsteve.github.io/blog/tags/Server/"},{"name":"Python","slug":"Python","permalink":"https://buptsteve.github.io/blog/tags/Python/"},{"name":"Node.js","slug":"Node-js","permalink":"https://buptsteve.github.io/blog/tags/Node-js/"}]},{"title":"ã€Œ1ã€ä¼˜é›…åœ°æ‰“å¼€è½¯ä»¶æ˜¯æ€æ ·çš„ä½“éªŒï¼Ÿ","date":"2015-11-01T11:04:58.000Z","path":"2015/11/01/1.the-way-to-open-software/","text":"é›¶ã€é—®é¢˜çš„ç”±æ¥ä¸çŸ¥é“å¤§å®¶å¹³æ—¶æ˜¯æ€ä¹ˆæ‰“å¼€å¸¸ç”¨è½¯ä»¶çš„ï¼š 1. windows ç”¨æˆ· ä»æ¡Œé¢ä¸Šä¸€å †æ‚ä¹±çš„æ–‡ä»¶ä¸­æ‰¾åˆ°å¿«æ·æ–¹å¼åŒå‡»æ‰“å¼€ï¼Ÿ ä»æ¡Œé¢ä¸Šåˆ†ç±»æ•´ç†å¥½çš„æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å¿«æ·æ–¹å¼åŒå‡»æ‰“å¼€ï¼Ÿ æˆ–æ˜¯æ›´è¿›ä¸€æ­¥åœ°åˆ©ç”¨ Fences ä»æ¡Œé¢é€‰æ‹©ï¼Ÿ åˆ©ç”¨ Everything è¿›è¡Œæ–‡ä»¶åæœç´¢ï¼Ÿ win8ä¸‹çš„ Metroï¼Œwin10ä¸‹çš„ blablablaâ€¦ 2. OS X ç”¨æˆ· é€šè¿‡åœ¨ Dock ä¸­å¯»æ‰¾åï¼Œå•å‡»æ‰“å¼€ï¼Ÿ é€šè¿‡æ‹‡æŒ‡ä¸å…¶ä»–ä¸‰ä¸ªæ‰‹æŒ‡åˆæ‹¢è¿›å…¥ Launchpad åï¼Œå•å‡»æ‰“å¼€ï¼Ÿ åˆ©ç”¨è‡ªå¸¦çš„ spotlight æˆ–è€… alfred ç­‰å·¥å…·è¾“å…¥è½¯ä»¶åæ‰“å¼€ï¼Ÿ é€šè¿‡ç»ˆç«¯â€¦ 3. linux ç”¨æˆ· é€šè¿‡ç»ˆç«¯â€¦ è¦å•¥è‡ªè¡Œè½¦â€¦â•®(â•¯â–½â•°)â•­â€¦ (æ‰ä¸ä¼šå‘Šè¯‰ä½ æ˜¯å› ä¸ºæˆ‘ä¸é€ å‘¢â€¦) ä¸€ã€æˆ‘çš„é€‰æ‹© (ç§ã®choice)1.1. OS X ä¸‹é€šè¿‡ ctrl + space å”¤èµ· alfred ï¼Œä¹‹åè¾“å…¥è½¯ä»¶ç¼©å†™ï¼Œç‚¹å‡»å›è½¦æˆ– cmd + næ‰“å¼€è½¯ä»¶ã€‚(btw å¯ä»¥å°† Application ä¸­çš„å„ä¸ª app çš„åå­—é‡æ–°å‘½åç¼©å†™è¿‡ï¼Œæ¯”å¦‚å°† ç½‘æ˜“äº‘éŸ³ä¹ ç¼©å†™æˆ wyy) 1.2. windows ä¸‹1.2.1. è‡ªå¸¦çš„è¿è¡Œå°±æ˜¯é‚£ä¸ª win + r ï¼Œä¸è¿‡ä¸ºäº†ä¿æŒä¸ OS X æ“ä½œçš„ä¸€è‡´æ€§åˆ©ç”¨äº†AutoHotkey å°†å…¶ç»Ÿä¸€ä¿®æ”¹ä¸º ctrl + spaceã€‚ å…·ä½“çš„é…ç½®æ–‡ä»¶æ˜¯ ç‚¹æˆ‘ ä¸­çš„ autohotkey/steve.ahk 1.2.2. ç„¶åå‘¢ï¼Ÿè¿˜éœ€è¦2æ­¥è®¾ç½®ï¼š(å±…ç„¶æ¯”æŠŠå¤§è±¡æ”¾å†°ç®±è¿˜å°‘ä¸€æ­¥å•Šå–‚ï¼) å°† (æ¡Œé¢ä¸Šæˆ–è€…å…¶ä»–åœ°æ–¹çš„) è½¯ä»¶å¿«æ·æ–¹å¼æ”¹åç¼©å†™æˆ2~3ä¸ªå­—æ¯ æŠŠè¯¥å¿«æ·æ–¹å¼ duangï½ åœ°ä¸€å£°å‰ªåˆ‡åˆ° C:\\Windows ä¸‹ï¼Œæå®šæ”¶å·¥ï½=ï¿£Ï‰ï¿£=ï½ ä¸è¿‡æœ‰çš„è½¯ä»¶æ¯”å¦‚ Github.appref-ms è¿™ç§æ ¼å¼çš„å°±æ²¡åŠæ³•é€šè¿‡ä»¥ä¸Šæ–¹æ³•å¿«é€Ÿæ‰“å¼€äº†ã€‚è¿™æ—¶å€™å°±åˆè¦æ¨èä¸€ä¸ªå¥½ç”¨è½¯ä»¶å•¦ï¼šRolanï¼Œå°†å¿«æ·æ–¹å¼æˆ–å…¶ä»–çš„æ–‡ä»¶/æ–‡ä»¶å¤¹æ‹–è¿›å»å°±okã€‚è¦ä½¿ç”¨çš„æ—¶å€™å°±é€šè¿‡å¿«æ·é”®å‘¼å«å‡º Rolan åå³å¯æ‰“å¼€ã€‚ äºŒã€ç»¼ä¸Šæ— è®ºä½•æ—¶ï¼Œæ— è®ºå½“å‰å±‚å äº†å¤šå°‘çª—å£â€¦åªéœ€è¦: æŒ‰ä¸‹ Ctrl + Space è¾“å…¥ç¼©å†™è¿‡çš„ 2~3 ä¸ªå­—æ¯çš„è½¯ä»¶åç§° æŒ‰ä¸‹ Enter ç¡®è®¤ Duangï½ä¸€ä¸‹å°±ä¼˜é›…åœ°æŠŠè½¯ä»¶æ‰“å¼€äº†~\\(â‰§â–½â‰¦)/~","tags":[{"name":"æ•ˆç‡","slug":"æ•ˆç‡","permalink":"https://buptsteve.github.io/blog/tags/æ•ˆç‡/"}]},{"title":"ã€Œ0ã€Hello World","date":"2015-10-29T11:04:58.000Z","path":"2015/10/29/0.hello-world/","text":"é›¶ã€Blogçš„ç”±æ¥ä½œä¸ºä¸€ä¸ªå­¦è®¡ç®—æœºçš„ï¼Œä¸€ç›´æƒ³æ•´ä¸ªè‡ªå·±çš„ Blogï¼Œå°¤å…¶æ˜¯æœ€è¿‘åœ¨æå‰ç«¯ã€‚å…ˆæ˜¯çœ‹åˆ° jekyll æ„Ÿè§‰ä¸é”™ï¼ŒæŠ˜è…¾äº†åŠå¤©æ„Ÿè§‰è¿˜æ˜¯ä¸å¤Ÿç»™åŠ›ã€‚æœ€åè¿˜æ˜¯é€‰æ‹©äº† hexo3ã€‚ ä¸»è¦æ˜¯è¿™å‡ ä¸ªä¼˜ç‚¹å§ï¼š å…è´¹â•®(â•¯â–½â•°)â•­ åŸºäº Node.js é€Ÿåº¦å¿«ã€æ“ä½œæ›´ç®€å•ã€å‘½ä»¤å°‘ï¼Œä¸“æ³¨äºå†™ä½œæœ¬èº« ç”±äº deploy å‘½ä»¤ï¼Œå‘å¸ƒåˆ° github ä¸Šç”Ÿæˆé™æ€ç«™ç‚¹ä¹Ÿå¾ˆç®€å• æ‰€ä»¥æ•´ä¸ª Blog å°±æ˜¯é‡‡ç”¨ hexo3 + github pages,ä¸»é¢˜åŸºäº indigo è¿›è¡Œä¿®æ”¹ï¼Œä¸‹é¢å°±è¯¦ç»†è¯´è¯´æ€ä¹ˆæ­èµ·æ¥å§â€¦ ä¸€ã€hexoçš„å®‰è£…é¦–å…ˆç”±äº hexo æ˜¯åŸºäº Node.js å¼€å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¦å®‰è£… Node.js ç¯å¢ƒï¼Œè¿›å…¥Node.jså®˜ç½‘ï¼Œä¸€èˆ¬ä¼šå‘ç°æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šLTS å’Œ Stableã€‚ è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„åŒºåˆ«åœ¨äºä¸€ä¸ªæ˜¯ LTS é•¿æœŸæ”¯æŒç‰ˆï¼ˆä¹Ÿæ˜¯æ¨èé€‰é¡¹ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯æ‹¥æœ‰æœ€æ–°åŠŸèƒ½çš„ç¨³å®šç‰ˆï¼ˆé€‚åˆæœ‰æ–°åŠŸèƒ½éœ€æ±‚çš„å°é²œç”¨æˆ·ï¼‰ã€‚ å®‰è£…å®Œæˆåï¼Œåœ¨å‘½ä»¤è¡Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå…¶ä¸­æ‹¬å·çš„æ„æ€æ˜¯ install å¯ä»¥ç¼©å†™ä¸º iï¼‰ï¼š 1$ npm i(nstall) -g hexo npm å®‰è£…æ–¹å¼ä¸­ -g çš„æ„æ€æ˜¯å…¨å±€å®‰è£…ã€‚ äºŒã€åˆä½“éªŒ~2.1. ç”Ÿæˆé¡¹ç›®æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œåˆ›å»ºæˆ‘ä»¬çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼š ä¸€èˆ¬çš„ç”¨æˆ·ï¼šè‡ªå·±å›¾å½¢ç•Œé¢æ–°å»ºäº†ä¸€ä¸ª,ç„¶åç‚¹è¿›å» å‘½ä»¤è¡Œç”¨æˆ·ï¼šmkdir &lt;folder&gt; &amp;&amp; cd &lt;folder&gt; hexoçš„ç”¨æˆ·ï¼šhexo init &lt;folder&gt; &amp;&amp; cd &lt;folder&gt; 2.2. å®‰è£…ä¾èµ–1$ npm i(nstall) npm å°±ä¼šè‡ªåŠ¨æ ¹æ® package.json ä¸­çš„é…ç½®è‡ªåŠ¨è¿›è¡Œå®‰è£… 2.3. è¿è¡Œé¢„è§ˆ12$ hexo g(enerate)$ hexo s(erver) å¦‚æœè¿™æ­¥æŠ¥é”™ä¸€èˆ¬æ˜¯å› ä¸ºæ²¡è£… hexo-serverï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…å³å¯ï¼š 1$ npm i(nstall) --save hexo-server npm å®‰è£…æ–¹å¼ä¸­ â€“save çš„æ„æ€æ˜¯ä½œä¸ºé¡¹ç›®ä¾èµ–(dependencies)è¿›è¡Œå®‰è£…ï¼Œå¯ä»¥ç¼©å†™ä¸º -S (æ³¨æ„å¤§å†™)æ­¤å¤–è¿˜æœ‰ â€“save-dev çš„æ„æ€æ˜¯ä½œä¸ºé¡¹ç›®çš„ã€Œå¼€å‘ã€ä¾èµ–(devDependencies)è¿›è¡Œå®‰è£…ï¼Œå¯ä»¥ç¼©å†™ä¸º -D (æ³¨æ„å¤§å†™)è¿™ä¸¤ç§å®‰è£…æ–¹å¼éƒ½ä¼šå°†è¿™ä¸ªåŒ…çš„åç§°å’Œç‰ˆæœ¬å†™è¿› package.json é…ç½®æ–‡ä»¶ä¸­ æœ€åæ‰“å¼€æµè§ˆå™¨è¾“å…¥http://localhost:4000å°±å¯ä»¥çœ‹åˆ°é¡µé¢å•¦ï½ ä¸‰ã€æ¢ä¸»é¢˜ï¼ˆthemeï¼‰ç„¶è€Œåªæ˜¯ä½¿ç”¨é»˜è®¤çš„ä¸»é¢˜ï¼ˆthemeï¼‰æ€ä¹ˆä¼šæœ‰é€¼æ ¼â†’_â†’ï¼Œæœæ–­è¦æ•´ä¸€ä¸ªåŠç‚¸å¤©çš„ä¸»é¢˜å‘€~ï¼Œä¸‹é¢ä»¥ indigo ä¸ºä¾‹ä½œä¸ºè¯´æ˜ã€‚ 3.1. ä¸‹è½½ä¸»é¢˜é¦–å…ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆå°±æ˜¯è¯´æœ‰ä¸ª themes çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†ä¸»é¢˜ä¸‹è½½åˆ° themes æ–‡ä»¶å¤¹ä¸‹çš„ indigo æ–‡ä»¶å¤¹ä¸­ã€‚ 1$ git clone https://github.com/yscoder/hexo-theme-indigo themes/indigo 3.2. é…ç½®ä½¿ç”¨ä¸»é¢˜æ¥ç€ä¿®æ”¹ _config.ymlï¼ˆé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯ä¸»é¢˜çš„ï¼‰ å°† theme æ”¹ä¸º indigo å››ã€éƒ¨ç½²åˆ° github pages4.1. å®‰è£… hexo-deployer-git1$ npm i(nstall) hexo-deployer-git --save 4.2. å…³äº github pages4.2.1. åˆ†ç±»1. é¡¹ç›®ç«™ç‚¹ï¼ˆProject Pagesï¼‰github ä¼šæ ¹æ® gh-pages åˆ†æ”¯ä¸‹æ–‡ä»¶ç”Ÿæˆé™æ€é¡µé¢ï¼Œåœ°å€æ˜¯ [yourName].github.io/[projectName]ã€‚ï¼ˆ[yourName] æ˜¯ä½ çš„è´¦æˆ·åï¼Œ[projectName] æ˜¯ä½ çš„é¡¹ç›®åï¼‰ 2. ä¸ªäººæˆ–å…¬å¸ç«™ç‚¹ï¼ˆUser/Organization Pagesï¼‰é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªå«åš [yourName].github.io çš„é¡¹ç›®ï¼Œæ¥ç€ github ä¼šæ ¹æ® master åˆ†æ”¯ä¸‹æ–‡ä»¶ç”Ÿæˆé™æ€é¡µé¢ï¼Œåœ°å€æ˜¯ [yourName].github.io/ã€‚ 4.2.2. ä¸€äº›å‘â€¦ æœ‰çš„ä¸»é¢˜ä¸­å„ç§é™æ€æ–‡ä»¶è·¯å¾„æ˜¯å†™æ­»çš„ï¼Œæ¯”å¦‚å¥½å¤šä¸»é¢˜ä¸­çš„æ–‡ä»¶å¼•å…¥æ˜¯é’ˆå¯¹ç¬¬äºŒç±»é¡µé¢å†™æ­»çš„ã€‚ æœ‰äº›ä¸»é¢˜ä¸­çš„ CDN èµ„æºè¢«å¢™ï¼Œé‚£å°±éœ€è¦æ‰¾åˆ°è¿™äº›æ–‡ä»¶æ‰‹åŠ¨ä¿®æ”¹åœ°å€â•®(â•¯â–½â•°)â•­ã€‚ 4.3. ä¿®æ”¹ _config.yml æ–‡ä»¶å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯è¿™ä¹ˆä»‹ç»çš„ 1234567891011121314# You can use this:deploy: type: git repo: &lt;repository url&gt; branch: [branch] message: [message]# or this:deploy: type: git message: [message] repo: github: &lt;repository url&gt;,[branch] gitcafe: &lt;repository url&gt;,[branch] 123* repo: Repository URL* branch: Git branch to deploy the static site to* message: Commit message. The default commit message is Site updated: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;. æ ¹æ® 4.2. æ‰€è¿°ï¼Œéƒ¨ç½²éƒ¨åˆ†çš„å¡«å†™ä¹Ÿåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š 1. ä¸ªäººæˆ–å…¬å¸ç«™ç‚¹ repoï¼šå¡«å†™é¡¹ç›®åœ°å€ï¼Œä¾‹å¦‚ `git@github.com:BuptStEve/BuptStEve.github.io.git` branchï¼šå¡«å†™ master 2. é¡¹ç›®ç«™ç‚¹ repoï¼šå¡«å†™é¡¹ç›®åœ°å€ï¼Œä¾‹å¦‚ `git@github.com:BuptStEve/blog.git` branchï¼šå¡«å†™ gh-pages urlï¼šhttps://buptsteve.github.io/blog/ ï¼ˆæ³¨æ„æœ€åçš„ /ï¼‰ rootï¼š/blog/ ï¼ˆæ³¨æ„æœ€åçš„ /ï¼‰ 4.4. å¼€å§‹éƒ¨ç½²é¦–å…ˆç”Ÿæˆç«™ç‚¹æ–‡ä»¶ 1$ hexo g æ¥ç€å‘å¸ƒ 1$ hexo d(eploy) æœ€åæ‰“å¼€å¯¹åº”åœ°å€å°±å¯ä»¥çœ‹åˆ°è‡ªå·±çš„åšå®¢å•¦ï½=ï¿£Ï‰ï¿£=ï½ã€‚","tags":[{"name":"hexo","slug":"hexo","permalink":"https://buptsteve.github.io/blog/tags/hexo/"}]}]